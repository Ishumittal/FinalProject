import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { NxDynamicTableDataSource } from './dynamic-table.models';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/table";
import * as i2 from "@angular/common";
export class NxDynamicTableComponent {
    constructor(_cdr) {
        this._cdr = _cdr;
        this._dataChange = new BehaviorSubject([]);
        this._data = [];
        this._columnKeys = [];
        /** An event is dispatched when a row is clicked. */
        this.nxRowClick = new EventEmitter();
    }
    /** Sets the data that it will show in the table. */
    set data(value) {
        this._data = value.filter(element => element);
        // If user dont pass displayedColumns the table will show all data and the name of columns will be the key of data
        if (!this._displayedColumns) {
            const keys = [], cArray = [];
            // For catch keys of data Objects and assing title, key and type string by default to displayedColumns
            this._data.forEach(element => {
                for (const key in element) {
                    if (!keys.includes(key)) {
                        keys.push(key);
                        cArray.push({ title: key, key, type: 'string' });
                    }
                }
            });
            this._columnKeys = keys;
            this._displayedColumns = cArray;
            // need to call markForCheck as the setter changes displayedColumns here
            // sidenote: isn't needed for the data itself as it gets passed to the cdk-table
            // by the datasource observable
            this._cdr.markForCheck();
        }
        this._dataChange.next(this._data);
    }
    get data() {
        return this._data;
    }
    /** Sets the name order and type of columns. */
    set displayedColumns(value) {
        this._displayedColumns = value;
        this._columnKeys = value ? value.map(column => column.key) : [];
        this._cdr.markForCheck();
    }
    get displayedColumns() {
        return this._displayedColumns;
    }
    /** @docs-private */
    get dataSource() {
        return this._dataSource;
    }
    /** @docs-private */
    get columnKeys() {
        return this._columnKeys;
    }
    ngOnInit() {
        if (!this._data) {
            this._data = [];
            this._dataChange.next(this._data);
        }
        this._dataSource = new NxDynamicTableDataSource(this._dataChange);
    }
    /** @docs-private */
    handleRowClick(row) {
        this.nxRowClick.emit(row);
    }
    /** @docs-private */
    isNumeric(column) {
        return column.type === 'numeric';
    }
}
NxDynamicTableComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxDynamicTableComponent, deps: [{ token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
NxDynamicTableComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxDynamicTableComponent, selector: "nx-dynamic-table", inputs: { data: ["nxData", "data"], displayedColumns: ["nxDisplayedColumns", "displayedColumns"] }, outputs: { nxRowClick: "nxRowClick" }, ngImport: i0, template: "<div class=\"nx-table__container\" *ngIf=\"data && data.length > 0\">\n    <div class=\"nx-table__scroll\">\n        <cdk-table [dataSource]=\"dataSource\" class=\"nx-table\">\n            <!-- Column Definitions -->\n            <ng-container *ngFor=\"let column of displayedColumns\" cdkColumnDef=\"{{ column.key }}\">\n                <cdk-header-cell\n                    *cdkHeaderCellDef\n                    class=\"nx-table__header-cell\"\n                    [ngClass]=\"[column.headerCellClass ?? '', isNumeric(column) ? 'nx-table__header-cell--number' : '']\"\n                    [ngStyle]=\"column.headerCellStyle || null\"\n                    ><div class=\"nx-table__header-title--block\">\n                        <span class=\"nx-table__header-title\">{{ column.title }}</span>\n                    </div>\n                </cdk-header-cell>\n                <cdk-cell\n                    *cdkCellDef=\"let row\"\n                    class=\"nx-table__cell\"\n                    [ngClass]=\"[column.cellClass ?? '', isNumeric(column) ? 'nx-table__cell--number' : '']\"\n                    [ngStyle]=\"column.cellStyle ?? null\"\n                    [innerHTML]=\"row[column.key]\"\n                ></cdk-cell>\n            </ng-container>\n\n            <!-- Header and Row Declarations -->\n            <cdk-header-row *cdkHeaderRowDef=\"columnKeys\" class=\"nx-table__header-row\"></cdk-header-row>\n            <cdk-row *cdkRowDef=\"let row; columns: columnKeys\" class=\"nx-table__row\" (dblclick)=\"handleRowClick(row)\"></cdk-row>\n        </cdk-table>\n    </div>\n</div>\n<div class=\"nx-table__appendix\" *ngIf=\"data.length === 0\">\n    <ng-content></ng-content>\n</div>\n", styles: [".nx-table{font-size:var(--table-cell-font-size);line-height:var(--table-cell-line-height);font-weight:var(--table-cell-font-weight);letter-spacing:var(--table-cell-letter-spacing);color:var(--table-cell-color);text-align:left;width:100%;display:table}:host-context([dir=rtl]) .nx-table{text-align:right}.nx-table__scroll{max-width:100%;overflow:hidden;overflow-x:auto}.nx-table__header-cell{font-size:var(--table-header-cell-font-size);line-height:var(--table-header-cell-line-height);font-weight:var(--table-header-cell-font-weight);letter-spacing:var(--table-header-cell-letter-spacing);color:var(--table-header-cell-color);background:var(--table-header-cell-background-color);border-top:1px solid var(--table-cell-border-top-color);border-bottom:2px solid var(--table-header-border-bottom-color);padding:23px 16px 22px;position:relative}.nx-table__header-cell--number{display:flex;position:relative}.nx-table__header-cell--number .nx-table__header-title--block{justify-content:flex-end}.nx-table__cell--number,.nx-table__header-cell--number{text-align:right}:host-context([dir=rtl]) .nx-table__cell--number,:host-context([dir=rtl]) .nx-table__header-cell--number{text-align:left}.nx-table__header-row,.nx-table__row{display:table-row;vertical-align:inherit;background-color:transparent}.nx-table__row{background:var(--table-row-background-color)}.nx-table__cell{border-bottom:1px solid var(--table-header-border-top-color);padding:24px 16px 23px;vertical-align:top}.nx-table__row:last-child .nx-table__cell{padding-bottom:22px;border-bottom:2px solid var(--table-header-border-bottom-color)}.nx-table__header-cell,.nx-table__cell{display:table-cell;vertical-align:inherit}\n"], components: [{ type: i1.CdkTable, selector: "cdk-table, table[cdk-table]", inputs: ["trackBy", "dataSource", "multiTemplateDataRows", "fixedLayout"], outputs: ["contentChanged"], exportAs: ["cdkTable"] }, { type: i1.CdkHeaderRow, selector: "cdk-header-row, tr[cdk-header-row]" }, { type: i1.CdkRow, selector: "cdk-row, tr[cdk-row]" }], directives: [{ type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i1.CdkColumnDef, selector: "[cdkColumnDef]", inputs: ["sticky", "cdkColumnDef", "stickyEnd"] }, { type: i1.CdkHeaderCellDef, selector: "[cdkHeaderCellDef]" }, { type: i1.CdkHeaderCell, selector: "cdk-header-cell, th[cdk-header-cell]" }, { type: i2.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i2.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { type: i1.CdkCellDef, selector: "[cdkCellDef]" }, { type: i1.CdkCell, selector: "cdk-cell, td[cdk-cell]" }, { type: i1.CdkHeaderRowDef, selector: "[cdkHeaderRowDef]", inputs: ["cdkHeaderRowDef", "cdkHeaderRowDefSticky"] }, { type: i1.CdkRowDef, selector: "[cdkRowDef]", inputs: ["cdkRowDefColumns", "cdkRowDefWhen"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxDynamicTableComponent, decorators: [{
            type: Component,
            args: [{ selector: 'nx-dynamic-table', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"nx-table__container\" *ngIf=\"data && data.length > 0\">\n    <div class=\"nx-table__scroll\">\n        <cdk-table [dataSource]=\"dataSource\" class=\"nx-table\">\n            <!-- Column Definitions -->\n            <ng-container *ngFor=\"let column of displayedColumns\" cdkColumnDef=\"{{ column.key }}\">\n                <cdk-header-cell\n                    *cdkHeaderCellDef\n                    class=\"nx-table__header-cell\"\n                    [ngClass]=\"[column.headerCellClass ?? '', isNumeric(column) ? 'nx-table__header-cell--number' : '']\"\n                    [ngStyle]=\"column.headerCellStyle || null\"\n                    ><div class=\"nx-table__header-title--block\">\n                        <span class=\"nx-table__header-title\">{{ column.title }}</span>\n                    </div>\n                </cdk-header-cell>\n                <cdk-cell\n                    *cdkCellDef=\"let row\"\n                    class=\"nx-table__cell\"\n                    [ngClass]=\"[column.cellClass ?? '', isNumeric(column) ? 'nx-table__cell--number' : '']\"\n                    [ngStyle]=\"column.cellStyle ?? null\"\n                    [innerHTML]=\"row[column.key]\"\n                ></cdk-cell>\n            </ng-container>\n\n            <!-- Header and Row Declarations -->\n            <cdk-header-row *cdkHeaderRowDef=\"columnKeys\" class=\"nx-table__header-row\"></cdk-header-row>\n            <cdk-row *cdkRowDef=\"let row; columns: columnKeys\" class=\"nx-table__row\" (dblclick)=\"handleRowClick(row)\"></cdk-row>\n        </cdk-table>\n    </div>\n</div>\n<div class=\"nx-table__appendix\" *ngIf=\"data.length === 0\">\n    <ng-content></ng-content>\n</div>\n", styles: [".nx-table{font-size:var(--table-cell-font-size);line-height:var(--table-cell-line-height);font-weight:var(--table-cell-font-weight);letter-spacing:var(--table-cell-letter-spacing);color:var(--table-cell-color);text-align:left;width:100%;display:table}:host-context([dir=rtl]) .nx-table{text-align:right}.nx-table__scroll{max-width:100%;overflow:hidden;overflow-x:auto}.nx-table__header-cell{font-size:var(--table-header-cell-font-size);line-height:var(--table-header-cell-line-height);font-weight:var(--table-header-cell-font-weight);letter-spacing:var(--table-header-cell-letter-spacing);color:var(--table-header-cell-color);background:var(--table-header-cell-background-color);border-top:1px solid var(--table-cell-border-top-color);border-bottom:2px solid var(--table-header-border-bottom-color);padding:23px 16px 22px;position:relative}.nx-table__header-cell--number{display:flex;position:relative}.nx-table__header-cell--number .nx-table__header-title--block{justify-content:flex-end}.nx-table__cell--number,.nx-table__header-cell--number{text-align:right}:host-context([dir=rtl]) .nx-table__cell--number,:host-context([dir=rtl]) .nx-table__header-cell--number{text-align:left}.nx-table__header-row,.nx-table__row{display:table-row;vertical-align:inherit;background-color:transparent}.nx-table__row{background:var(--table-row-background-color)}.nx-table__cell{border-bottom:1px solid var(--table-header-border-top-color);padding:24px 16px 23px;vertical-align:top}.nx-table__row:last-child .nx-table__cell{padding-bottom:22px;border-bottom:2px solid var(--table-header-border-bottom-color)}.nx-table__header-cell,.nx-table__cell{display:table-cell;vertical-align:inherit}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }]; }, propDecorators: { data: [{
                type: Input,
                args: ['nxData']
            }], displayedColumns: [{
                type: Input,
                args: ['nxDisplayedColumns']
            }], nxRowClick: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy10YWJsZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1hcXVpbGEvc3JjL2R5bmFtaWMtdGFibGUvZHluYW1pYy10YWJsZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1hcXVpbGEvc3JjL2R5bmFtaWMtdGFibGUvZHluYW1pYy10YWJsZS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsdUJBQXVCLEVBQXFCLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzSCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRXZDLE9BQU8sRUFBa0Msd0JBQXdCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQzs7OztBQVFsRyxNQUFNLE9BQU8sdUJBQXVCO0lBNkRoQyxZQUFvQixJQUF1QjtRQUF2QixTQUFJLEdBQUosSUFBSSxDQUFtQjtRQTVEbkMsZ0JBQVcsR0FBMkIsSUFBSSxlQUFlLENBQVEsRUFBRSxDQUFDLENBQUM7UUFFckUsVUFBSyxHQUFVLEVBQUUsQ0FBQztRQUVsQixnQkFBVyxHQUFhLEVBQUUsQ0FBQztRQTJDbkMsb0RBQW9EO1FBQzFDLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBWUksQ0FBQztJQXREL0Msb0RBQW9EO0lBQ3BELElBQ0ksSUFBSSxDQUFDLEtBQVk7UUFDakIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDOUMsa0hBQWtIO1FBQ2xILElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUU7WUFDekIsTUFBTSxJQUFJLEdBQWEsRUFBRSxFQUNyQixNQUFNLEdBQVUsRUFBRSxDQUFDO1lBQ3ZCLHNHQUFzRztZQUN0RyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtnQkFDekIsS0FBSyxNQUFNLEdBQUcsSUFBSSxPQUFPLEVBQUU7b0JBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFO3dCQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO3dCQUNmLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztxQkFDcEQ7aUJBQ0o7WUFDTCxDQUFDLENBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1lBQ3hCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxNQUFNLENBQUM7WUFDaEMsd0VBQXdFO1lBQ3hFLGdGQUFnRjtZQUNoRiwrQkFBK0I7WUFDL0IsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztTQUM1QjtRQUNELElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBQ0QsSUFBSSxJQUFJO1FBQ0osT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ3RCLENBQUM7SUFFRCwrQ0FBK0M7SUFDL0MsSUFDSSxnQkFBZ0IsQ0FBQyxLQUFtRDtRQUNwRSxJQUFJLENBQUMsaUJBQWlCLEdBQUcsS0FBeUMsQ0FBQztRQUNuRSxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ2hFLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDN0IsQ0FBQztJQUNELElBQUksZ0JBQWdCO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDO0lBQ2xDLENBQUM7SUFLRCxvQkFBb0I7SUFDcEIsSUFBSSxVQUFVO1FBQ1YsT0FBTyxJQUFJLENBQUMsV0FBdUMsQ0FBQztJQUN4RCxDQUFDO0lBRUQsb0JBQW9CO0lBQ3BCLElBQUksVUFBVTtRQUNWLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQztJQUM1QixDQUFDO0lBSUQsUUFBUTtRQUNKLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ2IsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3JDO1FBQ0QsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLHdCQUF3QixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUN0RSxDQUFDO0lBRUQsb0JBQW9CO0lBQ3BCLGNBQWMsQ0FBQyxHQUFXO1FBQ3RCLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFRCxvQkFBb0I7SUFDcEIsU0FBUyxDQUFDLE1BQXNDO1FBQzVDLE9BQU8sTUFBTSxDQUFDLElBQUksS0FBSyxTQUFTLENBQUM7SUFDckMsQ0FBQzs7b0hBL0VRLHVCQUF1Qjt3R0FBdkIsdUJBQXVCLG1NQ1hwQywwcURBZ0NBOzJGRHJCYSx1QkFBdUI7a0JBTm5DLFNBQVM7K0JBQ0ksa0JBQWtCLG1CQUVYLHVCQUF1QixDQUFDLE1BQU07d0dBWTNDLElBQUk7c0JBRFAsS0FBSzt1QkFBQyxRQUFRO2dCQStCWCxnQkFBZ0I7c0JBRG5CLEtBQUs7dUJBQUMsb0JBQW9CO2dCQVdqQixVQUFVO3NCQUFuQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgTnhEeW5hbWljVGFibGVDb2x1bW5EZWZpbml0aW9uLCBOeER5bmFtaWNUYWJsZURhdGFTb3VyY2UgfSBmcm9tICcuL2R5bmFtaWMtdGFibGUubW9kZWxzJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdueC1keW5hbWljLXRhYmxlJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vZHluYW1pYy10YWJsZS5jb21wb25lbnQuaHRtbCcsXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gICAgc3R5bGVVcmxzOiBbJy4vZHluYW1pYy10YWJsZS5jb21wb25lbnQuc2NzcyddLFxufSlcbmV4cG9ydCBjbGFzcyBOeER5bmFtaWNUYWJsZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgcHJpdmF0ZSBfZGF0YUNoYW5nZTogQmVoYXZpb3JTdWJqZWN0PGFueVtdPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55W10+KFtdKTtcbiAgICBwcml2YXRlIF9kYXRhU291cmNlITogTnhEeW5hbWljVGFibGVEYXRhU291cmNlIHwgbnVsbDtcbiAgICBwcml2YXRlIF9kYXRhOiBhbnlbXSA9IFtdO1xuICAgIHByaXZhdGUgX2Rpc3BsYXllZENvbHVtbnMhOiBOeER5bmFtaWNUYWJsZUNvbHVtbkRlZmluaXRpb25bXTtcbiAgICBwcml2YXRlIF9jb2x1bW5LZXlzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgLyoqIFNldHMgdGhlIGRhdGEgdGhhdCBpdCB3aWxsIHNob3cgaW4gdGhlIHRhYmxlLiAqL1xuICAgIEBJbnB1dCgnbnhEYXRhJylcbiAgICBzZXQgZGF0YSh2YWx1ZTogYW55W10pIHtcbiAgICAgICAgdGhpcy5fZGF0YSA9IHZhbHVlLmZpbHRlcihlbGVtZW50ID0+IGVsZW1lbnQpO1xuICAgICAgICAvLyBJZiB1c2VyIGRvbnQgcGFzcyBkaXNwbGF5ZWRDb2x1bW5zIHRoZSB0YWJsZSB3aWxsIHNob3cgYWxsIGRhdGEgYW5kIHRoZSBuYW1lIG9mIGNvbHVtbnMgd2lsbCBiZSB0aGUga2V5IG9mIGRhdGFcbiAgICAgICAgaWYgKCF0aGlzLl9kaXNwbGF5ZWRDb2x1bW5zKSB7XG4gICAgICAgICAgICBjb25zdCBrZXlzOiBzdHJpbmdbXSA9IFtdLFxuICAgICAgICAgICAgICAgIGNBcnJheTogYW55W10gPSBbXTtcbiAgICAgICAgICAgIC8vIEZvciBjYXRjaCBrZXlzIG9mIGRhdGEgT2JqZWN0cyBhbmQgYXNzaW5nIHRpdGxlLCBrZXkgYW5kIHR5cGUgc3RyaW5nIGJ5IGRlZmF1bHQgdG8gZGlzcGxheWVkQ29sdW1uc1xuICAgICAgICAgICAgdGhpcy5fZGF0YS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFrZXlzLmluY2x1ZGVzKGtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleXMucHVzaChrZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY0FycmF5LnB1c2goeyB0aXRsZToga2V5LCBrZXksIHR5cGU6ICdzdHJpbmcnIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLl9jb2x1bW5LZXlzID0ga2V5cztcbiAgICAgICAgICAgIHRoaXMuX2Rpc3BsYXllZENvbHVtbnMgPSBjQXJyYXk7XG4gICAgICAgICAgICAvLyBuZWVkIHRvIGNhbGwgbWFya0ZvckNoZWNrIGFzIHRoZSBzZXR0ZXIgY2hhbmdlcyBkaXNwbGF5ZWRDb2x1bW5zIGhlcmVcbiAgICAgICAgICAgIC8vIHNpZGVub3RlOiBpc24ndCBuZWVkZWQgZm9yIHRoZSBkYXRhIGl0c2VsZiBhcyBpdCBnZXRzIHBhc3NlZCB0byB0aGUgY2RrLXRhYmxlXG4gICAgICAgICAgICAvLyBieSB0aGUgZGF0YXNvdXJjZSBvYnNlcnZhYmxlXG4gICAgICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fZGF0YUNoYW5nZS5uZXh0KHRoaXMuX2RhdGEpO1xuICAgIH1cbiAgICBnZXQgZGF0YSgpOiBhbnlbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kYXRhO1xuICAgIH1cblxuICAgIC8qKiBTZXRzIHRoZSBuYW1lIG9yZGVyIGFuZCB0eXBlIG9mIGNvbHVtbnMuICovXG4gICAgQElucHV0KCdueERpc3BsYXllZENvbHVtbnMnKVxuICAgIHNldCBkaXNwbGF5ZWRDb2x1bW5zKHZhbHVlOiBOeER5bmFtaWNUYWJsZUNvbHVtbkRlZmluaXRpb25bXSB8IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9kaXNwbGF5ZWRDb2x1bW5zID0gdmFsdWUgYXMgTnhEeW5hbWljVGFibGVDb2x1bW5EZWZpbml0aW9uW107XG4gICAgICAgIHRoaXMuX2NvbHVtbktleXMgPSB2YWx1ZSA/IHZhbHVlLm1hcChjb2x1bW4gPT4gY29sdW1uLmtleSkgOiBbXTtcbiAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cbiAgICBnZXQgZGlzcGxheWVkQ29sdW1ucygpOiBOeER5bmFtaWNUYWJsZUNvbHVtbkRlZmluaXRpb25bXSB8IHVuZGVmaW5lZCB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kaXNwbGF5ZWRDb2x1bW5zO1xuICAgIH1cblxuICAgIC8qKiBBbiBldmVudCBpcyBkaXNwYXRjaGVkIHdoZW4gYSByb3cgaXMgY2xpY2tlZC4gKi9cbiAgICBAT3V0cHV0KCkgbnhSb3dDbGljayA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgZ2V0IGRhdGFTb3VyY2UoKTogTnhEeW5hbWljVGFibGVEYXRhU291cmNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGFTb3VyY2UgYXMgTnhEeW5hbWljVGFibGVEYXRhU291cmNlO1xuICAgIH1cblxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgZ2V0IGNvbHVtbktleXMoKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29sdW1uS2V5cztcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9jZHI6IENoYW5nZURldGVjdG9yUmVmKSB7fVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIGlmICghdGhpcy5fZGF0YSkge1xuICAgICAgICAgICAgdGhpcy5fZGF0YSA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fZGF0YUNoYW5nZS5uZXh0KHRoaXMuX2RhdGEpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2RhdGFTb3VyY2UgPSBuZXcgTnhEeW5hbWljVGFibGVEYXRhU291cmNlKHRoaXMuX2RhdGFDaGFuZ2UpO1xuICAgIH1cblxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgaGFuZGxlUm93Q2xpY2socm93OiBvYmplY3QpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5ueFJvd0NsaWNrLmVtaXQocm93KTtcbiAgICB9XG5cbiAgICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICAgIGlzTnVtZXJpYyhjb2x1bW46IE54RHluYW1pY1RhYmxlQ29sdW1uRGVmaW5pdGlvbik6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gY29sdW1uLnR5cGUgPT09ICdudW1lcmljJztcbiAgICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwibngtdGFibGVfX2NvbnRhaW5lclwiICpuZ0lmPVwiZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDBcIj5cbiAgICA8ZGl2IGNsYXNzPVwibngtdGFibGVfX3Njcm9sbFwiPlxuICAgICAgICA8Y2RrLXRhYmxlIFtkYXRhU291cmNlXT1cImRhdGFTb3VyY2VcIiBjbGFzcz1cIm54LXRhYmxlXCI+XG4gICAgICAgICAgICA8IS0tIENvbHVtbiBEZWZpbml0aW9ucyAtLT5cbiAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IGNvbHVtbiBvZiBkaXNwbGF5ZWRDb2x1bW5zXCIgY2RrQ29sdW1uRGVmPVwie3sgY29sdW1uLmtleSB9fVwiPlxuICAgICAgICAgICAgICAgIDxjZGstaGVhZGVyLWNlbGxcbiAgICAgICAgICAgICAgICAgICAgKmNka0hlYWRlckNlbGxEZWZcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M9XCJueC10YWJsZV9faGVhZGVyLWNlbGxcIlxuICAgICAgICAgICAgICAgICAgICBbbmdDbGFzc109XCJbY29sdW1uLmhlYWRlckNlbGxDbGFzcyA/PyAnJywgaXNOdW1lcmljKGNvbHVtbikgPyAnbngtdGFibGVfX2hlYWRlci1jZWxsLS1udW1iZXInIDogJyddXCJcbiAgICAgICAgICAgICAgICAgICAgW25nU3R5bGVdPVwiY29sdW1uLmhlYWRlckNlbGxTdHlsZSB8fCBudWxsXCJcbiAgICAgICAgICAgICAgICAgICAgPjxkaXYgY2xhc3M9XCJueC10YWJsZV9faGVhZGVyLXRpdGxlLS1ibG9ja1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJueC10YWJsZV9faGVhZGVyLXRpdGxlXCI+e3sgY29sdW1uLnRpdGxlIH19PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Nkay1oZWFkZXItY2VsbD5cbiAgICAgICAgICAgICAgICA8Y2RrLWNlbGxcbiAgICAgICAgICAgICAgICAgICAgKmNka0NlbGxEZWY9XCJsZXQgcm93XCJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M9XCJueC10YWJsZV9fY2VsbFwiXG4gICAgICAgICAgICAgICAgICAgIFtuZ0NsYXNzXT1cIltjb2x1bW4uY2VsbENsYXNzID8/ICcnLCBpc051bWVyaWMoY29sdW1uKSA/ICdueC10YWJsZV9fY2VsbC0tbnVtYmVyJyA6ICcnXVwiXG4gICAgICAgICAgICAgICAgICAgIFtuZ1N0eWxlXT1cImNvbHVtbi5jZWxsU3R5bGUgPz8gbnVsbFwiXG4gICAgICAgICAgICAgICAgICAgIFtpbm5lckhUTUxdPVwicm93W2NvbHVtbi5rZXldXCJcbiAgICAgICAgICAgICAgICA+PC9jZGstY2VsbD5cbiAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgICAgICAgICA8IS0tIEhlYWRlciBhbmQgUm93IERlY2xhcmF0aW9ucyAtLT5cbiAgICAgICAgICAgIDxjZGstaGVhZGVyLXJvdyAqY2RrSGVhZGVyUm93RGVmPVwiY29sdW1uS2V5c1wiIGNsYXNzPVwibngtdGFibGVfX2hlYWRlci1yb3dcIj48L2Nkay1oZWFkZXItcm93PlxuICAgICAgICAgICAgPGNkay1yb3cgKmNka1Jvd0RlZj1cImxldCByb3c7IGNvbHVtbnM6IGNvbHVtbktleXNcIiBjbGFzcz1cIm54LXRhYmxlX19yb3dcIiAoZGJsY2xpY2spPVwiaGFuZGxlUm93Q2xpY2socm93KVwiPjwvY2RrLXJvdz5cbiAgICAgICAgPC9jZGstdGFibGU+XG4gICAgPC9kaXY+XG48L2Rpdj5cbjxkaXYgY2xhc3M9XCJueC10YWJsZV9fYXBwZW5kaXhcIiAqbmdJZj1cImRhdGEubGVuZ3RoID09PSAwXCI+XG4gICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuPC9kaXY+XG4iXX0=