import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { ChangeDetectionStrategy, Component, ContentChildren, EventEmitter, HostBinding, Inject, InjectionToken, Input, Optional, Output, Self, ViewChild, } from '@angular/core';
import { NxErrorComponent } from '@aposin/ng-aquila/base';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { NxSelectableCardChangeEvent } from './selectable-card-change-event';
import * as i0 from "@angular/core";
import * as i1 from "@aposin/ng-aquila/utils";
import * as i2 from "@angular/forms";
import * as i3 from "@angular/cdk/a11y";
import * as i4 from "@aposin/ng-aquila/icon";
import * as i5 from "@angular/common";
let nextId = 0;
export const SELECTABLE_CARD_DEFAULT_OPTIONS = new InjectionToken('SELECTABLE_CARD_DEFAULT_OPTIONS');
export class NxSelectableCardComponent {
    constructor(_cdr, _errorStateMatcher, ngControl, _parentForm, _parentFormGroup, _focusMonitor, _defaultOptions) {
        this._cdr = _cdr;
        this._errorStateMatcher = _errorStateMatcher;
        this.ngControl = ngControl;
        this._parentForm = _parentForm;
        this._parentFormGroup = _parentFormGroup;
        this._focusMonitor = _focusMonitor;
        this._defaultOptions = _defaultOptions;
        this._id = `nx-selectable-card-${nextId++}`;
        this._checked = false;
        this._disabled = false;
        this._value = '';
        this._name = '';
        this._negative = false;
        this._tabindex = '0';
        this._errorListIds = '';
        this._errorState = false;
        /** An event is dispatched each time the selectable card value is changed */
        this.selectionChange = new EventEmitter();
        /** An event is dispatched each time the selectable card value is changed */
        this.checkedChange = new EventEmitter();
        this._destroyed = new Subject();
        /** @docs-private */
        this.onChangeCallback = (_) => { };
        this.onTouchedCallback = (_) => { };
        if (this.ngControl) {
            // Note: we provide the value accessor through here, instead of
            // the `providers` to avoid running into a circular import.
            this.ngControl.valueAccessor = this;
        }
    }
    /**
     * ** Expert option **
     *
     * Sets the appearance of the small stage. Default: 'default'
     */
    set appearance(value) {
        if (value !== this.appearance) {
            this._appearance = value;
            this._cdr.markForCheck();
        }
    }
    get appearance() {
        return this._appearance || this._defaultOptions?.appearance || 'default';
    }
    /**
     * Id of the selectable card.
     *
     * If not set, the selectable card gets an incremented value by default.
     */
    set id(value) {
        if (value !== this._id) {
            this._id = value;
            this._cdr.markForCheck();
        }
    }
    get id() {
        return this._id;
    }
    /** Whether the selectable card  is checked. */
    set checked(value) {
        const newValue = coerceBooleanProperty(value);
        if (newValue !== this._checked) {
            this._checked = newValue;
            this._cdr.markForCheck();
        }
    }
    get checked() {
        return this._checked;
    }
    /** The value attribute of the native input element  */
    get value() {
        return this._value;
    }
    set value(value) {
        if (value) {
            this._value = value;
        }
        this._cdr.markForCheck();
    }
    /** Whether the selectable card is disabled. */
    set disabled(value) {
        const newValue = coerceBooleanProperty(value);
        if (newValue !== this._disabled) {
            this._disabled = newValue;
            this._cdr.markForCheck();
        }
    }
    get disabled() {
        return this._disabled;
    }
    /**
     * Whether the selectable card is negative.
     * @deprecated Obsolete as negative state is not implemented.
     * @deletion-target 12.0.0
     */
    set negative(value) {
        const newValue = coerceBooleanProperty(value);
        if (newValue !== this._negative) {
            this._negative = newValue;
            this._cdr.markForCheck();
        }
    }
    get negative() {
        return this._negative;
    }
    /** Whether the selectable card is required. */
    get required() {
        return !!this._required;
    }
    set required(value) {
        this._required = coerceBooleanProperty(value);
    }
    /** Name of the selectable card. */
    get name() {
        return this._name;
    }
    set name(value) {
        this._name = value;
    }
    /** The tabindex of the selectable card. */
    get tabindex() {
        if (this.disabled) {
            return '-1';
        }
        return this._tabindex;
    }
    set tabindex(value) {
        this._tabindex = value;
    }
    get _isExpert() {
        return this.appearance === 'expert';
    }
    ngAfterViewInit() {
        this._focusMonitor.monitor(this._nativeInput);
    }
    ngAfterContentInit() {
        this._errorList.changes.pipe(takeUntil(this._destroyed)).subscribe(() => {
            this._errorListIds = this._getErrorListIds();
            this._cdr.markForCheck();
        });
        this._errorListIds = this._getErrorListIds();
    }
    ngOnDestroy() {
        this._destroyed.next();
        this._destroyed.complete();
        this._focusMonitor.stopMonitoring(this._nativeInput);
    }
    registerOnChange(fn) {
        this.onChangeCallback = fn;
    }
    registerOnTouched(onTouched) {
        this.onTouchedCallback = onTouched;
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    writeValue(value) {
        this.checked = !!value;
    }
    ngDoCheck() {
        if (this.ngControl) {
            // We need to re-evaluate this on every change detection cycle, because there are some
            // error triggers that we can't subscribed to (e.g. parent form submissions). This means
            // that whatever logic is in here has to be super lean or we risk destroying the performance.
            this._updateErrorState();
        }
    }
    _updateErrorState() {
        const oldState = this._errorState;
        const parent = this._parentFormGroup || this._parentForm;
        const control = this.ngControl ? this.ngControl.control : null;
        const newState = this._errorStateMatcher.isErrorState(control, parent);
        if (newState !== oldState) {
            this._errorState = newState;
            this._cdr.markForCheck();
        }
    }
    /** Toggles the checked state of the selectable card . */
    toggle() {
        if (!this.disabled) {
            this.checked = !this.checked;
        }
    }
    _onInputClick(event) {
        // We have to stop propagation for click events on the visual hidden input element.
        // By default, when a user clicks on a label element, a generated click event will be
        // stop the propagation of the native click on the checkbox input so that a click is not triggered twice
        // Preventing bubbling for the second event will solve that issue.
        event.stopPropagation();
        if (!this.disabled) {
            this.toggle();
            this._emitChangeEvent();
        }
    }
    _onInteractionEvent(event) {
        // We always have to stop propagation on the change event.
        // Otherwise the change event, from the input element, will bubble up and
        // emit its event object to the `change` output.
        event.stopPropagation();
    }
    _emitChangeEvent() {
        const event = new NxSelectableCardChangeEvent(this.checked, this.value, this);
        this.onChangeCallback(this.checked);
        this.selectionChange.emit(event);
        this.checkedChange.emit(this.checked);
    }
    _getErrorListIds() {
        return this._errorList.map((errorItem) => errorItem.id).join(' ');
    }
}
NxSelectableCardComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxSelectableCardComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: i1.ErrorStateMatcher }, { token: i2.NgControl, optional: true, self: true }, { token: i2.NgForm, optional: true }, { token: i2.FormGroupDirective, optional: true }, { token: i3.FocusMonitor }, { token: SELECTABLE_CARD_DEFAULT_OPTIONS, optional: true }], target: i0.ɵɵFactoryTarget.Component });
NxSelectableCardComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxSelectableCardComponent, selector: "nx-selectable-card", inputs: { appearance: "appearance", id: "id", checked: "checked", value: "value", disabled: "disabled", negative: "negative", required: "required", name: "name", tabindex: "tabindex" }, outputs: { selectionChange: "selectionChange", checkedChange: "checkedChange" }, host: { attributes: { "attr.role": "checkbox" }, properties: { "class.is-disabled": "disabled", "class.has-error": "_errorState", "attr.aria-invalid": "_errorState", "attr.aria-checked": "checked", "class.is-expert": "this._isExpert" } }, queries: [{ propertyName: "_errorList", predicate: NxErrorComponent }], viewQueries: [{ propertyName: "_nativeInput", first: true, predicate: ["input"], descendants: true }], ngImport: i0, template: "<input\n    #input\n    type=\"checkbox\"\n    [checked]=\"checked\"\n    [value]=\"value || null\"\n    [attr.disabled]=\"disabled || null\"\n    (change)=\"_onInteractionEvent($event)\"\n    (blur)=\"onTouchedCallback($event)\"\n    [attr.id]=\"id\"\n    [attr.name]=\"name\"\n    (click)=\"_onInputClick($event)\"\n    [required]=\"required\"\n    [attr.aria-required]=\"required\"\n    [attr.tabindex]=\"tabindex\"\n    [attr.aria-invalid]=\"_errorState\"\n    [attr.aria-describedby]=\"_errorListIds || null\"\n/>\n\n<label [attr.for]=\"id\">\n    <span class=\"checkbox\" *ngIf=\"appearance === 'default'; else expert\">\n        <nx-icon *ngIf=\"checked\" name=\"check\" aria-hidden=\"true\"></nx-icon>\n    </span>\n\n    <div class=\"content\">\n        <ng-content select=\"nx-card-header\"></ng-content>\n        <ng-content></ng-content>\n        <ng-content select=\"nx-card-footer\"></ng-content>\n    </div>\n</label>\n\n<ng-content *ngIf=\"_errorState\" select=\"nx-error\"></ng-content>\n\n<ng-template #expert>\n    <nx-icon name=\"check-circle\" size=\"s\" aria-hidden=\"true\" class=\"checkmark\"> </nx-icon>\n</ng-template>\n", styles: [":host{display:block}:host ::ng-deep nx-error{margin-top:8px}:host ::ng-deep nx-error.nx-error--message{margin-top:12px}::ng-deep nx-card-footer,::ng-deep nx-card-content,::ng-deep nx-card-header{display:block}.checkmark{float:right;position:relative;color:var(--selectable-card-icon-color)}:host-context([dir=rtl]) .checkmark{float:left}.checkmark:before,.checkmark ::ng-deep svg{display:none;z-index:1}.checkmark:after{content:\"\";display:block;position:absolute;width:22px;height:22px;border:1px solid var(--selectable-card-icon-placeholder-border-color);border-radius:50%}.checkbox{float:left;background-color:var(--checkbox-background-color);border-style:solid;border-width:var(--checkbox-border-width);border-color:var(--checkbox-border-color);border-radius:var(--checkbox-border-radius);color:var(--checkbox-icon-color);font-size:var(--checkbox-icon-size);height:var(--checkbox-control-size);width:var(--checkbox-control-size);min-width:var(--checkbox-control-size);display:flex;justify-content:center;align-items:center;z-index:0}:host-context([dir=rtl]) .checkbox{float:right}:host(:not(.is-expert)) .content{overflow:hidden;padding-left:16px}:host-context([dir=rtl]) :host(:not(.is-expert)) .content{padding-left:0;padding-right:16px}@media (max-width: 703px){:host(:not(.is-expert)) .content{padding-left:8px}:host-context([dir=rtl]) :host(:not(.is-expert)) .content{padding-right:8px}}:host(.is-expert) label:hover{background:var(--selectable-card-expert-background-hover-color)}:host(.is-expert) label:hover .checkmark{color:var(--selectable-card-unchecked-icon-hover-color)}:host(.is-expert) label:hover .checkmark:before,:host(.is-expert) label:hover .checkmark ::ng-deep svg{display:block}:host(.is-expert) input:checked+label{background:var(--selectable-card-expert-background-selected-color)}:host(.is-expert) input:checked+label:hover{background:var(--selectable-card-expert-background-selected-hover-color)}input{position:absolute;height:0;width:0;overflow:hidden;opacity:0}input:checked+label{background:var(--selectable-card-background-selected-color);border-color:var(--selectable-card-border-selected-color)}input:checked+label .checkmark:before,input:checked+label .checkmark ::ng-deep svg{display:block}input:checked+label:hover{background:var(--selectable-card-background-selected-hover-color)}input:checked+label:hover .checkmark{color:var(--selectable-card-icon-color)}input:checked+label .checkbox{background-color:var(--checkbox-selected-background-color);border-color:var(--checkbox-selected-border-color)}label{border:var(--selectable-card-border-width) solid var(--selectable-card-border-color);display:block;position:relative;padding:16px;cursor:pointer;width:100%;min-height:56px;border-radius:var(--selectable-card-border-radius);background:var(--selectable-card-background-color)}label:hover{background:var(--selectable-card-background-hover-color);border-color:var(--selectable-card-border-hover-color)}@media (hover: none){label:hover{background:var(--selectable-card-background-color);border-color:var(--selectable-card-border-color)}input:checked+label:hover{background:var(--selectable-card-background-selected-color)}}:host(.is-disabled) label{border-color:var(--selectable-card-border-disabled-color);cursor:not-allowed}:host(.is-disabled) .checkmark{opacity:40%}:host(.is-disabled) label:hover{background:var(--selectable-card-background-disabled-color)}:host(.is-disabled) label:hover .checkmark:before,:host(.is-disabled) label:hover .checkmark ::ng-deep svg{display:none}:host(.is-disabled) input:checked+label{background:var(--selectable-card-background-disabled-selected-color);border-color:var(--selectable-card-border-disabled-selected-color)}:host(.is-disabled) input:checked+label .checkbox{background-color:var(--checkbox-disabled-selected-background-color);border-color:var(--checkbox-disabled-border-color);color:var(--checkbox-disabled-icon-color)}:host(.is-disabled) input:checked+label .checkmark:before,:host(.is-disabled) input:checked+label .checkmark ::ng-deep svg{display:block}:host(.is-disabled).is-expert input:checked+label{background:var(--selectable-card-expert-background-disabled-selected-color)}:host(.is-disabled) .checkbox{background-color:var(--checkbox-disabled-background-color);border-color:var(--checkbox-disabled-border-color);color:var(--checkbox-disabled-icon-color)}:host(.has-error) label,:host(.has-error) label:hover,:host(.has-error) input:checked+label,:host(.has-error) input:checked+label:hover{border-color:var(--selectable-card-border-error-color)}input.cdk-keyboard-focused+label{box-shadow:var(--focus-box-shadow)}@media screen and (-ms-high-contrast: active),(forced-colors: active){input.cdk-keyboard-focused+label{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}@media screen and (-ms-high-contrast: active){:host label,:host label:hover,:host(.has-error) label,:host(.has-error) label:hover{border-color:buttonText}:host input:checked+label,:host input:checked+label:hover,:host(.has-error) input:checked+label,:host(.has-error) input:checked+label:hover{border-width:3px;padding:14px;border-color:highlight}:host input:checked+label .checkmark,:host input:checked+label:hover .checkmark,:host(.has-error) input:checked+label .checkmark,:host(.has-error) input:checked+label:hover .checkmark{color:CanvasText}:host(.is-disabled) label,:host(.is-disabled) input:checked+label{border-color:GrayText;color:GrayText}:host(.is-disabled) label .checkmark,:host(.is-disabled) input:checked+label .checkmark{color:GrayText}}\n"], components: [{ type: i4.NxIconComponent, selector: "nx-icon", inputs: ["name", "outline", "fill", "size", "font"] }], directives: [{ type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxSelectableCardComponent, decorators: [{
            type: Component,
            args: [{ selector: 'nx-selectable-card', changeDetection: ChangeDetectionStrategy.OnPush, host: {
                        '[class.is-disabled]': 'disabled',
                        '[class.has-error]': '_errorState',
                        '[attr.aria-invalid]': '_errorState',
                        'attr.role': 'checkbox',
                        '[attr.aria-checked]': 'checked',
                    }, template: "<input\n    #input\n    type=\"checkbox\"\n    [checked]=\"checked\"\n    [value]=\"value || null\"\n    [attr.disabled]=\"disabled || null\"\n    (change)=\"_onInteractionEvent($event)\"\n    (blur)=\"onTouchedCallback($event)\"\n    [attr.id]=\"id\"\n    [attr.name]=\"name\"\n    (click)=\"_onInputClick($event)\"\n    [required]=\"required\"\n    [attr.aria-required]=\"required\"\n    [attr.tabindex]=\"tabindex\"\n    [attr.aria-invalid]=\"_errorState\"\n    [attr.aria-describedby]=\"_errorListIds || null\"\n/>\n\n<label [attr.for]=\"id\">\n    <span class=\"checkbox\" *ngIf=\"appearance === 'default'; else expert\">\n        <nx-icon *ngIf=\"checked\" name=\"check\" aria-hidden=\"true\"></nx-icon>\n    </span>\n\n    <div class=\"content\">\n        <ng-content select=\"nx-card-header\"></ng-content>\n        <ng-content></ng-content>\n        <ng-content select=\"nx-card-footer\"></ng-content>\n    </div>\n</label>\n\n<ng-content *ngIf=\"_errorState\" select=\"nx-error\"></ng-content>\n\n<ng-template #expert>\n    <nx-icon name=\"check-circle\" size=\"s\" aria-hidden=\"true\" class=\"checkmark\"> </nx-icon>\n</ng-template>\n", styles: [":host{display:block}:host ::ng-deep nx-error{margin-top:8px}:host ::ng-deep nx-error.nx-error--message{margin-top:12px}::ng-deep nx-card-footer,::ng-deep nx-card-content,::ng-deep nx-card-header{display:block}.checkmark{float:right;position:relative;color:var(--selectable-card-icon-color)}:host-context([dir=rtl]) .checkmark{float:left}.checkmark:before,.checkmark ::ng-deep svg{display:none;z-index:1}.checkmark:after{content:\"\";display:block;position:absolute;width:22px;height:22px;border:1px solid var(--selectable-card-icon-placeholder-border-color);border-radius:50%}.checkbox{float:left;background-color:var(--checkbox-background-color);border-style:solid;border-width:var(--checkbox-border-width);border-color:var(--checkbox-border-color);border-radius:var(--checkbox-border-radius);color:var(--checkbox-icon-color);font-size:var(--checkbox-icon-size);height:var(--checkbox-control-size);width:var(--checkbox-control-size);min-width:var(--checkbox-control-size);display:flex;justify-content:center;align-items:center;z-index:0}:host-context([dir=rtl]) .checkbox{float:right}:host(:not(.is-expert)) .content{overflow:hidden;padding-left:16px}:host-context([dir=rtl]) :host(:not(.is-expert)) .content{padding-left:0;padding-right:16px}@media (max-width: 703px){:host(:not(.is-expert)) .content{padding-left:8px}:host-context([dir=rtl]) :host(:not(.is-expert)) .content{padding-right:8px}}:host(.is-expert) label:hover{background:var(--selectable-card-expert-background-hover-color)}:host(.is-expert) label:hover .checkmark{color:var(--selectable-card-unchecked-icon-hover-color)}:host(.is-expert) label:hover .checkmark:before,:host(.is-expert) label:hover .checkmark ::ng-deep svg{display:block}:host(.is-expert) input:checked+label{background:var(--selectable-card-expert-background-selected-color)}:host(.is-expert) input:checked+label:hover{background:var(--selectable-card-expert-background-selected-hover-color)}input{position:absolute;height:0;width:0;overflow:hidden;opacity:0}input:checked+label{background:var(--selectable-card-background-selected-color);border-color:var(--selectable-card-border-selected-color)}input:checked+label .checkmark:before,input:checked+label .checkmark ::ng-deep svg{display:block}input:checked+label:hover{background:var(--selectable-card-background-selected-hover-color)}input:checked+label:hover .checkmark{color:var(--selectable-card-icon-color)}input:checked+label .checkbox{background-color:var(--checkbox-selected-background-color);border-color:var(--checkbox-selected-border-color)}label{border:var(--selectable-card-border-width) solid var(--selectable-card-border-color);display:block;position:relative;padding:16px;cursor:pointer;width:100%;min-height:56px;border-radius:var(--selectable-card-border-radius);background:var(--selectable-card-background-color)}label:hover{background:var(--selectable-card-background-hover-color);border-color:var(--selectable-card-border-hover-color)}@media (hover: none){label:hover{background:var(--selectable-card-background-color);border-color:var(--selectable-card-border-color)}input:checked+label:hover{background:var(--selectable-card-background-selected-color)}}:host(.is-disabled) label{border-color:var(--selectable-card-border-disabled-color);cursor:not-allowed}:host(.is-disabled) .checkmark{opacity:40%}:host(.is-disabled) label:hover{background:var(--selectable-card-background-disabled-color)}:host(.is-disabled) label:hover .checkmark:before,:host(.is-disabled) label:hover .checkmark ::ng-deep svg{display:none}:host(.is-disabled) input:checked+label{background:var(--selectable-card-background-disabled-selected-color);border-color:var(--selectable-card-border-disabled-selected-color)}:host(.is-disabled) input:checked+label .checkbox{background-color:var(--checkbox-disabled-selected-background-color);border-color:var(--checkbox-disabled-border-color);color:var(--checkbox-disabled-icon-color)}:host(.is-disabled) input:checked+label .checkmark:before,:host(.is-disabled) input:checked+label .checkmark ::ng-deep svg{display:block}:host(.is-disabled).is-expert input:checked+label{background:var(--selectable-card-expert-background-disabled-selected-color)}:host(.is-disabled) .checkbox{background-color:var(--checkbox-disabled-background-color);border-color:var(--checkbox-disabled-border-color);color:var(--checkbox-disabled-icon-color)}:host(.has-error) label,:host(.has-error) label:hover,:host(.has-error) input:checked+label,:host(.has-error) input:checked+label:hover{border-color:var(--selectable-card-border-error-color)}input.cdk-keyboard-focused+label{box-shadow:var(--focus-box-shadow)}@media screen and (-ms-high-contrast: active),(forced-colors: active){input.cdk-keyboard-focused+label{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}@media screen and (-ms-high-contrast: active){:host label,:host label:hover,:host(.has-error) label,:host(.has-error) label:hover{border-color:buttonText}:host input:checked+label,:host input:checked+label:hover,:host(.has-error) input:checked+label,:host(.has-error) input:checked+label:hover{border-width:3px;padding:14px;border-color:highlight}:host input:checked+label .checkmark,:host input:checked+label:hover .checkmark,:host(.has-error) input:checked+label .checkmark,:host(.has-error) input:checked+label:hover .checkmark{color:CanvasText}:host(.is-disabled) label,:host(.is-disabled) input:checked+label{border-color:GrayText;color:GrayText}:host(.is-disabled) label .checkmark,:host(.is-disabled) input:checked+label .checkmark{color:GrayText}}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i1.ErrorStateMatcher }, { type: i2.NgControl, decorators: [{
                    type: Optional
                }, {
                    type: Self
                }] }, { type: i2.NgForm, decorators: [{
                    type: Optional
                }] }, { type: i2.FormGroupDirective, decorators: [{
                    type: Optional
                }] }, { type: i3.FocusMonitor }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [SELECTABLE_CARD_DEFAULT_OPTIONS]
                }] }]; }, propDecorators: { _errorList: [{
                type: ContentChildren,
                args: [NxErrorComponent]
            }], _nativeInput: [{
                type: ViewChild,
                args: ['input']
            }], selectionChange: [{
                type: Output
            }], checkedChange: [{
                type: Output
            }], appearance: [{
                type: Input
            }], id: [{
                type: Input
            }], checked: [{
                type: Input
            }], value: [{
                type: Input
            }], disabled: [{
                type: Input
            }], negative: [{
                type: Input
            }], required: [{
                type: Input
            }], name: [{
                type: Input
            }], tabindex: [{
                type: Input
            }], _isExpert: [{
                type: HostBinding,
                args: ['class.is-expert']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0YWJsZS1jYXJkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWFxdWlsYS9zcmMvY2FyZC9zZWxlY3RhYmxlLWNhcmQuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmctYXF1aWxhL3NyYy9jYXJkL3NlbGVjdGFibGUtY2FyZC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQWdCLHFCQUFxQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDNUUsT0FBTyxFQUdILHVCQUF1QixFQUV2QixTQUFTLEVBQ1QsZUFBZSxFQUdmLFlBQVksRUFDWixXQUFXLEVBQ1gsTUFBTSxFQUNOLGNBQWMsRUFDZCxLQUFLLEVBRUwsUUFBUSxFQUNSLE1BQU0sRUFFTixJQUFJLEVBQ0osU0FBUyxHQUNaLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRTFELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDOzs7Ozs7O0FBRTdFLElBQUksTUFBTSxHQUFHLENBQUMsQ0FBQztBQWVmLE1BQU0sQ0FBQyxNQUFNLCtCQUErQixHQUFHLElBQUksY0FBYyxDQUErQixpQ0FBaUMsQ0FBQyxDQUFDO0FBZW5JLE1BQU0sT0FBTyx5QkFBeUI7SUErSmxDLFlBQ1ksSUFBdUIsRUFDdkIsa0JBQXFDLEVBQ2xCLFNBQTJCLEVBQ2xDLFdBQTBCLEVBQzFCLGdCQUEyQyxFQUN2RCxhQUEyQixFQUMwQixlQUFvRDtRQU56RyxTQUFJLEdBQUosSUFBSSxDQUFtQjtRQUN2Qix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW1CO1FBQ2xC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QkFBSSxJQUFJOzswQkFDaEIsUUFBUTs7MEJBQ1IsUUFBUTs7MEJBRVIsUUFBUTs7MEJBQUksTUFBTTsyQkFBQywrQkFBK0I7NENBekpwQixVQUFVO3NCQUE1QyxlQUFlO3VCQUFDLGdCQUFnQjtnQkFDYixZQUFZO3NCQUEvQixTQUFTO3VCQUFDLE9BQU87Z0JBTWxCLGVBQWU7c0JBRGQsTUFBTTtnQkFJRyxhQUFhO3NCQUF0QixNQUFNO2dCQVFILFVBQVU7c0JBRGIsS0FBSztnQkFrQkYsRUFBRTtzQkFETCxLQUFLO2dCQWNGLE9BQU87c0JBRFYsS0FBSztnQkFlRixLQUFLO3NCQURSLEtBQUs7Z0JBZUYsUUFBUTtzQkFEWCxLQUFLO2dCQW1CRixRQUFRO3NCQURYLEtBQUs7Z0JBZUYsUUFBUTtzQkFEWCxLQUFLO2dCQVVGLElBQUk7c0JBRFAsS0FBSztnQkFXRixRQUFRO3NCQURYLEtBQUs7Z0JBY0YsU0FBUztzQkFEWixXQUFXO3VCQUFDLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvY3VzTW9uaXRvciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9hMTF5JztcbmltcG9ydCB7IEJvb2xlYW5JbnB1dCwgY29lcmNlQm9vbGVhblByb3BlcnR5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcbmltcG9ydCB7XG4gICAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgICBBZnRlclZpZXdJbml0LFxuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgIENvbXBvbmVudCxcbiAgICBDb250ZW50Q2hpbGRyZW4sXG4gICAgRG9DaGVjayxcbiAgICBFbGVtZW50UmVmLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBIb3N0QmluZGluZyxcbiAgICBJbmplY3QsXG4gICAgSW5qZWN0aW9uVG9rZW4sXG4gICAgSW5wdXQsXG4gICAgT25EZXN0cm95LFxuICAgIE9wdGlvbmFsLFxuICAgIE91dHB1dCxcbiAgICBRdWVyeUxpc3QsXG4gICAgU2VsZixcbiAgICBWaWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29udHJvbFZhbHVlQWNjZXNzb3IsIEZvcm1Db250cm9sLCBGb3JtR3JvdXBEaXJlY3RpdmUsIE5nQ29udHJvbCwgTmdGb3JtIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgTnhFcnJvckNvbXBvbmVudCB9IGZyb20gJ0BhcG9zaW4vbmctYXF1aWxhL2Jhc2UnO1xuaW1wb3J0IHsgRXJyb3JTdGF0ZU1hdGNoZXIgfSBmcm9tICdAYXBvc2luL25nLWFxdWlsYS91dGlscyc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IE54U2VsZWN0YWJsZUNhcmRDaGFuZ2VFdmVudCB9IGZyb20gJy4vc2VsZWN0YWJsZS1jYXJkLWNoYW5nZS1ldmVudCc7XG5cbmxldCBuZXh0SWQgPSAwO1xuXG5leHBvcnQgdHlwZSBOeFNlbGVjdGFibGVDYXJkQXBwZWFyYW5jZSA9ICdleHBlcnQnIHwgJ2RlZmF1bHQnO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIGRlZmF1bHQgb3B0aW9ucyBmb3IgdGhlIHNlbGVjdGFibGUgY2FyZC5cbiAqIEl0IGNhbiBiZSBjb25maWd1cmVkIHVzaW5nIHRoZSBgTlhfU0VMRUNUQUJMRV9DQVJEX0RFRkFVTFRfT1BUSU9OU2AgaW5qZWN0aW9uIHRva2VuLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNlbGVjdGFibGVDYXJkRGVmYXVsdE9wdGlvbnMge1xuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGRlZmF1bHQgYXBwZWFyYW5jZS4gKG9wdGlvbmFsKVxuICAgICAqL1xuICAgIGFwcGVhcmFuY2U/OiBOeFNlbGVjdGFibGVDYXJkQXBwZWFyYW5jZTtcbn1cblxuZXhwb3J0IGNvbnN0IFNFTEVDVEFCTEVfQ0FSRF9ERUZBVUxUX09QVElPTlMgPSBuZXcgSW5qZWN0aW9uVG9rZW48U2VsZWN0YWJsZUNhcmREZWZhdWx0T3B0aW9ucz4oJ1NFTEVDVEFCTEVfQ0FSRF9ERUZBVUxUX09QVElPTlMnKTtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdueC1zZWxlY3RhYmxlLWNhcmQnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9zZWxlY3RhYmxlLWNhcmQuY29tcG9uZW50Lmh0bWwnLFxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICAgIHN0eWxlVXJsczogWycuL3NlbGVjdGFibGUtY2FyZC5jb21wb25lbnQuc2NzcyddLFxuICAgIGhvc3Q6IHtcbiAgICAgICAgJ1tjbGFzcy5pcy1kaXNhYmxlZF0nOiAnZGlzYWJsZWQnLFxuICAgICAgICAnW2NsYXNzLmhhcy1lcnJvcl0nOiAnX2Vycm9yU3RhdGUnLFxuICAgICAgICAnW2F0dHIuYXJpYS1pbnZhbGlkXSc6ICdfZXJyb3JTdGF0ZScsXG4gICAgICAgICdhdHRyLnJvbGUnOiAnY2hlY2tib3gnLFxuICAgICAgICAnW2F0dHIuYXJpYS1jaGVja2VkXSc6ICdjaGVja2VkJyxcbiAgICB9LFxufSlcbmV4cG9ydCBjbGFzcyBOeFNlbGVjdGFibGVDYXJkQ29tcG9uZW50IGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIERvQ2hlY2ssIEFmdGVyQ29udGVudEluaXQsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB7XG4gICAgcHJpdmF0ZSBfaWQgPSBgbngtc2VsZWN0YWJsZS1jYXJkLSR7bmV4dElkKyt9YDtcbiAgICBwcml2YXRlIF9jaGVja2VkID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBfZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBwcml2YXRlIF92YWx1ZSA9ICcnO1xuICAgIHByaXZhdGUgX25hbWUgPSAnJztcbiAgICBwcml2YXRlIF9uZWdhdGl2ZSA9IGZhbHNlO1xuICAgIHByaXZhdGUgX3RhYmluZGV4ID0gJzAnO1xuICAgIHByaXZhdGUgX3JlcXVpcmVkOiBib29sZWFuIHwgdW5kZWZpbmVkO1xuICAgIHByaXZhdGUgX2FwcGVhcmFuY2U6IE54U2VsZWN0YWJsZUNhcmRBcHBlYXJhbmNlIHwgdW5kZWZpbmVkO1xuXG4gICAgX2Vycm9yTGlzdElkcyA9ICcnO1xuXG4gICAgQENvbnRlbnRDaGlsZHJlbihOeEVycm9yQ29tcG9uZW50KSBfZXJyb3JMaXN0ITogUXVlcnlMaXN0PE54RXJyb3JDb21wb25lbnQ+O1xuICAgIEBWaWV3Q2hpbGQoJ2lucHV0JykgX25hdGl2ZUlucHV0ITogRWxlbWVudFJlZjxIVE1MRWxlbWVudD47XG5cbiAgICBfZXJyb3JTdGF0ZSA9IGZhbHNlO1xuXG4gICAgLyoqIEFuIGV2ZW50IGlzIGRpc3BhdGNoZWQgZWFjaCB0aW1lIHRoZSBzZWxlY3RhYmxlIGNhcmQgdmFsdWUgaXMgY2hhbmdlZCAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHNlbGVjdGlvbkNoYW5nZTogRXZlbnRFbWl0dGVyPE54U2VsZWN0YWJsZUNhcmRDaGFuZ2VFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPE54U2VsZWN0YWJsZUNhcmRDaGFuZ2VFdmVudD4oKTtcblxuICAgIC8qKiBBbiBldmVudCBpcyBkaXNwYXRjaGVkIGVhY2ggdGltZSB0aGUgc2VsZWN0YWJsZSBjYXJkIHZhbHVlIGlzIGNoYW5nZWQgKi9cbiAgICBAT3V0cHV0KCkgY2hlY2tlZENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcblxuICAgIC8qKlxuICAgICAqICoqIEV4cGVydCBvcHRpb24gKipcbiAgICAgKlxuICAgICAqIFNldHMgdGhlIGFwcGVhcmFuY2Ugb2YgdGhlIHNtYWxsIHN0YWdlLiBEZWZhdWx0OiAnZGVmYXVsdCdcbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHNldCBhcHBlYXJhbmNlKHZhbHVlOiBOeFNlbGVjdGFibGVDYXJkQXBwZWFyYW5jZSkge1xuICAgICAgICBpZiAodmFsdWUgIT09IHRoaXMuYXBwZWFyYW5jZSkge1xuICAgICAgICAgICAgdGhpcy5fYXBwZWFyYW5jZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IGFwcGVhcmFuY2UoKTogTnhTZWxlY3RhYmxlQ2FyZEFwcGVhcmFuY2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXBwZWFyYW5jZSB8fCB0aGlzLl9kZWZhdWx0T3B0aW9ucz8uYXBwZWFyYW5jZSB8fCAnZGVmYXVsdCc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSWQgb2YgdGhlIHNlbGVjdGFibGUgY2FyZC5cbiAgICAgKlxuICAgICAqIElmIG5vdCBzZXQsIHRoZSBzZWxlY3RhYmxlIGNhcmQgZ2V0cyBhbiBpbmNyZW1lbnRlZCB2YWx1ZSBieSBkZWZhdWx0LlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2V0IGlkKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKHZhbHVlICE9PSB0aGlzLl9pZCkge1xuICAgICAgICAgICAgdGhpcy5faWQgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lkO1xuICAgIH1cblxuICAgIC8qKiBXaGV0aGVyIHRoZSBzZWxlY3RhYmxlIGNhcmQgIGlzIGNoZWNrZWQuICovXG4gICAgQElucHV0KClcbiAgICBzZXQgY2hlY2tlZCh2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB0aGlzLl9jaGVja2VkKSB7XG4gICAgICAgICAgICB0aGlzLl9jaGVja2VkID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgY2hlY2tlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoZWNrZWQ7XG4gICAgfVxuXG4gICAgLyoqIFRoZSB2YWx1ZSBhdHRyaWJ1dGUgb2YgdGhlIG5hdGl2ZSBpbnB1dCBlbGVtZW50ICAqL1xuICAgIEBJbnB1dCgpXG4gICAgZ2V0IHZhbHVlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgICB9XG5cbiAgICBzZXQgdmFsdWUodmFsdWU6IHN0cmluZykge1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuXG4gICAgLyoqIFdoZXRoZXIgdGhlIHNlbGVjdGFibGUgY2FyZCBpcyBkaXNhYmxlZC4gKi9cbiAgICBASW5wdXQoKVxuICAgIHNldCBkaXNhYmxlZCh2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB0aGlzLl9kaXNhYmxlZCkge1xuICAgICAgICAgICAgdGhpcy5fZGlzYWJsZWQgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBkaXNhYmxlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhlIHNlbGVjdGFibGUgY2FyZCBpcyBuZWdhdGl2ZS5cbiAgICAgKiBAZGVwcmVjYXRlZCBPYnNvbGV0ZSBhcyBuZWdhdGl2ZSBzdGF0ZSBpcyBub3QgaW1wbGVtZW50ZWQuXG4gICAgICogQGRlbGV0aW9uLXRhcmdldCAxMi4wLjBcbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHNldCBuZWdhdGl2ZSh2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB0aGlzLl9uZWdhdGl2ZSkge1xuICAgICAgICAgICAgdGhpcy5fbmVnYXRpdmUgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBuZWdhdGl2ZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX25lZ2F0aXZlO1xuICAgIH1cblxuICAgIC8qKiBXaGV0aGVyIHRoZSBzZWxlY3RhYmxlIGNhcmQgaXMgcmVxdWlyZWQuICovXG4gICAgQElucHV0KClcbiAgICBnZXQgcmVxdWlyZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuX3JlcXVpcmVkO1xuICAgIH1cbiAgICBzZXQgcmVxdWlyZWQodmFsdWU6IEJvb2xlYW5JbnB1dCkge1xuICAgICAgICB0aGlzLl9yZXF1aXJlZCA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSh2YWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqIE5hbWUgb2YgdGhlIHNlbGVjdGFibGUgY2FyZC4gKi9cbiAgICBASW5wdXQoKVxuICAgIGdldCBuYW1lKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9uYW1lO1xuICAgIH1cblxuICAgIHNldCBuYW1lKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5fbmFtZSA9IHZhbHVlO1xuICAgIH1cblxuICAgIC8qKiBUaGUgdGFiaW5kZXggb2YgdGhlIHNlbGVjdGFibGUgY2FyZC4gKi9cbiAgICBASW5wdXQoKVxuICAgIGdldCB0YWJpbmRleCgpOiBzdHJpbmcge1xuICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuICctMSc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5fdGFiaW5kZXg7XG4gICAgfVxuXG4gICAgc2V0IHRhYmluZGV4KHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5fdGFiaW5kZXggPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmlzLWV4cGVydCcpXG4gICAgZ2V0IF9pc0V4cGVydCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXBwZWFyYW5jZSA9PT0gJ2V4cGVydCc7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZWFkb25seSBfZGVzdHJveWVkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIF9jZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICBwcml2YXRlIF9lcnJvclN0YXRlTWF0Y2hlcjogRXJyb3JTdGF0ZU1hdGNoZXIsXG4gICAgICAgIEBPcHRpb25hbCgpIEBTZWxmKCkgcHVibGljIG5nQ29udHJvbDogTmdDb250cm9sIHwgbnVsbCxcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBfcGFyZW50Rm9ybTogTmdGb3JtIHwgbnVsbCxcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBfcGFyZW50Rm9ybUdyb3VwOiBGb3JtR3JvdXBEaXJlY3RpdmUgfCBudWxsLFxuICAgICAgICBwcml2YXRlIF9mb2N1c01vbml0b3I6IEZvY3VzTW9uaXRvcixcbiAgICAgICAgQE9wdGlvbmFsKCkgQEluamVjdChTRUxFQ1RBQkxFX0NBUkRfREVGQVVMVF9PUFRJT05TKSBwcml2YXRlIF9kZWZhdWx0T3B0aW9uczogU2VsZWN0YWJsZUNhcmREZWZhdWx0T3B0aW9ucyB8IG51bGwsXG4gICAgKSB7XG4gICAgICAgIGlmICh0aGlzLm5nQ29udHJvbCkge1xuICAgICAgICAgICAgLy8gTm90ZTogd2UgcHJvdmlkZSB0aGUgdmFsdWUgYWNjZXNzb3IgdGhyb3VnaCBoZXJlLCBpbnN0ZWFkIG9mXG4gICAgICAgICAgICAvLyB0aGUgYHByb3ZpZGVyc2AgdG8gYXZvaWQgcnVubmluZyBpbnRvIGEgY2lyY3VsYXIgaW1wb3J0LlxuICAgICAgICAgICAgdGhpcy5uZ0NvbnRyb2wudmFsdWVBY2Nlc3NvciA9IHRoaXM7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIHRoaXMuX2ZvY3VzTW9uaXRvci5tb25pdG9yKHRoaXMuX25hdGl2ZUlucHV0KTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgICAgIHRoaXMuX2Vycm9yTGlzdC5jaGFuZ2VzLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9lcnJvckxpc3RJZHMgPSB0aGlzLl9nZXRFcnJvckxpc3RJZHMoKTtcbiAgICAgICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5fZXJyb3JMaXN0SWRzID0gdGhpcy5fZ2V0RXJyb3JMaXN0SWRzKCk7XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuX2Rlc3Ryb3llZC5uZXh0KCk7XG4gICAgICAgIHRoaXMuX2Rlc3Ryb3llZC5jb21wbGV0ZSgpO1xuICAgICAgICB0aGlzLl9mb2N1c01vbml0b3Iuc3RvcE1vbml0b3JpbmcodGhpcy5fbmF0aXZlSW5wdXQpO1xuICAgIH1cblxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgb25DaGFuZ2VDYWxsYmFjayA9IChfOiBhbnkpID0+IHt9O1xuXG4gICAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XG4gICAgICAgIHRoaXMub25DaGFuZ2VDYWxsYmFjayA9IGZuO1xuICAgIH1cblxuICAgIG9uVG91Y2hlZENhbGxiYWNrID0gKF86IGFueSkgPT4ge307XG5cbiAgICByZWdpc3Rlck9uVG91Y2hlZChvblRvdWNoZWQ6IGFueSk6IHZvaWQge1xuICAgICAgICB0aGlzLm9uVG91Y2hlZENhbGxiYWNrID0gb25Ub3VjaGVkO1xuICAgIH1cblxuICAgIHNldERpc2FibGVkU3RhdGU/KGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XG4gICAgfVxuXG4gICAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2hlY2tlZCA9ICEhdmFsdWU7XG4gICAgfVxuXG4gICAgbmdEb0NoZWNrKCkge1xuICAgICAgICBpZiAodGhpcy5uZ0NvbnRyb2wpIHtcbiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gcmUtZXZhbHVhdGUgdGhpcyBvbiBldmVyeSBjaGFuZ2UgZGV0ZWN0aW9uIGN5Y2xlLCBiZWNhdXNlIHRoZXJlIGFyZSBzb21lXG4gICAgICAgICAgICAvLyBlcnJvciB0cmlnZ2VycyB0aGF0IHdlIGNhbid0IHN1YnNjcmliZWQgdG8gKGUuZy4gcGFyZW50IGZvcm0gc3VibWlzc2lvbnMpLiBUaGlzIG1lYW5zXG4gICAgICAgICAgICAvLyB0aGF0IHdoYXRldmVyIGxvZ2ljIGlzIGluIGhlcmUgaGFzIHRvIGJlIHN1cGVyIGxlYW4gb3Igd2UgcmlzayBkZXN0cm95aW5nIHRoZSBwZXJmb3JtYW5jZS5cbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUVycm9yU3RhdGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF91cGRhdGVFcnJvclN0YXRlKCkge1xuICAgICAgICBjb25zdCBvbGRTdGF0ZSA9IHRoaXMuX2Vycm9yU3RhdGU7XG4gICAgICAgIGNvbnN0IHBhcmVudCA9IHRoaXMuX3BhcmVudEZvcm1Hcm91cCB8fCB0aGlzLl9wYXJlbnRGb3JtO1xuICAgICAgICBjb25zdCBjb250cm9sID0gdGhpcy5uZ0NvbnRyb2wgPyAodGhpcy5uZ0NvbnRyb2wuY29udHJvbCBhcyBGb3JtQ29udHJvbCkgOiBudWxsO1xuICAgICAgICBjb25zdCBuZXdTdGF0ZSA9IHRoaXMuX2Vycm9yU3RhdGVNYXRjaGVyLmlzRXJyb3JTdGF0ZShjb250cm9sLCBwYXJlbnQpO1xuXG4gICAgICAgIGlmIChuZXdTdGF0ZSAhPT0gb2xkU3RhdGUpIHtcbiAgICAgICAgICAgIHRoaXMuX2Vycm9yU3RhdGUgPSBuZXdTdGF0ZTtcbiAgICAgICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBUb2dnbGVzIHRoZSBjaGVja2VkIHN0YXRlIG9mIHRoZSBzZWxlY3RhYmxlIGNhcmQgLiAqL1xuICAgIHRvZ2dsZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgICAgICB0aGlzLmNoZWNrZWQgPSAhdGhpcy5jaGVja2VkO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX29uSW5wdXRDbGljayhldmVudDogRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgLy8gV2UgaGF2ZSB0byBzdG9wIHByb3BhZ2F0aW9uIGZvciBjbGljayBldmVudHMgb24gdGhlIHZpc3VhbCBoaWRkZW4gaW5wdXQgZWxlbWVudC5cbiAgICAgICAgLy8gQnkgZGVmYXVsdCwgd2hlbiBhIHVzZXIgY2xpY2tzIG9uIGEgbGFiZWwgZWxlbWVudCwgYSBnZW5lcmF0ZWQgY2xpY2sgZXZlbnQgd2lsbCBiZVxuICAgICAgICAvLyBzdG9wIHRoZSBwcm9wYWdhdGlvbiBvZiB0aGUgbmF0aXZlIGNsaWNrIG9uIHRoZSBjaGVja2JveCBpbnB1dCBzbyB0aGF0IGEgY2xpY2sgaXMgbm90IHRyaWdnZXJlZCB0d2ljZVxuICAgICAgICAvLyBQcmV2ZW50aW5nIGJ1YmJsaW5nIGZvciB0aGUgc2Vjb25kIGV2ZW50IHdpbGwgc29sdmUgdGhhdCBpc3N1ZS5cbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGlmICghdGhpcy5kaXNhYmxlZCkge1xuICAgICAgICAgICAgdGhpcy50b2dnbGUoKTtcbiAgICAgICAgICAgIHRoaXMuX2VtaXRDaGFuZ2VFdmVudCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX29uSW50ZXJhY3Rpb25FdmVudChldmVudDogRXZlbnQpIHtcbiAgICAgICAgLy8gV2UgYWx3YXlzIGhhdmUgdG8gc3RvcCBwcm9wYWdhdGlvbiBvbiB0aGUgY2hhbmdlIGV2ZW50LlxuICAgICAgICAvLyBPdGhlcndpc2UgdGhlIGNoYW5nZSBldmVudCwgZnJvbSB0aGUgaW5wdXQgZWxlbWVudCwgd2lsbCBidWJibGUgdXAgYW5kXG4gICAgICAgIC8vIGVtaXQgaXRzIGV2ZW50IG9iamVjdCB0byB0aGUgYGNoYW5nZWAgb3V0cHV0LlxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9lbWl0Q2hhbmdlRXZlbnQoKSB7XG4gICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IE54U2VsZWN0YWJsZUNhcmRDaGFuZ2VFdmVudCh0aGlzLmNoZWNrZWQsIHRoaXMudmFsdWUsIHRoaXMpO1xuICAgICAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2sodGhpcy5jaGVja2VkKTtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25DaGFuZ2UuZW1pdChldmVudCk7XG4gICAgICAgIHRoaXMuY2hlY2tlZENoYW5nZS5lbWl0KHRoaXMuY2hlY2tlZCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZ2V0RXJyb3JMaXN0SWRzKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lcnJvckxpc3QubWFwKChlcnJvckl0ZW06IE54RXJyb3JDb21wb25lbnQpID0+IGVycm9ySXRlbS5pZCkuam9pbignICcpO1xuICAgIH1cbn1cbiIsIjxpbnB1dFxuICAgICNpbnB1dFxuICAgIHR5cGU9XCJjaGVja2JveFwiXG4gICAgW2NoZWNrZWRdPVwiY2hlY2tlZFwiXG4gICAgW3ZhbHVlXT1cInZhbHVlIHx8IG51bGxcIlxuICAgIFthdHRyLmRpc2FibGVkXT1cImRpc2FibGVkIHx8IG51bGxcIlxuICAgIChjaGFuZ2UpPVwiX29uSW50ZXJhY3Rpb25FdmVudCgkZXZlbnQpXCJcbiAgICAoYmx1cik9XCJvblRvdWNoZWRDYWxsYmFjaygkZXZlbnQpXCJcbiAgICBbYXR0ci5pZF09XCJpZFwiXG4gICAgW2F0dHIubmFtZV09XCJuYW1lXCJcbiAgICAoY2xpY2spPVwiX29uSW5wdXRDbGljaygkZXZlbnQpXCJcbiAgICBbcmVxdWlyZWRdPVwicmVxdWlyZWRcIlxuICAgIFthdHRyLmFyaWEtcmVxdWlyZWRdPVwicmVxdWlyZWRcIlxuICAgIFthdHRyLnRhYmluZGV4XT1cInRhYmluZGV4XCJcbiAgICBbYXR0ci5hcmlhLWludmFsaWRdPVwiX2Vycm9yU3RhdGVcIlxuICAgIFthdHRyLmFyaWEtZGVzY3JpYmVkYnldPVwiX2Vycm9yTGlzdElkcyB8fCBudWxsXCJcbi8+XG5cbjxsYWJlbCBbYXR0ci5mb3JdPVwiaWRcIj5cbiAgICA8c3BhbiBjbGFzcz1cImNoZWNrYm94XCIgKm5nSWY9XCJhcHBlYXJhbmNlID09PSAnZGVmYXVsdCc7IGVsc2UgZXhwZXJ0XCI+XG4gICAgICAgIDxueC1pY29uICpuZ0lmPVwiY2hlY2tlZFwiIG5hbWU9XCJjaGVja1wiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvbngtaWNvbj5cbiAgICA8L3NwYW4+XG5cbiAgICA8ZGl2IGNsYXNzPVwiY29udGVudFwiPlxuICAgICAgICA8bmctY29udGVudCBzZWxlY3Q9XCJueC1jYXJkLWhlYWRlclwiPjwvbmctY29udGVudD5cbiAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgICAgICA8bmctY29udGVudCBzZWxlY3Q9XCJueC1jYXJkLWZvb3RlclwiPjwvbmctY29udGVudD5cbiAgICA8L2Rpdj5cbjwvbGFiZWw+XG5cbjxuZy1jb250ZW50ICpuZ0lmPVwiX2Vycm9yU3RhdGVcIiBzZWxlY3Q9XCJueC1lcnJvclwiPjwvbmctY29udGVudD5cblxuPG5nLXRlbXBsYXRlICNleHBlcnQ+XG4gICAgPG54LWljb24gbmFtZT1cImNoZWNrLWNpcmNsZVwiIHNpemU9XCJzXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCIgY2xhc3M9XCJjaGVja21hcmtcIj4gPC9ueC1pY29uPlxuPC9uZy10ZW1wbGF0ZT5cbiJdfQ==