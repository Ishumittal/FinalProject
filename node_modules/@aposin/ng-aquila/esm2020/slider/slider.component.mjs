import { coerceBooleanProperty, coerceNumberProperty } from '@angular/cdk/coercion';
import { DOWN_ARROW, LEFT_ARROW, RIGHT_ARROW, UP_ARROW } from '@angular/cdk/keycodes';
import { ChangeDetectionStrategy, Component, EventEmitter, forwardRef, Input, Optional, Output, ViewChild, } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { clamp } from '@aposin/ng-aquila/utils';
import { Decimal } from 'decimal.js';
import { fromEvent } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/bidi";
import * as i2 from "@angular/cdk/a11y";
import * as i3 from "@angular/common";
let nextId = 0;
const DEFAULT_MIN = 0;
const DEFAULT_MAX = 100;
const DEFAULT_STEP = 1;
const DEFAULT_LABEL_POSITION = '-50%';
const VALUE_MARGIN = 4;
export class NxSliderComponent {
    constructor(elementRef, _cdr, _ngZone, _dir, _focusMonitor) {
        this.elementRef = elementRef;
        this._cdr = _cdr;
        this._ngZone = _ngZone;
        this._dir = _dir;
        this._focusMonitor = _focusMonitor;
        this._dragSubscriptions = [];
        this._value = 0;
        this._decimalPlaces = 0;
        this._step = DEFAULT_STEP;
        this._id = `nx-slider-${nextId++}`;
        this._tabIndex = 0;
        this._min = DEFAULT_MIN;
        this._max = DEFAULT_MAX;
        this._label = '';
        this._inverted = false;
        this._thumbLabel = true;
        this._negative = false;
        this._hideLabels = false;
        this._disabled = false;
        this._tickInterval = 0;
        this.ticks = [];
        this._labelPosition = DEFAULT_LABEL_POSITION;
        this._longTicks = [0];
        /** An event is dispatched on each value change. */
        this.valueChange = new EventEmitter();
        /** Sets the customization function for the value which is displayed above the slider handle (Default:(value) => value). ). */
        this.valueFormatter = (value) => value;
        /** Sets the customization function for the label on the min-side of the slider (Default:(value) => value). */
        this.labelMinFormatter = (value) => value;
        /** Sets the customization function for the label on the max-side of the slider (Default:(value) => value). */
        this.labelMaxFormatter = (value) => value;
        this._onChange = () => { };
        this._onTouched = () => { };
    }
    /**
     * How often to show ticks. Relative to the step so that a tick always appears on a step.
     * Ex: Tick interval of 4 with a step of 3 will draw a tick every 4 steps (every 12 values).
     */
    set tickInterval(value) {
        this._tickInterval = coerceNumberProperty(value);
        this.ticks = this.getTicks(this.min, this.max, this.step, this._tickInterval, this.longTicks);
        this._cdr.markForCheck();
    }
    get tickInterval() {
        return this._tickInterval;
    }
    /** Sets the id of the slider. */
    set id(value) {
        if (this._id !== value) {
            this._id = value;
            this._cdr.markForCheck();
        }
    }
    get id() {
        return this._id;
    }
    /** Sets the tabindex of the slider. */
    set tabindex(value) {
        this._tabIndex = coerceNumberProperty(value);
        this._cdr.markForCheck();
    }
    get tabindex() {
        return this._disabled ? -1 : this._tabIndex;
    }
    /** Sets the minimum value (Default: 0). */
    set min(value) {
        this._min = coerceNumberProperty(value);
        this.ticks = this.getTicks(this._min, this.max, this.step, this.tickInterval, this.longTicks);
        this._cdr.markForCheck();
    }
    get min() {
        return this._min;
    }
    /** Sets the maximum value (Default: 100). */
    set max(value) {
        this._max = coerceNumberProperty(value);
        this.ticks = this.getTicks(this.min, this._max, this.step, this.tickInterval, this.longTicks);
        this._cdr.markForCheck();
    }
    get max() {
        return this._max;
    }
    /** Sets the step size by which the value of the slider can be increased or decreased (Default: 1). */
    get step() {
        return this._step;
    }
    set step(value) {
        this._step = coerceNumberProperty(value, this._step);
        this.ticks = this.getTicks(this.min, this.max, this._step, this._tickInterval, this.longTicks);
        if (this._step % 1 !== 0) {
            this._decimalPlaces = this._step.toString().split('.').pop().length;
        }
        this._cdr.markForCheck();
    }
    /** Sets the label which is displayed on top of the slider. */
    set label(value) {
        if (this._label !== value) {
            this._label = value;
            this._cdr.markForCheck();
        }
    }
    get label() {
        return this._label;
    }
    /** Whether the input to the control of the slider should be disabled. */
    set disabled(value) {
        this._disabled = coerceBooleanProperty(value);
        this._cdr.markForCheck();
    }
    get disabled() {
        return this._disabled;
    }
    /** Whether the max value is to the right (false) or left (true).*/
    set inverted(value) {
        this._inverted = coerceBooleanProperty(value);
        this._cdr.markForCheck();
    }
    get inverted() {
        return this._inverted;
    }
    /** Whether to display the thumb label on top of the slider.*/
    set thumbLabel(value) {
        this._thumbLabel = coerceBooleanProperty(value);
        this._cdr.markForCheck();
    }
    get thumbLabel() {
        return this._thumbLabel;
    }
    /** Whether the negative set of styles is applied (Default: 'false').*/
    set negative(value) {
        this._negative = coerceBooleanProperty(value);
        this._cdr.markForCheck();
    }
    get negative() {
        return this._negative;
    }
    /** Hides the min/max labels (Default: 'false'). */
    set hideLabels(value) {
        this._hideLabels = coerceBooleanProperty(value);
        this._cdr.markForCheck();
    }
    get hideLabels() {
        return this._hideLabels;
    }
    /** Sets the array of value which will render as long tick (Default: Middle value if present). */
    set longTicks(value) {
        if (this._longTicks !== value) {
            this._longTicks = value;
            this.ticks = this.getTicks(this.min, this.max, this.step, this.tickInterval, this._longTicks);
            this._cdr.markForCheck();
        }
    }
    get longTicks() {
        return this._longTicks;
    }
    ngAfterViewInit() {
        this._focusMonitor.monitor(this._handleElement);
        setTimeout(() => {
            this._updateLabelPosition();
        });
    }
    /** Sets the current value of the slider. */
    set value(value) {
        this.writeValue(Number(value));
        // wait for rerender to calculate latest label position
        setTimeout(() => {
            this._updateLabelPosition();
        });
    }
    get value() {
        return this._value;
    }
    ngOnDestroy() {
        this._reset();
        this._focusMonitor.stopMonitoring(this._handleElement);
    }
    writeValue(value) {
        if (value !== this._value) {
            this._value = value;
            this.valueChange.emit(value);
            this._cdr.markForCheck();
        }
    }
    registerOnChange(fn) {
        this._onChange = fn;
    }
    registerOnTouched(fn) {
        this._onTouched = fn;
    }
    setDisabledState(disabled) {
        this.disabled = disabled;
    }
    _isMinimum() {
        return this._value === this.min;
    }
    /**
     * Checks if the value is in the boundaries of min/max and if it is a multiple of `step.
     */
    _isValidStep() {
        const safeValue = new Decimal(this._value).minus(this.min);
        const modulo = safeValue.mod(this.step);
        return this._isMinimum() || modulo.cmp(0) === 0;
    }
    /**
     * We have to look at two cases:
     * - current value is a valid multitude of the step size
     *   then we can safely add or subtract the step
     * - the value is not a valid multitude. this could be the max value or the value bound
     *   via nxValue
     *   then we look for the next closest value upwards or downwards
     *   decimal.js provides a nice utility function for this.
     */
    _changeValue(valueDiff) {
        let newValue = new Decimal(this._value);
        if (this._isValidStep()) {
            newValue = newValue.plus(valueDiff);
        }
        else {
            // subtract the minimum to find the closest multitude then add the minimum again to get the valid slider step
            const minAdjustedValue = new Decimal(this._value).minus(this.min);
            newValue = valueDiff < 0 ? minAdjustedValue.toNearest(this.step, Decimal.ROUND_DOWN) : minAdjustedValue.toNearest(this.step, Decimal.ROUND_UP);
            newValue = newValue.plus(this.min);
        }
        // cast the Decimal object to a JS number before it gets returned
        let toNumber = newValue.toNumber();
        toNumber = clamp(toNumber, this.min, this.max);
        if (this.value !== toNumber) {
            this._onChange(toNumber);
            this.valueChange.emit(toNumber);
            this.value = toNumber;
        }
    }
    get _percentageValue() {
        let percentageValue = (((this.value || 0) - this.min) / (this.max - this.min)) * 100;
        if (this.inverted) {
            percentageValue = 100 - percentageValue;
        }
        return clamp(percentageValue, 0, 100);
    }
    _sliderClick(event) {
        if (this.disabled) {
            return;
        }
        this._focusHandleElement();
        event.stopPropagation();
        const position = this._getPositionFromEvent(event);
        const newValue = this._getValueFromPosition(position);
        if (this.value !== newValue) {
            this.value = newValue;
            this._onChange(this.value);
        }
    }
    _focus() {
        // if (this.disabled) {}
        this._focusHandleElement();
    }
    /**
     * Prevent text selection when dragging the handle.
     */
    _selectStart() {
        return false;
    }
    _handleKeypress(event) {
        if (this.disabled) {
            return;
        }
        // TODO return statement should not substitute break keyword
        switch (event.keyCode) {
            case DOWN_ARROW:
            case this.inverted ? RIGHT_ARROW : LEFT_ARROW:
                return this._changeValue(-this.step);
            case UP_ARROW:
            case this.inverted ? LEFT_ARROW : RIGHT_ARROW:
                return this._changeValue(this.step);
        }
    }
    /**
     * This is called on mousedown or touchstart
     */
    _dragStart() {
        if (this.disabled) {
            return;
        }
        this._ngZone.runOutsideAngular(() => {
            this._dragSubscriptions.push(fromEvent(document, 'touchmove').subscribe(this._handleDragMove.bind(this)));
            this._dragSubscriptions.push(fromEvent(document, 'mousemove').subscribe(this._handleDragMove.bind(this)));
        });
        this._dragSubscriptions.push(fromEvent(document, 'touchcancel').subscribe(this._handleDragStop.bind(this)));
        this._dragSubscriptions.push(fromEvent(document, 'mouseup').subscribe(this._handleDragStop.bind(this)));
        this._dragSubscriptions.push(fromEvent(document, 'touchend').subscribe(this._handleDragStop.bind(this)));
    }
    _formatValue(value) {
        return this.valueFormatter(value);
    }
    _formatLabelLeft() {
        return this.inverted ? this._formatLabelMax() : this._formatLabelMin();
    }
    _formatLabelRight() {
        return this.inverted ? this._formatLabelMin() : this._formatLabelMax();
    }
    _formatLabelMin() {
        return this.labelMinFormatter(this.min);
    }
    _formatLabelMax() {
        return this.labelMaxFormatter(this.max);
    }
    _focusHandleElement() {
        this._handleElement.nativeElement.focus();
    }
    _updateLabelPosition() {
        const label = this._handleElement.nativeElement.querySelector('.nx-slider__value');
        if (!label) {
            return;
        }
        const handleRect = this._handleElement.nativeElement.getBoundingClientRect();
        const valueRect = label.getBoundingClientRect(label);
        const handleCenter = handleRect.left + handleRect.width / 2;
        const labelLeft = handleCenter - valueRect.width / 2;
        const labelRight = handleCenter + valueRect.width / 2;
        const bodyWidth = document.body.offsetWidth;
        let position = DEFAULT_LABEL_POSITION;
        if (labelLeft < 0) {
            position = -handleCenter + VALUE_MARGIN + 'px';
        }
        else if (labelRight > bodyWidth) {
            position = -valueRect.width + bodyWidth - handleCenter - VALUE_MARGIN + 'px';
        }
        this._labelPosition = `translateX(${position})`;
        this._cdr.markForCheck();
    }
    _getValueFromPosition(position) {
        const isRTL = this._dir?.value === 'rtl';
        const rect = this.elementRef.nativeElement.getBoundingClientRect();
        const x = Math.max(rect.left, Math.min(rect.right, position));
        // position of slider relative to slider width
        let percent = (x - rect.left) / rect.width;
        if (this.inverted) {
            percent = 1 - percent;
        }
        if (isRTL) {
            percent = 1 - percent;
        }
        // edge case handling because of float precision errors you couldn't reach the maximum
        let closestValue;
        if (percent === 1) {
            closestValue = this.max;
        }
        else if (percent === 0) {
            closestValue = this.min;
        }
        else {
            const exactValue = this.min + percent * (this.max - this.min);
            closestValue = Math.round((exactValue - this.min) / this.step) * this.step + this.min;
        }
        if (this._decimalPlaces) {
            closestValue = this._roundToDecimal(closestValue);
        }
        return clamp(closestValue, this.min, this.max);
    }
    _roundToDecimal(value) {
        return parseFloat(value.toFixed(this._decimalPlaces));
    }
    _handleDragMove(event) {
        event.preventDefault();
        const position = this._getPositionFromEvent(event);
        const newValue = this._getValueFromPosition(position);
        if (this.value !== newValue) {
            // run change detection to update value and position of handle
            this._ngZone.run(() => {
                this.value = newValue;
                this._onChange(this.value);
                this._cdr.markForCheck();
            });
        }
    }
    _handleDragStop(event) {
        this._reset();
        const position = this._getPositionFromEvent(event);
        const newValue = this._getValueFromPosition(position);
        if (this.value !== newValue) {
            this.value = newValue;
            this._onChange(this.value);
        }
    }
    _reset() {
        for (const subscription of this._dragSubscriptions) {
            subscription.unsubscribe();
        }
        this._dragSubscriptions = [];
    }
    _getPositionFromEvent(event) {
        const cursor = event.type.includes('touch') ? event.touches.item(0) : event;
        return cursor.clientX;
    }
    getTicks(min, max, step, interval, longTick = []) {
        if (!interval) {
            return [];
        }
        const range = max - min;
        const stepProduct = step * interval;
        const gapSize = (stepProduct / range) * 100; // %
        const numberOfTicks = Math.floor(100 / gapSize);
        const spaceLeft = 100 - gapSize * numberOfTicks; // %
        const hiddenThreshold = 3; // %
        if (!longTick.length) {
            const middleValue = range / 2;
            longTick.push(middleValue);
        }
        return Array.from({ length: numberOfTicks }, (_, i) => {
            const index = i + 1;
            const value = index * stepProduct;
            return {
                gapSize,
                hideTick: index === numberOfTicks && spaceLeft <= hiddenThreshold,
                isLongTick: longTick.includes(value),
            };
        });
    }
}
NxSliderComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxSliderComponent, deps: [{ token: i0.ElementRef }, { token: i0.ChangeDetectorRef }, { token: i0.NgZone }, { token: i1.Directionality, optional: true }, { token: i2.FocusMonitor }], target: i0.ɵɵFactoryTarget.Component });
NxSliderComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxSliderComponent, selector: "nx-slider", inputs: { tickInterval: "tickInterval", id: "id", tabindex: "tabindex", min: ["nxMin", "min"], max: ["nxMax", "max"], step: ["nxStep", "step"], label: ["nxLabel", "label"], disabled: "disabled", inverted: ["nxInverted", "inverted"], thumbLabel: "thumbLabel", negative: "negative", hideLabels: "hideLabels", longTicks: "longTicks", valueFormatter: ["nxValueFormatter", "valueFormatter"], labelMinFormatter: ["nxLabelMinFormatter", "labelMinFormatter"], labelMaxFormatter: ["nxLabelMaxFormatter", "labelMaxFormatter"], value: ["nxValue", "value"] }, outputs: { valueChange: "nxValueChange" }, host: { listeners: { "keydown": "_handleKeypress($event)" }, properties: { "attr.aria-disabled": "disabled ? true : null", "class.nx-slider--disabled": "disabled", "class.nx-slider--negative": "negative" } }, providers: [
        {
            provide: NG_VALUE_ACCESSOR,
            useExisting: forwardRef(() => NxSliderComponent),
            multi: true,
        },
    ], viewQueries: [{ propertyName: "_handleElement", first: true, predicate: ["handle"], descendants: true, static: true }], ngImport: i0, template: "<label class=\"nx-slider__label\" [id]=\"id + '-label'\" [attr.for]=\"id + '-handle'\" (click)=\"_focusHandleElement()\">{{ label }}</label>\n\n<div class=\"nx-slider__wrapper\" (click)=\"_sliderClick($event)\" [class.nx-slider__has-ticks]=\"!tickInterval\">\n    <span class=\"nx-slider__background\">\n        <span class=\"nx-slider__filler\" [style.width.%]=\"_percentageValue\">\n            <div\n                class=\"nx-slider__handle\"\n                [id]=\"id + '-handle'\"\n                [attr.tabindex]=\"tabindex\"\n                [attr.aria-labelledby]=\"id + '-label'\"\n                role=\"slider\"\n                [attr.aria-valuemin]=\"_formatLabelMin()\"\n                [attr.aria-valuemax]=\"_formatLabelMax()\"\n                [attr.aria-valuetext]=\"_formatValue(value)\"\n                [attr.aria-valuenow]=\"_formatValue(value)\"\n                (mousedown)=\"_dragStart()\"\n                (touchstart)=\"_dragStart()\"\n                (selectstart)=\"_selectStart()\"\n                #handle\n            >\n                <ng-container *ngIf=\"thumbLabel\">\n                    <span [style.transform]=\"_labelPosition\" class=\"nx-slider__value\">{{ _formatValue(value) }} </span>\n                    <div class=\"nx-slider__arrow\"> </div>\n                </ng-container>\n            </div>\n        </span>\n    </span>\n    <div *ngIf=\"tickInterval\" class=\"nx-slider__tick-container\">\n        <div\n            *ngFor=\"let t of ticks\"\n            class=\"nx-slider__tick\"\n            [class.nx-slider__tick-primary]=\"t.isLongTick\"\n            [class.nx-slider__tick-hidden]=\"t.hideTick\"\n            [ngStyle]=\"{ width: t.gapSize + '%' }\"\n        ></div>\n    </div>\n</div>\n\n<div *ngIf=\"!hideLabels\" class=\"nx-slider__label-container\">\n    <span class=\"nx-slider__value-label\">{{ _formatLabelLeft() }}</span>\n    <span class=\"nx-slider__value-label\">{{ _formatLabelRight() }}</span>\n</div>\n", styles: [":host{display:block}.nx-slider__label{font-size:var(--slider-label-font-size);line-height:var(--slider-label-line-height);font-weight:var(--slider-label-font-weight);letter-spacing:var(--slider-label-letter-spacing);color:var(--slider-label-color)}.nx-slider__wrapper{width:100%;padding-top:66px;padding-left:0;padding-right:0}.nx-slider__wrapper.nx-slider__has-ticks{padding-bottom:18px}.nx-slider__background{position:relative;background-color:var(--slider-background-color);display:block;height:4px;border-radius:2px;white-space:nowrap;cursor:pointer}.nx-slider__tick-container{margin-top:9px;display:flex;border-left:1px solid var(--slider-tick-color);border-right:1px solid var(--slider-tick-color);height:9px;align-items:center;overflow:hidden}.nx-slider__tick{height:5px;display:flex;border-right:1px solid var(--slider-tick-color)}.nx-slider__tick.nx-slider__tick-primary{height:9px}.nx-slider__tick.nx-slider__tick-hidden{border:none}.nx-slider__filler{display:inline-block;height:4px;border-radius:2px;background-color:var(--slider-indicator-color);float:left;position:relative}:host-context([dir=rtl]) .nx-slider__filler{float:right}.nx-slider__handle{position:absolute;width:24px;height:24px;right:0;transform:translate(50%);border-radius:50%;box-shadow:var(--shadow-small);border-style:solid;border-width:1px;border-color:var(--slider-handle-border-color);background:var(--slider-handle-background-color);box-sizing:border-box;top:-10px;z-index:2;cursor:grab}:host-context([dir=rtl]) .nx-slider__handle{left:0;right:auto;transform:translate(-50%)}.nx-slider__handle:focus{outline:none;border-color:var(--slider-handle-focus-border-color)}.nx-slider__handle:active{box-shadow:var(--shadow-small),inset 0 0 0 4px var(--slider-handle-background-color),inset 0 0 0 24px var(--slider-handle-active-inset-color);cursor:grabbing}.nx-slider__handle.cdk-keyboard-focused{border-color:var(--slider-handle-focus-border-color);box-shadow:var(--focus-box-shadow)}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-slider__handle.cdk-keyboard-focused{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}.nx-slider__value{display:block;position:absolute;font-size:var(--slider-handle-value-font-size);line-height:var(--slider-handle-value-line-height);font-weight:var(--slider-handle-value-font-weight);letter-spacing:var(--slider-handle-value-letter-spacing);color:var(--slider-handle-value-color);border:1px solid;border-color:var(--slider-handle-border-color);border-radius:4px;box-shadow:var(--shadow-small);cursor:grab;height:24px;min-width:48px;text-align:center;padding:3px 8px;top:-40px;background:var(--slider-value-background-color);left:12px;transform:translate(-50%)}.nx-slider__value:active{cursor:grabbing}.nx-slider__arrow{width:6px;height:6px;border-right:1px solid;border-bottom:1px solid;left:50%;top:-22px;transform:translate(-50%,3px) rotate(45deg);position:absolute;box-shadow:-2px -2px 1px 1px var(--slider-value-background-color),2px 2px 4px var(--shadow-small-color);background:var(--slider-value-background-color);border-color:var(--slider-handle-border-color)}.nx-slider__label-container{display:flex;width:100%;justify-content:space-between;font-size:var(--slider-value-label-font-size);line-height:var(--slider-value-label-line-height);font-weight:var(--slider-value-label-font-weight);letter-spacing:var(--slider-value-label-letter-spacing);color:var(--slider-value-label-color)}.nx-slider__max-value-label{text-align:right}:host(.nx-slider--disabled){cursor:not-allowed}:host(.nx-slider--disabled) .nx-slider__filler,:host(.nx-slider--disabled) .nx-slider__value,:host(.nx-slider--disabled) .nx-slider__value-label,:host(.nx-slider--disabled) .nx-slider__handle,:host(.nx-slider--disabled) .nx-slider__background{pointer-events:none;cursor:not-allowed}:host(.nx-slider--disabled) .nx-slider__value,:host(.nx-slider--disabled) .nx-slider__handle{background-color:var(--slider-value-disabled-background-color)}:host(.nx-slider--disabled) .nx-slider__filler{background-color:var(--slider-indicator-disabled-color)}:host(.nx-slider--disabled) .nx-slider__value{color:var(--slider-handle-value-disabled-color)}:host(.nx-slider--disabled) .nx-slider__label-container{color:var(--slider-value-label-disabled-color)}:host(.nx-slider--disabled) .nx-slider__arrow{background:var(--slider-value-disabled-background-color);box-shadow:-2px -2px 1px 1px var(--slider-value-disabled-background-color),2px 2px 4px #41414180}:host(.nx-slider--disabled) .nx-slider__background{background:var(--slider-disabled-background-color)}:host(.nx-slider--negative) .nx-slider__label,:host(.nx-slider--negative) .nx-slider__value-label{color:var(--negative)}:host(.nx-slider--negative) .nx-slider__filler{background-color:var(--negative)}:host(.nx-slider--negative) .nx-slider__background{background-color:var(--slider-negative-background-color)}:host(.nx-slider--negative.nx-slider--disabled) .nx-slider__label,:host(.nx-slider--negative.nx-slider--disabled) .nx-slider__value-label{color:var(--negative-01)}:host(.nx-slider--negative.nx-slider--disabled) .nx-slider__filler{background-color:var(--negative-01)}@media screen and (-ms-high-contrast: active){.nx-slider__background{background-color:buttonFace;border:1px solid buttonText}.nx-slider__filler{background-color:highlight}.nx-slider__handle{background-color:buttonFace;border-color:buttonText}.nx-slider__handle:hover,.nx-slider__handle:focus{background-color:highlight}.nx-slider__handle:active{background-color:buttonText}.nx-slider__value{border-color:buttonText;color:buttonText}:host(.nx-slider--disabled) .nx-slider__background{background-color:Canvas;border:1px solid GrayText}:host(.nx-slider--disabled) .nx-slider__filler{background-color:GrayText}:host(.nx-slider--disabled) .nx-slider__handle{background-color:GrayText}:host(.nx-slider--disabled) .nx-slider__value{border-color:GrayText;color:GrayText}:host(.nx-slider--disabled) .nx-slider__arrow{border-color:GrayText}:host.nx-slider--negative.nx-slider--disabled .nx-slider__filler{background-color:GrayText}}\n"], directives: [{ type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i3.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxSliderComponent, decorators: [{
            type: Component,
            args: [{ selector: 'nx-slider', changeDetection: ChangeDetectionStrategy.OnPush, providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => NxSliderComponent),
                            multi: true,
                        },
                    ], host: {
                        '[attr.aria-disabled]': 'disabled ? true : null',
                        '(keydown)': '_handleKeypress($event)',
                        '[class.nx-slider--disabled]': 'disabled',
                        '[class.nx-slider--negative]': 'negative',
                    }, template: "<label class=\"nx-slider__label\" [id]=\"id + '-label'\" [attr.for]=\"id + '-handle'\" (click)=\"_focusHandleElement()\">{{ label }}</label>\n\n<div class=\"nx-slider__wrapper\" (click)=\"_sliderClick($event)\" [class.nx-slider__has-ticks]=\"!tickInterval\">\n    <span class=\"nx-slider__background\">\n        <span class=\"nx-slider__filler\" [style.width.%]=\"_percentageValue\">\n            <div\n                class=\"nx-slider__handle\"\n                [id]=\"id + '-handle'\"\n                [attr.tabindex]=\"tabindex\"\n                [attr.aria-labelledby]=\"id + '-label'\"\n                role=\"slider\"\n                [attr.aria-valuemin]=\"_formatLabelMin()\"\n                [attr.aria-valuemax]=\"_formatLabelMax()\"\n                [attr.aria-valuetext]=\"_formatValue(value)\"\n                [attr.aria-valuenow]=\"_formatValue(value)\"\n                (mousedown)=\"_dragStart()\"\n                (touchstart)=\"_dragStart()\"\n                (selectstart)=\"_selectStart()\"\n                #handle\n            >\n                <ng-container *ngIf=\"thumbLabel\">\n                    <span [style.transform]=\"_labelPosition\" class=\"nx-slider__value\">{{ _formatValue(value) }} </span>\n                    <div class=\"nx-slider__arrow\"> </div>\n                </ng-container>\n            </div>\n        </span>\n    </span>\n    <div *ngIf=\"tickInterval\" class=\"nx-slider__tick-container\">\n        <div\n            *ngFor=\"let t of ticks\"\n            class=\"nx-slider__tick\"\n            [class.nx-slider__tick-primary]=\"t.isLongTick\"\n            [class.nx-slider__tick-hidden]=\"t.hideTick\"\n            [ngStyle]=\"{ width: t.gapSize + '%' }\"\n        ></div>\n    </div>\n</div>\n\n<div *ngIf=\"!hideLabels\" class=\"nx-slider__label-container\">\n    <span class=\"nx-slider__value-label\">{{ _formatLabelLeft() }}</span>\n    <span class=\"nx-slider__value-label\">{{ _formatLabelRight() }}</span>\n</div>\n", styles: [":host{display:block}.nx-slider__label{font-size:var(--slider-label-font-size);line-height:var(--slider-label-line-height);font-weight:var(--slider-label-font-weight);letter-spacing:var(--slider-label-letter-spacing);color:var(--slider-label-color)}.nx-slider__wrapper{width:100%;padding-top:66px;padding-left:0;padding-right:0}.nx-slider__wrapper.nx-slider__has-ticks{padding-bottom:18px}.nx-slider__background{position:relative;background-color:var(--slider-background-color);display:block;height:4px;border-radius:2px;white-space:nowrap;cursor:pointer}.nx-slider__tick-container{margin-top:9px;display:flex;border-left:1px solid var(--slider-tick-color);border-right:1px solid var(--slider-tick-color);height:9px;align-items:center;overflow:hidden}.nx-slider__tick{height:5px;display:flex;border-right:1px solid var(--slider-tick-color)}.nx-slider__tick.nx-slider__tick-primary{height:9px}.nx-slider__tick.nx-slider__tick-hidden{border:none}.nx-slider__filler{display:inline-block;height:4px;border-radius:2px;background-color:var(--slider-indicator-color);float:left;position:relative}:host-context([dir=rtl]) .nx-slider__filler{float:right}.nx-slider__handle{position:absolute;width:24px;height:24px;right:0;transform:translate(50%);border-radius:50%;box-shadow:var(--shadow-small);border-style:solid;border-width:1px;border-color:var(--slider-handle-border-color);background:var(--slider-handle-background-color);box-sizing:border-box;top:-10px;z-index:2;cursor:grab}:host-context([dir=rtl]) .nx-slider__handle{left:0;right:auto;transform:translate(-50%)}.nx-slider__handle:focus{outline:none;border-color:var(--slider-handle-focus-border-color)}.nx-slider__handle:active{box-shadow:var(--shadow-small),inset 0 0 0 4px var(--slider-handle-background-color),inset 0 0 0 24px var(--slider-handle-active-inset-color);cursor:grabbing}.nx-slider__handle.cdk-keyboard-focused{border-color:var(--slider-handle-focus-border-color);box-shadow:var(--focus-box-shadow)}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-slider__handle.cdk-keyboard-focused{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}.nx-slider__value{display:block;position:absolute;font-size:var(--slider-handle-value-font-size);line-height:var(--slider-handle-value-line-height);font-weight:var(--slider-handle-value-font-weight);letter-spacing:var(--slider-handle-value-letter-spacing);color:var(--slider-handle-value-color);border:1px solid;border-color:var(--slider-handle-border-color);border-radius:4px;box-shadow:var(--shadow-small);cursor:grab;height:24px;min-width:48px;text-align:center;padding:3px 8px;top:-40px;background:var(--slider-value-background-color);left:12px;transform:translate(-50%)}.nx-slider__value:active{cursor:grabbing}.nx-slider__arrow{width:6px;height:6px;border-right:1px solid;border-bottom:1px solid;left:50%;top:-22px;transform:translate(-50%,3px) rotate(45deg);position:absolute;box-shadow:-2px -2px 1px 1px var(--slider-value-background-color),2px 2px 4px var(--shadow-small-color);background:var(--slider-value-background-color);border-color:var(--slider-handle-border-color)}.nx-slider__label-container{display:flex;width:100%;justify-content:space-between;font-size:var(--slider-value-label-font-size);line-height:var(--slider-value-label-line-height);font-weight:var(--slider-value-label-font-weight);letter-spacing:var(--slider-value-label-letter-spacing);color:var(--slider-value-label-color)}.nx-slider__max-value-label{text-align:right}:host(.nx-slider--disabled){cursor:not-allowed}:host(.nx-slider--disabled) .nx-slider__filler,:host(.nx-slider--disabled) .nx-slider__value,:host(.nx-slider--disabled) .nx-slider__value-label,:host(.nx-slider--disabled) .nx-slider__handle,:host(.nx-slider--disabled) .nx-slider__background{pointer-events:none;cursor:not-allowed}:host(.nx-slider--disabled) .nx-slider__value,:host(.nx-slider--disabled) .nx-slider__handle{background-color:var(--slider-value-disabled-background-color)}:host(.nx-slider--disabled) .nx-slider__filler{background-color:var(--slider-indicator-disabled-color)}:host(.nx-slider--disabled) .nx-slider__value{color:var(--slider-handle-value-disabled-color)}:host(.nx-slider--disabled) .nx-slider__label-container{color:var(--slider-value-label-disabled-color)}:host(.nx-slider--disabled) .nx-slider__arrow{background:var(--slider-value-disabled-background-color);box-shadow:-2px -2px 1px 1px var(--slider-value-disabled-background-color),2px 2px 4px #41414180}:host(.nx-slider--disabled) .nx-slider__background{background:var(--slider-disabled-background-color)}:host(.nx-slider--negative) .nx-slider__label,:host(.nx-slider--negative) .nx-slider__value-label{color:var(--negative)}:host(.nx-slider--negative) .nx-slider__filler{background-color:var(--negative)}:host(.nx-slider--negative) .nx-slider__background{background-color:var(--slider-negative-background-color)}:host(.nx-slider--negative.nx-slider--disabled) .nx-slider__label,:host(.nx-slider--negative.nx-slider--disabled) .nx-slider__value-label{color:var(--negative-01)}:host(.nx-slider--negative.nx-slider--disabled) .nx-slider__filler{background-color:var(--negative-01)}@media screen and (-ms-high-contrast: active){.nx-slider__background{background-color:buttonFace;border:1px solid buttonText}.nx-slider__filler{background-color:highlight}.nx-slider__handle{background-color:buttonFace;border-color:buttonText}.nx-slider__handle:hover,.nx-slider__handle:focus{background-color:highlight}.nx-slider__handle:active{background-color:buttonText}.nx-slider__value{border-color:buttonText;color:buttonText}:host(.nx-slider--disabled) .nx-slider__background{background-color:Canvas;border:1px solid GrayText}:host(.nx-slider--disabled) .nx-slider__filler{background-color:GrayText}:host(.nx-slider--disabled) .nx-slider__handle{background-color:GrayText}:host(.nx-slider--disabled) .nx-slider__value{border-color:GrayText;color:GrayText}:host(.nx-slider--disabled) .nx-slider__arrow{border-color:GrayText}:host.nx-slider--negative.nx-slider--disabled .nx-slider__filler{background-color:GrayText}}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.ChangeDetectorRef }, { type: i0.NgZone }, { type: i1.Directionality, decorators: [{
                    type: Optional
                }] }, { type: i2.FocusMonitor }]; }, propDecorators: { tickInterval: [{
                type: Input,
                args: ['tickInterval']
            }], _handleElement: [{
                type: ViewChild,
                args: ['handle', { static: true }]
            }], id: [{
                type: Input,
                args: ['id']
            }], tabindex: [{
                type: Input
            }], min: [{
                type: Input,
                args: ['nxMin']
            }], max: [{
                type: Input,
                args: ['nxMax']
            }], step: [{
                type: Input,
                args: ['nxStep']
            }], label: [{
                type: Input,
                args: ['nxLabel']
            }], disabled: [{
                type: Input
            }], inverted: [{
                type: Input,
                args: ['nxInverted']
            }], thumbLabel: [{
                type: Input
            }], negative: [{
                type: Input,
                args: ['negative']
            }], hideLabels: [{
                type: Input,
                args: ['hideLabels']
            }], longTicks: [{
                type: Input,
                args: ['longTicks']
            }], valueChange: [{
                type: Output,
                args: ['nxValueChange']
            }], valueFormatter: [{
                type: Input,
                args: ['nxValueFormatter']
            }], labelMinFormatter: [{
                type: Input,
                args: ['nxLabelMinFormatter']
            }], labelMaxFormatter: [{
                type: Input,
                args: ['nxLabelMaxFormatter']
            }], value: [{
                type: Input,
                args: ['nxValue']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpZGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWFxdWlsYS9zcmMvc2xpZGVyL3NsaWRlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1hcXVpbGEvc3JjL3NsaWRlci9zbGlkZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFnQixxQkFBcUIsRUFBRSxvQkFBb0IsRUFBZSxNQUFNLHVCQUF1QixDQUFDO0FBQy9HLE9BQU8sRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUN0RixPQUFPLEVBRUgsdUJBQXVCLEVBRXZCLFNBQVMsRUFFVCxZQUFZLEVBQ1osVUFBVSxFQUNWLEtBQUssRUFHTCxRQUFRLEVBQ1IsTUFBTSxFQUNOLFNBQVMsR0FDWixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ2hELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDckMsT0FBTyxFQUFFLFNBQVMsRUFBZ0IsTUFBTSxNQUFNLENBQUM7Ozs7O0FBUS9DLElBQUksTUFBTSxHQUFHLENBQUMsQ0FBQztBQUVmLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBQztBQUN0QixNQUFNLFdBQVcsR0FBRyxHQUFHLENBQUM7QUFDeEIsTUFBTSxZQUFZLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZCLE1BQU0sc0JBQXNCLEdBQUcsTUFBTSxDQUFDO0FBQ3RDLE1BQU0sWUFBWSxHQUFHLENBQUMsQ0FBQztBQXFCdkIsTUFBTSxPQUFPLGlCQUFpQjtJQXdMMUIsWUFDWSxVQUFzQixFQUN0QixJQUF1QixFQUN2QixPQUFlLEVBQ0gs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VUssU0FBUztzQkFBaEMsS0FBSzt1QkFBQyxXQUFXO2dCQWFPLFdBQVc7c0JBQW5DLE1BQU07dUJBQUMsZUFBZTtnQkFHSSxjQUFjO3NCQUF4QyxLQUFLO3VCQUFDLGtCQUFrQjtnQkFHSyxpQkFBaUI7c0JBQTlDLEtBQUs7dUJBQUMscUJBQXFCO2dCQUdFLGlCQUFpQjtzQkFBOUMsS0FBSzt1QkFBQyxxQkFBcUI7Z0JBdUJ4QixLQUFLO3NCQURSLEtBQUs7dUJBQUMsU0FBUyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvY3VzTW9uaXRvciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9hMTF5JztcbmltcG9ydCB7IERpcmVjdGlvbmFsaXR5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2JpZGknO1xuaW1wb3J0IHsgQm9vbGVhbklucHV0LCBjb2VyY2VCb29sZWFuUHJvcGVydHksIGNvZXJjZU51bWJlclByb3BlcnR5LCBOdW1iZXJJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2VyY2lvbic7XG5pbXBvcnQgeyBET1dOX0FSUk9XLCBMRUZUX0FSUk9XLCBSSUdIVF9BUlJPVywgVVBfQVJST1cgfSBmcm9tICdAYW5ndWxhci9jZGsva2V5Y29kZXMnO1xuaW1wb3J0IHtcbiAgICBBZnRlclZpZXdJbml0LFxuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgIENvbXBvbmVudCxcbiAgICBFbGVtZW50UmVmLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBmb3J3YXJkUmVmLFxuICAgIElucHV0LFxuICAgIE5nWm9uZSxcbiAgICBPbkRlc3Ryb3ksXG4gICAgT3B0aW9uYWwsXG4gICAgT3V0cHV0LFxuICAgIFZpZXdDaGlsZCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBjbGFtcCB9IGZyb20gJ0BhcG9zaW4vbmctYXF1aWxhL3V0aWxzJztcbmltcG9ydCB7IERlY2ltYWwgfSBmcm9tICdkZWNpbWFsLmpzJztcbmltcG9ydCB7IGZyb21FdmVudCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbmludGVyZmFjZSBUaWNrSXRlbSB7XG4gICAgZ2FwU2l6ZTogbnVtYmVyO1xuICAgIGhpZGVUaWNrOiBib29sZWFuO1xuICAgIGlzTG9uZ1RpY2s6IGJvb2xlYW47XG59XG5cbmxldCBuZXh0SWQgPSAwO1xuXG5jb25zdCBERUZBVUxUX01JTiA9IDA7XG5jb25zdCBERUZBVUxUX01BWCA9IDEwMDtcbmNvbnN0IERFRkFVTFRfU1RFUCA9IDE7XG5jb25zdCBERUZBVUxUX0xBQkVMX1BPU0lUSU9OID0gJy01MCUnO1xuY29uc3QgVkFMVUVfTUFSR0lOID0gNDtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdueC1zbGlkZXInLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9zbGlkZXIuY29tcG9uZW50Lmh0bWwnLFxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICAgIHN0eWxlVXJsczogWycuL3NsaWRlci5jb21wb25lbnQuc2NzcyddLFxuICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgICAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IE54U2xpZGVyQ29tcG9uZW50KSxcbiAgICAgICAgICAgIG11bHRpOiB0cnVlLFxuICAgICAgICB9LFxuICAgIF0sXG4gICAgaG9zdDoge1xuICAgICAgICAnW2F0dHIuYXJpYS1kaXNhYmxlZF0nOiAnZGlzYWJsZWQgPyB0cnVlIDogbnVsbCcsXG4gICAgICAgICcoa2V5ZG93biknOiAnX2hhbmRsZUtleXByZXNzKCRldmVudCknLFxuICAgICAgICAnW2NsYXNzLm54LXNsaWRlci0tZGlzYWJsZWRdJzogJ2Rpc2FibGVkJyxcbiAgICAgICAgJ1tjbGFzcy5ueC1zbGlkZXItLW5lZ2F0aXZlXSc6ICduZWdhdGl2ZScsXG4gICAgfSxcbn0pXG5leHBvcnQgY2xhc3MgTnhTbGlkZXJDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcbiAgICBwcml2YXRlIF9kcmFnU3Vic2NyaXB0aW9uczogU3Vic2NyaXB0aW9uW10gPSBbXTtcbiAgICBwcml2YXRlIF92YWx1ZSA9IDA7XG4gICAgcHJpdmF0ZSBfZGVjaW1hbFBsYWNlcyA9IDA7XG4gICAgcHJpdmF0ZSBfc3RlcDogbnVtYmVyID0gREVGQVVMVF9TVEVQO1xuICAgIHByaXZhdGUgX2lkID0gYG54LXNsaWRlci0ke25leHRJZCsrfWA7XG4gICAgcHJpdmF0ZSBfdGFiSW5kZXggPSAwO1xuICAgIHByaXZhdGUgX21pbiA9IERFRkFVTFRfTUlOO1xuICAgIHByaXZhdGUgX21heCA9IERFRkFVTFRfTUFYO1xuICAgIHByaXZhdGUgX2xhYmVsID0gJyc7XG4gICAgcHJpdmF0ZSBfaW52ZXJ0ZWQgPSBmYWxzZTtcbiAgICBwcml2YXRlIF90aHVtYkxhYmVsID0gdHJ1ZTtcbiAgICBwcml2YXRlIF9uZWdhdGl2ZSA9IGZhbHNlO1xuICAgIHByaXZhdGUgX2hpZGVMYWJlbHMgPSBmYWxzZTtcbiAgICBwcml2YXRlIF9kaXNhYmxlZCA9IGZhbHNlO1xuXG4gICAgLyoqXG4gICAgICogSG93IG9mdGVuIHRvIHNob3cgdGlja3MuIFJlbGF0aXZlIHRvIHRoZSBzdGVwIHNvIHRoYXQgYSB0aWNrIGFsd2F5cyBhcHBlYXJzIG9uIGEgc3RlcC5cbiAgICAgKiBFeDogVGljayBpbnRlcnZhbCBvZiA0IHdpdGggYSBzdGVwIG9mIDMgd2lsbCBkcmF3IGEgdGljayBldmVyeSA0IHN0ZXBzIChldmVyeSAxMiB2YWx1ZXMpLlxuICAgICAqL1xuICAgIEBJbnB1dCgndGlja0ludGVydmFsJykgc2V0IHRpY2tJbnRlcnZhbCh2YWx1ZTogTnVtYmVySW5wdXQpIHtcbiAgICAgICAgdGhpcy5fdGlja0ludGVydmFsID0gY29lcmNlTnVtYmVyUHJvcGVydHkodmFsdWUpO1xuICAgICAgICB0aGlzLnRpY2tzID0gdGhpcy5nZXRUaWNrcyh0aGlzLm1pbiwgdGhpcy5tYXgsIHRoaXMuc3RlcCwgdGhpcy5fdGlja0ludGVydmFsLCB0aGlzLmxvbmdUaWNrcyk7XG4gICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gICAgZ2V0IHRpY2tJbnRlcnZhbCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGlja0ludGVydmFsO1xuICAgIH1cbiAgICBwcml2YXRlIF90aWNrSW50ZXJ2YWwgPSAwO1xuXG4gICAgdGlja3M6IFRpY2tJdGVtW10gPSBbXTtcblxuICAgIEBWaWV3Q2hpbGQoJ2hhbmRsZScsIHsgc3RhdGljOiB0cnVlIH0pIHByaXZhdGUgX2hhbmRsZUVsZW1lbnQhOiBFbGVtZW50UmVmO1xuXG4gICAgX2xhYmVsUG9zaXRpb246IHN0cmluZyA9IERFRkFVTFRfTEFCRUxfUE9TSVRJT047XG5cbiAgICAvKiogU2V0cyB0aGUgaWQgb2YgdGhlIHNsaWRlci4gKi9cbiAgICBASW5wdXQoJ2lkJylcbiAgICBzZXQgaWQodmFsdWU6IHN0cmluZykge1xuICAgICAgICBpZiAodGhpcy5faWQgIT09IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLl9pZCA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBpZCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5faWQ7XG4gICAgfVxuXG4gICAgLyoqIFNldHMgdGhlIHRhYmluZGV4IG9mIHRoZSBzbGlkZXIuICovXG4gICAgQElucHV0KClcbiAgICBzZXQgdGFiaW5kZXgodmFsdWU6IE51bWJlcklucHV0KSB7XG4gICAgICAgIHRoaXMuX3RhYkluZGV4ID0gY29lcmNlTnVtYmVyUHJvcGVydHkodmFsdWUpO1xuICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuICAgIGdldCB0YWJpbmRleCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fZGlzYWJsZWQgPyAtMSA6IHRoaXMuX3RhYkluZGV4O1xuICAgIH1cblxuICAgIC8qKiBTZXRzIHRoZSBtaW5pbXVtIHZhbHVlIChEZWZhdWx0OiAwKS4gKi9cbiAgICBASW5wdXQoJ254TWluJylcbiAgICBzZXQgbWluKHZhbHVlOiBOdW1iZXJJbnB1dCkge1xuICAgICAgICB0aGlzLl9taW4gPSBjb2VyY2VOdW1iZXJQcm9wZXJ0eSh2YWx1ZSk7XG4gICAgICAgIHRoaXMudGlja3MgPSB0aGlzLmdldFRpY2tzKHRoaXMuX21pbiwgdGhpcy5tYXgsIHRoaXMuc3RlcCwgdGhpcy50aWNrSW50ZXJ2YWwsIHRoaXMubG9uZ1RpY2tzKTtcbiAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cbiAgICBnZXQgbWluKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9taW47XG4gICAgfVxuXG4gICAgLyoqIFNldHMgdGhlIG1heGltdW0gdmFsdWUgKERlZmF1bHQ6IDEwMCkuICovXG4gICAgQElucHV0KCdueE1heCcpXG4gICAgc2V0IG1heCh2YWx1ZTogTnVtYmVySW5wdXQpIHtcbiAgICAgICAgdGhpcy5fbWF4ID0gY29lcmNlTnVtYmVyUHJvcGVydHkodmFsdWUpO1xuICAgICAgICB0aGlzLnRpY2tzID0gdGhpcy5nZXRUaWNrcyh0aGlzLm1pbiwgdGhpcy5fbWF4LCB0aGlzLnN0ZXAsIHRoaXMudGlja0ludGVydmFsLCB0aGlzLmxvbmdUaWNrcyk7XG4gICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gICAgZ2V0IG1heCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fbWF4O1xuICAgIH1cblxuICAgIC8qKiBTZXRzIHRoZSBzdGVwIHNpemUgYnkgd2hpY2ggdGhlIHZhbHVlIG9mIHRoZSBzbGlkZXIgY2FuIGJlIGluY3JlYXNlZCBvciBkZWNyZWFzZWQgKERlZmF1bHQ6IDEpLiAqL1xuICAgIEBJbnB1dCgnbnhTdGVwJylcbiAgICBnZXQgc3RlcCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3RlcDtcbiAgICB9XG4gICAgc2V0IHN0ZXAodmFsdWU6IE51bWJlcklucHV0KSB7XG4gICAgICAgIHRoaXMuX3N0ZXAgPSBjb2VyY2VOdW1iZXJQcm9wZXJ0eSh2YWx1ZSwgdGhpcy5fc3RlcCk7XG4gICAgICAgIHRoaXMudGlja3MgPSB0aGlzLmdldFRpY2tzKHRoaXMubWluLCB0aGlzLm1heCwgdGhpcy5fc3RlcCwgdGhpcy5fdGlja0ludGVydmFsLCB0aGlzLmxvbmdUaWNrcyk7XG4gICAgICAgIGlmICh0aGlzLl9zdGVwICUgMSAhPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5fZGVjaW1hbFBsYWNlcyA9IHRoaXMuX3N0ZXAudG9TdHJpbmcoKS5zcGxpdCgnLicpLnBvcCgpIS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cblxuICAgIC8qKiBTZXRzIHRoZSBsYWJlbCB3aGljaCBpcyBkaXNwbGF5ZWQgb24gdG9wIG9mIHRoZSBzbGlkZXIuICovXG4gICAgQElucHV0KCdueExhYmVsJylcbiAgICBzZXQgbGFiZWwodmFsdWU6IHN0cmluZykge1xuICAgICAgICBpZiAodGhpcy5fbGFiZWwgIT09IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLl9sYWJlbCA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBsYWJlbCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGFiZWw7XG4gICAgfVxuXG4gICAgLyoqIFdoZXRoZXIgdGhlIGlucHV0IHRvIHRoZSBjb250cm9sIG9mIHRoZSBzbGlkZXIgc2hvdWxkIGJlIGRpc2FibGVkLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2V0IGRpc2FibGVkKHZhbHVlOiBCb29sZWFuSW5wdXQpIHtcbiAgICAgICAgdGhpcy5fZGlzYWJsZWQgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsdWUpO1xuICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuICAgIGdldCBkaXNhYmxlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVkO1xuICAgIH1cblxuICAgIC8qKiBXaGV0aGVyIHRoZSBtYXggdmFsdWUgaXMgdG8gdGhlIHJpZ2h0IChmYWxzZSkgb3IgbGVmdCAodHJ1ZSkuKi9cbiAgICBASW5wdXQoJ254SW52ZXJ0ZWQnKVxuICAgIHNldCBpbnZlcnRlZCh2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgICAgIHRoaXMuX2ludmVydGVkID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cbiAgICBnZXQgaW52ZXJ0ZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbnZlcnRlZDtcbiAgICB9XG5cbiAgICAvKiogV2hldGhlciB0byBkaXNwbGF5IHRoZSB0aHVtYiBsYWJlbCBvbiB0b3Agb2YgdGhlIHNsaWRlci4qL1xuICAgIEBJbnB1dCgpXG4gICAgc2V0IHRodW1iTGFiZWwodmFsdWU6IEJvb2xlYW5JbnB1dCkge1xuICAgICAgICB0aGlzLl90aHVtYkxhYmVsID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cbiAgICBnZXQgdGh1bWJMYWJlbCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RodW1iTGFiZWw7XG4gICAgfVxuXG4gICAgLyoqIFdoZXRoZXIgdGhlIG5lZ2F0aXZlIHNldCBvZiBzdHlsZXMgaXMgYXBwbGllZCAoRGVmYXVsdDogJ2ZhbHNlJykuKi9cbiAgICBASW5wdXQoJ25lZ2F0aXZlJylcbiAgICBzZXQgbmVnYXRpdmUodmFsdWU6IEJvb2xlYW5JbnB1dCkge1xuICAgICAgICB0aGlzLl9uZWdhdGl2ZSA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSh2YWx1ZSk7XG4gICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gICAgZ2V0IG5lZ2F0aXZlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fbmVnYXRpdmU7XG4gICAgfVxuXG4gICAgLyoqIEhpZGVzIHRoZSBtaW4vbWF4IGxhYmVscyAoRGVmYXVsdDogJ2ZhbHNlJykuICovXG4gICAgQElucHV0KCdoaWRlTGFiZWxzJylcbiAgICBzZXQgaGlkZUxhYmVscyh2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgICAgIHRoaXMuX2hpZGVMYWJlbHMgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsdWUpO1xuICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuICAgIGdldCBoaWRlTGFiZWxzKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5faGlkZUxhYmVscztcbiAgICB9XG5cbiAgICAvKiogU2V0cyB0aGUgYXJyYXkgb2YgdmFsdWUgd2hpY2ggd2lsbCByZW5kZXIgYXMgbG9uZyB0aWNrIChEZWZhdWx0OiBNaWRkbGUgdmFsdWUgaWYgcHJlc2VudCkuICovXG4gICAgQElucHV0KCdsb25nVGlja3MnKSBzZXQgbG9uZ1RpY2tzKHZhbHVlOiBudW1iZXJbXSkge1xuICAgICAgICBpZiAodGhpcy5fbG9uZ1RpY2tzICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5fbG9uZ1RpY2tzID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnRpY2tzID0gdGhpcy5nZXRUaWNrcyh0aGlzLm1pbiwgdGhpcy5tYXgsIHRoaXMuc3RlcCwgdGhpcy50aWNrSW50ZXJ2YWwsIHRoaXMuX2xvbmdUaWNrcyk7XG4gICAgICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGxvbmdUaWNrcygpOiBudW1iZXJbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sb25nVGlja3M7XG4gICAgfVxuICAgIHByaXZhdGUgX2xvbmdUaWNrcyA9IFswXTtcblxuICAgIC8qKiBBbiBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2ggdmFsdWUgY2hhbmdlLiAqL1xuICAgIEBPdXRwdXQoJ254VmFsdWVDaGFuZ2UnKSB2YWx1ZUNoYW5nZTogRXZlbnRFbWl0dGVyPG51bWJlcj4gPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlcj4oKTtcblxuICAgIC8qKiBTZXRzIHRoZSBjdXN0b21pemF0aW9uIGZ1bmN0aW9uIGZvciB0aGUgdmFsdWUgd2hpY2ggaXMgZGlzcGxheWVkIGFib3ZlIHRoZSBzbGlkZXIgaGFuZGxlIChEZWZhdWx0Oih2YWx1ZSkgPT4gdmFsdWUpLiApLiAqL1xuICAgIEBJbnB1dCgnbnhWYWx1ZUZvcm1hdHRlcicpIHZhbHVlRm9ybWF0dGVyID0gKHZhbHVlOiBhbnkpID0+IHZhbHVlO1xuXG4gICAgLyoqIFNldHMgdGhlIGN1c3RvbWl6YXRpb24gZnVuY3Rpb24gZm9yIHRoZSBsYWJlbCBvbiB0aGUgbWluLXNpZGUgb2YgdGhlIHNsaWRlciAoRGVmYXVsdDoodmFsdWUpID0+IHZhbHVlKS4gKi9cbiAgICBASW5wdXQoJ254TGFiZWxNaW5Gb3JtYXR0ZXInKSBsYWJlbE1pbkZvcm1hdHRlciA9ICh2YWx1ZTogYW55KSA9PiB2YWx1ZTtcblxuICAgIC8qKiBTZXRzIHRoZSBjdXN0b21pemF0aW9uIGZ1bmN0aW9uIGZvciB0aGUgbGFiZWwgb24gdGhlIG1heC1zaWRlIG9mIHRoZSBzbGlkZXIgKERlZmF1bHQ6KHZhbHVlKSA9PiB2YWx1ZSkuICovXG4gICAgQElucHV0KCdueExhYmVsTWF4Rm9ybWF0dGVyJykgbGFiZWxNYXhGb3JtYXR0ZXIgPSAodmFsdWU6IGFueSkgPT4gdmFsdWU7XG5cbiAgICBwcml2YXRlIF9vbkNoYW5nZTogKHZhbHVlOiBhbnkpID0+IHZvaWQgPSAoKSA9PiB7fTtcbiAgICBwcml2YXRlIF9vblRvdWNoZWQ6ICgpID0+IGFueSA9ICgpID0+IHt9O1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICAgICAgcHJpdmF0ZSBfY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgcHJpdmF0ZSBfbmdab25lOiBOZ1pvbmUsXG4gICAgICAgIEBPcHRpb25hbCgpIHByaXZhdGUgX2RpcjogRGlyZWN0aW9uYWxpdHkgfCBudWxsLFxuICAgICAgICBwcml2YXRlIF9mb2N1c01vbml0b3I6IEZvY3VzTW9uaXRvcixcbiAgICApIHt9XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIHRoaXMuX2ZvY3VzTW9uaXRvci5tb25pdG9yKHRoaXMuX2hhbmRsZUVsZW1lbnQpO1xuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlTGFiZWxQb3NpdGlvbigpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKiogU2V0cyB0aGUgY3VycmVudCB2YWx1ZSBvZiB0aGUgc2xpZGVyLiAqL1xuICAgIEBJbnB1dCgnbnhWYWx1ZScpXG4gICAgc2V0IHZhbHVlKHZhbHVlOiBOdW1iZXJJbnB1dCkge1xuICAgICAgICB0aGlzLndyaXRlVmFsdWUoTnVtYmVyKHZhbHVlKSk7XG5cbiAgICAgICAgLy8gd2FpdCBmb3IgcmVyZW5kZXIgdG8gY2FsY3VsYXRlIGxhdGVzdCBsYWJlbCBwb3NpdGlvblxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUxhYmVsUG9zaXRpb24oKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0IHZhbHVlKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5fcmVzZXQoKTtcbiAgICAgICAgdGhpcy5fZm9jdXNNb25pdG9yLnN0b3BNb25pdG9yaW5nKHRoaXMuX2hhbmRsZUVsZW1lbnQpO1xuICAgIH1cblxuICAgIHdyaXRlVmFsdWUodmFsdWU6IG51bWJlcikge1xuICAgICAgICBpZiAodmFsdWUgIT09IHRoaXMuX3ZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLl92YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJlZ2lzdGVyT25DaGFuZ2UoZm46ICh2YWx1ZTogYW55KSA9PiB2b2lkKSB7XG4gICAgICAgIHRoaXMuX29uQ2hhbmdlID0gZm47XG4gICAgfVxuXG4gICAgcmVnaXN0ZXJPblRvdWNoZWQoZm46IGFueSk6IHZvaWQge1xuICAgICAgICB0aGlzLl9vblRvdWNoZWQgPSBmbjtcbiAgICB9XG5cbiAgICBzZXREaXNhYmxlZFN0YXRlKGRpc2FibGVkOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMuZGlzYWJsZWQgPSBkaXNhYmxlZDtcbiAgICB9XG5cbiAgICBfaXNNaW5pbXVtKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUgPT09IHRoaXMubWluO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiB0aGUgdmFsdWUgaXMgaW4gdGhlIGJvdW5kYXJpZXMgb2YgbWluL21heCBhbmQgaWYgaXQgaXMgYSBtdWx0aXBsZSBvZiBgc3RlcC5cbiAgICAgKi9cbiAgICBfaXNWYWxpZFN0ZXAoKSB7XG4gICAgICAgIGNvbnN0IHNhZmVWYWx1ZSA9IG5ldyBEZWNpbWFsKHRoaXMuX3ZhbHVlKS5taW51cyh0aGlzLm1pbik7XG4gICAgICAgIGNvbnN0IG1vZHVsbyA9IHNhZmVWYWx1ZS5tb2QodGhpcy5zdGVwKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzTWluaW11bSgpIHx8IG1vZHVsby5jbXAoMCkgPT09IDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogV2UgaGF2ZSB0byBsb29rIGF0IHR3byBjYXNlczpcbiAgICAgKiAtIGN1cnJlbnQgdmFsdWUgaXMgYSB2YWxpZCBtdWx0aXR1ZGUgb2YgdGhlIHN0ZXAgc2l6ZVxuICAgICAqICAgdGhlbiB3ZSBjYW4gc2FmZWx5IGFkZCBvciBzdWJ0cmFjdCB0aGUgc3RlcFxuICAgICAqIC0gdGhlIHZhbHVlIGlzIG5vdCBhIHZhbGlkIG11bHRpdHVkZS4gdGhpcyBjb3VsZCBiZSB0aGUgbWF4IHZhbHVlIG9yIHRoZSB2YWx1ZSBib3VuZFxuICAgICAqICAgdmlhIG54VmFsdWVcbiAgICAgKiAgIHRoZW4gd2UgbG9vayBmb3IgdGhlIG5leHQgY2xvc2VzdCB2YWx1ZSB1cHdhcmRzIG9yIGRvd253YXJkc1xuICAgICAqICAgZGVjaW1hbC5qcyBwcm92aWRlcyBhIG5pY2UgdXRpbGl0eSBmdW5jdGlvbiBmb3IgdGhpcy5cbiAgICAgKi9cbiAgICBfY2hhbmdlVmFsdWUodmFsdWVEaWZmOiBudW1iZXIpIHtcbiAgICAgICAgbGV0IG5ld1ZhbHVlID0gbmV3IERlY2ltYWwodGhpcy5fdmFsdWUpO1xuICAgICAgICBpZiAodGhpcy5faXNWYWxpZFN0ZXAoKSkge1xuICAgICAgICAgICAgbmV3VmFsdWUgPSBuZXdWYWx1ZS5wbHVzKHZhbHVlRGlmZik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBzdWJ0cmFjdCB0aGUgbWluaW11bSB0byBmaW5kIHRoZSBjbG9zZXN0IG11bHRpdHVkZSB0aGVuIGFkZCB0aGUgbWluaW11bSBhZ2FpbiB0byBnZXQgdGhlIHZhbGlkIHNsaWRlciBzdGVwXG4gICAgICAgICAgICBjb25zdCBtaW5BZGp1c3RlZFZhbHVlID0gbmV3IERlY2ltYWwodGhpcy5fdmFsdWUpLm1pbnVzKHRoaXMubWluKTtcbiAgICAgICAgICAgIG5ld1ZhbHVlID0gdmFsdWVEaWZmIDwgMCA/IG1pbkFkanVzdGVkVmFsdWUudG9OZWFyZXN0KHRoaXMuc3RlcCwgRGVjaW1hbC5ST1VORF9ET1dOKSA6IG1pbkFkanVzdGVkVmFsdWUudG9OZWFyZXN0KHRoaXMuc3RlcCwgRGVjaW1hbC5ST1VORF9VUCk7XG4gICAgICAgICAgICBuZXdWYWx1ZSA9IG5ld1ZhbHVlLnBsdXModGhpcy5taW4pO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNhc3QgdGhlIERlY2ltYWwgb2JqZWN0IHRvIGEgSlMgbnVtYmVyIGJlZm9yZSBpdCBnZXRzIHJldHVybmVkXG4gICAgICAgIGxldCB0b051bWJlciA9IG5ld1ZhbHVlLnRvTnVtYmVyKCk7XG4gICAgICAgIHRvTnVtYmVyID0gY2xhbXAodG9OdW1iZXIsIHRoaXMubWluLCB0aGlzLm1heCk7XG4gICAgICAgIGlmICh0aGlzLnZhbHVlICE9PSB0b051bWJlcikge1xuICAgICAgICAgICAgdGhpcy5fb25DaGFuZ2UodG9OdW1iZXIpO1xuICAgICAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHRvTnVtYmVyKTtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0b051bWJlcjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBfcGVyY2VudGFnZVZhbHVlKCk6IG51bWJlciB7XG4gICAgICAgIGxldCBwZXJjZW50YWdlVmFsdWUgPSAoKCh0aGlzLnZhbHVlIHx8IDApIC0gdGhpcy5taW4pIC8gKHRoaXMubWF4IC0gdGhpcy5taW4pKSAqIDEwMDtcbiAgICAgICAgaWYgKHRoaXMuaW52ZXJ0ZWQpIHtcbiAgICAgICAgICAgIHBlcmNlbnRhZ2VWYWx1ZSA9IDEwMCAtIHBlcmNlbnRhZ2VWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2xhbXAocGVyY2VudGFnZVZhbHVlLCAwLCAxMDApO1xuICAgIH1cblxuICAgIF9zbGlkZXJDbGljayhldmVudDogTW91c2VFdmVudCkge1xuICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZm9jdXNIYW5kbGVFbGVtZW50KCk7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5fZ2V0UG9zaXRpb25Gcm9tRXZlbnQoZXZlbnQpO1xuICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHRoaXMuX2dldFZhbHVlRnJvbVBvc2l0aW9uKHBvc2l0aW9uKTtcblxuICAgICAgICBpZiAodGhpcy52YWx1ZSAhPT0gbmV3VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIHRoaXMuX29uQ2hhbmdlKHRoaXMudmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2ZvY3VzKCk6IHZvaWQge1xuICAgICAgICAvLyBpZiAodGhpcy5kaXNhYmxlZCkge31cbiAgICAgICAgdGhpcy5fZm9jdXNIYW5kbGVFbGVtZW50KCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHJldmVudCB0ZXh0IHNlbGVjdGlvbiB3aGVuIGRyYWdnaW5nIHRoZSBoYW5kbGUuXG4gICAgICovXG4gICAgX3NlbGVjdFN0YXJ0KCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgX2hhbmRsZUtleXByZXNzKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUT0RPIHJldHVybiBzdGF0ZW1lbnQgc2hvdWxkIG5vdCBzdWJzdGl0dXRlIGJyZWFrIGtleXdvcmRcbiAgICAgICAgc3dpdGNoIChldmVudC5rZXlDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIERPV05fQVJST1c6XG4gICAgICAgICAgICBjYXNlIHRoaXMuaW52ZXJ0ZWQgPyBSSUdIVF9BUlJPVyA6IExFRlRfQVJST1c6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NoYW5nZVZhbHVlKC10aGlzLnN0ZXApO1xuXG4gICAgICAgICAgICBjYXNlIFVQX0FSUk9XOlxuICAgICAgICAgICAgY2FzZSB0aGlzLmludmVydGVkID8gTEVGVF9BUlJPVyA6IFJJR0hUX0FSUk9XOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jaGFuZ2VWYWx1ZSh0aGlzLnN0ZXApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBpcyBjYWxsZWQgb24gbW91c2Vkb3duIG9yIHRvdWNoc3RhcnRcbiAgICAgKi9cbiAgICBfZHJhZ1N0YXJ0KCkge1xuICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fbmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2RyYWdTdWJzY3JpcHRpb25zLnB1c2goZnJvbUV2ZW50PFRvdWNoRXZlbnQ+KGRvY3VtZW50LCAndG91Y2htb3ZlJykuc3Vic2NyaWJlKHRoaXMuX2hhbmRsZURyYWdNb3ZlLmJpbmQodGhpcykpKTtcbiAgICAgICAgICAgIHRoaXMuX2RyYWdTdWJzY3JpcHRpb25zLnB1c2goZnJvbUV2ZW50PE1vdXNlRXZlbnQ+KGRvY3VtZW50LCAnbW91c2Vtb3ZlJykuc3Vic2NyaWJlKHRoaXMuX2hhbmRsZURyYWdNb3ZlLmJpbmQodGhpcykpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5fZHJhZ1N1YnNjcmlwdGlvbnMucHVzaChmcm9tRXZlbnQ8VG91Y2hFdmVudD4oZG9jdW1lbnQsICd0b3VjaGNhbmNlbCcpLnN1YnNjcmliZSh0aGlzLl9oYW5kbGVEcmFnU3RvcC5iaW5kKHRoaXMpKSk7XG4gICAgICAgIHRoaXMuX2RyYWdTdWJzY3JpcHRpb25zLnB1c2goZnJvbUV2ZW50PE1vdXNlRXZlbnQ+KGRvY3VtZW50LCAnbW91c2V1cCcpLnN1YnNjcmliZSh0aGlzLl9oYW5kbGVEcmFnU3RvcC5iaW5kKHRoaXMpKSk7XG4gICAgICAgIHRoaXMuX2RyYWdTdWJzY3JpcHRpb25zLnB1c2goZnJvbUV2ZW50PFRvdWNoRXZlbnQ+KGRvY3VtZW50LCAndG91Y2hlbmQnKS5zdWJzY3JpYmUodGhpcy5faGFuZGxlRHJhZ1N0b3AuYmluZCh0aGlzKSkpO1xuICAgIH1cblxuICAgIF9mb3JtYXRWYWx1ZSh2YWx1ZTogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVGb3JtYXR0ZXIodmFsdWUpO1xuICAgIH1cblxuICAgIF9mb3JtYXRMYWJlbExlZnQoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW52ZXJ0ZWQgPyB0aGlzLl9mb3JtYXRMYWJlbE1heCgpIDogdGhpcy5fZm9ybWF0TGFiZWxNaW4oKTtcbiAgICB9XG5cbiAgICBfZm9ybWF0TGFiZWxSaWdodCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnZlcnRlZCA/IHRoaXMuX2Zvcm1hdExhYmVsTWluKCkgOiB0aGlzLl9mb3JtYXRMYWJlbE1heCgpO1xuICAgIH1cblxuICAgIF9mb3JtYXRMYWJlbE1pbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGFiZWxNaW5Gb3JtYXR0ZXIodGhpcy5taW4pO1xuICAgIH1cblxuICAgIF9mb3JtYXRMYWJlbE1heCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGFiZWxNYXhGb3JtYXR0ZXIodGhpcy5tYXgpO1xuICAgIH1cblxuICAgIF9mb2N1c0hhbmRsZUVsZW1lbnQoKSB7XG4gICAgICAgIHRoaXMuX2hhbmRsZUVsZW1lbnQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX3VwZGF0ZUxhYmVsUG9zaXRpb24oKSB7XG4gICAgICAgIGNvbnN0IGxhYmVsID0gdGhpcy5faGFuZGxlRWxlbWVudC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ueC1zbGlkZXJfX3ZhbHVlJyk7XG5cbiAgICAgICAgaWYgKCFsYWJlbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFuZGxlUmVjdCA9IHRoaXMuX2hhbmRsZUVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgY29uc3QgdmFsdWVSZWN0ID0gbGFiZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KGxhYmVsKTtcbiAgICAgICAgY29uc3QgaGFuZGxlQ2VudGVyID0gaGFuZGxlUmVjdC5sZWZ0ICsgaGFuZGxlUmVjdC53aWR0aCAvIDI7XG4gICAgICAgIGNvbnN0IGxhYmVsTGVmdCA9IGhhbmRsZUNlbnRlciAtIHZhbHVlUmVjdC53aWR0aCAvIDI7XG4gICAgICAgIGNvbnN0IGxhYmVsUmlnaHQgPSBoYW5kbGVDZW50ZXIgKyB2YWx1ZVJlY3Qud2lkdGggLyAyO1xuICAgICAgICBjb25zdCBib2R5V2lkdGggPSBkb2N1bWVudC5ib2R5Lm9mZnNldFdpZHRoO1xuICAgICAgICBsZXQgcG9zaXRpb24gPSBERUZBVUxUX0xBQkVMX1BPU0lUSU9OO1xuXG4gICAgICAgIGlmIChsYWJlbExlZnQgPCAwKSB7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IC1oYW5kbGVDZW50ZXIgKyBWQUxVRV9NQVJHSU4gKyAncHgnO1xuICAgICAgICB9IGVsc2UgaWYgKGxhYmVsUmlnaHQgPiBib2R5V2lkdGgpIHtcbiAgICAgICAgICAgIHBvc2l0aW9uID0gLXZhbHVlUmVjdC53aWR0aCArIGJvZHlXaWR0aCAtIGhhbmRsZUNlbnRlciAtIFZBTFVFX01BUkdJTiArICdweCc7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9sYWJlbFBvc2l0aW9uID0gYHRyYW5zbGF0ZVgoJHtwb3NpdGlvbn0pYDtcbiAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2dldFZhbHVlRnJvbVBvc2l0aW9uKHBvc2l0aW9uOiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICBjb25zdCBpc1JUTCA9IHRoaXMuX2Rpcj8udmFsdWUgPT09ICdydGwnO1xuICAgICAgICBjb25zdCByZWN0ID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIGNvbnN0IHggPSBNYXRoLm1heChyZWN0LmxlZnQsIE1hdGgubWluKHJlY3QucmlnaHQsIHBvc2l0aW9uKSk7XG5cbiAgICAgICAgLy8gcG9zaXRpb24gb2Ygc2xpZGVyIHJlbGF0aXZlIHRvIHNsaWRlciB3aWR0aFxuICAgICAgICBsZXQgcGVyY2VudCA9ICh4IC0gcmVjdC5sZWZ0KSAvIHJlY3Qud2lkdGg7XG5cbiAgICAgICAgaWYgKHRoaXMuaW52ZXJ0ZWQpIHtcbiAgICAgICAgICAgIHBlcmNlbnQgPSAxIC0gcGVyY2VudDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpc1JUTCkge1xuICAgICAgICAgICAgcGVyY2VudCA9IDEgLSBwZXJjZW50O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZWRnZSBjYXNlIGhhbmRsaW5nIGJlY2F1c2Ugb2YgZmxvYXQgcHJlY2lzaW9uIGVycm9ycyB5b3UgY291bGRuJ3QgcmVhY2ggdGhlIG1heGltdW1cbiAgICAgICAgbGV0IGNsb3Nlc3RWYWx1ZTtcblxuICAgICAgICBpZiAocGVyY2VudCA9PT0gMSkge1xuICAgICAgICAgICAgY2xvc2VzdFZhbHVlID0gdGhpcy5tYXg7XG4gICAgICAgIH0gZWxzZSBpZiAocGVyY2VudCA9PT0gMCkge1xuICAgICAgICAgICAgY2xvc2VzdFZhbHVlID0gdGhpcy5taW47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBleGFjdFZhbHVlID0gdGhpcy5taW4gKyBwZXJjZW50ICogKHRoaXMubWF4IC0gdGhpcy5taW4pO1xuICAgICAgICAgICAgY2xvc2VzdFZhbHVlID0gTWF0aC5yb3VuZCgoZXhhY3RWYWx1ZSAtIHRoaXMubWluKSAvIHRoaXMuc3RlcCkgKiB0aGlzLnN0ZXAgKyB0aGlzLm1pbjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLl9kZWNpbWFsUGxhY2VzKSB7XG4gICAgICAgICAgICBjbG9zZXN0VmFsdWUgPSB0aGlzLl9yb3VuZFRvRGVjaW1hbChjbG9zZXN0VmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNsYW1wKGNsb3Nlc3RWYWx1ZSwgdGhpcy5taW4sIHRoaXMubWF4KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9yb3VuZFRvRGVjaW1hbCh2YWx1ZTogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiBwYXJzZUZsb2F0KHZhbHVlLnRvRml4ZWQodGhpcy5fZGVjaW1hbFBsYWNlcykpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2hhbmRsZURyYWdNb3ZlKGV2ZW50OiBNb3VzZUV2ZW50IHwgVG91Y2hFdmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5fZ2V0UG9zaXRpb25Gcm9tRXZlbnQoZXZlbnQpO1xuICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHRoaXMuX2dldFZhbHVlRnJvbVBvc2l0aW9uKHBvc2l0aW9uKTtcblxuICAgICAgICBpZiAodGhpcy52YWx1ZSAhPT0gbmV3VmFsdWUpIHtcbiAgICAgICAgICAgIC8vIHJ1biBjaGFuZ2UgZGV0ZWN0aW9uIHRvIHVwZGF0ZSB2YWx1ZSBhbmQgcG9zaXRpb24gb2YgaGFuZGxlXG4gICAgICAgICAgICB0aGlzLl9uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gbmV3VmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5fb25DaGFuZ2UodGhpcy52YWx1ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIF9oYW5kbGVEcmFnU3RvcChldmVudDogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fcmVzZXQoKTtcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLl9nZXRQb3NpdGlvbkZyb21FdmVudChldmVudCk7XG4gICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gdGhpcy5fZ2V0VmFsdWVGcm9tUG9zaXRpb24ocG9zaXRpb24pO1xuXG4gICAgICAgIGlmICh0aGlzLnZhbHVlICE9PSBuZXdWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgdGhpcy5fb25DaGFuZ2UodGhpcy52YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIF9yZXNldCgpOiB2b2lkIHtcbiAgICAgICAgZm9yIChjb25zdCBzdWJzY3JpcHRpb24gb2YgdGhpcy5fZHJhZ1N1YnNjcmlwdGlvbnMpIHtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZHJhZ1N1YnNjcmlwdGlvbnMgPSBbXTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9nZXRQb3NpdGlvbkZyb21FdmVudChldmVudDogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQpOiBudW1iZXIge1xuICAgICAgICBjb25zdCBjdXJzb3I6IGFueSA9IGV2ZW50LnR5cGUuaW5jbHVkZXMoJ3RvdWNoJykgPyAoZXZlbnQgYXMgVG91Y2hFdmVudCkudG91Y2hlcy5pdGVtKDApIDogZXZlbnQ7XG4gICAgICAgIHJldHVybiBjdXJzb3IuY2xpZW50WDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFRpY2tzKG1pbjogbnVtYmVyLCBtYXg6IG51bWJlciwgc3RlcDogbnVtYmVyLCBpbnRlcnZhbDogbnVtYmVyLCBsb25nVGljazogbnVtYmVyW10gPSBbXSk6IFRpY2tJdGVtW10ge1xuICAgICAgICBpZiAoIWludGVydmFsKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByYW5nZSA9IG1heCAtIG1pbjtcbiAgICAgICAgY29uc3Qgc3RlcFByb2R1Y3QgPSBzdGVwICogaW50ZXJ2YWw7XG4gICAgICAgIGNvbnN0IGdhcFNpemUgPSAoc3RlcFByb2R1Y3QgLyByYW5nZSkgKiAxMDA7IC8vICVcbiAgICAgICAgY29uc3QgbnVtYmVyT2ZUaWNrcyA9IE1hdGguZmxvb3IoMTAwIC8gZ2FwU2l6ZSk7XG4gICAgICAgIGNvbnN0IHNwYWNlTGVmdCA9IDEwMCAtIGdhcFNpemUgKiBudW1iZXJPZlRpY2tzOyAvLyAlXG4gICAgICAgIGNvbnN0IGhpZGRlblRocmVzaG9sZCA9IDM7IC8vICVcblxuICAgICAgICBpZiAoIWxvbmdUaWNrLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgbWlkZGxlVmFsdWUgPSByYW5nZSAvIDI7XG4gICAgICAgICAgICBsb25nVGljay5wdXNoKG1pZGRsZVZhbHVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHsgbGVuZ3RoOiBudW1iZXJPZlRpY2tzIH0sIChfLCBpKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IGkgKyAxO1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBpbmRleCAqIHN0ZXBQcm9kdWN0O1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBnYXBTaXplLFxuICAgICAgICAgICAgICAgIGhpZGVUaWNrOiBpbmRleCA9PT0gbnVtYmVyT2ZUaWNrcyAmJiBzcGFjZUxlZnQgPD0gaGlkZGVuVGhyZXNob2xkLFxuICAgICAgICAgICAgICAgIGlzTG9uZ1RpY2s6IGxvbmdUaWNrLmluY2x1ZGVzKHZhbHVlKSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiIsIjxsYWJlbCBjbGFzcz1cIm54LXNsaWRlcl9fbGFiZWxcIiBbaWRdPVwiaWQgKyAnLWxhYmVsJ1wiIFthdHRyLmZvcl09XCJpZCArICctaGFuZGxlJ1wiIChjbGljayk9XCJfZm9jdXNIYW5kbGVFbGVtZW50KClcIj57eyBsYWJlbCB9fTwvbGFiZWw+XG5cbjxkaXYgY2xhc3M9XCJueC1zbGlkZXJfX3dyYXBwZXJcIiAoY2xpY2spPVwiX3NsaWRlckNsaWNrKCRldmVudClcIiBbY2xhc3Mubngtc2xpZGVyX19oYXMtdGlja3NdPVwiIXRpY2tJbnRlcnZhbFwiPlxuICAgIDxzcGFuIGNsYXNzPVwibngtc2xpZGVyX19iYWNrZ3JvdW5kXCI+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwibngtc2xpZGVyX19maWxsZXJcIiBbc3R5bGUud2lkdGguJV09XCJfcGVyY2VudGFnZVZhbHVlXCI+XG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgY2xhc3M9XCJueC1zbGlkZXJfX2hhbmRsZVwiXG4gICAgICAgICAgICAgICAgW2lkXT1cImlkICsgJy1oYW5kbGUnXCJcbiAgICAgICAgICAgICAgICBbYXR0ci50YWJpbmRleF09XCJ0YWJpbmRleFwiXG4gICAgICAgICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbGxlZGJ5XT1cImlkICsgJy1sYWJlbCdcIlxuICAgICAgICAgICAgICAgIHJvbGU9XCJzbGlkZXJcIlxuICAgICAgICAgICAgICAgIFthdHRyLmFyaWEtdmFsdWVtaW5dPVwiX2Zvcm1hdExhYmVsTWluKClcIlxuICAgICAgICAgICAgICAgIFthdHRyLmFyaWEtdmFsdWVtYXhdPVwiX2Zvcm1hdExhYmVsTWF4KClcIlxuICAgICAgICAgICAgICAgIFthdHRyLmFyaWEtdmFsdWV0ZXh0XT1cIl9mb3JtYXRWYWx1ZSh2YWx1ZSlcIlxuICAgICAgICAgICAgICAgIFthdHRyLmFyaWEtdmFsdWVub3ddPVwiX2Zvcm1hdFZhbHVlKHZhbHVlKVwiXG4gICAgICAgICAgICAgICAgKG1vdXNlZG93bik9XCJfZHJhZ1N0YXJ0KClcIlxuICAgICAgICAgICAgICAgICh0b3VjaHN0YXJ0KT1cIl9kcmFnU3RhcnQoKVwiXG4gICAgICAgICAgICAgICAgKHNlbGVjdHN0YXJ0KT1cIl9zZWxlY3RTdGFydCgpXCJcbiAgICAgICAgICAgICAgICAjaGFuZGxlXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInRodW1iTGFiZWxcIj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gW3N0eWxlLnRyYW5zZm9ybV09XCJfbGFiZWxQb3NpdGlvblwiIGNsYXNzPVwibngtc2xpZGVyX192YWx1ZVwiPnt7IF9mb3JtYXRWYWx1ZSh2YWx1ZSkgfX0gPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibngtc2xpZGVyX19hcnJvd1wiPiA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L3NwYW4+XG4gICAgPC9zcGFuPlxuICAgIDxkaXYgKm5nSWY9XCJ0aWNrSW50ZXJ2YWxcIiBjbGFzcz1cIm54LXNsaWRlcl9fdGljay1jb250YWluZXJcIj5cbiAgICAgICAgPGRpdlxuICAgICAgICAgICAgKm5nRm9yPVwibGV0IHQgb2YgdGlja3NcIlxuICAgICAgICAgICAgY2xhc3M9XCJueC1zbGlkZXJfX3RpY2tcIlxuICAgICAgICAgICAgW2NsYXNzLm54LXNsaWRlcl9fdGljay1wcmltYXJ5XT1cInQuaXNMb25nVGlja1wiXG4gICAgICAgICAgICBbY2xhc3Mubngtc2xpZGVyX190aWNrLWhpZGRlbl09XCJ0LmhpZGVUaWNrXCJcbiAgICAgICAgICAgIFtuZ1N0eWxlXT1cInsgd2lkdGg6IHQuZ2FwU2l6ZSArICclJyB9XCJcbiAgICAgICAgPjwvZGl2PlxuICAgIDwvZGl2PlxuPC9kaXY+XG5cbjxkaXYgKm5nSWY9XCIhaGlkZUxhYmVsc1wiIGNsYXNzPVwibngtc2xpZGVyX19sYWJlbC1jb250YWluZXJcIj5cbiAgICA8c3BhbiBjbGFzcz1cIm54LXNsaWRlcl9fdmFsdWUtbGFiZWxcIj57eyBfZm9ybWF0TGFiZWxMZWZ0KCkgfX08L3NwYW4+XG4gICAgPHNwYW4gY2xhc3M9XCJueC1zbGlkZXJfX3ZhbHVlLWxhYmVsXCI+e3sgX2Zvcm1hdExhYmVsUmlnaHQoKSB9fTwvc3Bhbj5cbjwvZGl2PlxuIl19