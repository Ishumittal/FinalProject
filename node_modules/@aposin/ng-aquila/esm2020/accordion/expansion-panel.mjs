import { CdkAccordionItem } from '@angular/cdk/accordion';
import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { TemplatePortal } from '@angular/cdk/portal';
import { ChangeDetectionStrategy, Component, ContentChild, Input, Optional, SkipSelf, } from '@angular/core';
import { Subject } from 'rxjs';
import { filter, startWith, take } from 'rxjs/operators';
import { NxAccordionDirective } from './accordion';
import { nxAccordionAnimations } from './accordion-animations';
import { NxExpansionPanelBodyDirective } from './expansion-panel-body';
import * as i0 from "@angular/core";
import * as i1 from "./accordion";
import * as i2 from "@angular/cdk/collections";
import * as i3 from "@angular/cdk/portal";
let nextId = 0;
const DEFAULT_TYPE = 'regular';
export class NxExpansionPanelComponent extends CdkAccordionItem {
    constructor(
    /** @docs-private */ accordion, // not typed as nullable: super class does not support `null`
    _cdr, _expansionDispatcher, _viewContainerRef) {
        super(accordion, _cdr, _expansionDispatcher);
        this.accordion = accordion;
        this._viewContainerRef = _viewContainerRef;
        this._negative = null;
        this._accordionStyle = DEFAULT_TYPE;
        this._style = null;
        this._headerId = `nx-expansion-panel-header-${nextId++}`;
        /** Stream that emits for changes in `@Input` properties. */
        this._inputChanges = new Subject();
    }
    /** Whether the negative set of styles should be used. */
    set negative(value) {
        this._negative = coerceBooleanProperty(value);
    }
    get negative() {
        return this._negative;
    }
    /**
     * Value for the styling that should be chosen.
     * Default value: 'regular'.
     */
    set style(value) {
        value = value ? value : DEFAULT_TYPE;
        const [newValue] = value.match(/regular|light|extra-light/) || [DEFAULT_TYPE];
        this._style = newValue;
        this._accordionStyle = newValue;
    }
    get style() {
        return this._style;
    }
    /** @docs-private */
    get portal() {
        return this._portal;
    }
    ngAfterContentInit() {
        if (this.lazyContent) {
            // Render the content as soon as the panel becomes open.
            this.opened
                .pipe(startWith(null), filter(() => this.expanded && !this._portal), take(1))
                .subscribe(() => {
                this._portal = new TemplatePortal(this.lazyContent._template, this._viewContainerRef);
            });
        }
        // Inherit appearance given by the accordion (if any).
        if (this.accordion) {
            if (this.style === null && this.accordion.style !== null) {
                this.style = this.accordion.style;
            }
            if (this.negative === null && this.accordion.negative !== null) {
                this.negative = this.accordion.negative;
            }
        }
    }
    ngOnChanges(changes) {
        this._inputChanges.next(changes);
    }
    ngOnDestroy() {
        super.ngOnDestroy();
        this._inputChanges.complete();
    }
    /** @docs-private */
    getOpenState() {
        return this.expanded ? 'open' : 'closed';
    }
}
NxExpansionPanelComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxExpansionPanelComponent, deps: [{ token: i1.NxAccordionDirective, optional: true, skipSelf: true }, { token: i0.ChangeDetectorRef }, { token: i2.UniqueSelectionDispatcher }, { token: i0.ViewContainerRef }], target: i0.ɵɵFactoryTarget.Component });
NxExpansionPanelComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxExpansionPanelComponent, selector: "nx-expansion-panel", inputs: { negative: "negative", style: ["nxStyle", "style"] }, host: { properties: { "class.nx-expanded": "expanded", "class.nx-expansion-panel--light": "_accordionStyle === \"light\"", "class.nx-expansion-panel--regular": "_accordionStyle === \"regular\"", "class.nx-expansion-panel--extra-light": "_accordionStyle === \"extra-light\"", "class.nx-expansion-panel--negative": "negative", "class.is-disabled": "disabled" } }, providers: [
        // Provide NxAccordionDirective as undefined to prevent nested expansion panels from registering
        // to the same accordion.
        { provide: NxAccordionDirective, useValue: undefined },
    ], queries: [{ propertyName: "lazyContent", first: true, predicate: NxExpansionPanelBodyDirective, descendants: true }], exportAs: ["NxExpansionPanelComponent"], usesInheritance: true, usesOnChanges: true, ngImport: i0, template: "<ng-content select=\"nx-expansion-panel-header\"></ng-content>\n\n<div class=\"nx-expansion-panel__content\" role=\"region\" [@bodyExpansion]=\"getOpenState()\" [attr.aria-labelledby]=\"_headerId\" [id]=\"id\">\n    <div class=\"nx-expansion-panel__body\">\n        <ng-content></ng-content>\n        <ng-template [cdkPortalOutlet]=\"portal\"></ng-template>\n    </div>\n</div>\n", styles: [":host{display:block}:host(.nx-expansion-panel--negative) ::ng-deep div.nx-expansion-panel__body *{color:var(--negative)}.nx-expansion-panel__content{overflow:hidden;display:block}.nx-expansion-panel__body{padding:var(--accordion-regular-body-padding);font-size:var(--accordion-body-font-size);line-height:var(--accordion-body-line-height);font-weight:var(--accordion-body-font-weight);letter-spacing:var(--accordion-body-letter-spacing)}@media (max-width: 703px){.nx-expansion-panel__body{padding:var(--accordion-regular-mobile-body-padding)}}:host(.nx-expansion-panel--regular):not(:first-child){margin-top:var(--accordion-regular-header-top-margin)}:host(.nx-expansion-panel--regular) ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--accordion-regular-border-color)}:host(.nx-expansion-panel--regular):last-child,:host(.nx-expansion-panel--regular):only-child{box-shadow:0 1px 0 0 var(--accordion-regular-border-color)}@media (max-width: 703px){:host(.nx-expansion-panel--regular):not(:first-child){margin-top:0}:host(.nx-expansion-panel--regular) ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--accordion-regular-mobile-border-color)}:host(.nx-expansion-panel--regular):last-child ::ng-deep .nx-expansion-panel__header-content,:host(.nx-expansion-panel--regular):only-child ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--accordion-regular-mobile-border-color),inset 0 -1px 0 0 var(--accordion-regular-mobile-separator-color)}:host(.nx-expansion-panel--regular).nx-expanded ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--accordion-regular-mobile-border-color),inset 0 -1px 0 0 var(--accordion-regular-mobile-separator-color)}}:host(.nx-expansion-panel--light) .nx-expansion-panel__body{padding:var(--accordion-light-body-padding)}@media (max-width: 703px){:host(.nx-expansion-panel--light) .nx-expansion-panel__body{padding:var(--accordion-light-mobile-body-padding)}}:host(.nx-expansion-panel--light):not(.nx-expansion-panel--negative) ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--accordion-light-border-color)}:host(.nx-expansion-panel--light):not(.nx-expansion-panel--negative):last-child,:host(.nx-expansion-panel--light):not(.nx-expansion-panel--negative):only-child{box-shadow:0 1px 0 0 var(--accordion-light-border-color)}@media (max-width: 703px){:host(.nx-expansion-panel--regular.nx-expansion-panel--negative) ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--negative-01)}:host(.nx-expansion-panel--regular.nx-expansion-panel--negative):last-child ::ng-deep .nx-expansion-panel__header-content,:host(.nx-expansion-panel--regular.nx-expansion-panel--negative):only-child ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--negative-01),inset 0 -1px 0 0 var(--negative-01)}:host(.nx-expansion-panel--regular.nx-expansion-panel--negative).nx-expanded ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--negative-01),inset 0 -1px 0 0 var(--negative-01)}}:host(.nx-expansion-panel--light.nx-expansion-panel--negative){color:var(--negative)}:host(.nx-expansion-panel--light.nx-expansion-panel--negative) ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--negative)}:host(.nx-expansion-panel--light.nx-expansion-panel--negative):last-child,:host(.nx-expansion-panel--light.nx-expansion-panel--negative):only-child{box-shadow:0 1px 0 0 var(--negative)}:host(.nx-expansion-panel--extra-light):not(:first-child){margin-top:var(--accordion-extra-light-header-top-margin)}:host(.nx-expansion-panel--extra-light) .nx-expansion-panel__body{padding:var(--accordion-extra-light-body-padding)}@media screen and (-ms-high-contrast: active){:host{border-color:windowText}:host ::ng-deep .nx-expansion-panel__header-content{color:buttonText}:host.nx-expansion-panel--regular ::ng-deep .nx-expansion-panel__header-content{border:1px solid buttonText}:host.is-disabled ::ng-deep .nx-expansion-panel__header-content{border-color:GrayText}:host.nx-expansion-panel--light.nx-expansion-panel--negative ::ng-deep .nx-expansion-panel__header-content,:host.nx-expansion-panel--light:not(.nx-expansion-panel--negative) ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 windowText}:host.nx-expansion-panel--light.nx-expansion-panel--negative:last-child,:host.nx-expansion-panel--light.nx-expansion-panel--negative:only-child,:host.nx-expansion-panel--light:not(.nx-expansion-panel--negative):last-child,:host.nx-expansion-panel--light:not(.nx-expansion-panel--negative):only-child{box-shadow:0 1px 0 0 windowText;border-bottom:1px solid CanvasText}}\n"], directives: [{ type: i3.CdkPortalOutlet, selector: "[cdkPortalOutlet]", inputs: ["cdkPortalOutlet"], outputs: ["attached"], exportAs: ["cdkPortalOutlet"] }], animations: [nxAccordionAnimations.bodyExpansion], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxExpansionPanelComponent, decorators: [{
            type: Component,
            args: [{ selector: 'nx-expansion-panel', exportAs: 'NxExpansionPanelComponent', changeDetection: ChangeDetectionStrategy.OnPush, animations: [nxAccordionAnimations.bodyExpansion], host: {
                        '[class.nx-expanded]': 'expanded',
                        '[class.nx-expansion-panel--light]': '_accordionStyle === "light"',
                        '[class.nx-expansion-panel--regular]': '_accordionStyle === "regular"',
                        '[class.nx-expansion-panel--extra-light]': '_accordionStyle === "extra-light"',
                        '[class.nx-expansion-panel--negative]': 'negative',
                        '[class.is-disabled]': 'disabled',
                    }, providers: [
                        // Provide NxAccordionDirective as undefined to prevent nested expansion panels from registering
                        // to the same accordion.
                        { provide: NxAccordionDirective, useValue: undefined },
                    ], template: "<ng-content select=\"nx-expansion-panel-header\"></ng-content>\n\n<div class=\"nx-expansion-panel__content\" role=\"region\" [@bodyExpansion]=\"getOpenState()\" [attr.aria-labelledby]=\"_headerId\" [id]=\"id\">\n    <div class=\"nx-expansion-panel__body\">\n        <ng-content></ng-content>\n        <ng-template [cdkPortalOutlet]=\"portal\"></ng-template>\n    </div>\n</div>\n", styles: [":host{display:block}:host(.nx-expansion-panel--negative) ::ng-deep div.nx-expansion-panel__body *{color:var(--negative)}.nx-expansion-panel__content{overflow:hidden;display:block}.nx-expansion-panel__body{padding:var(--accordion-regular-body-padding);font-size:var(--accordion-body-font-size);line-height:var(--accordion-body-line-height);font-weight:var(--accordion-body-font-weight);letter-spacing:var(--accordion-body-letter-spacing)}@media (max-width: 703px){.nx-expansion-panel__body{padding:var(--accordion-regular-mobile-body-padding)}}:host(.nx-expansion-panel--regular):not(:first-child){margin-top:var(--accordion-regular-header-top-margin)}:host(.nx-expansion-panel--regular) ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--accordion-regular-border-color)}:host(.nx-expansion-panel--regular):last-child,:host(.nx-expansion-panel--regular):only-child{box-shadow:0 1px 0 0 var(--accordion-regular-border-color)}@media (max-width: 703px){:host(.nx-expansion-panel--regular):not(:first-child){margin-top:0}:host(.nx-expansion-panel--regular) ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--accordion-regular-mobile-border-color)}:host(.nx-expansion-panel--regular):last-child ::ng-deep .nx-expansion-panel__header-content,:host(.nx-expansion-panel--regular):only-child ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--accordion-regular-mobile-border-color),inset 0 -1px 0 0 var(--accordion-regular-mobile-separator-color)}:host(.nx-expansion-panel--regular).nx-expanded ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--accordion-regular-mobile-border-color),inset 0 -1px 0 0 var(--accordion-regular-mobile-separator-color)}}:host(.nx-expansion-panel--light) .nx-expansion-panel__body{padding:var(--accordion-light-body-padding)}@media (max-width: 703px){:host(.nx-expansion-panel--light) .nx-expansion-panel__body{padding:var(--accordion-light-mobile-body-padding)}}:host(.nx-expansion-panel--light):not(.nx-expansion-panel--negative) ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--accordion-light-border-color)}:host(.nx-expansion-panel--light):not(.nx-expansion-panel--negative):last-child,:host(.nx-expansion-panel--light):not(.nx-expansion-panel--negative):only-child{box-shadow:0 1px 0 0 var(--accordion-light-border-color)}@media (max-width: 703px){:host(.nx-expansion-panel--regular.nx-expansion-panel--negative) ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--negative-01)}:host(.nx-expansion-panel--regular.nx-expansion-panel--negative):last-child ::ng-deep .nx-expansion-panel__header-content,:host(.nx-expansion-panel--regular.nx-expansion-panel--negative):only-child ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--negative-01),inset 0 -1px 0 0 var(--negative-01)}:host(.nx-expansion-panel--regular.nx-expansion-panel--negative).nx-expanded ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--negative-01),inset 0 -1px 0 0 var(--negative-01)}}:host(.nx-expansion-panel--light.nx-expansion-panel--negative){color:var(--negative)}:host(.nx-expansion-panel--light.nx-expansion-panel--negative) ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 var(--negative)}:host(.nx-expansion-panel--light.nx-expansion-panel--negative):last-child,:host(.nx-expansion-panel--light.nx-expansion-panel--negative):only-child{box-shadow:0 1px 0 0 var(--negative)}:host(.nx-expansion-panel--extra-light):not(:first-child){margin-top:var(--accordion-extra-light-header-top-margin)}:host(.nx-expansion-panel--extra-light) .nx-expansion-panel__body{padding:var(--accordion-extra-light-body-padding)}@media screen and (-ms-high-contrast: active){:host{border-color:windowText}:host ::ng-deep .nx-expansion-panel__header-content{color:buttonText}:host.nx-expansion-panel--regular ::ng-deep .nx-expansion-panel__header-content{border:1px solid buttonText}:host.is-disabled ::ng-deep .nx-expansion-panel__header-content{border-color:GrayText}:host.nx-expansion-panel--light.nx-expansion-panel--negative ::ng-deep .nx-expansion-panel__header-content,:host.nx-expansion-panel--light:not(.nx-expansion-panel--negative) ::ng-deep .nx-expansion-panel__header-content{box-shadow:inset 0 1px 0 0 windowText}:host.nx-expansion-panel--light.nx-expansion-panel--negative:last-child,:host.nx-expansion-panel--light.nx-expansion-panel--negative:only-child,:host.nx-expansion-panel--light:not(.nx-expansion-panel--negative):last-child,:host.nx-expansion-panel--light:not(.nx-expansion-panel--negative):only-child{box-shadow:0 1px 0 0 windowText;border-bottom:1px solid CanvasText}}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.NxAccordionDirective, decorators: [{
                    type: Optional
                }, {
                    type: SkipSelf
                }] }, { type: i0.ChangeDetectorRef }, { type: i2.UniqueSelectionDispatcher }, { type: i0.ViewContainerRef }]; }, propDecorators: { negative: [{
                type: Input
            }], style: [{
                type: Input,
                args: ['nxStyle']
            }], lazyContent: [{
                type: ContentChild,
                args: [NxExpansionPanelBodyDirective]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwYW5zaW9uLXBhbmVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmctYXF1aWxhL3NyYy9hY2NvcmRpb24vZXhwYW5zaW9uLXBhbmVsLnRzIiwiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmctYXF1aWxhL3NyYy9hY2NvcmRpb24vZXhwYW5zaW9uLXBhbmVsLmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDMUQsT0FBTyxFQUFnQixxQkFBcUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRTVFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNyRCxPQUFPLEVBRUgsdUJBQXVCLEVBRXZCLFNBQVMsRUFDVCxZQUFZLEVBQ1osS0FBSyxFQUdMLFFBQVEsRUFFUixRQUFRLEdBRVgsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV6RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDbkQsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDL0QsT0FBTyxFQUFFLDZCQUE2QixFQUFFLE1BQU0sd0JBQXdCLENBQUM7Ozs7O0FBRXZFLElBQUksTUFBTSxHQUFHLENBQUMsQ0FBQztBQUlmLE1BQU0sWUFBWSxHQUFHLFNBQVMsQ0FBQztBQXVCL0IsTUFBTSxPQUFPLHlCQUEwQixTQUFRLGdCQUFnQjtJQStDM0Q7SUFDSSxvQkFBb0IsQ0FBZ0MsU0FBK0IsRUFBRSw2REFBNkQ7SUFDbEosSUFBdUIsRUFDdkIsb0JBQStDLEVBQ3ZDLGlCQUFtQztRQUUzQyxLQUFLLENBQUMsU0FBVSxFQUFFLElBQUksRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO1FBTE0sY0FBUyxHQUFULFNBQVMsQ0FBc0I7UUFHM0Usc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFrQjtRQXpDdkMsY0FBUyxHQUFtQixJQUFJLENBQUM7UUFDekMsb0JBQWUsR0FBbUIsWUFBWSxDQUFDO1FBbUJ2QyxXQUFNLEdBQTBCLElBQUksQ0FBQztRQVk3QyxjQUFTLEdBQUcsNkJBQTZCLE1BQU0sRUFBRSxFQUFFLENBQUM7UUFFcEQsNERBQTREO1FBQ25ELGtCQUFhLEdBQUcsSUFBSSxPQUFPLEVBQWlCLENBQUM7SUFTdEQsQ0FBQztJQXJERCx5REFBeUQ7SUFDekQsSUFDSSxRQUFRLENBQUMsS0FBbUI7UUFDNUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsRCxDQUFDO0lBQ0QsSUFBSSxRQUFRO1FBQ1IsT0FBTyxJQUFJLENBQUMsU0FBb0IsQ0FBQztJQUNyQyxDQUFDO0lBS0Q7OztPQUdHO0lBQ0gsSUFDSSxLQUFLLENBQUMsS0FBcUI7UUFDM0IsS0FBSyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUM7UUFFckMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsMkJBQTJCLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzlFLElBQUksQ0FBQyxNQUFNLEdBQUcsUUFBMEIsQ0FBQztRQUN6QyxJQUFJLENBQUMsZUFBZSxHQUFHLFFBQTBCLENBQUM7SUFDdEQsQ0FBQztJQUVELElBQUksS0FBSztRQUNMLE9BQU8sSUFBSSxDQUFDLE1BQXdCLENBQUM7SUFDekMsQ0FBQztJQVNELG9CQUFvQjtJQUNwQixJQUFJLE1BQU07UUFDTixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDeEIsQ0FBQztJQWdCRCxrQkFBa0I7UUFDZCxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDbEIsd0RBQXdEO1lBQ3hELElBQUksQ0FBQyxNQUFNO2lCQUNOLElBQUksQ0FDRCxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQ2YsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQzVDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FDVjtpQkFDQSxTQUFTLENBQUMsR0FBRyxFQUFFO2dCQUNaLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxjQUFjLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFDMUYsQ0FBQyxDQUFDLENBQUM7U0FDVjtRQUVELHNEQUFzRDtRQUN0RCxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDaEIsSUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLElBQUksSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssS0FBSyxJQUFJLEVBQUU7Z0JBQ3RELElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7YUFDckM7WUFFRCxJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssSUFBSSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxLQUFLLElBQUksRUFBRTtnQkFDNUQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQzthQUMzQztTQUNKO0lBQ0wsQ0FBQztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUM5QixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBRUQsV0FBVztRQUNQLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ2xDLENBQUM7SUFFRCxvQkFBb0I7SUFDcEIsWUFBWTtRQUNSLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7SUFDN0MsQ0FBQzs7c0hBOUZRLHlCQUF5QjswR0FBekIseUJBQXlCLHNkQU52QjtRQUNQLGdHQUFnRztRQUNoRyx5QkFBeUI7UUFDekIsRUFBRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRTtLQUN6RCxtRUFtQ2EsNkJBQTZCLHFJQ3JGL0MsNlhBUUEsZ3pKRDZCZ0IsQ0FBQyxxQkFBcUIsQ0FBQyxhQUFhLENBQUM7MkZBZXhDLHlCQUF5QjtrQkFyQnJDLFNBQVM7K0JBQ0ksb0JBQW9CLFlBQ3BCLDJCQUEyQixtQkFHcEIsdUJBQXVCLENBQUMsTUFBTSxjQUNuQyxDQUFDLHFCQUFxQixDQUFDLGFBQWEsQ0FBQyxRQUMzQzt3QkFDRixxQkFBcUIsRUFBRSxVQUFVO3dCQUNqQyxtQ0FBbUMsRUFBRSw2QkFBNkI7d0JBQ2xFLHFDQUFxQyxFQUFFLCtCQUErQjt3QkFDdEUseUNBQXlDLEVBQUUsbUNBQW1DO3dCQUM5RSxzQ0FBc0MsRUFBRSxVQUFVO3dCQUNsRCxxQkFBcUIsRUFBRSxVQUFVO3FCQUNwQyxhQUNVO3dCQUNQLGdHQUFnRzt3QkFDaEcseUJBQXlCO3dCQUN6QixFQUFFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFO3FCQUN6RDs7MEJBa0R5QixRQUFROzswQkFBSSxRQUFRO21KQTdDMUMsUUFBUTtzQkFEWCxLQUFLO2dCQWdCRixLQUFLO3NCQURSLEtBQUs7dUJBQUMsU0FBUztnQkFnQjZCLFdBQVc7c0JBQXZELFlBQVk7dUJBQUMsNkJBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2RrQWNjb3JkaW9uSXRlbSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9hY2NvcmRpb24nO1xuaW1wb3J0IHsgQm9vbGVhbklucHV0LCBjb2VyY2VCb29sZWFuUHJvcGVydHkgfSBmcm9tICdAYW5ndWxhci9jZGsvY29lcmNpb24nO1xuaW1wb3J0IHsgVW5pcXVlU2VsZWN0aW9uRGlzcGF0Y2hlciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2xsZWN0aW9ucyc7XG5pbXBvcnQgeyBUZW1wbGF0ZVBvcnRhbCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9wb3J0YWwnO1xuaW1wb3J0IHtcbiAgICBBZnRlckNvbnRlbnRJbml0LFxuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgIENvbXBvbmVudCxcbiAgICBDb250ZW50Q2hpbGQsXG4gICAgSW5wdXQsXG4gICAgT25DaGFuZ2VzLFxuICAgIE9uRGVzdHJveSxcbiAgICBPcHRpb25hbCxcbiAgICBTaW1wbGVDaGFuZ2VzLFxuICAgIFNraXBTZWxmLFxuICAgIFZpZXdDb250YWluZXJSZWYsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZmlsdGVyLCBzdGFydFdpdGgsIHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IE54QWNjb3JkaW9uRGlyZWN0aXZlIH0gZnJvbSAnLi9hY2NvcmRpb24nO1xuaW1wb3J0IHsgbnhBY2NvcmRpb25BbmltYXRpb25zIH0gZnJvbSAnLi9hY2NvcmRpb24tYW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBOeEV4cGFuc2lvblBhbmVsQm9keURpcmVjdGl2ZSB9IGZyb20gJy4vZXhwYW5zaW9uLXBhbmVsLWJvZHknO1xuXG5sZXQgbmV4dElkID0gMDtcblxuLyoqIFRoZSBzdHlsaW5nIG9mIHRoZSBhY2NvcmRpb24uICovXG5leHBvcnQgdHlwZSBBY2NvcmRpb25TdHlsZSA9ICdyZWd1bGFyJyB8ICdsaWdodCcgfCAnZXh0cmEtbGlnaHQnO1xuY29uc3QgREVGQVVMVF9UWVBFID0gJ3JlZ3VsYXInO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ254LWV4cGFuc2lvbi1wYW5lbCcsXG4gICAgZXhwb3J0QXM6ICdOeEV4cGFuc2lvblBhbmVsQ29tcG9uZW50JyxcbiAgICB0ZW1wbGF0ZVVybDogJ2V4cGFuc2lvbi1wYW5lbC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnZXhwYW5zaW9uLXBhbmVsLnNjc3MnXSxcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgICBhbmltYXRpb25zOiBbbnhBY2NvcmRpb25BbmltYXRpb25zLmJvZHlFeHBhbnNpb25dLFxuICAgIGhvc3Q6IHtcbiAgICAgICAgJ1tjbGFzcy5ueC1leHBhbmRlZF0nOiAnZXhwYW5kZWQnLFxuICAgICAgICAnW2NsYXNzLm54LWV4cGFuc2lvbi1wYW5lbC0tbGlnaHRdJzogJ19hY2NvcmRpb25TdHlsZSA9PT0gXCJsaWdodFwiJyxcbiAgICAgICAgJ1tjbGFzcy5ueC1leHBhbnNpb24tcGFuZWwtLXJlZ3VsYXJdJzogJ19hY2NvcmRpb25TdHlsZSA9PT0gXCJyZWd1bGFyXCInLFxuICAgICAgICAnW2NsYXNzLm54LWV4cGFuc2lvbi1wYW5lbC0tZXh0cmEtbGlnaHRdJzogJ19hY2NvcmRpb25TdHlsZSA9PT0gXCJleHRyYS1saWdodFwiJyxcbiAgICAgICAgJ1tjbGFzcy5ueC1leHBhbnNpb24tcGFuZWwtLW5lZ2F0aXZlXSc6ICduZWdhdGl2ZScsXG4gICAgICAgICdbY2xhc3MuaXMtZGlzYWJsZWRdJzogJ2Rpc2FibGVkJyxcbiAgICB9LFxuICAgIHByb3ZpZGVyczogW1xuICAgICAgICAvLyBQcm92aWRlIE54QWNjb3JkaW9uRGlyZWN0aXZlIGFzIHVuZGVmaW5lZCB0byBwcmV2ZW50IG5lc3RlZCBleHBhbnNpb24gcGFuZWxzIGZyb20gcmVnaXN0ZXJpbmdcbiAgICAgICAgLy8gdG8gdGhlIHNhbWUgYWNjb3JkaW9uLlxuICAgICAgICB7IHByb3ZpZGU6IE54QWNjb3JkaW9uRGlyZWN0aXZlLCB1c2VWYWx1ZTogdW5kZWZpbmVkIH0sXG4gICAgXSxcbn0pXG5leHBvcnQgY2xhc3MgTnhFeHBhbnNpb25QYW5lbENvbXBvbmVudCBleHRlbmRzIENka0FjY29yZGlvbkl0ZW0gaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG4gICAgLyoqIFdoZXRoZXIgdGhlIG5lZ2F0aXZlIHNldCBvZiBzdHlsZXMgc2hvdWxkIGJlIHVzZWQuICovXG4gICAgQElucHV0KClcbiAgICBzZXQgbmVnYXRpdmUodmFsdWU6IEJvb2xlYW5JbnB1dCkge1xuICAgICAgICB0aGlzLl9uZWdhdGl2ZSA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSh2YWx1ZSk7XG4gICAgfVxuICAgIGdldCBuZWdhdGl2ZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX25lZ2F0aXZlIGFzIGJvb2xlYW47XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfbmVnYXRpdmU6IGJvb2xlYW4gfCBudWxsID0gbnVsbDtcbiAgICBfYWNjb3JkaW9uU3R5bGU6IEFjY29yZGlvblN0eWxlID0gREVGQVVMVF9UWVBFO1xuXG4gICAgLyoqXG4gICAgICogVmFsdWUgZm9yIHRoZSBzdHlsaW5nIHRoYXQgc2hvdWxkIGJlIGNob3Nlbi5cbiAgICAgKiBEZWZhdWx0IHZhbHVlOiAncmVndWxhcicuXG4gICAgICovXG4gICAgQElucHV0KCdueFN0eWxlJylcbiAgICBzZXQgc3R5bGUodmFsdWU6IEFjY29yZGlvblN0eWxlKSB7XG4gICAgICAgIHZhbHVlID0gdmFsdWUgPyB2YWx1ZSA6IERFRkFVTFRfVFlQRTtcblxuICAgICAgICBjb25zdCBbbmV3VmFsdWVdID0gdmFsdWUubWF0Y2goL3JlZ3VsYXJ8bGlnaHR8ZXh0cmEtbGlnaHQvKSB8fCBbREVGQVVMVF9UWVBFXTtcbiAgICAgICAgdGhpcy5fc3R5bGUgPSBuZXdWYWx1ZSBhcyBBY2NvcmRpb25TdHlsZTtcbiAgICAgICAgdGhpcy5fYWNjb3JkaW9uU3R5bGUgPSBuZXdWYWx1ZSBhcyBBY2NvcmRpb25TdHlsZTtcbiAgICB9XG5cbiAgICBnZXQgc3R5bGUoKTogQWNjb3JkaW9uU3R5bGUge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3R5bGUgYXMgQWNjb3JkaW9uU3R5bGU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfc3R5bGU6IEFjY29yZGlvblN0eWxlIHwgbnVsbCA9IG51bGw7XG5cbiAgICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICAgIEBDb250ZW50Q2hpbGQoTnhFeHBhbnNpb25QYW5lbEJvZHlEaXJlY3RpdmUpIGxhenlDb250ZW50OiBhbnk7XG5cbiAgICBwcml2YXRlIF9wb3J0YWwhOiBUZW1wbGF0ZVBvcnRhbDtcblxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgZ2V0IHBvcnRhbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BvcnRhbDtcbiAgICB9XG5cbiAgICBfaGVhZGVySWQgPSBgbngtZXhwYW5zaW9uLXBhbmVsLWhlYWRlci0ke25leHRJZCsrfWA7XG5cbiAgICAvKiogU3RyZWFtIHRoYXQgZW1pdHMgZm9yIGNoYW5nZXMgaW4gYEBJbnB1dGAgcHJvcGVydGllcy4gKi9cbiAgICByZWFkb25seSBfaW5wdXRDaGFuZ2VzID0gbmV3IFN1YmplY3Q8U2ltcGxlQ2hhbmdlcz4oKTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICAvKiogQGRvY3MtcHJpdmF0ZSAqLyBAT3B0aW9uYWwoKSBAU2tpcFNlbGYoKSBwdWJsaWMgYWNjb3JkaW9uOiBOeEFjY29yZGlvbkRpcmVjdGl2ZSwgLy8gbm90IHR5cGVkIGFzIG51bGxhYmxlOiBzdXBlciBjbGFzcyBkb2VzIG5vdCBzdXBwb3J0IGBudWxsYFxuICAgICAgICBfY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgX2V4cGFuc2lvbkRpc3BhdGNoZXI6IFVuaXF1ZVNlbGVjdGlvbkRpc3BhdGNoZXIsXG4gICAgICAgIHByaXZhdGUgX3ZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYsXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKGFjY29yZGlvbiEsIF9jZHIsIF9leHBhbnNpb25EaXNwYXRjaGVyKTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgICAgIGlmICh0aGlzLmxhenlDb250ZW50KSB7XG4gICAgICAgICAgICAvLyBSZW5kZXIgdGhlIGNvbnRlbnQgYXMgc29vbiBhcyB0aGUgcGFuZWwgYmVjb21lcyBvcGVuLlxuICAgICAgICAgICAgdGhpcy5vcGVuZWRcbiAgICAgICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRXaXRoKG51bGwpLFxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXIoKCkgPT4gdGhpcy5leHBhbmRlZCAmJiAhdGhpcy5fcG9ydGFsKSxcbiAgICAgICAgICAgICAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3BvcnRhbCA9IG5ldyBUZW1wbGF0ZVBvcnRhbCh0aGlzLmxhenlDb250ZW50Ll90ZW1wbGF0ZSwgdGhpcy5fdmlld0NvbnRhaW5lclJlZik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJbmhlcml0IGFwcGVhcmFuY2UgZ2l2ZW4gYnkgdGhlIGFjY29yZGlvbiAoaWYgYW55KS5cbiAgICAgICAgaWYgKHRoaXMuYWNjb3JkaW9uKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zdHlsZSA9PT0gbnVsbCAmJiB0aGlzLmFjY29yZGlvbi5zdHlsZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUgPSB0aGlzLmFjY29yZGlvbi5zdHlsZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMubmVnYXRpdmUgPT09IG51bGwgJiYgdGhpcy5hY2NvcmRpb24ubmVnYXRpdmUgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5lZ2F0aXZlID0gdGhpcy5hY2NvcmRpb24ubmVnYXRpdmU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIHRoaXMuX2lucHV0Q2hhbmdlcy5uZXh0KGNoYW5nZXMpO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBzdXBlci5uZ09uRGVzdHJveSgpO1xuICAgICAgICB0aGlzLl9pbnB1dENoYW5nZXMuY29tcGxldGUoKTtcbiAgICB9XG5cbiAgICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICAgIGdldE9wZW5TdGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXhwYW5kZWQgPyAnb3BlbicgOiAnY2xvc2VkJztcbiAgICB9XG59XG4iLCI8bmctY29udGVudCBzZWxlY3Q9XCJueC1leHBhbnNpb24tcGFuZWwtaGVhZGVyXCI+PC9uZy1jb250ZW50PlxuXG48ZGl2IGNsYXNzPVwibngtZXhwYW5zaW9uLXBhbmVsX19jb250ZW50XCIgcm9sZT1cInJlZ2lvblwiIFtAYm9keUV4cGFuc2lvbl09XCJnZXRPcGVuU3RhdGUoKVwiIFthdHRyLmFyaWEtbGFiZWxsZWRieV09XCJfaGVhZGVySWRcIiBbaWRdPVwiaWRcIj5cbiAgICA8ZGl2IGNsYXNzPVwibngtZXhwYW5zaW9uLXBhbmVsX19ib2R5XCI+XG4gICAgICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbiAgICAgICAgPG5nLXRlbXBsYXRlIFtjZGtQb3J0YWxPdXRsZXRdPVwicG9ydGFsXCI+PC9uZy10ZW1wbGF0ZT5cbiAgICA8L2Rpdj5cbjwvZGl2PlxuIl19