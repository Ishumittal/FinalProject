import { coerceBooleanProperty, coerceNumberProperty } from '@angular/cdk/coercion';
import { ChangeDetectionStrategy, Component, ContentChildren, EventEmitter, Inject, Input, Optional, Output, ViewChild, ViewChildren, } from '@angular/core';
import { NxAccordionDirective, NxExpansionPanelComponent } from '@aposin/ng-aquila/accordion';
import { NxBreakpoints } from '@aposin/ng-aquila/utils';
import { merge, Subject, Subscription } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { NxTabComponent } from './tab';
import { NxTabBodyComponent } from './tab-body';
import { NxTabGroupBase } from './tab-group-base';
import { TAB_GROUP_DEFAULT_OPTIONS } from './tabs.models';
import * as i0 from "@angular/core";
import * as i1 from "@aposin/ng-aquila/utils";
import * as i2 from "@angular/cdk/a11y";
import * as i3 from "./tab-header";
import * as i4 from "./tab-header-outlet";
import * as i5 from "./tab-body";
import * as i6 from "@aposin/ng-aquila/accordion";
import * as i7 from "@angular/common";
import * as i8 from "./tab-label-wrapper";
export class NxTabChangeEvent {
}
let nextId = 0;
export class NxTabGroupComponent {
    constructor(viewportService, _cdr, _defaultOptions, _focusMonitor) {
        this.viewportService = viewportService;
        this._cdr = _cdr;
        this._defaultOptions = _defaultOptions;
        this._focusMonitor = _focusMonitor;
        this._selectedIndex = null;
        this._negative = false;
        this._disabled = false;
        this._indexToSelect = 0;
        this._autoselect = true;
        this._mobileAccordion = true;
        this._showAccordion = false;
        /** An event emitted when the selected tab has changed. */
        this.selectedIndexChange = new EventEmitter();
        /** An event emitted when the selected tab has changed. */
        this.selectedTabChange = new EventEmitter();
        /**
         * An event emitted when focus has changed within a tab group.
         *
         * **Note:** is not supported in mobile view.
         */
        this.focusChange = new EventEmitter();
        /** Subscription to changes in the tab labels. */
        this._tabLabelSubscription = Subscription.EMPTY;
        this._disabledTabsCache = [];
        this._appearanceChange = new Subject();
        this._destroyed = new Subject();
        this._groupId = nextId++;
        this.viewportService
            .max(NxBreakpoints.BREAKPOINT_MEDIUM)
            .pipe(takeUntil(this._destroyed))
            .subscribe(isSmallTablet => this._switchAppearance(isSmallTablet));
    }
    /** Sets the selected tab. */
    get selectedIndex() {
        return this._selectedIndex;
    }
    set selectedIndex(value) {
        this._indexToSelect = coerceNumberProperty(value, null);
    }
    /** Whether the negative set of styling should be used. */
    get negative() {
        return this._negative;
    }
    set negative(value) {
        if (value !== this._negative) {
            this._negative = coerceBooleanProperty(value);
            this._cdr.markForCheck();
        }
    }
    /** Whether the tab group is disabled. Default: false. */
    get disabled() {
        return this._disabled;
    }
    set disabled(value) {
        if (value !== this._disabled) {
            this._disabled = coerceBooleanProperty(value);
            this._cdr.markForCheck();
        }
    }
    /** Whether the tab should be immediately selected on focus. */
    get autoselect() {
        return this._autoselect;
    }
    set autoselect(value) {
        this._autoselect = coerceBooleanProperty(value);
    }
    /** Whether the tabs should to accordion on mobile viewports. */
    get mobileAccordion() {
        return this._mobileAccordion;
    }
    set mobileAccordion(value) {
        this._mobileAccordion = coerceBooleanProperty(value);
    }
    /**
     * **Expert option**
     *
     * Sets the appearance of the tab group. Default: 'default'.
     */
    set appearance(value) {
        if (this._appearance !== value) {
            this._appearance = value;
            this._cdr.markForCheck();
        }
    }
    get appearance() {
        return this._appearance || this._defaultOptions?.appearance || 'default';
    }
    ngAfterContentInit() {
        this._subscribeToTabLabels();
        // Subscribe to changes in the amount of tabs, in order to be
        // able to re-render the content as new tabs are added or removed.
        this.tabs.changes.pipe(takeUntil(this._destroyed)).subscribe(() => {
            const indexToSelect = this._clampTabIndex(this._indexToSelect);
            // Maintain the previously-selected tab if a new tab is added or removed and there is no
            // explicit change that selects a different tab.
            if (indexToSelect === this._selectedIndex) {
                const tabs = this.tabs.toArray();
                for (let i = 0; i < tabs.length; i++) {
                    if (tabs[i].isActive) {
                        // Assign both to the `_indexToSelect` and `_selectedIndex` so we don't fire a changed
                        // event, otherwise the consumer may end up in an infinite loop in some edge cases like
                        // adding a tab within the `selectedIndexChange` event.
                        this._indexToSelect = this._selectedIndex = i;
                        break;
                    }
                }
            }
            this._cdr.markForCheck();
        });
    }
    /**
     * After the content is checked, this component knows what tabs have been defined
     * and what the selected index should be.
     */
    ngAfterContentChecked() {
        // Don't clamp the `indexToSelect` immediately in the setter because it can happen that
        // the amount of tabs changes before the actual change detection runs.
        let indexToSelect = (this._indexToSelect = this._clampTabIndex(this._indexToSelect));
        // If the active tab is disabled select the next focusable tab
        // if all tabs are disabled, allow selection of disabled active tab.
        if (!this.disabled && this.tabs.toArray()[indexToSelect].disabled) {
            const nextFocusable = this.tabs
                .toArray()
                .map((tab, index) => ({ tab, index }))
                .find(item => !item.tab.disabled);
            indexToSelect = nextFocusable ? nextFocusable.index : indexToSelect;
        }
        // If the index to select was disabled previously leave the selection on the current
        // so that the selection does not jump from one to another tab.
        if (this._disabledTabsCache[this._indexToSelect]) {
            this._indexToSelect = this.selectedIndex;
        }
        // If there is a change in selected index, emit a change event. Should not trigger if
        // the selected index has not yet been initialized.
        if (this._selectedIndex !== indexToSelect) {
            const isFirstRun = this._selectedIndex == null;
            if (!isFirstRun) {
                this.selectedTabChange.emit(this._createChangeEvent(indexToSelect));
            }
            // Changing these values after change detection has run
            // since the checked content may contain references to them.
            Promise.resolve().then(() => {
                this.tabs.forEach((tab, index) => (tab.isActive = index === indexToSelect));
                if (!isFirstRun) {
                    this.selectedIndexChange.emit(indexToSelect);
                }
            });
        }
        if (this._selectedIndex !== indexToSelect) {
            this._selectedIndex = indexToSelect;
            this._cdr.markForCheck();
        }
        // cache the previous disabled status of all tabs
        if (!this.disabled) {
            this.tabs.toArray().forEach((tab, index) => (this._disabledTabsCache[index] = tab.disabled));
        }
    }
    ngAfterViewInit() {
        this._tabButtons.forEach(button => this._focusMonitor.monitor(button));
        this._tabButtonsPrevious = this._tabButtons;
        this._tabButtons.changes.subscribe(tabButtons => {
            this._tabButtonsPrevious.forEach(button => this._focusMonitor.stopMonitoring(button));
            this._tabButtonsPrevious = tabButtons;
            tabButtons.forEach((button) => this._focusMonitor.monitor(button));
        });
    }
    ngOnDestroy() {
        this._destroyed.next();
        this._destroyed.complete();
        this._tabLabelSubscription.unsubscribe();
        this._tabButtons.forEach(button => {
            this._focusMonitor.stopMonitoring(button);
        });
    }
    /**
     * Subscribes to changes in the tab labels. This is needed, because the @Input for the label is
     * on the NxTab component, whereas the data binding is inside the NxTabGroup. In order for the
     * binding to be updated, we need to subscribe to changes in it and trigger change detection
     * manually.
     */
    _subscribeToTabLabels() {
        if (this._tabLabelSubscription) {
            this._tabLabelSubscription.unsubscribe();
        }
        this._tabLabelSubscription = merge(...this.tabs.map(tab => tab._stateChanges)).subscribe(() => this._cdr.markForCheck());
    }
    /** Clamps the given index to the bounds of 0 and the tabs length. */
    _clampTabIndex(index) {
        // Note the `|| 0`, which ensures that values like NaN can't get through
        // and which would otherwise throw the component into an infinite loop
        // (since Math.max(NaN, 0) === NaN).
        return Math.min(this.tabs.length - 1, Math.max(index || 0, 0));
    }
    /** @docs-private */
    focusChanged(index) {
        this.focusChange.emit(this._createChangeEvent(index));
    }
    _createChangeEvent(index) {
        const event = new NxTabChangeEvent();
        event.index = index;
        if (this.tabs?.length) {
            event.tab = this.tabs.toArray()[index];
        }
        return event;
    }
    /** @docs-private */
    handleClick(index) {
        const clickedTab = this.tabs.toArray()[index];
        if (!this.disabled && !clickedTab.disabled) {
            this.selectedIndex = this.tabHeader.focusIndex = index;
        }
    }
    /**
     * @docs-private
     * Returns the tabindex for a tab label
     */
    getTabIndex(tab, idx) {
        return this.selectedIndex === idx && !tab.disabled && !this.disabled ? 0 : -1;
    }
    /** Returns a unique id for each tab label element */
    _getTabLabelId(i) {
        return `nx-tab-label-${this._groupId}-${i}`;
    }
    /** Returns a unique id for each tab content element */
    _getTabContentId(i) {
        return `nx-tab-content-${this._groupId}-${i}`;
    }
    _switchAppearance(isSmallTablet) {
        if (!this._mobileAccordion) {
            return;
        }
        // trigger a change only when there is value difference
        // otherwise a switch is triggered by tablet <-> desktop change
        if (this._showAccordion !== isSmallTablet) {
            // notify the outlets to detach the viewrefs for header and body before
            // we switch the appearance. this way we only instantiate the templates
            // once so that they do not get destroyed during the switch
            this._appearanceChange.next();
            this._showAccordion = isSmallTablet;
            this._cdr.markForCheck();
        }
    }
    /**
     * Emulate the tab change event when an accordion panel is opened in
     * mobile viewports.
     */
    _panelOpened(index) {
        this.selectedIndex = index;
    }
}
NxTabGroupComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxTabGroupComponent, deps: [{ token: i1.NxViewportService }, { token: i0.ChangeDetectorRef }, { token: TAB_GROUP_DEFAULT_OPTIONS, optional: true }, { token: i2.FocusMonitor }], target: i0.ɵɵFactoryTarget.Component });
NxTabGroupComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxTabGroupComponent, selector: "nx-tab-group", inputs: { selectedIndex: "selectedIndex", negative: "negative", disabled: "disabled", autoselect: "autoselect", mobileAccordion: "mobileAccordion", appearance: "appearance" }, outputs: { selectedIndexChange: "selectedIndexChange", selectedTabChange: "selectedTabChange", focusChange: "focusChange" }, host: { properties: { "class.is-negative": "negative", "class.is-disabled": "disabled", "class.is-expert": "appearance === \"expert\"" } }, providers: [{ provide: NxTabGroupBase, useExisting: NxTabGroupComponent }], queries: [{ propertyName: "tabs", predicate: NxTabComponent }], viewQueries: [{ propertyName: "tabHeader", first: true, predicate: ["tabHeader"], descendants: true }, { propertyName: "accordion", first: true, predicate: ["accordion"], descendants: true, read: NxAccordionDirective }, { propertyName: "tabBodyChildren", predicate: NxTabBodyComponent, descendants: true }, { propertyName: "panels", predicate: NxExpansionPanelComponent, descendants: true }, { propertyName: "_tabButtons", predicate: ["tabButton"], descendants: true }], ngImport: i0, template: "<ng-container *ngIf=\"!_showAccordion\">\n    <nx-tab-header\n        #tabHeader\n        [selectedIndex]=\"selectedIndex\"\n        (selectFocusedIndex)=\"selectedIndex = $event\"\n        (indexFocused)=\"focusChanged($event)\"\n        [autoselect]=\"autoselect\"\n    >\n        <button\n            #tabButton\n            type=\"button\"\n            nxTabLabelWrapper\n            *ngFor=\"let tab of tabs; let i = index\"\n            role=\"tab\"\n            (click)=\"handleClick(i)\"\n            class=\"nx-tab-header__item\"\n            [id]=\"_getTabLabelId(i)\"\n            [attr.aria-controls]=\"_getTabContentId(i)\"\n            [attr.aria-selected]=\"selectedIndex === i\"\n            [attr.tabindex]=\"getTabIndex(tab, i)\"\n            [disabled]=\"tab.disabled\"\n            [class.nx-tab-header__item--disabled]=\"tab.disabled\"\n            [class.nx-tab-header__item--active]=\"selectedIndex === i\"\n        >\n            <div class=\"nx-tab-label__content\">\n                <nx-tab-header-outlet *ngIf=\"tab.templateLabel\" [content]=\"tab.headerViewRef\"></nx-tab-header-outlet>\n                <ng-container *ngIf=\"!tab.templateLabel\">{{tab.label}}</ng-container>\n            </div>\n        </button>\n    </nx-tab-header>\n\n    <div class=\"nx-tab-body__container\">\n        <nx-tab-body\n            *ngFor=\"let tab of tabs; let i = index\"\n            [id]=\"_getTabContentId(i)\"\n            role=\"tabpanel\"\n            class=\"nx-tab__body\"\n            [attr.aria-labelledby]=\"_getTabContentId(i)\"\n            [class.nx-tab__body--active]=\"selectedIndex === i\"\n            [tab]=\"tab\"\n            [active]=\"selectedIndex === i\"\n        ></nx-tab-body>\n    </div>\n</ng-container>\n\n<ng-template [ngIf]=\"_showAccordion\">\n    <nx-accordion #accordion [negative]=\"negative\">\n        <nx-expansion-panel *ngFor=\"let tab of tabs; let i = index\" [expanded]=\"selectedIndex === i\" (opened)=\"_panelOpened(i)\" [disabled]=\"tab.disabled\">\n            <nx-expansion-panel-header>\n                <nx-expansion-panel-title>\n                    <nx-tab-header-outlet *ngIf=\"tab.templateLabel\" [content]=\"tab.headerViewRef\"></nx-tab-header-outlet>\n                    <ng-container *ngIf=\"!tab.templateLabel\">{{tab.label}}</ng-container>\n                </nx-expansion-panel-title>\n            </nx-expansion-panel-header>\n            <!-- this is not lazy loading this is a trick because the portal gets added here -->\n            <!-- so we could rewrite the tab-body component that it takes care of \"lazy loading\" and the\n    accordion wouldn't know about it -->\n            <!-- active=true is a trick because we want to keep the content attached for better user experience along with expansion panel animation.  -->\n            <nx-tab-body [active]=\"true\" [tab]=\"tab\"></nx-tab-body>\n        </nx-expansion-panel>\n    </nx-accordion>\n</ng-template>\n", styles: [":host{display:block}.nx-tab-header__item{font-size:var(--tab-item-font-size);line-height:var(--tab-item-line-height);font-weight:var(--tab-item-font-weight);letter-spacing:var(--tab-item-letter-spacing);text-decoration:none;border:none;background:transparent;color:var(--tab-item-color);padding:4px 0 12px;margin:4px 16px 0;outline:none;position:relative;cursor:pointer;flex:0 0 auto}@media screen and (-ms-high-contrast: active){.nx-tab-header__item{background-color:buttonFace;border-color:buttonText;color:buttonText;-ms-high-contrast-adjust:none}}.nx-tab-header__item:hover{color:var(--tab-item-hover-color)}.nx-tab-header__item:active{color:var(--tab-item-active-color)}.nx-tab-header__item::-moz-focus-inner{border:0}:host .nx-tab-header__item{overflow:visible}:host .nx-tab-header__item:first-child{margin-left:0}[dir=rtl] :host .nx-tab-header__item:first-child{margin-right:0;margin-left:16px}:host .nx-tab-header__item:last-child{margin-right:0}[dir=rtl] :host .nx-tab-header__item:last-child{margin-right:16px;margin-left:0}.nx-tab-header__item:before{content:\"\";position:absolute;width:calc(100% + 64px);height:1px;bottom:0;left:-32px;background-color:var(--tab-item-border-color)}.nx-tab-header__item:first-child:before{left:0;width:calc(100% + 32px)}[dir=rtl] .nx-tab-header__item:first-child:before{left:auto;left:initial;right:0}.nx-tab-header__item:last-child:before{width:calc(100% + 32px)}[dir=rtl] .nx-tab-header__item:last-child:before{left:auto;left:initial;right:-32px}:host(.is-expert) .nx-tab-header__item:before{display:none}:host(.is-expert) .nx-tab-header__item:not(.nx-tab-header__item--active){border-color:transparent}:host(.is-expert) .nx-tab-header__item{padding-bottom:8px}:host(.is-expert) .nx-tab-header__item.nx-tab-header__item--active{padding-bottom:4px}:host(.is-expert):not(.is-negative) .nx-tab-header__item:not(.nx-tab-header__item--active):not(.nx-tab-header__item--disabled){color:var(--tab-expert-color)}:host(.is-expert):not(.is-negative) .nx-tab-header__item:not(.nx-tab-header__item--active):not(.nx-tab-header__item--disabled):hover{color:var(--tab-item-hover-color)}:host(.is-expert):not(.is-negative) .nx-tab-header__item:not(.nx-tab-header__item--active):not(.nx-tab-header__item--disabled):active{color:var(--tab-item-active-color)}@media screen and (-ms-high-contrast: active){:host(.is-expert):not(.is-negative) .nx-tab-header__item:not(.nx-tab-header__item--active):not(.nx-tab-header__item--disabled){color:buttonText}}.nx-tab-header__item--active{border-width:4px;font-weight:700;border-bottom-style:solid;border-color:var(--tab-item-active-border-color);padding-bottom:8px;cursor:default}.nx-tab-header__item--active:hover,.nx-tab-header__item--active:active{color:var(--tab-item-color)}@media screen and (-ms-high-contrast: active){.nx-tab-header__item--active{background-color:highlight;color:highlightText;border-color:highlight}}.nx-tab-header__item--active:before{display:none}.nx-tab-header__item--disabled{border-color:var(--tab-item-disabled-border-color);color:var(--tab-item-disabled-color);cursor:not-allowed}.nx-tab-header__item--disabled:hover,.nx-tab-header__item--disabled:active{color:var(--tab-item-disabled-color)}@media screen and (-ms-high-contrast: active){.nx-tab-header__item--disabled{border-color:GrayText;background-color:buttonFace;color:GrayText}}.nx-tab-label__content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}.nx-tab-header__item.cdk-keyboard-focused .nx-tab-label__content{box-shadow:var(--focus-box-shadow);border-radius:4px}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-tab-header__item.cdk-keyboard-focused .nx-tab-label__content{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}:host(.is-negative){color:var(--negative)}:host(.is-negative) .nx-tab-header__item{color:var(--negative);border-bottom-color:var(--negative)}:host(.is-negative) .nx-tab-header__item:hover,:host(.is-negative) .nx-tab-header__item:active{font-weight:700}:host(.is-negative) .nx-tab-header__item.nx-tab-header__item--disabled{border-color:var(--tab-item-disabled-border-color);color:var(--tab-item-disabled-color);cursor:not-allowed;color:var(--tab-item-disabled-negative-color);border-color:var(--tab-item-disabled-negative-color)}:host(.is-negative) .nx-tab-header__item.nx-tab-header__item--disabled:hover,:host(.is-negative) .nx-tab-header__item.nx-tab-header__item--disabled:active{color:var(--tab-item-disabled-color)}@media screen and (-ms-high-contrast: active){:host(.is-negative) .nx-tab-header__item.nx-tab-header__item--disabled{border-color:GrayText;background-color:buttonFace;color:GrayText}}:host(.is-negative.is-expert) .nx-tab-header__item.nx-tab-header__item--disabled:not(.nx-tab-header__item--active){border-bottom-color:transparent}:host(.is-disabled){cursor:not-allowed}:host(.is-disabled.is-negative) .nx-tab-header__item{color:var(--tab-item-disabled-negative-color);border-color:var(--tab-item-disabled-negative-color)}@media screen and (-ms-high-contrast: active){:host(.is-negative){color:buttonText}:host(.is-negative) .nx-tab-header__item{color:buttonText;border-bottom-color:buttonText}:host(.is-negative) .nx-tab-header__item--active{background-color:highlight;color:highlightText;border-color:highlight;-ms-high-contrast-adjust:none}:host(.is-disabled.is-negative) .nx-tab-header__item{color:GrayText;border-bottom-color:GrayText}}\n"], components: [{ type: i3.NxTabHeaderComponent, selector: "nx-tab-header", inputs: ["selectedIndex", "autoselect"], outputs: ["selectFocusedIndex", "indexFocused"] }, { type: i4.NxTabHeaderOutletComponent, selector: "nx-tab-header-outlet", inputs: ["content"] }, { type: i5.NxTabBodyComponent, selector: "nx-tab-body", inputs: ["tab", "active"] }, { type: i6.NxExpansionPanelComponent, selector: "nx-expansion-panel", inputs: ["negative", "nxStyle"], exportAs: ["NxExpansionPanelComponent"] }, { type: i6.NxExpansionPanelHeaderComponent, selector: "nx-expansion-panel-header" }], directives: [{ type: i7.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i7.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i8.NxTabLabelWrapperDirective, selector: "[nxTabLabelWrapper]", inputs: ["disabled"] }, { type: i6.NxAccordionDirective, selector: "nx-accordion", inputs: ["nxStyle", "negative"] }, { type: i6.NxExpansionPanelTitleDirective, selector: "nx-expansion-panel-title" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxTabGroupComponent, decorators: [{
            type: Component,
            args: [{ selector: 'nx-tab-group', changeDetection: ChangeDetectionStrategy.OnPush, host: {
                        '[class.is-negative]': 'negative',
                        '[class.is-disabled]': 'disabled',
                        '[class.is-expert]': 'appearance === "expert"',
                    }, providers: [{ provide: NxTabGroupBase, useExisting: NxTabGroupComponent }], template: "<ng-container *ngIf=\"!_showAccordion\">\n    <nx-tab-header\n        #tabHeader\n        [selectedIndex]=\"selectedIndex\"\n        (selectFocusedIndex)=\"selectedIndex = $event\"\n        (indexFocused)=\"focusChanged($event)\"\n        [autoselect]=\"autoselect\"\n    >\n        <button\n            #tabButton\n            type=\"button\"\n            nxTabLabelWrapper\n            *ngFor=\"let tab of tabs; let i = index\"\n            role=\"tab\"\n            (click)=\"handleClick(i)\"\n            class=\"nx-tab-header__item\"\n            [id]=\"_getTabLabelId(i)\"\n            [attr.aria-controls]=\"_getTabContentId(i)\"\n            [attr.aria-selected]=\"selectedIndex === i\"\n            [attr.tabindex]=\"getTabIndex(tab, i)\"\n            [disabled]=\"tab.disabled\"\n            [class.nx-tab-header__item--disabled]=\"tab.disabled\"\n            [class.nx-tab-header__item--active]=\"selectedIndex === i\"\n        >\n            <div class=\"nx-tab-label__content\">\n                <nx-tab-header-outlet *ngIf=\"tab.templateLabel\" [content]=\"tab.headerViewRef\"></nx-tab-header-outlet>\n                <ng-container *ngIf=\"!tab.templateLabel\">{{tab.label}}</ng-container>\n            </div>\n        </button>\n    </nx-tab-header>\n\n    <div class=\"nx-tab-body__container\">\n        <nx-tab-body\n            *ngFor=\"let tab of tabs; let i = index\"\n            [id]=\"_getTabContentId(i)\"\n            role=\"tabpanel\"\n            class=\"nx-tab__body\"\n            [attr.aria-labelledby]=\"_getTabContentId(i)\"\n            [class.nx-tab__body--active]=\"selectedIndex === i\"\n            [tab]=\"tab\"\n            [active]=\"selectedIndex === i\"\n        ></nx-tab-body>\n    </div>\n</ng-container>\n\n<ng-template [ngIf]=\"_showAccordion\">\n    <nx-accordion #accordion [negative]=\"negative\">\n        <nx-expansion-panel *ngFor=\"let tab of tabs; let i = index\" [expanded]=\"selectedIndex === i\" (opened)=\"_panelOpened(i)\" [disabled]=\"tab.disabled\">\n            <nx-expansion-panel-header>\n                <nx-expansion-panel-title>\n                    <nx-tab-header-outlet *ngIf=\"tab.templateLabel\" [content]=\"tab.headerViewRef\"></nx-tab-header-outlet>\n                    <ng-container *ngIf=\"!tab.templateLabel\">{{tab.label}}</ng-container>\n                </nx-expansion-panel-title>\n            </nx-expansion-panel-header>\n            <!-- this is not lazy loading this is a trick because the portal gets added here -->\n            <!-- so we could rewrite the tab-body component that it takes care of \"lazy loading\" and the\n    accordion wouldn't know about it -->\n            <!-- active=true is a trick because we want to keep the content attached for better user experience along with expansion panel animation.  -->\n            <nx-tab-body [active]=\"true\" [tab]=\"tab\"></nx-tab-body>\n        </nx-expansion-panel>\n    </nx-accordion>\n</ng-template>\n", styles: [":host{display:block}.nx-tab-header__item{font-size:var(--tab-item-font-size);line-height:var(--tab-item-line-height);font-weight:var(--tab-item-font-weight);letter-spacing:var(--tab-item-letter-spacing);text-decoration:none;border:none;background:transparent;color:var(--tab-item-color);padding:4px 0 12px;margin:4px 16px 0;outline:none;position:relative;cursor:pointer;flex:0 0 auto}@media screen and (-ms-high-contrast: active){.nx-tab-header__item{background-color:buttonFace;border-color:buttonText;color:buttonText;-ms-high-contrast-adjust:none}}.nx-tab-header__item:hover{color:var(--tab-item-hover-color)}.nx-tab-header__item:active{color:var(--tab-item-active-color)}.nx-tab-header__item::-moz-focus-inner{border:0}:host .nx-tab-header__item{overflow:visible}:host .nx-tab-header__item:first-child{margin-left:0}[dir=rtl] :host .nx-tab-header__item:first-child{margin-right:0;margin-left:16px}:host .nx-tab-header__item:last-child{margin-right:0}[dir=rtl] :host .nx-tab-header__item:last-child{margin-right:16px;margin-left:0}.nx-tab-header__item:before{content:\"\";position:absolute;width:calc(100% + 64px);height:1px;bottom:0;left:-32px;background-color:var(--tab-item-border-color)}.nx-tab-header__item:first-child:before{left:0;width:calc(100% + 32px)}[dir=rtl] .nx-tab-header__item:first-child:before{left:auto;left:initial;right:0}.nx-tab-header__item:last-child:before{width:calc(100% + 32px)}[dir=rtl] .nx-tab-header__item:last-child:before{left:auto;left:initial;right:-32px}:host(.is-expert) .nx-tab-header__item:before{display:none}:host(.is-expert) .nx-tab-header__item:not(.nx-tab-header__item--active){border-color:transparent}:host(.is-expert) .nx-tab-header__item{padding-bottom:8px}:host(.is-expert) .nx-tab-header__item.nx-tab-header__item--active{padding-bottom:4px}:host(.is-expert):not(.is-negative) .nx-tab-header__item:not(.nx-tab-header__item--active):not(.nx-tab-header__item--disabled){color:var(--tab-expert-color)}:host(.is-expert):not(.is-negative) .nx-tab-header__item:not(.nx-tab-header__item--active):not(.nx-tab-header__item--disabled):hover{color:var(--tab-item-hover-color)}:host(.is-expert):not(.is-negative) .nx-tab-header__item:not(.nx-tab-header__item--active):not(.nx-tab-header__item--disabled):active{color:var(--tab-item-active-color)}@media screen and (-ms-high-contrast: active){:host(.is-expert):not(.is-negative) .nx-tab-header__item:not(.nx-tab-header__item--active):not(.nx-tab-header__item--disabled){color:buttonText}}.nx-tab-header__item--active{border-width:4px;font-weight:700;border-bottom-style:solid;border-color:var(--tab-item-active-border-color);padding-bottom:8px;cursor:default}.nx-tab-header__item--active:hover,.nx-tab-header__item--active:active{color:var(--tab-item-color)}@media screen and (-ms-high-contrast: active){.nx-tab-header__item--active{background-color:highlight;color:highlightText;border-color:highlight}}.nx-tab-header__item--active:before{display:none}.nx-tab-header__item--disabled{border-color:var(--tab-item-disabled-border-color);color:var(--tab-item-disabled-color);cursor:not-allowed}.nx-tab-header__item--disabled:hover,.nx-tab-header__item--disabled:active{color:var(--tab-item-disabled-color)}@media screen and (-ms-high-contrast: active){.nx-tab-header__item--disabled{border-color:GrayText;background-color:buttonFace;color:GrayText}}.nx-tab-label__content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}.nx-tab-header__item.cdk-keyboard-focused .nx-tab-label__content{box-shadow:var(--focus-box-shadow);border-radius:4px}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-tab-header__item.cdk-keyboard-focused .nx-tab-label__content{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}:host(.is-negative){color:var(--negative)}:host(.is-negative) .nx-tab-header__item{color:var(--negative);border-bottom-color:var(--negative)}:host(.is-negative) .nx-tab-header__item:hover,:host(.is-negative) .nx-tab-header__item:active{font-weight:700}:host(.is-negative) .nx-tab-header__item.nx-tab-header__item--disabled{border-color:var(--tab-item-disabled-border-color);color:var(--tab-item-disabled-color);cursor:not-allowed;color:var(--tab-item-disabled-negative-color);border-color:var(--tab-item-disabled-negative-color)}:host(.is-negative) .nx-tab-header__item.nx-tab-header__item--disabled:hover,:host(.is-negative) .nx-tab-header__item.nx-tab-header__item--disabled:active{color:var(--tab-item-disabled-color)}@media screen and (-ms-high-contrast: active){:host(.is-negative) .nx-tab-header__item.nx-tab-header__item--disabled{border-color:GrayText;background-color:buttonFace;color:GrayText}}:host(.is-negative.is-expert) .nx-tab-header__item.nx-tab-header__item--disabled:not(.nx-tab-header__item--active){border-bottom-color:transparent}:host(.is-disabled){cursor:not-allowed}:host(.is-disabled.is-negative) .nx-tab-header__item{color:var(--tab-item-disabled-negative-color);border-color:var(--tab-item-disabled-negative-color)}@media screen and (-ms-high-contrast: active){:host(.is-negative){color:buttonText}:host(.is-negative) .nx-tab-header__item{color:buttonText;border-bottom-color:buttonText}:host(.is-negative) .nx-tab-header__item--active{background-color:highlight;color:highlightText;border-color:highlight;-ms-high-contrast-adjust:none}:host(.is-disabled.is-negative) .nx-tab-header__item{color:GrayText;border-bottom-color:GrayText}}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.NxViewportService }, { type: i0.ChangeDetectorRef }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [TAB_GROUP_DEFAULT_OPTIONS]
                }] }, { type: i2.FocusMonitor }]; }, propDecorators: { tabs: [{
                type: ContentChildren,
                args: [NxTabComponent]
            }], tabBodyChildren: [{
                type: ViewChildren,
                args: [NxTabBodyComponent]
            }], tabHeader: [{
                type: ViewChild,
                args: ['tabHeader']
            }], panels: [{
                type: ViewChildren,
                args: [NxExpansionPanelComponent]
            }], accordion: [{
                type: ViewChild,
                args: ['accordion', { read: NxAccordionDirective }]
            }], _tabButtons: [{
                type: ViewChildren,
                args: ['tabButton']
            }], selectedIndex: [{
                type: Input
            }], negative: [{
                type: Input
            }], disabled: [{
                type: Input
            }], autoselect: [{
                type: Input
            }], mobileAccordion: [{
                type: Input
            }], appearance: [{
                type: Input
            }], selectedIndexChange: [{
                type: Output
            }], selectedTabChange: [{
                type: Output
            }], focusChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFiLWdyb3VwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmctYXF1aWxhL3NyYy90YWJzL3RhYi1ncm91cC50cyIsIi4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWFxdWlsYS9zcmMvdGFicy90YWItZ3JvdXAuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQWdCLHFCQUFxQixFQUFFLG9CQUFvQixFQUFlLE1BQU0sdUJBQXVCLENBQUM7QUFDL0csT0FBTyxFQUlILHVCQUF1QixFQUV2QixTQUFTLEVBQ1QsZUFBZSxFQUVmLFlBQVksRUFDWixNQUFNLEVBQ04sS0FBSyxFQUVMLFFBQVEsRUFDUixNQUFNLEVBRU4sU0FBUyxFQUNULFlBQVksR0FDZixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsb0JBQW9CLEVBQUUseUJBQXlCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUM5RixPQUFPLEVBQUUsYUFBYSxFQUFxQixNQUFNLHlCQUF5QixDQUFDO0FBQzNFLE9BQU8sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNwRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUN2QyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDaEQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRWxELE9BQU8sRUFBb0IseUJBQXlCLEVBQTBCLE1BQU0sZUFBZSxDQUFDOzs7Ozs7Ozs7O0FBRXBHLE1BQU0sT0FBTyxnQkFBZ0I7Q0FNNUI7QUFFRCxJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7QUFjZixNQUFNLE9BQU8sbUJBQW1CO0lBd0g1QixZQUNXLGVBQWtDLEVBQ2pDLElBQXVCLEVBQ3dCLGVBQThDLEVB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QixFQUFFLENBQUMsK0NBY3pELGNBQWMseU1BWUMsb0JBQW9CLGtEQVR0QyxrQkFBa0IsNERBTWxCLHlCQUF5Qiw4SEMzRTNDLHc0RkE4REE7MkZEUmEsbUJBQW1CO2tCQVovQixTQUFTOytCQUNJLGNBQWMsbUJBR1AsdUJBQXVCLENBQUMsTUFBTSxRQUN6Qzt3QkFDRixxQkFBcUIsRUFBRSxVQUFVO3dCQUNqQyxxQkFBcUIsRUFBRSxVQUFVO3dCQUNqQyxtQkFBbUIsRUFBRSx5QkFBeUI7cUJBQ2pELGFBQ1UsQ0FBQyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsV0FBVyxxQkFBcUIsRUFBRSxDQUFDOzswQkE2SHJFLFFBQVE7OzBCQUFJLE1BQU07MkJBQUMseUJBQXlCO3VFQS9HaEIsSUFBSTtzQkFBcEMsZUFBZTt1QkFBQyxjQUFjO2dCQUdHLGVBQWU7c0JBQWhELFlBQVk7dUJBQUMsa0JBQWtCO2dCQUdSLFNBQVM7c0JBQWhDLFNBQVM7dUJBQUMsV0FBVztnQkFHbUIsTUFBTTtzQkFBOUMsWUFBWTt1QkFBQyx5QkFBeUI7Z0JBR2lCLFNBQVM7c0JBQWhFLFNBQVM7dUJBQUMsV0FBVyxFQUFFLEVBQUUsSUFBSSxFQUFFLG9CQUFvQixFQUFFO2dCQUUzQixXQUFXO3NCQUFyQyxZQUFZO3VCQUFDLFdBQVc7Z0JBT3JCLGFBQWE7c0JBRGhCLEtBQUs7Z0JBVUYsUUFBUTtzQkFEWCxLQUFLO2dCQWFGLFFBQVE7c0JBRFgsS0FBSztnQkFhRixVQUFVO3NCQURiLEtBQUs7Z0JBVUYsZUFBZTtzQkFEbEIsS0FBSztnQkFjRixVQUFVO3NCQURiLEtBQUs7Z0JBWWEsbUJBQW1CO3NCQUFyQyxNQUFNO2dCQUdZLGlCQUFpQjtzQkFBbkMsTUFBTTtnQkFPWSxXQUFXO3NCQUE3QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRm9jdXNNb25pdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2ExMXknO1xuaW1wb3J0IHsgQm9vbGVhbklucHV0LCBjb2VyY2VCb29sZWFuUHJvcGVydHksIGNvZXJjZU51bWJlclByb3BlcnR5LCBOdW1iZXJJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2VyY2lvbic7XG5pbXBvcnQge1xuICAgIEFmdGVyQ29udGVudENoZWNrZWQsXG4gICAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgICBBZnRlclZpZXdJbml0LFxuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgIENvbXBvbmVudCxcbiAgICBDb250ZW50Q2hpbGRyZW4sXG4gICAgRWxlbWVudFJlZixcbiAgICBFdmVudEVtaXR0ZXIsXG4gICAgSW5qZWN0LFxuICAgIElucHV0LFxuICAgIE9uRGVzdHJveSxcbiAgICBPcHRpb25hbCxcbiAgICBPdXRwdXQsXG4gICAgUXVlcnlMaXN0LFxuICAgIFZpZXdDaGlsZCxcbiAgICBWaWV3Q2hpbGRyZW4sXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTnhBY2NvcmRpb25EaXJlY3RpdmUsIE54RXhwYW5zaW9uUGFuZWxDb21wb25lbnQgfSBmcm9tICdAYXBvc2luL25nLWFxdWlsYS9hY2NvcmRpb24nO1xuaW1wb3J0IHsgTnhCcmVha3BvaW50cywgTnhWaWV3cG9ydFNlcnZpY2UgfSBmcm9tICdAYXBvc2luL25nLWFxdWlsYS91dGlscyc7XG5pbXBvcnQgeyBtZXJnZSwgU3ViamVjdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IE54VGFiQ29tcG9uZW50IH0gZnJvbSAnLi90YWInO1xuaW1wb3J0IHsgTnhUYWJCb2R5Q29tcG9uZW50IH0gZnJvbSAnLi90YWItYm9keSc7XG5pbXBvcnQgeyBOeFRhYkdyb3VwQmFzZSB9IGZyb20gJy4vdGFiLWdyb3VwLWJhc2UnO1xuaW1wb3J0IHsgTnhUYWJIZWFkZXJDb21wb25lbnQgfSBmcm9tICcuL3RhYi1oZWFkZXInO1xuaW1wb3J0IHsgTnhUYWJzQXBwZWFyYW5jZSwgVEFCX0dST1VQX0RFRkFVTFRfT1BUSU9OUywgVGFiR3JvdXBEZWZhdWx0T3B0aW9ucyB9IGZyb20gJy4vdGFicy5tb2RlbHMnO1xuXG5leHBvcnQgY2xhc3MgTnhUYWJDaGFuZ2VFdmVudCB7XG4gICAgLyoqIFRoZSBpbmRleCBvZiB0aGUgc2VsZWN0ZWQgb3IgZm9jdXNlZCB0YWIuICovXG4gICAgaW5kZXghOiBudW1iZXI7XG5cbiAgICAvKiogVGhlIGNvbXBvbmVudCBpbnN0YW5jZSBvZiB0aGUgc2VsZWN0ZWQgb3IgZm9jdXNlZCB0YWIuICovXG4gICAgdGFiITogTnhUYWJDb21wb25lbnQ7XG59XG5cbmxldCBuZXh0SWQgPSAwO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ254LXRhYi1ncm91cCcsXG4gICAgdGVtcGxhdGVVcmw6ICd0YWItZ3JvdXAuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vdGFiLWdyb3VwLnNjc3MnXSxcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgICBob3N0OiB7XG4gICAgICAgICdbY2xhc3MuaXMtbmVnYXRpdmVdJzogJ25lZ2F0aXZlJyxcbiAgICAgICAgJ1tjbGFzcy5pcy1kaXNhYmxlZF0nOiAnZGlzYWJsZWQnLFxuICAgICAgICAnW2NsYXNzLmlzLWV4cGVydF0nOiAnYXBwZWFyYW5jZSA9PT0gXCJleHBlcnRcIicsXG4gICAgfSxcbiAgICBwcm92aWRlcnM6IFt7IHByb3ZpZGU6IE54VGFiR3JvdXBCYXNlLCB1c2VFeGlzdGluZzogTnhUYWJHcm91cENvbXBvbmVudCB9XSxcbn0pXG5leHBvcnQgY2xhc3MgTnhUYWJHcm91cENvbXBvbmVudCBpbXBsZW1lbnRzIE54VGFiR3JvdXBCYXNlLCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQsIEFmdGVyQ29udGVudEluaXQsIEFmdGVyQ29udGVudENoZWNrZWQge1xuICAgIHByaXZhdGUgX3NlbGVjdGVkSW5kZXg6IG51bWJlciB8IG51bGwgPSBudWxsO1xuICAgIHByaXZhdGUgX2dyb3VwSWQ6IG51bWJlcjtcbiAgICBwcml2YXRlIF9uZWdhdGl2ZSA9IGZhbHNlO1xuICAgIHByaXZhdGUgX2Rpc2FibGVkID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBfaW5kZXhUb1NlbGVjdDogbnVtYmVyIHwgbnVsbCA9IDA7XG4gICAgcHJpdmF0ZSBfYXV0b3NlbGVjdCA9IHRydWU7XG4gICAgcHJpdmF0ZSBfbW9iaWxlQWNjb3JkaW9uID0gdHJ1ZTtcbiAgICBwcml2YXRlIF9hcHBlYXJhbmNlITogTnhUYWJzQXBwZWFyYW5jZTtcbiAgICBfc2hvd0FjY29yZGlvbiA9IGZhbHNlO1xuXG4gICAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgICBAQ29udGVudENoaWxkcmVuKE54VGFiQ29tcG9uZW50KSB0YWJzITogUXVlcnlMaXN0PE54VGFiQ29tcG9uZW50PjtcblxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgQFZpZXdDaGlsZHJlbihOeFRhYkJvZHlDb21wb25lbnQpIHRhYkJvZHlDaGlsZHJlbiE6IFF1ZXJ5TGlzdDxOeFRhYkJvZHlDb21wb25lbnQ+O1xuXG4gICAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgICBAVmlld0NoaWxkKCd0YWJIZWFkZXInKSB0YWJIZWFkZXIhOiBOeFRhYkhlYWRlckNvbXBvbmVudDtcblxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgQFZpZXdDaGlsZHJlbihOeEV4cGFuc2lvblBhbmVsQ29tcG9uZW50KSBwYW5lbHMhOiBRdWVyeUxpc3Q8TnhFeHBhbnNpb25QYW5lbENvbXBvbmVudD47XG5cbiAgICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICAgIEBWaWV3Q2hpbGQoJ2FjY29yZGlvbicsIHsgcmVhZDogTnhBY2NvcmRpb25EaXJlY3RpdmUgfSkgYWNjb3JkaW9uITogTnhBY2NvcmRpb25EaXJlY3RpdmU7XG5cbiAgICBAVmlld0NoaWxkcmVuKCd0YWJCdXR0b24nKSBfdGFiQnV0dG9ucyE6IFF1ZXJ5TGlzdDxFbGVtZW50UmVmPjtcblxuICAgIC8qKiBQcmVzZXJ2ZXMgdGhlIGN1cnJlbnQgdmFsdWUgb2YgdGhlIF90YWJCdXR0b25zIFZpZXdDaGlsZHJlbiBpbiBjYXNlIGl0IGNoYW5nZXMuICovXG4gICAgcHJpdmF0ZSBfdGFiQnV0dG9uc1ByZXZpb3VzITogUXVlcnlMaXN0PEVsZW1lbnRSZWY+O1xuXG4gICAgLyoqIFNldHMgdGhlIHNlbGVjdGVkIHRhYi4gKi9cbiAgICBASW5wdXQoKVxuICAgIGdldCBzZWxlY3RlZEluZGV4KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZEluZGV4IGFzIG51bWJlcjtcbiAgICB9XG4gICAgc2V0IHNlbGVjdGVkSW5kZXgodmFsdWU6IE51bWJlcklucHV0KSB7XG4gICAgICAgIHRoaXMuX2luZGV4VG9TZWxlY3QgPSBjb2VyY2VOdW1iZXJQcm9wZXJ0eSh2YWx1ZSwgbnVsbCk7XG4gICAgfVxuXG4gICAgLyoqIFdoZXRoZXIgdGhlIG5lZ2F0aXZlIHNldCBvZiBzdHlsaW5nIHNob3VsZCBiZSB1c2VkLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZ2V0IG5lZ2F0aXZlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fbmVnYXRpdmU7XG4gICAgfVxuICAgIHNldCBuZWdhdGl2ZSh2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdGhpcy5fbmVnYXRpdmUpIHtcbiAgICAgICAgICAgIHRoaXMuX25lZ2F0aXZlID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBXaGV0aGVyIHRoZSB0YWIgZ3JvdXAgaXMgZGlzYWJsZWQuIERlZmF1bHQ6IGZhbHNlLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZ2V0IGRpc2FibGVkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fZGlzYWJsZWQ7XG4gICAgfVxuICAgIHNldCBkaXNhYmxlZCh2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdGhpcy5fZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX2Rpc2FibGVkID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBXaGV0aGVyIHRoZSB0YWIgc2hvdWxkIGJlIGltbWVkaWF0ZWx5IHNlbGVjdGVkIG9uIGZvY3VzLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZ2V0IGF1dG9zZWxlY3QoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hdXRvc2VsZWN0O1xuICAgIH1cbiAgICBzZXQgYXV0b3NlbGVjdCh2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgICAgIHRoaXMuX2F1dG9zZWxlY3QgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsdWUpO1xuICAgIH1cblxuICAgIC8qKiBXaGV0aGVyIHRoZSB0YWJzIHNob3VsZCB0byBhY2NvcmRpb24gb24gbW9iaWxlIHZpZXdwb3J0cy4gKi9cbiAgICBASW5wdXQoKVxuICAgIGdldCBtb2JpbGVBY2NvcmRpb24oKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9tb2JpbGVBY2NvcmRpb247XG4gICAgfVxuICAgIHNldCBtb2JpbGVBY2NvcmRpb24odmFsdWU6IEJvb2xlYW5JbnB1dCkge1xuICAgICAgICB0aGlzLl9tb2JpbGVBY2NvcmRpb24gPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsdWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqICoqRXhwZXJ0IG9wdGlvbioqXG4gICAgICpcbiAgICAgKiBTZXRzIHRoZSBhcHBlYXJhbmNlIG9mIHRoZSB0YWIgZ3JvdXAuIERlZmF1bHQ6ICdkZWZhdWx0Jy5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHNldCBhcHBlYXJhbmNlKHZhbHVlOiBOeFRhYnNBcHBlYXJhbmNlKSB7XG4gICAgICAgIGlmICh0aGlzLl9hcHBlYXJhbmNlICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5fYXBwZWFyYW5jZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBhcHBlYXJhbmNlKCk6IE54VGFic0FwcGVhcmFuY2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXBwZWFyYW5jZSB8fCB0aGlzLl9kZWZhdWx0T3B0aW9ucz8uYXBwZWFyYW5jZSB8fCAnZGVmYXVsdCc7XG4gICAgfVxuXG4gICAgLyoqIEFuIGV2ZW50IGVtaXR0ZWQgd2hlbiB0aGUgc2VsZWN0ZWQgdGFiIGhhcyBjaGFuZ2VkLiAqL1xuICAgIEBPdXRwdXQoKSByZWFkb25seSBzZWxlY3RlZEluZGV4Q2hhbmdlOiBFdmVudEVtaXR0ZXI8bnVtYmVyPiA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xuXG4gICAgLyoqIEFuIGV2ZW50IGVtaXR0ZWQgd2hlbiB0aGUgc2VsZWN0ZWQgdGFiIGhhcyBjaGFuZ2VkLiAqL1xuICAgIEBPdXRwdXQoKSByZWFkb25seSBzZWxlY3RlZFRhYkNoYW5nZTogRXZlbnRFbWl0dGVyPE54VGFiQ2hhbmdlRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxOeFRhYkNoYW5nZUV2ZW50PigpO1xuXG4gICAgLyoqXG4gICAgICogQW4gZXZlbnQgZW1pdHRlZCB3aGVuIGZvY3VzIGhhcyBjaGFuZ2VkIHdpdGhpbiBhIHRhYiBncm91cC5cbiAgICAgKlxuICAgICAqICoqTm90ZToqKiBpcyBub3Qgc3VwcG9ydGVkIGluIG1vYmlsZSB2aWV3LlxuICAgICAqL1xuICAgIEBPdXRwdXQoKSByZWFkb25seSBmb2N1c0NoYW5nZTogRXZlbnRFbWl0dGVyPE54VGFiQ2hhbmdlRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxOeFRhYkNoYW5nZUV2ZW50PigpO1xuXG4gICAgLyoqIFN1YnNjcmlwdGlvbiB0byBjaGFuZ2VzIGluIHRoZSB0YWIgbGFiZWxzLiAqL1xuICAgIHByaXZhdGUgX3RhYkxhYmVsU3Vic2NyaXB0aW9uID0gU3Vic2NyaXB0aW9uLkVNUFRZO1xuXG4gICAgcHJpdmF0ZSBfZGlzYWJsZWRUYWJzQ2FjaGU6IGJvb2xlYW5bXSA9IFtdO1xuXG4gICAgX2FwcGVhcmFuY2VDaGFuZ2UgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gICAgcHJpdmF0ZSByZWFkb25seSBfZGVzdHJveWVkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwdWJsaWMgdmlld3BvcnRTZXJ2aWNlOiBOeFZpZXdwb3J0U2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBfY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgQE9wdGlvbmFsKCkgQEluamVjdChUQUJfR1JPVVBfREVGQVVMVF9PUFRJT05TKSBwcml2YXRlIF9kZWZhdWx0T3B0aW9uczogVGFiR3JvdXBEZWZhdWx0T3B0aW9ucyB8IG51bGwsXG4gICAgICAgIHByaXZhdGUgX2ZvY3VzTW9uaXRvcjogRm9jdXNNb25pdG9yLFxuICAgICkge1xuICAgICAgICB0aGlzLl9ncm91cElkID0gbmV4dElkKys7XG5cbiAgICAgICAgdGhpcy52aWV3cG9ydFNlcnZpY2VcbiAgICAgICAgICAgIC5tYXgoTnhCcmVha3BvaW50cy5CUkVBS1BPSU5UX01FRElVTSlcbiAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQpKVxuICAgICAgICAgICAgLnN1YnNjcmliZShpc1NtYWxsVGFibGV0ID0+IHRoaXMuX3N3aXRjaEFwcGVhcmFuY2UoaXNTbWFsbFRhYmxldCkpO1xuICAgIH1cblxuICAgIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICAgICAgdGhpcy5fc3Vic2NyaWJlVG9UYWJMYWJlbHMoKTtcblxuICAgICAgICAvLyBTdWJzY3JpYmUgdG8gY2hhbmdlcyBpbiB0aGUgYW1vdW50IG9mIHRhYnMsIGluIG9yZGVyIHRvIGJlXG4gICAgICAgIC8vIGFibGUgdG8gcmUtcmVuZGVyIHRoZSBjb250ZW50IGFzIG5ldyB0YWJzIGFyZSBhZGRlZCBvciByZW1vdmVkLlxuICAgICAgICB0aGlzLnRhYnMuY2hhbmdlcy5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW5kZXhUb1NlbGVjdCA9IHRoaXMuX2NsYW1wVGFiSW5kZXgodGhpcy5faW5kZXhUb1NlbGVjdCk7XG4gICAgICAgICAgICAvLyBNYWludGFpbiB0aGUgcHJldmlvdXNseS1zZWxlY3RlZCB0YWIgaWYgYSBuZXcgdGFiIGlzIGFkZGVkIG9yIHJlbW92ZWQgYW5kIHRoZXJlIGlzIG5vXG4gICAgICAgICAgICAvLyBleHBsaWNpdCBjaGFuZ2UgdGhhdCBzZWxlY3RzIGEgZGlmZmVyZW50IHRhYi5cbiAgICAgICAgICAgIGlmIChpbmRleFRvU2VsZWN0ID09PSB0aGlzLl9zZWxlY3RlZEluZGV4KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFicyA9IHRoaXMudGFicy50b0FycmF5KCk7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhYnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhYnNbaV0uaXNBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFzc2lnbiBib3RoIHRvIHRoZSBgX2luZGV4VG9TZWxlY3RgIGFuZCBgX3NlbGVjdGVkSW5kZXhgIHNvIHdlIGRvbid0IGZpcmUgYSBjaGFuZ2VkXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBldmVudCwgb3RoZXJ3aXNlIHRoZSBjb25zdW1lciBtYXkgZW5kIHVwIGluIGFuIGluZmluaXRlIGxvb3AgaW4gc29tZSBlZGdlIGNhc2VzIGxpa2VcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZGluZyBhIHRhYiB3aXRoaW4gdGhlIGBzZWxlY3RlZEluZGV4Q2hhbmdlYCBldmVudC5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2luZGV4VG9TZWxlY3QgPSB0aGlzLl9zZWxlY3RlZEluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFmdGVyIHRoZSBjb250ZW50IGlzIGNoZWNrZWQsIHRoaXMgY29tcG9uZW50IGtub3dzIHdoYXQgdGFicyBoYXZlIGJlZW4gZGVmaW5lZFxuICAgICAqIGFuZCB3aGF0IHRoZSBzZWxlY3RlZCBpbmRleCBzaG91bGQgYmUuXG4gICAgICovXG4gICAgbmdBZnRlckNvbnRlbnRDaGVja2VkKCkge1xuICAgICAgICAvLyBEb24ndCBjbGFtcCB0aGUgYGluZGV4VG9TZWxlY3RgIGltbWVkaWF0ZWx5IGluIHRoZSBzZXR0ZXIgYmVjYXVzZSBpdCBjYW4gaGFwcGVuIHRoYXRcbiAgICAgICAgLy8gdGhlIGFtb3VudCBvZiB0YWJzIGNoYW5nZXMgYmVmb3JlIHRoZSBhY3R1YWwgY2hhbmdlIGRldGVjdGlvbiBydW5zLlxuICAgICAgICBsZXQgaW5kZXhUb1NlbGVjdCA9ICh0aGlzLl9pbmRleFRvU2VsZWN0ID0gdGhpcy5fY2xhbXBUYWJJbmRleCh0aGlzLl9pbmRleFRvU2VsZWN0KSk7XG5cbiAgICAgICAgLy8gSWYgdGhlIGFjdGl2ZSB0YWIgaXMgZGlzYWJsZWQgc2VsZWN0IHRoZSBuZXh0IGZvY3VzYWJsZSB0YWJcbiAgICAgICAgLy8gaWYgYWxsIHRhYnMgYXJlIGRpc2FibGVkLCBhbGxvdyBzZWxlY3Rpb24gb2YgZGlzYWJsZWQgYWN0aXZlIHRhYi5cbiAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVkICYmIHRoaXMudGFicy50b0FycmF5KClbaW5kZXhUb1NlbGVjdF0uZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IG5leHRGb2N1c2FibGUgPSB0aGlzLnRhYnNcbiAgICAgICAgICAgICAgICAudG9BcnJheSgpXG4gICAgICAgICAgICAgICAgLm1hcCgodGFiLCBpbmRleCkgPT4gKHsgdGFiLCBpbmRleCB9KSlcbiAgICAgICAgICAgICAgICAuZmluZChpdGVtID0+ICFpdGVtLnRhYi5kaXNhYmxlZCk7XG5cbiAgICAgICAgICAgIGluZGV4VG9TZWxlY3QgPSBuZXh0Rm9jdXNhYmxlID8gbmV4dEZvY3VzYWJsZS5pbmRleCA6IGluZGV4VG9TZWxlY3Q7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiB0aGUgaW5kZXggdG8gc2VsZWN0IHdhcyBkaXNhYmxlZCBwcmV2aW91c2x5IGxlYXZlIHRoZSBzZWxlY3Rpb24gb24gdGhlIGN1cnJlbnRcbiAgICAgICAgLy8gc28gdGhhdCB0aGUgc2VsZWN0aW9uIGRvZXMgbm90IGp1bXAgZnJvbSBvbmUgdG8gYW5vdGhlciB0YWIuXG4gICAgICAgIGlmICh0aGlzLl9kaXNhYmxlZFRhYnNDYWNoZVt0aGlzLl9pbmRleFRvU2VsZWN0XSkge1xuICAgICAgICAgICAgdGhpcy5faW5kZXhUb1NlbGVjdCA9IHRoaXMuc2VsZWN0ZWRJbmRleDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIHRoZXJlIGlzIGEgY2hhbmdlIGluIHNlbGVjdGVkIGluZGV4LCBlbWl0IGEgY2hhbmdlIGV2ZW50LiBTaG91bGQgbm90IHRyaWdnZXIgaWZcbiAgICAgICAgLy8gdGhlIHNlbGVjdGVkIGluZGV4IGhhcyBub3QgeWV0IGJlZW4gaW5pdGlhbGl6ZWQuXG4gICAgICAgIGlmICh0aGlzLl9zZWxlY3RlZEluZGV4ICE9PSBpbmRleFRvU2VsZWN0KSB7XG4gICAgICAgICAgICBjb25zdCBpc0ZpcnN0UnVuID0gdGhpcy5fc2VsZWN0ZWRJbmRleCA9PSBudWxsO1xuXG4gICAgICAgICAgICBpZiAoIWlzRmlyc3RSdW4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkVGFiQ2hhbmdlLmVtaXQodGhpcy5fY3JlYXRlQ2hhbmdlRXZlbnQoaW5kZXhUb1NlbGVjdCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDaGFuZ2luZyB0aGVzZSB2YWx1ZXMgYWZ0ZXIgY2hhbmdlIGRldGVjdGlvbiBoYXMgcnVuXG4gICAgICAgICAgICAvLyBzaW5jZSB0aGUgY2hlY2tlZCBjb250ZW50IG1heSBjb250YWluIHJlZmVyZW5jZXMgdG8gdGhlbS5cbiAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudGFicy5mb3JFYWNoKCh0YWIsIGluZGV4KSA9PiAodGFiLmlzQWN0aXZlID0gaW5kZXggPT09IGluZGV4VG9TZWxlY3QpKTtcblxuICAgICAgICAgICAgICAgIGlmICghaXNGaXJzdFJ1bikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXhDaGFuZ2UuZW1pdChpbmRleFRvU2VsZWN0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLl9zZWxlY3RlZEluZGV4ICE9PSBpbmRleFRvU2VsZWN0KSB7XG4gICAgICAgICAgICB0aGlzLl9zZWxlY3RlZEluZGV4ID0gaW5kZXhUb1NlbGVjdDtcbiAgICAgICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGNhY2hlIHRoZSBwcmV2aW91cyBkaXNhYmxlZCBzdGF0dXMgb2YgYWxsIHRhYnNcbiAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgICAgICB0aGlzLnRhYnMudG9BcnJheSgpLmZvckVhY2goKHRhYiwgaW5kZXgpID0+ICh0aGlzLl9kaXNhYmxlZFRhYnNDYWNoZVtpbmRleF0gPSB0YWIuZGlzYWJsZWQpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgdGhpcy5fdGFiQnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiB0aGlzLl9mb2N1c01vbml0b3IubW9uaXRvcihidXR0b24pKTtcbiAgICAgICAgdGhpcy5fdGFiQnV0dG9uc1ByZXZpb3VzID0gdGhpcy5fdGFiQnV0dG9ucztcbiAgICAgICAgdGhpcy5fdGFiQnV0dG9ucy5jaGFuZ2VzLnN1YnNjcmliZSh0YWJCdXR0b25zID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3RhYkJ1dHRvbnNQcmV2aW91cy5mb3JFYWNoKGJ1dHRvbiA9PiB0aGlzLl9mb2N1c01vbml0b3Iuc3RvcE1vbml0b3JpbmcoYnV0dG9uKSk7XG4gICAgICAgICAgICB0aGlzLl90YWJCdXR0b25zUHJldmlvdXMgPSB0YWJCdXR0b25zO1xuICAgICAgICAgICAgdGFiQnV0dG9ucy5mb3JFYWNoKChidXR0b246IEhUTUxFbGVtZW50KSA9PiB0aGlzLl9mb2N1c01vbml0b3IubW9uaXRvcihidXR0b24pKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuX2Rlc3Ryb3llZC5uZXh0KCk7XG4gICAgICAgIHRoaXMuX2Rlc3Ryb3llZC5jb21wbGV0ZSgpO1xuICAgICAgICB0aGlzLl90YWJMYWJlbFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB0aGlzLl90YWJCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2ZvY3VzTW9uaXRvci5zdG9wTW9uaXRvcmluZyhidXR0b24pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTdWJzY3JpYmVzIHRvIGNoYW5nZXMgaW4gdGhlIHRhYiBsYWJlbHMuIFRoaXMgaXMgbmVlZGVkLCBiZWNhdXNlIHRoZSBASW5wdXQgZm9yIHRoZSBsYWJlbCBpc1xuICAgICAqIG9uIHRoZSBOeFRhYiBjb21wb25lbnQsIHdoZXJlYXMgdGhlIGRhdGEgYmluZGluZyBpcyBpbnNpZGUgdGhlIE54VGFiR3JvdXAuIEluIG9yZGVyIGZvciB0aGVcbiAgICAgKiBiaW5kaW5nIHRvIGJlIHVwZGF0ZWQsIHdlIG5lZWQgdG8gc3Vic2NyaWJlIHRvIGNoYW5nZXMgaW4gaXQgYW5kIHRyaWdnZXIgY2hhbmdlIGRldGVjdGlvblxuICAgICAqIG1hbnVhbGx5LlxuICAgICAqL1xuICAgIHByaXZhdGUgX3N1YnNjcmliZVRvVGFiTGFiZWxzKCkge1xuICAgICAgICBpZiAodGhpcy5fdGFiTGFiZWxTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuX3RhYkxhYmVsU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl90YWJMYWJlbFN1YnNjcmlwdGlvbiA9IG1lcmdlKC4uLnRoaXMudGFicy5tYXAodGFiID0+IHRhYi5fc3RhdGVDaGFuZ2VzKSkuc3Vic2NyaWJlKCgpID0+IHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKSk7XG4gICAgfVxuXG4gICAgLyoqIENsYW1wcyB0aGUgZ2l2ZW4gaW5kZXggdG8gdGhlIGJvdW5kcyBvZiAwIGFuZCB0aGUgdGFicyBsZW5ndGguICovXG4gICAgcHJpdmF0ZSBfY2xhbXBUYWJJbmRleChpbmRleDogbnVtYmVyIHwgbnVsbCk6IG51bWJlciB7XG4gICAgICAgIC8vIE5vdGUgdGhlIGB8fCAwYCwgd2hpY2ggZW5zdXJlcyB0aGF0IHZhbHVlcyBsaWtlIE5hTiBjYW4ndCBnZXQgdGhyb3VnaFxuICAgICAgICAvLyBhbmQgd2hpY2ggd291bGQgb3RoZXJ3aXNlIHRocm93IHRoZSBjb21wb25lbnQgaW50byBhbiBpbmZpbml0ZSBsb29wXG4gICAgICAgIC8vIChzaW5jZSBNYXRoLm1heChOYU4sIDApID09PSBOYU4pLlxuICAgICAgICByZXR1cm4gTWF0aC5taW4odGhpcy50YWJzLmxlbmd0aCAtIDEsIE1hdGgubWF4KGluZGV4IHx8IDAsIDApKTtcbiAgICB9XG5cbiAgICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICAgIGZvY3VzQ2hhbmdlZChpbmRleDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuZm9jdXNDaGFuZ2UuZW1pdCh0aGlzLl9jcmVhdGVDaGFuZ2VFdmVudChpbmRleCkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2NyZWF0ZUNoYW5nZUV2ZW50KGluZGV4OiBudW1iZXIpOiBOeFRhYkNoYW5nZUV2ZW50IHtcbiAgICAgICAgY29uc3QgZXZlbnQgPSBuZXcgTnhUYWJDaGFuZ2VFdmVudCgpO1xuICAgICAgICBldmVudC5pbmRleCA9IGluZGV4O1xuICAgICAgICBpZiAodGhpcy50YWJzPy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGV2ZW50LnRhYiA9IHRoaXMudGFicy50b0FycmF5KClbaW5kZXhdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBldmVudDtcbiAgICB9XG5cbiAgICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICAgIGhhbmRsZUNsaWNrKGluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgY2xpY2tlZFRhYiA9IHRoaXMudGFicy50b0FycmF5KClbaW5kZXhdO1xuICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZWQgJiYgIWNsaWNrZWRUYWIuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IHRoaXMudGFiSGVhZGVyLmZvY3VzSW5kZXggPSBpbmRleDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBkb2NzLXByaXZhdGVcbiAgICAgKiBSZXR1cm5zIHRoZSB0YWJpbmRleCBmb3IgYSB0YWIgbGFiZWxcbiAgICAgKi9cbiAgICBnZXRUYWJJbmRleCh0YWI6IE54VGFiQ29tcG9uZW50LCBpZHg6IG51bWJlcik6IG51bWJlciB8IG51bGwge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZEluZGV4ID09PSBpZHggJiYgIXRhYi5kaXNhYmxlZCAmJiAhdGhpcy5kaXNhYmxlZCA/IDAgOiAtMTtcbiAgICB9XG5cbiAgICAvKiogUmV0dXJucyBhIHVuaXF1ZSBpZCBmb3IgZWFjaCB0YWIgbGFiZWwgZWxlbWVudCAqL1xuICAgIF9nZXRUYWJMYWJlbElkKGk6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBgbngtdGFiLWxhYmVsLSR7dGhpcy5fZ3JvdXBJZH0tJHtpfWA7XG4gICAgfVxuXG4gICAgLyoqIFJldHVybnMgYSB1bmlxdWUgaWQgZm9yIGVhY2ggdGFiIGNvbnRlbnQgZWxlbWVudCAqL1xuICAgIF9nZXRUYWJDb250ZW50SWQoaTogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGBueC10YWItY29udGVudC0ke3RoaXMuX2dyb3VwSWR9LSR7aX1gO1xuICAgIH1cblxuICAgIHByaXZhdGUgX3N3aXRjaEFwcGVhcmFuY2UoaXNTbWFsbFRhYmxldDogYm9vbGVhbikge1xuICAgICAgICBpZiAoIXRoaXMuX21vYmlsZUFjY29yZGlvbikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdHJpZ2dlciBhIGNoYW5nZSBvbmx5IHdoZW4gdGhlcmUgaXMgdmFsdWUgZGlmZmVyZW5jZVxuICAgICAgICAvLyBvdGhlcndpc2UgYSBzd2l0Y2ggaXMgdHJpZ2dlcmVkIGJ5IHRhYmxldCA8LT4gZGVza3RvcCBjaGFuZ2VcbiAgICAgICAgaWYgKHRoaXMuX3Nob3dBY2NvcmRpb24gIT09IGlzU21hbGxUYWJsZXQpIHtcbiAgICAgICAgICAgIC8vIG5vdGlmeSB0aGUgb3V0bGV0cyB0byBkZXRhY2ggdGhlIHZpZXdyZWZzIGZvciBoZWFkZXIgYW5kIGJvZHkgYmVmb3JlXG4gICAgICAgICAgICAvLyB3ZSBzd2l0Y2ggdGhlIGFwcGVhcmFuY2UuIHRoaXMgd2F5IHdlIG9ubHkgaW5zdGFudGlhdGUgdGhlIHRlbXBsYXRlc1xuICAgICAgICAgICAgLy8gb25jZSBzbyB0aGF0IHRoZXkgZG8gbm90IGdldCBkZXN0cm95ZWQgZHVyaW5nIHRoZSBzd2l0Y2hcbiAgICAgICAgICAgIHRoaXMuX2FwcGVhcmFuY2VDaGFuZ2UubmV4dCgpO1xuICAgICAgICAgICAgdGhpcy5fc2hvd0FjY29yZGlvbiA9IGlzU21hbGxUYWJsZXQ7XG4gICAgICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFbXVsYXRlIHRoZSB0YWIgY2hhbmdlIGV2ZW50IHdoZW4gYW4gYWNjb3JkaW9uIHBhbmVsIGlzIG9wZW5lZCBpblxuICAgICAqIG1vYmlsZSB2aWV3cG9ydHMuXG4gICAgICovXG4gICAgX3BhbmVsT3BlbmVkKGluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gaW5kZXg7XG4gICAgfVxufVxuIiwiPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFfc2hvd0FjY29yZGlvblwiPlxuICAgIDxueC10YWItaGVhZGVyXG4gICAgICAgICN0YWJIZWFkZXJcbiAgICAgICAgW3NlbGVjdGVkSW5kZXhdPVwic2VsZWN0ZWRJbmRleFwiXG4gICAgICAgIChzZWxlY3RGb2N1c2VkSW5kZXgpPVwic2VsZWN0ZWRJbmRleCA9ICRldmVudFwiXG4gICAgICAgIChpbmRleEZvY3VzZWQpPVwiZm9jdXNDaGFuZ2VkKCRldmVudClcIlxuICAgICAgICBbYXV0b3NlbGVjdF09XCJhdXRvc2VsZWN0XCJcbiAgICA+XG4gICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICN0YWJCdXR0b25cbiAgICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICAgbnhUYWJMYWJlbFdyYXBwZXJcbiAgICAgICAgICAgICpuZ0Zvcj1cImxldCB0YWIgb2YgdGFiczsgbGV0IGkgPSBpbmRleFwiXG4gICAgICAgICAgICByb2xlPVwidGFiXCJcbiAgICAgICAgICAgIChjbGljayk9XCJoYW5kbGVDbGljayhpKVwiXG4gICAgICAgICAgICBjbGFzcz1cIm54LXRhYi1oZWFkZXJfX2l0ZW1cIlxuICAgICAgICAgICAgW2lkXT1cIl9nZXRUYWJMYWJlbElkKGkpXCJcbiAgICAgICAgICAgIFthdHRyLmFyaWEtY29udHJvbHNdPVwiX2dldFRhYkNvbnRlbnRJZChpKVwiXG4gICAgICAgICAgICBbYXR0ci5hcmlhLXNlbGVjdGVkXT1cInNlbGVjdGVkSW5kZXggPT09IGlcIlxuICAgICAgICAgICAgW2F0dHIudGFiaW5kZXhdPVwiZ2V0VGFiSW5kZXgodGFiLCBpKVwiXG4gICAgICAgICAgICBbZGlzYWJsZWRdPVwidGFiLmRpc2FibGVkXCJcbiAgICAgICAgICAgIFtjbGFzcy5ueC10YWItaGVhZGVyX19pdGVtLS1kaXNhYmxlZF09XCJ0YWIuZGlzYWJsZWRcIlxuICAgICAgICAgICAgW2NsYXNzLm54LXRhYi1oZWFkZXJfX2l0ZW0tLWFjdGl2ZV09XCJzZWxlY3RlZEluZGV4ID09PSBpXCJcbiAgICAgICAgPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm54LXRhYi1sYWJlbF9fY29udGVudFwiPlxuICAgICAgICAgICAgICAgIDxueC10YWItaGVhZGVyLW91dGxldCAqbmdJZj1cInRhYi50ZW1wbGF0ZUxhYmVsXCIgW2NvbnRlbnRdPVwidGFiLmhlYWRlclZpZXdSZWZcIj48L254LXRhYi1oZWFkZXItb3V0bGV0PlxuICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhdGFiLnRlbXBsYXRlTGFiZWxcIj57e3RhYi5sYWJlbH19PC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9idXR0b24+XG4gICAgPC9ueC10YWItaGVhZGVyPlxuXG4gICAgPGRpdiBjbGFzcz1cIm54LXRhYi1ib2R5X19jb250YWluZXJcIj5cbiAgICAgICAgPG54LXRhYi1ib2R5XG4gICAgICAgICAgICAqbmdGb3I9XCJsZXQgdGFiIG9mIHRhYnM7IGxldCBpID0gaW5kZXhcIlxuICAgICAgICAgICAgW2lkXT1cIl9nZXRUYWJDb250ZW50SWQoaSlcIlxuICAgICAgICAgICAgcm9sZT1cInRhYnBhbmVsXCJcbiAgICAgICAgICAgIGNsYXNzPVwibngtdGFiX19ib2R5XCJcbiAgICAgICAgICAgIFthdHRyLmFyaWEtbGFiZWxsZWRieV09XCJfZ2V0VGFiQ29udGVudElkKGkpXCJcbiAgICAgICAgICAgIFtjbGFzcy5ueC10YWJfX2JvZHktLWFjdGl2ZV09XCJzZWxlY3RlZEluZGV4ID09PSBpXCJcbiAgICAgICAgICAgIFt0YWJdPVwidGFiXCJcbiAgICAgICAgICAgIFthY3RpdmVdPVwic2VsZWN0ZWRJbmRleCA9PT0gaVwiXG4gICAgICAgID48L254LXRhYi1ib2R5PlxuICAgIDwvZGl2PlxuPC9uZy1jb250YWluZXI+XG5cbjxuZy10ZW1wbGF0ZSBbbmdJZl09XCJfc2hvd0FjY29yZGlvblwiPlxuICAgIDxueC1hY2NvcmRpb24gI2FjY29yZGlvbiBbbmVnYXRpdmVdPVwibmVnYXRpdmVcIj5cbiAgICAgICAgPG54LWV4cGFuc2lvbi1wYW5lbCAqbmdGb3I9XCJsZXQgdGFiIG9mIHRhYnM7IGxldCBpID0gaW5kZXhcIiBbZXhwYW5kZWRdPVwic2VsZWN0ZWRJbmRleCA9PT0gaVwiIChvcGVuZWQpPVwiX3BhbmVsT3BlbmVkKGkpXCIgW2Rpc2FibGVkXT1cInRhYi5kaXNhYmxlZFwiPlxuICAgICAgICAgICAgPG54LWV4cGFuc2lvbi1wYW5lbC1oZWFkZXI+XG4gICAgICAgICAgICAgICAgPG54LWV4cGFuc2lvbi1wYW5lbC10aXRsZT5cbiAgICAgICAgICAgICAgICAgICAgPG54LXRhYi1oZWFkZXItb3V0bGV0ICpuZ0lmPVwidGFiLnRlbXBsYXRlTGFiZWxcIiBbY29udGVudF09XCJ0YWIuaGVhZGVyVmlld1JlZlwiPjwvbngtdGFiLWhlYWRlci1vdXRsZXQ+XG4gICAgICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhdGFiLnRlbXBsYXRlTGFiZWxcIj57e3RhYi5sYWJlbH19PC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICAgICAgPC9ueC1leHBhbnNpb24tcGFuZWwtdGl0bGU+XG4gICAgICAgICAgICA8L254LWV4cGFuc2lvbi1wYW5lbC1oZWFkZXI+XG4gICAgICAgICAgICA8IS0tIHRoaXMgaXMgbm90IGxhenkgbG9hZGluZyB0aGlzIGlzIGEgdHJpY2sgYmVjYXVzZSB0aGUgcG9ydGFsIGdldHMgYWRkZWQgaGVyZSAtLT5cbiAgICAgICAgICAgIDwhLS0gc28gd2UgY291bGQgcmV3cml0ZSB0aGUgdGFiLWJvZHkgY29tcG9uZW50IHRoYXQgaXQgdGFrZXMgY2FyZSBvZiBcImxhenkgbG9hZGluZ1wiIGFuZCB0aGVcbiAgICBhY2NvcmRpb24gd291bGRuJ3Qga25vdyBhYm91dCBpdCAtLT5cbiAgICAgICAgICAgIDwhLS0gYWN0aXZlPXRydWUgaXMgYSB0cmljayBiZWNhdXNlIHdlIHdhbnQgdG8ga2VlcCB0aGUgY29udGVudCBhdHRhY2hlZCBmb3IgYmV0dGVyIHVzZXIgZXhwZXJpZW5jZSBhbG9uZyB3aXRoIGV4cGFuc2lvbiBwYW5lbCBhbmltYXRpb24uICAtLT5cbiAgICAgICAgICAgIDxueC10YWItYm9keSBbYWN0aXZlXT1cInRydWVcIiBbdGFiXT1cInRhYlwiPjwvbngtdGFiLWJvZHk+XG4gICAgICAgIDwvbngtZXhwYW5zaW9uLXBhbmVsPlxuICAgIDwvbngtYWNjb3JkaW9uPlxuPC9uZy10ZW1wbGF0ZT5cbiJdfQ==