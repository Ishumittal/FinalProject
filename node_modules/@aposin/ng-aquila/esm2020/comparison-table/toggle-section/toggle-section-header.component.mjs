import { ENTER, SPACE } from '@angular/cdk/keycodes';
import { isPlatformBrowser } from '@angular/common';
import { Component, Inject, Input, PLATFORM_ID, ViewChild } from '@angular/core';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { NxToggleSectionAnimations } from './toggle-section-animations';
import * as i0 from "@angular/core";
import * as i1 from "../comparison-table-base";
import * as i2 from "./toggle-section-base";
import * as i3 from "@angular/cdk/a11y";
import * as i4 from "@aposin/ng-aquila/icon";
import * as i5 from "@angular/common";
let nextId = 0;
export class NxToggleSectionHeaderComponent {
    constructor(_table, _toggleSection, _focusMonitor, _ngZone, platformId) {
        this._table = _table;
        this._toggleSection = _toggleSection;
        this._focusMonitor = _focusMonitor;
        this._ngZone = _ngZone;
        this._id = `nx-comparison-table-toggle-section-header-${nextId++}`;
        this._destroyed = new Subject();
        if (isPlatformBrowser(platformId)) {
            this._table.viewTypeChange.pipe(takeUntil(this._destroyed)).subscribe(() => {
                this._updateFocusMonitoringTimeout();
            });
        }
    }
    /** Sets the id of the toggle section header. */
    set id(value) {
        if (this._id !== value) {
            this._id = value;
        }
    }
    get id() {
        return this._id;
    }
    ngAfterViewInit() {
        this._updateFocusMonitoringTimeout();
    }
    ngOnDestroy() {
        this._destroyed.next();
        this._destroyed.complete();
        this._focusMonitor.stopMonitoring(this._wrapperElement);
    }
    _updateFocusMonitoringTimeout() {
        this._ngZone.runOutsideAngular(() => 
        // timeout is needed here so that the focus monitor is updated after the view was updated
        setTimeout(() => this._updateFocusMonitoring()));
    }
    _updateFocusMonitoring() {
        if (this._wrapperElementPrevious && !this._wrapperElement) {
            this._focusMonitor.stopMonitoring(this._wrapperElementPrevious);
            this._wrapperElementPrevious = this._wrapperElement;
        }
        if (!this._wrapperElementPrevious && this._wrapperElement) {
            this._focusMonitor
                .monitor(this._wrapperElement)
                .pipe(takeUntil(this._destroyed))
                .subscribe(origin => {
                if (origin === 'keyboard') {
                    this._table._scrollElementIntoView(this._wrapperElement, 8);
                }
            });
            this._wrapperElementPrevious = this._wrapperElement;
        }
    }
    /** Toggles the toggle section. */
    toggle() {
        if (this._table.viewType !== 'mobile') {
            this._toggleSection.toggleExpanded();
        }
    }
    _onKeydown($event) {
        if ($event && ($event.keyCode === ENTER || $event.keyCode === SPACE)) {
            this.toggle();
            // prevent page from scrolling down
            if ($event.keyCode === SPACE) {
                $event.preventDefault();
            }
        }
    }
    _getMobileClipPathInset() {
        if (this._mobileCell) {
            const cellRect = this._mobileCell.nativeElement.getBoundingClientRect();
            return this._table._getMobileClipPathInset(cellRect);
        }
        return '0';
    }
}
NxToggleSectionHeaderComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxToggleSectionHeaderComponent, deps: [{ token: i1.NxComparisonTableBase }, { token: i2.NxToggleSectionBase }, { token: i3.FocusMonitor }, { token: i0.NgZone }, { token: PLATFORM_ID }], target: i0.ɵɵFactoryTarget.Component });
NxToggleSectionHeaderComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxToggleSectionHeaderComponent, selector: "nx-comparison-table-toggle-section-header", inputs: { id: "id" }, viewQueries: [{ propertyName: "_content", first: true, predicate: ["content"], descendants: true, static: true }, { propertyName: "_mobileCell", first: true, predicate: ["mobileCell"], descendants: true }, { propertyName: "_wrapperElement", first: true, predicate: ["wrapper"], descendants: true }], ngImport: i0, template: "<ng-template #content>\n    <ng-container *ngIf=\"_table.viewType === 'desktop' || _table.viewType === 'tablet'\">\n        <div\n            #wrapper\n            class=\"nx-comparison-table-toggle-section__header-wrapper\"\n            role=\"columnheader\"\n            [attr.aria-colspan]=\"_table.viewType === 'desktop' ? _table._getHeaderCells().length + 1 : _table._getHeaderCells().length\"\n            [attr.aria-expanded]=\"_toggleSection.isExpanded\"\n            [attr.id]=\"id\"\n            (click)=\"toggle()\"\n            [attr.tabindex]=\"0\"\n            (keydown)=\"_onKeydown($event)\"\n        >\n            <div class=\"nx-comparison-table-toggle-section__header-content\">\n                <ng-container *ngTemplateOutlet=\"ngContent\"></ng-container>\n                <nx-icon class=\"nx-expansion-panel__chevron\" [@indicatorRotate]=\"_toggleSection.getOpenState()\" name=\"chevron-down\" aria-hidden=\"true\">\n                </nx-icon>\n            </div>\n        </div>\n    </ng-container>\n\n    <ng-container *ngIf=\"_table.viewType === 'mobile'\">\n        <th\n            #mobileCell\n            class=\"nx-comparison-table__mobile-toggle-section-header\"\n            scope=\"col\"\n            [attr.colspan]=\"_toggleSection._numberOfRows()\"\n            [attr.id]=\"id\"\n            [ngStyle]=\"{ 'clip-path': 'inset(' + _getMobileClipPathInset() + ')' }\"\n        >\n            <ng-container *ngTemplateOutlet=\"ngContent\"></ng-container>\n        </th>\n    </ng-container>\n</ng-template>\n\n<ng-template #ngContent>\n    <ng-content></ng-content>\n</ng-template>\n", styles: [".nx-comparison-table__mobile-toggle-section-header{font-size:var(--comparison-table-mobile-section-header-font-size);line-height:var(--comparison-table-mobile-section-header-line-height);font-weight:var(--comparison-table-mobile-section-header-font-weight);letter-spacing:var(--comparison-table-mobile-section-header-letter-spacing);background-color:var(--comparison-table-toggle-section-header-background-color);padding:8px 16px;border-top:1px solid var(--comparison-table-border-color)}.nx-comparison-table-toggle-section__header-wrapper{display:block;width:100%;cursor:pointer}.nx-comparison-table-toggle-section__header-wrapper:focus{outline:0}.nx-comparison-table-toggle-section__header-content{font-size:var(--comparison-table-toggle-section-header-font-size);line-height:var(--comparison-table-toggle-section-header-line-height);font-weight:var(--comparison-table-toggle-section-header-font-weight);letter-spacing:var(--comparison-table-toggle-section-header-letter-spacing);border:1px solid var(--comparison-table-border-color);background-color:var(--comparison-table-toggle-section-header-background-color);display:flex;justify-content:space-between;align-items:center}@media screen and (-ms-high-contrast: active){.nx-comparison-table-toggle-section__header-content{border-color:buttonText;background-color:buttonFace;color:buttonText}}.nx-expansion-panel__chevron{pointer-events:none;font-size:var(--comparison-table-toggle-section-chevron-size);color:var(--comparison-table-toggle-section-chevron-color)}\n"], components: [{ type: i4.NxIconComponent, selector: "nx-icon", inputs: ["name", "outline", "fill", "size", "font"] }], directives: [{ type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i5.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }, { type: i5.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }], animations: [NxToggleSectionAnimations.indicatorRotate] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxToggleSectionHeaderComponent, decorators: [{
            type: Component,
            args: [{ selector: 'nx-comparison-table-toggle-section-header', animations: [NxToggleSectionAnimations.indicatorRotate], template: "<ng-template #content>\n    <ng-container *ngIf=\"_table.viewType === 'desktop' || _table.viewType === 'tablet'\">\n        <div\n            #wrapper\n            class=\"nx-comparison-table-toggle-section__header-wrapper\"\n            role=\"columnheader\"\n            [attr.aria-colspan]=\"_table.viewType === 'desktop' ? _table._getHeaderCells().length + 1 : _table._getHeaderCells().length\"\n            [attr.aria-expanded]=\"_toggleSection.isExpanded\"\n            [attr.id]=\"id\"\n            (click)=\"toggle()\"\n            [attr.tabindex]=\"0\"\n            (keydown)=\"_onKeydown($event)\"\n        >\n            <div class=\"nx-comparison-table-toggle-section__header-content\">\n                <ng-container *ngTemplateOutlet=\"ngContent\"></ng-container>\n                <nx-icon class=\"nx-expansion-panel__chevron\" [@indicatorRotate]=\"_toggleSection.getOpenState()\" name=\"chevron-down\" aria-hidden=\"true\">\n                </nx-icon>\n            </div>\n        </div>\n    </ng-container>\n\n    <ng-container *ngIf=\"_table.viewType === 'mobile'\">\n        <th\n            #mobileCell\n            class=\"nx-comparison-table__mobile-toggle-section-header\"\n            scope=\"col\"\n            [attr.colspan]=\"_toggleSection._numberOfRows()\"\n            [attr.id]=\"id\"\n            [ngStyle]=\"{ 'clip-path': 'inset(' + _getMobileClipPathInset() + ')' }\"\n        >\n            <ng-container *ngTemplateOutlet=\"ngContent\"></ng-container>\n        </th>\n    </ng-container>\n</ng-template>\n\n<ng-template #ngContent>\n    <ng-content></ng-content>\n</ng-template>\n", styles: [".nx-comparison-table__mobile-toggle-section-header{font-size:var(--comparison-table-mobile-section-header-font-size);line-height:var(--comparison-table-mobile-section-header-line-height);font-weight:var(--comparison-table-mobile-section-header-font-weight);letter-spacing:var(--comparison-table-mobile-section-header-letter-spacing);background-color:var(--comparison-table-toggle-section-header-background-color);padding:8px 16px;border-top:1px solid var(--comparison-table-border-color)}.nx-comparison-table-toggle-section__header-wrapper{display:block;width:100%;cursor:pointer}.nx-comparison-table-toggle-section__header-wrapper:focus{outline:0}.nx-comparison-table-toggle-section__header-content{font-size:var(--comparison-table-toggle-section-header-font-size);line-height:var(--comparison-table-toggle-section-header-line-height);font-weight:var(--comparison-table-toggle-section-header-font-weight);letter-spacing:var(--comparison-table-toggle-section-header-letter-spacing);border:1px solid var(--comparison-table-border-color);background-color:var(--comparison-table-toggle-section-header-background-color);display:flex;justify-content:space-between;align-items:center}@media screen and (-ms-high-contrast: active){.nx-comparison-table-toggle-section__header-content{border-color:buttonText;background-color:buttonFace;color:buttonText}}.nx-expansion-panel__chevron{pointer-events:none;font-size:var(--comparison-table-toggle-section-chevron-size);color:var(--comparison-table-toggle-section-chevron-color)}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.NxComparisonTableBase }, { type: i2.NxToggleSectionBase }, { type: i3.FocusMonitor }, { type: i0.NgZone }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [PLATFORM_ID]
                }] }]; }, propDecorators: { _content: [{
                type: ViewChild,
                args: ['content', { static: true }]
            }], _mobileCell: [{
                type: ViewChild,
                args: ['mobileCell']
            }], _wrapperElement: [{
                type: ViewChild,
                args: ['wrapper']
            }], id: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9nZ2xlLXNlY3Rpb24taGVhZGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWFxdWlsYS9zcmMvY29tcGFyaXNvbi10YWJsZS90b2dnbGUtc2VjdGlvbi90b2dnbGUtc2VjdGlvbi1oZWFkZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmctYXF1aWxhL3NyYy9jb21wYXJpc29uLXRhYmxlL3RvZ2dsZS1zZWN0aW9uL3RvZ2dsZS1zZWN0aW9uLWhlYWRlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3JELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3BELE9BQU8sRUFBaUIsU0FBUyxFQUFjLE1BQU0sRUFBRSxLQUFLLEVBQXFCLFdBQVcsRUFBZSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUksT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHM0MsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7Ozs7Ozs7QUFHeEUsSUFBSSxNQUFNLEdBQUcsQ0FBQyxDQUFDO0FBUWYsTUFBTSxPQUFPLDhCQUE4QjtJQXdCdkMsWUFDVyxNQUE2QixFQUM3QixjQUFtQyxFQUNsQyxhQUEyQixFQUMzQixPQUFlLEVBQ0YsVUFBa0I7UUFKaEMsV0FBTSxHQUFOLE1BQU0sQ0FBdUI7UUFDN0IsbUJBQWMsR0FBZCxjQUFjLENBQXFCO1FBQ2xDLGtCQUFhLEdBQWIsYUFBYSxDQUFjO1FBQzNCLFlBQU8sR0FBUCxPQUFPLENBQVE7UUFuQm5CLFFBQUcsR0FBRyw2Q0FBNkMsTUFBTSxFQUFFLEVB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QUFJLENBQUMsV0FBVyxFQUFFO1lBQ2xCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLHFCQUFxQixFQUFFLENBQUM7WUFDeEUsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLHVCQUF1QixDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ3hEO1FBQ0QsT0FBTyxHQUFHLENBQUM7SUFDZixDQUFDOzsySEFqR1EsOEJBQThCLDRJQTZCM0IsV0FBVzsrR0E3QmQsOEJBQThCLG1aQ25CM0MsbWxEQXNDQSx5NUREckJnQixDQUFDLHlCQUF5QixDQUFDLGVBQWUsQ0FBQzsyRkFFOUMsOEJBQThCO2tCQU4xQyxTQUFTOytCQUNJLDJDQUEyQyxjQUd6QyxDQUFDLHlCQUF5QixDQUFDLGVBQWUsQ0FBQzs7MEJBK0JsRCxNQUFNOzJCQUFDLFdBQVc7NENBNUJpQixRQUFRO3NCQUEvQyxTQUFTO3VCQUFDLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBQ2IsV0FBVztzQkFBbkMsU0FBUzt1QkFBQyxZQUFZO2dCQUVELGVBQWU7c0JBQXBDLFNBQVM7dUJBQUMsU0FBUztnQkFXaEIsRUFBRTtzQkFETCxLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRm9jdXNNb25pdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2ExMXknO1xuaW1wb3J0IHsgRU5URVIsIFNQQUNFIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2tleWNvZGVzJztcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IEFmdGVyVmlld0luaXQsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgSW5qZWN0LCBJbnB1dCwgTmdab25lLCBPbkRlc3Ryb3ksIFBMQVRGT1JNX0lELCBUZW1wbGF0ZVJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IE54Q29tcGFyaXNvblRhYmxlQmFzZSB9IGZyb20gJy4uL2NvbXBhcmlzb24tdGFibGUtYmFzZSc7XG5pbXBvcnQgeyBOeFRvZ2dsZVNlY3Rpb25BbmltYXRpb25zIH0gZnJvbSAnLi90b2dnbGUtc2VjdGlvbi1hbmltYXRpb25zJztcbmltcG9ydCB7IE54VG9nZ2xlU2VjdGlvbkJhc2UgfSBmcm9tICcuL3RvZ2dsZS1zZWN0aW9uLWJhc2UnO1xuXG5sZXQgbmV4dElkID0gMDtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdueC1jb21wYXJpc29uLXRhYmxlLXRvZ2dsZS1zZWN0aW9uLWhlYWRlcicsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3RvZ2dsZS1zZWN0aW9uLWhlYWRlci5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vdG9nZ2xlLXNlY3Rpb24taGVhZGVyLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgYW5pbWF0aW9uczogW054VG9nZ2xlU2VjdGlvbkFuaW1hdGlvbnMuaW5kaWNhdG9yUm90YXRlXSxcbn0pXG5leHBvcnQgY2xhc3MgTnhUb2dnbGVTZWN0aW9uSGVhZGVyQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcbiAgICBAVmlld0NoaWxkKCdjb250ZW50JywgeyBzdGF0aWM6IHRydWUgfSkgX2NvbnRlbnQhOiBUZW1wbGF0ZVJlZjxhbnk+O1xuICAgIEBWaWV3Q2hpbGQoJ21vYmlsZUNlbGwnKSBfbW9iaWxlQ2VsbCE6IEVsZW1lbnRSZWY7XG5cbiAgICBAVmlld0NoaWxkKCd3cmFwcGVyJykgX3dyYXBwZXJFbGVtZW50ITogRWxlbWVudFJlZjtcblxuICAgIC8qKiBQcmVzZXJ2ZXMgdGhlIGN1cnJlbnQgdmFsdWUgb2YgdGhlIF93cmFwcGVyRWxlbWVudCBWaWV3Q2hpbGQgaW4gY2FzZSBpdCBjaGFuZ2VzLiAqL1xuICAgIHByaXZhdGUgX3dyYXBwZXJFbGVtZW50UHJldmlvdXMhOiBFbGVtZW50UmVmO1xuXG4gICAgcHJpdmF0ZSBfaWQgPSBgbngtY29tcGFyaXNvbi10YWJsZS10b2dnbGUtc2VjdGlvbi1oZWFkZXItJHtuZXh0SWQrK31gO1xuXG4gICAgcHJpdmF0ZSByZWFkb25seSBfZGVzdHJveWVkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICAgIC8qKiBTZXRzIHRoZSBpZCBvZiB0aGUgdG9nZ2xlIHNlY3Rpb24gaGVhZGVyLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2V0IGlkKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKHRoaXMuX2lkICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5faWQgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgaWQoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lkO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwdWJsaWMgX3RhYmxlOiBOeENvbXBhcmlzb25UYWJsZUJhc2UsXG4gICAgICAgIHB1YmxpYyBfdG9nZ2xlU2VjdGlvbjogTnhUb2dnbGVTZWN0aW9uQmFzZSxcbiAgICAgICAgcHJpdmF0ZSBfZm9jdXNNb25pdG9yOiBGb2N1c01vbml0b3IsXG4gICAgICAgIHByaXZhdGUgX25nWm9uZTogTmdab25lLFxuICAgICAgICBASW5qZWN0KFBMQVRGT1JNX0lEKSBwbGF0Zm9ybUlkOiBzdHJpbmcsXG4gICAgKSB7XG4gICAgICAgIGlmIChpc1BsYXRmb3JtQnJvd3NlcihwbGF0Zm9ybUlkKSkge1xuICAgICAgICAgICAgdGhpcy5fdGFibGUudmlld1R5cGVDaGFuZ2UucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVGb2N1c01vbml0b3JpbmdUaW1lb3V0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgdGhpcy5fdXBkYXRlRm9jdXNNb25pdG9yaW5nVGltZW91dCgpO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLl9kZXN0cm95ZWQubmV4dCgpO1xuICAgICAgICB0aGlzLl9kZXN0cm95ZWQuY29tcGxldGUoKTtcbiAgICAgICAgdGhpcy5fZm9jdXNNb25pdG9yLnN0b3BNb25pdG9yaW5nKHRoaXMuX3dyYXBwZXJFbGVtZW50KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF91cGRhdGVGb2N1c01vbml0b3JpbmdUaW1lb3V0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT5cbiAgICAgICAgICAgIC8vIHRpbWVvdXQgaXMgbmVlZGVkIGhlcmUgc28gdGhhdCB0aGUgZm9jdXMgbW9uaXRvciBpcyB1cGRhdGVkIGFmdGVyIHRoZSB2aWV3IHdhcyB1cGRhdGVkXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuX3VwZGF0ZUZvY3VzTW9uaXRvcmluZygpKSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF91cGRhdGVGb2N1c01vbml0b3JpbmcoKSB7XG4gICAgICAgIGlmICh0aGlzLl93cmFwcGVyRWxlbWVudFByZXZpb3VzICYmICF0aGlzLl93cmFwcGVyRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5fZm9jdXNNb25pdG9yLnN0b3BNb25pdG9yaW5nKHRoaXMuX3dyYXBwZXJFbGVtZW50UHJldmlvdXMpO1xuICAgICAgICAgICAgdGhpcy5fd3JhcHBlckVsZW1lbnRQcmV2aW91cyA9IHRoaXMuX3dyYXBwZXJFbGVtZW50O1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5fd3JhcHBlckVsZW1lbnRQcmV2aW91cyAmJiB0aGlzLl93cmFwcGVyRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5fZm9jdXNNb25pdG9yXG4gICAgICAgICAgICAgICAgLm1vbml0b3IodGhpcy5fd3JhcHBlckVsZW1lbnQpXG4gICAgICAgICAgICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCkpXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZShvcmlnaW4gPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAob3JpZ2luID09PSAna2V5Ym9hcmQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90YWJsZS5fc2Nyb2xsRWxlbWVudEludG9WaWV3KHRoaXMuX3dyYXBwZXJFbGVtZW50LCA4KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5fd3JhcHBlckVsZW1lbnRQcmV2aW91cyA9IHRoaXMuX3dyYXBwZXJFbGVtZW50O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIFRvZ2dsZXMgdGhlIHRvZ2dsZSBzZWN0aW9uLiAqL1xuICAgIHRvZ2dsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3RhYmxlLnZpZXdUeXBlICE9PSAnbW9iaWxlJykge1xuICAgICAgICAgICAgdGhpcy5fdG9nZ2xlU2VjdGlvbi50b2dnbGVFeHBhbmRlZCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX29uS2V5ZG93bigkZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAgICAgaWYgKCRldmVudCAmJiAoJGV2ZW50LmtleUNvZGUgPT09IEVOVEVSIHx8ICRldmVudC5rZXlDb2RlID09PSBTUEFDRSkpIHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlKCk7XG5cbiAgICAgICAgICAgIC8vIHByZXZlbnQgcGFnZSBmcm9tIHNjcm9sbGluZyBkb3duXG4gICAgICAgICAgICBpZiAoJGV2ZW50LmtleUNvZGUgPT09IFNQQUNFKSB7XG4gICAgICAgICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfZ2V0TW9iaWxlQ2xpcFBhdGhJbnNldCgpOiBzdHJpbmcge1xuICAgICAgICBpZiAodGhpcy5fbW9iaWxlQ2VsbCkge1xuICAgICAgICAgICAgY29uc3QgY2VsbFJlY3QgPSB0aGlzLl9tb2JpbGVDZWxsLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdGFibGUuX2dldE1vYmlsZUNsaXBQYXRoSW5zZXQoY2VsbFJlY3QpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnMCc7XG4gICAgfVxufVxuIiwiPG5nLXRlbXBsYXRlICNjb250ZW50PlxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJfdGFibGUudmlld1R5cGUgPT09ICdkZXNrdG9wJyB8fCBfdGFibGUudmlld1R5cGUgPT09ICd0YWJsZXQnXCI+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICAgICN3cmFwcGVyXG4gICAgICAgICAgICBjbGFzcz1cIm54LWNvbXBhcmlzb24tdGFibGUtdG9nZ2xlLXNlY3Rpb25fX2hlYWRlci13cmFwcGVyXCJcbiAgICAgICAgICAgIHJvbGU9XCJjb2x1bW5oZWFkZXJcIlxuICAgICAgICAgICAgW2F0dHIuYXJpYS1jb2xzcGFuXT1cIl90YWJsZS52aWV3VHlwZSA9PT0gJ2Rlc2t0b3AnID8gX3RhYmxlLl9nZXRIZWFkZXJDZWxscygpLmxlbmd0aCArIDEgOiBfdGFibGUuX2dldEhlYWRlckNlbGxzKCkubGVuZ3RoXCJcbiAgICAgICAgICAgIFthdHRyLmFyaWEtZXhwYW5kZWRdPVwiX3RvZ2dsZVNlY3Rpb24uaXNFeHBhbmRlZFwiXG4gICAgICAgICAgICBbYXR0ci5pZF09XCJpZFwiXG4gICAgICAgICAgICAoY2xpY2spPVwidG9nZ2xlKClcIlxuICAgICAgICAgICAgW2F0dHIudGFiaW5kZXhdPVwiMFwiXG4gICAgICAgICAgICAoa2V5ZG93bik9XCJfb25LZXlkb3duKCRldmVudClcIlxuICAgICAgICA+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibngtY29tcGFyaXNvbi10YWJsZS10b2dnbGUtc2VjdGlvbl9faGVhZGVyLWNvbnRlbnRcIj5cbiAgICAgICAgICAgICAgICA8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwibmdDb250ZW50XCI+PC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICAgICAgPG54LWljb24gY2xhc3M9XCJueC1leHBhbnNpb24tcGFuZWxfX2NoZXZyb25cIiBbQGluZGljYXRvclJvdGF0ZV09XCJfdG9nZ2xlU2VjdGlvbi5nZXRPcGVuU3RhdGUoKVwiIG5hbWU9XCJjaGV2cm9uLWRvd25cIiBhcmlhLWhpZGRlbj1cInRydWVcIj5cbiAgICAgICAgICAgICAgICA8L254LWljb24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9uZy1jb250YWluZXI+XG5cbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiX3RhYmxlLnZpZXdUeXBlID09PSAnbW9iaWxlJ1wiPlxuICAgICAgICA8dGhcbiAgICAgICAgICAgICNtb2JpbGVDZWxsXG4gICAgICAgICAgICBjbGFzcz1cIm54LWNvbXBhcmlzb24tdGFibGVfX21vYmlsZS10b2dnbGUtc2VjdGlvbi1oZWFkZXJcIlxuICAgICAgICAgICAgc2NvcGU9XCJjb2xcIlxuICAgICAgICAgICAgW2F0dHIuY29sc3Bhbl09XCJfdG9nZ2xlU2VjdGlvbi5fbnVtYmVyT2ZSb3dzKClcIlxuICAgICAgICAgICAgW2F0dHIuaWRdPVwiaWRcIlxuICAgICAgICAgICAgW25nU3R5bGVdPVwieyAnY2xpcC1wYXRoJzogJ2luc2V0KCcgKyBfZ2V0TW9iaWxlQ2xpcFBhdGhJbnNldCgpICsgJyknIH1cIlxuICAgICAgICA+XG4gICAgICAgICAgICA8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwibmdDb250ZW50XCI+PC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvdGg+XG4gICAgPC9uZy1jb250YWluZXI+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI25nQ29udGVudD5cbiAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG48L25nLXRlbXBsYXRlPlxuIl19