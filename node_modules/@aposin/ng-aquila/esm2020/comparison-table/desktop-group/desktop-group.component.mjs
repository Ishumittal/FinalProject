import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { ENTER, SPACE } from '@angular/cdk/keycodes';
import { Component, EventEmitter, Inject, Input, Optional, Output, ViewChild } from '@angular/core';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { COMPARISON_TABLE_DEFAULT_OPTIONS } from '../comparison-table.models';
import * as i0 from "@angular/core";
import * as i1 from "../comparison-table-base";
import * as i2 from "@angular/cdk/a11y";
import * as i3 from "@angular/cdk/bidi";
import * as i4 from "../flex-row/flex-row.component";
import * as i5 from "@aposin/ng-aquila/icon";
import * as i6 from "@angular/common";
/**
 * @docs-private
 *
 * Component that is only used internally for displaying a `nxComparisonTableRowGroup` in desktop and tablet view.
 */
export class NxComparisonTableDesktopGroup {
    constructor(_table, _focusMonitor, _dir, _defaultOptions) {
        this._table = _table;
        this._focusMonitor = _focusMonitor;
        this._dir = _dir;
        this._defaultOptions = _defaultOptions;
        this._expanded = false;
        this._useFullRowForExpandableArea = false;
        this.isExpandedChange = new EventEmitter();
        this._destroyed = new Subject();
    }
    /** Sets if the row group is expanded. Default: false. */
    set isExpanded(value) {
        this._expanded = coerceBooleanProperty(value);
    }
    get isExpanded() {
        return this._expanded;
    }
    /** Sets if the expansion cell uses the full row of the table or leaves out the first column. Default: false. */
    set useFullRowForExpandableArea(value) {
        this._useFullRowForExpandableArea = coerceBooleanProperty(value);
    }
    get useFullRowForExpandableArea() {
        if (this._useFullRowForExpandableArea !== undefined) {
            return this._useFullRowForExpandableArea;
        }
        if (this._defaultOptions?.useFullRowForExpandableArea !== undefined) {
            return this._defaultOptions.useFullRowForExpandableArea;
        }
        return false;
    }
    ngAfterViewInit() {
        this._updateFocusMonitoring();
        this.group?.rows.changes.pipe(takeUntil(this._destroyed)).subscribe(rows => 
        // timeout is needed here so that the focus monitor is updated after the view was updated
        setTimeout(() => this._updateFocusMonitoring()));
    }
    ngOnDestroy() {
        this._destroyed.next();
        this._destroyed.complete();
        this._focusMonitor.stopMonitoring(this._expansionCell);
    }
    /** The text direction of the containing app. */
    get dir() {
        return this._dir && this._dir.value === 'rtl' ? 'rtl' : 'ltr';
    }
    toggleGroup() {
        this.isExpanded = !this.isExpanded;
        this.isExpandedChange.emit(this.isExpanded);
    }
    _updateFocusMonitoring() {
        if (this._expansionCellPrevious && !this._expansionCell) {
            this._focusMonitor.stopMonitoring(this._expansionCellPrevious);
            this._expansionCellPrevious = this._expansionCell;
        }
        if (!this._expansionCellPrevious && this._expansionCell) {
            this._focusMonitor
                .monitor(this._expansionCell)
                .pipe(takeUntil(this._destroyed))
                .subscribe(origin => {
                if (origin === 'keyboard') {
                    this._table._scrollElementIntoView(this._expansionCell, 8);
                }
            });
            this._expansionCellPrevious = this._expansionCell;
        }
    }
    _onKeydown(event) {
        if (event.keyCode === ENTER) {
            this.toggleGroup();
        }
        else if (event.keyCode === SPACE) {
            this.toggleGroup();
            event.preventDefault(); // prevent from scrolling
        }
    }
    getOpenState() {
        return this._expanded ? 'open' : 'closed';
    }
    get _expandedAreaColspan() {
        if (this._table.viewType === 'desktop' && this._useFullRowForExpandableArea) {
            return this._table._infoColumnCount() + 1;
        }
        return this._table._infoColumnCount();
    }
}
NxComparisonTableDesktopGroup.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxComparisonTableDesktopGroup, deps: [{ token: i1.NxComparisonTableBase }, { token: i2.FocusMonitor }, { token: i3.Directionality, optional: true }, { token: COMPARISON_TABLE_DEFAULT_OPTIONS, optional: true }], target: i0.ɵɵFactoryTarget.Component });
NxComparisonTableDesktopGroup.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxComparisonTableDesktopGroup, selector: "nx-comparison-table-desktop-group", inputs: { group: "group", isExpanded: "isExpanded", useFullRowForExpandableArea: "useFullRowForExpandableArea" }, outputs: { isExpandedChange: "isExpandedChange" }, viewQueries: [{ propertyName: "_expansionCell", first: true, predicate: ["expansionCell"], descendants: true }], ngImport: i0, template: "<ng-container *ngFor=\"let row of group.rows; let i = index\">\n    <nx-comparison-table-flex-row *ngIf=\"i < group.visibleRows || _expanded\" [row]=\"row\"> </nx-comparison-table-flex-row>\n</ng-container>\n\n<div *ngIf=\"group.rows.length > group.visibleRows\" class=\"nx-comparison-table__row\" role=\"row\">\n    <div *ngIf=\"_table.viewType === 'desktop' && !useFullRowForExpandableArea\" class=\"nx-comparison-table__placeholder-cell\" role=\"cell\">\n        <div class=\"nx-comparison-table__cell-content\"></div>\n    </div>\n    <div\n        #expansionCell\n        class=\"nx-comparison-table__intersection-cell nx-comparison-table__group-expansion-cell\"\n        [class.full-width]=\"_table.viewType === 'desktop' && useFullRowForExpandableArea\"\n        role=\"cell\"\n        [attr.aria-colspan]=\"_expandedAreaColspan\"\n        [style.flex-grow]=\"_expandedAreaColspan\"\n        (click)=\"toggleGroup()\"\n        [attr.aria-expanded]=\"_expanded\"\n        tabindex=\"0\"\n        (keydown)=\"_onKeydown($event)\"\n    >\n        <div class=\"nx-comparison-table__cell-content\">\n            <span class=\"group-label\">{{ _expanded ? group.labelExpanded : group.labelCollapsed }}</span>\n            <nx-icon\n                [name]=\"_expanded ? 'chevron-up' : 'chevron-down'\"\n                aria-hidden=\"true\"\n                size=\"s\"\n                [class.nx-margin-left-2xs]=\"dir === 'ltr'\"\n                [class.nx-margin-right-2xs]=\"dir === 'rtl'\"\n            >\n            </nx-icon>\n        </div>\n    </div>\n</div>\n", styles: [":host{display:block}:host .nx-comparison-table__group-expansion-cell{cursor:pointer;color:var(--comparison-table-expansion-cell-color)}:host .nx-comparison-table__group-expansion-cell:focus{outline:0}:host .nx-comparison-table__group-expansion-cell .nx-comparison-table__cell-content{display:flex;justify-content:center}:host .nx-comparison-table__group-expansion-cell .group-label{font-size:var(--comparison-table-group-label-font-size);line-height:var(--comparison-table-group-label-line-height);font-weight:var(--comparison-table-group-label-font-weight);letter-spacing:var(--comparison-table-group-label-letter-spacing)}@media screen and (-ms-high-contrast: active){:host .nx-comparison-table__group-expansion-cell{color:buttonText;background:buttonFace;border-color:buttonText}}.nx-comparison-table__group-expansion-cell.cdk-keyboard-focused .nx-comparison-table__cell-content{box-shadow:var(--focus-box-shadow)}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-comparison-table__group-expansion-cell.cdk-keyboard-focused .nx-comparison-table__cell-content{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}\n"], components: [{ type: i4.NxComparisonTableFlexRow, selector: "nx-comparison-table-flex-row", inputs: ["row"] }, { type: i5.NxIconComponent, selector: "nx-icon", inputs: ["name", "outline", "fill", "size", "font"] }], directives: [{ type: i6.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i6.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxComparisonTableDesktopGroup, decorators: [{
            type: Component,
            args: [{ selector: 'nx-comparison-table-desktop-group', template: "<ng-container *ngFor=\"let row of group.rows; let i = index\">\n    <nx-comparison-table-flex-row *ngIf=\"i < group.visibleRows || _expanded\" [row]=\"row\"> </nx-comparison-table-flex-row>\n</ng-container>\n\n<div *ngIf=\"group.rows.length > group.visibleRows\" class=\"nx-comparison-table__row\" role=\"row\">\n    <div *ngIf=\"_table.viewType === 'desktop' && !useFullRowForExpandableArea\" class=\"nx-comparison-table__placeholder-cell\" role=\"cell\">\n        <div class=\"nx-comparison-table__cell-content\"></div>\n    </div>\n    <div\n        #expansionCell\n        class=\"nx-comparison-table__intersection-cell nx-comparison-table__group-expansion-cell\"\n        [class.full-width]=\"_table.viewType === 'desktop' && useFullRowForExpandableArea\"\n        role=\"cell\"\n        [attr.aria-colspan]=\"_expandedAreaColspan\"\n        [style.flex-grow]=\"_expandedAreaColspan\"\n        (click)=\"toggleGroup()\"\n        [attr.aria-expanded]=\"_expanded\"\n        tabindex=\"0\"\n        (keydown)=\"_onKeydown($event)\"\n    >\n        <div class=\"nx-comparison-table__cell-content\">\n            <span class=\"group-label\">{{ _expanded ? group.labelExpanded : group.labelCollapsed }}</span>\n            <nx-icon\n                [name]=\"_expanded ? 'chevron-up' : 'chevron-down'\"\n                aria-hidden=\"true\"\n                size=\"s\"\n                [class.nx-margin-left-2xs]=\"dir === 'ltr'\"\n                [class.nx-margin-right-2xs]=\"dir === 'rtl'\"\n            >\n            </nx-icon>\n        </div>\n    </div>\n</div>\n", styles: [":host{display:block}:host .nx-comparison-table__group-expansion-cell{cursor:pointer;color:var(--comparison-table-expansion-cell-color)}:host .nx-comparison-table__group-expansion-cell:focus{outline:0}:host .nx-comparison-table__group-expansion-cell .nx-comparison-table__cell-content{display:flex;justify-content:center}:host .nx-comparison-table__group-expansion-cell .group-label{font-size:var(--comparison-table-group-label-font-size);line-height:var(--comparison-table-group-label-line-height);font-weight:var(--comparison-table-group-label-font-weight);letter-spacing:var(--comparison-table-group-label-letter-spacing)}@media screen and (-ms-high-contrast: active){:host .nx-comparison-table__group-expansion-cell{color:buttonText;background:buttonFace;border-color:buttonText}}.nx-comparison-table__group-expansion-cell.cdk-keyboard-focused .nx-comparison-table__cell-content{box-shadow:var(--focus-box-shadow)}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-comparison-table__group-expansion-cell.cdk-keyboard-focused .nx-comparison-table__cell-content{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.NxComparisonTableBase }, { type: i2.FocusMonitor }, { type: i3.Directionality, decorators: [{
                    type: Optional
                }] }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [COMPARISON_TABLE_DEFAULT_OPTIONS]
                }] }]; }, propDecorators: { group: [{
                type: Input
            }], _expansionCell: [{
                type: ViewChild,
                args: ['expansionCell']
            }], isExpanded: [{
                type: Input
            }], useFullRowForExpandableArea: [{
                type: Input
            }], isExpandedChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVza3RvcC1ncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1hcXVpbGEvc3JjL2NvbXBhcmlzb24tdGFibGUvZGVza3RvcC1ncm91cC9kZXNrdG9wLWdyb3VwLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWFxdWlsYS9zcmMvY29tcGFyaXNvbi10YWJsZS9kZXNrdG9wLWdyb3VwL2Rlc2t0b3AtZ3JvdXAuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFnQixxQkFBcUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzVFLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDckQsT0FBTyxFQUFpQixTQUFTLEVBQWMsWUFBWSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQWEsUUFBUSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUksT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0MsT0FBTyxFQUFFLGdDQUFnQyxFQUFpQyxNQUFNLDRCQUE0QixDQUFDOzs7Ozs7OztBQUk3Rzs7OztHQUlHO0FBTUgsTUFBTSxPQUFPLDZCQUE2QjtJQXVDdEMsWUFDVyxNQUE2QixFQUM1QixhQUEyQixFQUNmLElBQTJCLEVBQ2UsZUFBcUQ7UUFINUcsV0FBTSxHQUFOLE1BQU0sQ0FBdUI7UUFDNUIsa0JBQWEsR0FBYixhQUFhLENBQWM7UUFDZixTQUFJLEdBQUosSUFBSSxDQUF1QjtRQUNlLG9CQUFlLEdBQWYsZUFBZSxDQUFzQztRQTFDdkgsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixpQ0FBNEIsR0FBRyxLQUFLLENBQUM7UUFpQzNCLHFCQUFnQixH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b25pdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2ExMXknO1xuaW1wb3J0IHsgRGlyZWN0aW9uLCBEaXJlY3Rpb25hbGl0eSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9iaWRpJztcbmltcG9ydCB7IEJvb2xlYW5JbnB1dCwgY29lcmNlQm9vbGVhblByb3BlcnR5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcbmltcG9ydCB7IEVOVEVSLCBTUEFDRSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9rZXljb2Rlcyc7XG5pbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5qZWN0LCBJbnB1dCwgT25EZXN0cm95LCBPcHRpb25hbCwgT3V0cHV0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgQ09NUEFSSVNPTl9UQUJMRV9ERUZBVUxUX09QVElPTlMsIENvbXBhcmlzb25UYWJsZURlZmF1bHRPcHRpb25zIH0gZnJvbSAnLi4vY29tcGFyaXNvbi10YWJsZS5tb2RlbHMnO1xuaW1wb3J0IHsgTnhDb21wYXJpc29uVGFibGVCYXNlIH0gZnJvbSAnLi4vY29tcGFyaXNvbi10YWJsZS1iYXNlJztcbmltcG9ydCB7IE54Q29tcGFyaXNvblRhYmxlUm93R3JvdXBEaXJlY3RpdmUgfSBmcm9tICcuLi9jb21wYXJpc29uLXRhYmxlLXJvdy1ncm91cC5kaXJlY3RpdmUnO1xuXG4vKipcbiAqIEBkb2NzLXByaXZhdGVcbiAqXG4gKiBDb21wb25lbnQgdGhhdCBpcyBvbmx5IHVzZWQgaW50ZXJuYWxseSBmb3IgZGlzcGxheWluZyBhIGBueENvbXBhcmlzb25UYWJsZVJvd0dyb3VwYCBpbiBkZXNrdG9wIGFuZCB0YWJsZXQgdmlldy5cbiAqL1xuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdueC1jb21wYXJpc29uLXRhYmxlLWRlc2t0b3AtZ3JvdXAnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9kZXNrdG9wLWdyb3VwLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9kZXNrdG9wLWdyb3VwLmNvbXBvbmVudC5zY3NzJ10sXG59KVxuZXhwb3J0IGNsYXNzIE54Q29tcGFyaXNvblRhYmxlRGVza3RvcEdyb3VwIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcbiAgICBfZXhwYW5kZWQgPSBmYWxzZTtcbiAgICBfdXNlRnVsbFJvd0ZvckV4cGFuZGFibGVBcmVhID0gZmFsc2U7XG5cbiAgICBASW5wdXQoKSBncm91cCE6IE54Q29tcGFyaXNvblRhYmxlUm93R3JvdXBEaXJlY3RpdmU7XG5cbiAgICBAVmlld0NoaWxkKCdleHBhbnNpb25DZWxsJykgX2V4cGFuc2lvbkNlbGwhOiBFbGVtZW50UmVmO1xuXG4gICAgLyoqIFByZXNlcnZlcyB0aGUgY3VycmVudCB2YWx1ZSBvZiB0aGUgX2V4cGFuc2lvbkNlbGwgVmlld0NoaWxkIGluIGNhc2UgaXQgY2hhbmdlcy4gKi9cbiAgICBwcml2YXRlIF9leHBhbnNpb25DZWxsUHJldmlvdXMhOiBFbGVtZW50UmVmO1xuXG4gICAgLyoqIFNldHMgaWYgdGhlIHJvdyBncm91cCBpcyBleHBhbmRlZC4gRGVmYXVsdDogZmFsc2UuICovXG4gICAgQElucHV0KClcbiAgICBzZXQgaXNFeHBhbmRlZCh2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgICAgIHRoaXMuX2V4cGFuZGVkID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgICB9XG4gICAgZ2V0IGlzRXhwYW5kZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9leHBhbmRlZDtcbiAgICB9XG5cbiAgICAvKiogU2V0cyBpZiB0aGUgZXhwYW5zaW9uIGNlbGwgdXNlcyB0aGUgZnVsbCByb3cgb2YgdGhlIHRhYmxlIG9yIGxlYXZlcyBvdXQgdGhlIGZpcnN0IGNvbHVtbi4gRGVmYXVsdDogZmFsc2UuICovXG4gICAgQElucHV0KClcbiAgICBzZXQgdXNlRnVsbFJvd0ZvckV4cGFuZGFibGVBcmVhKHZhbHVlOiBCb29sZWFuSW5wdXQpIHtcbiAgICAgICAgdGhpcy5fdXNlRnVsbFJvd0ZvckV4cGFuZGFibGVBcmVhID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgICB9XG4gICAgZ2V0IHVzZUZ1bGxSb3dGb3JFeHBhbmRhYmxlQXJlYSgpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuX3VzZUZ1bGxSb3dGb3JFeHBhbmRhYmxlQXJlYSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdXNlRnVsbFJvd0ZvckV4cGFuZGFibGVBcmVhO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9kZWZhdWx0T3B0aW9ucz8udXNlRnVsbFJvd0ZvckV4cGFuZGFibGVBcmVhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0T3B0aW9ucy51c2VGdWxsUm93Rm9yRXhwYW5kYWJsZUFyZWE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIEBPdXRwdXQoKSBpc0V4cGFuZGVkQ2hhbmdlOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cbiAgICBwcml2YXRlIHJlYWRvbmx5IF9kZXN0cm95ZWQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHB1YmxpYyBfdGFibGU6IE54Q29tcGFyaXNvblRhYmxlQmFzZSxcbiAgICAgICAgcHJpdmF0ZSBfZm9jdXNNb25pdG9yOiBGb2N1c01vbml0b3IsXG4gICAgICAgIEBPcHRpb25hbCgpIHByaXZhdGUgX2RpcjogRGlyZWN0aW9uYWxpdHkgfCBudWxsLFxuICAgICAgICBAT3B0aW9uYWwoKSBASW5qZWN0KENPTVBBUklTT05fVEFCTEVfREVGQVVMVF9PUFRJT05TKSBwcml2YXRlIF9kZWZhdWx0T3B0aW9uczogQ29tcGFyaXNvblRhYmxlRGVmYXVsdE9wdGlvbnMgfCBudWxsLFxuICAgICkge31cblxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgdGhpcy5fdXBkYXRlRm9jdXNNb25pdG9yaW5nKCk7XG4gICAgICAgIHRoaXMuZ3JvdXA/LnJvd3MuY2hhbmdlcy5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQpKS5zdWJzY3JpYmUocm93cyA9PlxuICAgICAgICAgICAgLy8gdGltZW91dCBpcyBuZWVkZWQgaGVyZSBzbyB0aGF0IHRoZSBmb2N1cyBtb25pdG9yIGlzIHVwZGF0ZWQgYWZ0ZXIgdGhlIHZpZXcgd2FzIHVwZGF0ZWRcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5fdXBkYXRlRm9jdXNNb25pdG9yaW5nKCkpLFxuICAgICAgICApO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLl9kZXN0cm95ZWQubmV4dCgpO1xuICAgICAgICB0aGlzLl9kZXN0cm95ZWQuY29tcGxldGUoKTtcbiAgICAgICAgdGhpcy5fZm9jdXNNb25pdG9yLnN0b3BNb25pdG9yaW5nKHRoaXMuX2V4cGFuc2lvbkNlbGwpO1xuICAgIH1cblxuICAgIC8qKiBUaGUgdGV4dCBkaXJlY3Rpb24gb2YgdGhlIGNvbnRhaW5pbmcgYXBwLiAqL1xuICAgIGdldCBkaXIoKTogRGlyZWN0aW9uIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RpciAmJiB0aGlzLl9kaXIudmFsdWUgPT09ICdydGwnID8gJ3J0bCcgOiAnbHRyJztcbiAgICB9XG5cbiAgICB0b2dnbGVHcm91cCgpIHtcbiAgICAgICAgdGhpcy5pc0V4cGFuZGVkID0gIXRoaXMuaXNFeHBhbmRlZDtcbiAgICAgICAgdGhpcy5pc0V4cGFuZGVkQ2hhbmdlLmVtaXQodGhpcy5pc0V4cGFuZGVkKTtcbiAgICB9XG5cbiAgICBfdXBkYXRlRm9jdXNNb25pdG9yaW5nKCkge1xuICAgICAgICBpZiAodGhpcy5fZXhwYW5zaW9uQ2VsbFByZXZpb3VzICYmICF0aGlzLl9leHBhbnNpb25DZWxsKSB7XG4gICAgICAgICAgICB0aGlzLl9mb2N1c01vbml0b3Iuc3RvcE1vbml0b3JpbmcodGhpcy5fZXhwYW5zaW9uQ2VsbFByZXZpb3VzKTtcbiAgICAgICAgICAgIHRoaXMuX2V4cGFuc2lvbkNlbGxQcmV2aW91cyA9IHRoaXMuX2V4cGFuc2lvbkNlbGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9leHBhbnNpb25DZWxsUHJldmlvdXMgJiYgdGhpcy5fZXhwYW5zaW9uQ2VsbCkge1xuICAgICAgICAgICAgdGhpcy5fZm9jdXNNb25pdG9yXG4gICAgICAgICAgICAgICAgLm1vbml0b3IodGhpcy5fZXhwYW5zaW9uQ2VsbClcbiAgICAgICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkKSlcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKG9yaWdpbiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcmlnaW4gPT09ICdrZXlib2FyZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RhYmxlLl9zY3JvbGxFbGVtZW50SW50b1ZpZXcodGhpcy5fZXhwYW5zaW9uQ2VsbCwgOCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuX2V4cGFuc2lvbkNlbGxQcmV2aW91cyA9IHRoaXMuX2V4cGFuc2lvbkNlbGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfb25LZXlkb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSBFTlRFUikge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVHcm91cCgpO1xuICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT09IFNQQUNFKSB7XG4gICAgICAgICAgICB0aGlzLnRvZ2dsZUdyb3VwKCk7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyAvLyBwcmV2ZW50IGZyb20gc2Nyb2xsaW5nXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRPcGVuU3RhdGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9leHBhbmRlZCA/ICdvcGVuJyA6ICdjbG9zZWQnO1xuICAgIH1cblxuICAgIGdldCBfZXhwYW5kZWRBcmVhQ29sc3BhbigpOiBudW1iZXIge1xuICAgICAgICBpZiAodGhpcy5fdGFibGUudmlld1R5cGUgPT09ICdkZXNrdG9wJyAmJiB0aGlzLl91c2VGdWxsUm93Rm9yRXhwYW5kYWJsZUFyZWEpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl90YWJsZS5faW5mb0NvbHVtbkNvdW50KCkgKyAxO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl90YWJsZS5faW5mb0NvbHVtbkNvdW50KCk7XG4gICAgfVxufVxuIiwiPG5nLWNvbnRhaW5lciAqbmdGb3I9XCJsZXQgcm93IG9mIGdyb3VwLnJvd3M7IGxldCBpID0gaW5kZXhcIj5cbiAgICA8bngtY29tcGFyaXNvbi10YWJsZS1mbGV4LXJvdyAqbmdJZj1cImkgPCBncm91cC52aXNpYmxlUm93cyB8fCBfZXhwYW5kZWRcIiBbcm93XT1cInJvd1wiPiA8L254LWNvbXBhcmlzb24tdGFibGUtZmxleC1yb3c+XG48L25nLWNvbnRhaW5lcj5cblxuPGRpdiAqbmdJZj1cImdyb3VwLnJvd3MubGVuZ3RoID4gZ3JvdXAudmlzaWJsZVJvd3NcIiBjbGFzcz1cIm54LWNvbXBhcmlzb24tdGFibGVfX3Jvd1wiIHJvbGU9XCJyb3dcIj5cbiAgICA8ZGl2ICpuZ0lmPVwiX3RhYmxlLnZpZXdUeXBlID09PSAnZGVza3RvcCcgJiYgIXVzZUZ1bGxSb3dGb3JFeHBhbmRhYmxlQXJlYVwiIGNsYXNzPVwibngtY29tcGFyaXNvbi10YWJsZV9fcGxhY2Vob2xkZXItY2VsbFwiIHJvbGU9XCJjZWxsXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJueC1jb21wYXJpc29uLXRhYmxlX19jZWxsLWNvbnRlbnRcIj48L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2XG4gICAgICAgICNleHBhbnNpb25DZWxsXG4gICAgICAgIGNsYXNzPVwibngtY29tcGFyaXNvbi10YWJsZV9faW50ZXJzZWN0aW9uLWNlbGwgbngtY29tcGFyaXNvbi10YWJsZV9fZ3JvdXAtZXhwYW5zaW9uLWNlbGxcIlxuICAgICAgICBbY2xhc3MuZnVsbC13aWR0aF09XCJfdGFibGUudmlld1R5cGUgPT09ICdkZXNrdG9wJyAmJiB1c2VGdWxsUm93Rm9yRXhwYW5kYWJsZUFyZWFcIlxuICAgICAgICByb2xlPVwiY2VsbFwiXG4gICAgICAgIFthdHRyLmFyaWEtY29sc3Bhbl09XCJfZXhwYW5kZWRBcmVhQ29sc3BhblwiXG4gICAgICAgIFtzdHlsZS5mbGV4LWdyb3ddPVwiX2V4cGFuZGVkQXJlYUNvbHNwYW5cIlxuICAgICAgICAoY2xpY2spPVwidG9nZ2xlR3JvdXAoKVwiXG4gICAgICAgIFthdHRyLmFyaWEtZXhwYW5kZWRdPVwiX2V4cGFuZGVkXCJcbiAgICAgICAgdGFiaW5kZXg9XCIwXCJcbiAgICAgICAgKGtleWRvd24pPVwiX29uS2V5ZG93bigkZXZlbnQpXCJcbiAgICA+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJueC1jb21wYXJpc29uLXRhYmxlX19jZWxsLWNvbnRlbnRcIj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZ3JvdXAtbGFiZWxcIj57eyBfZXhwYW5kZWQgPyBncm91cC5sYWJlbEV4cGFuZGVkIDogZ3JvdXAubGFiZWxDb2xsYXBzZWQgfX08L3NwYW4+XG4gICAgICAgICAgICA8bngtaWNvblxuICAgICAgICAgICAgICAgIFtuYW1lXT1cIl9leHBhbmRlZCA/ICdjaGV2cm9uLXVwJyA6ICdjaGV2cm9uLWRvd24nXCJcbiAgICAgICAgICAgICAgICBhcmlhLWhpZGRlbj1cInRydWVcIlxuICAgICAgICAgICAgICAgIHNpemU9XCJzXCJcbiAgICAgICAgICAgICAgICBbY2xhc3MubngtbWFyZ2luLWxlZnQtMnhzXT1cImRpciA9PT0gJ2x0cidcIlxuICAgICAgICAgICAgICAgIFtjbGFzcy5ueC1tYXJnaW4tcmlnaHQtMnhzXT1cImRpciA9PT0gJ3J0bCdcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgPC9ueC1pY29uPlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbjwvZGl2PlxuIl19