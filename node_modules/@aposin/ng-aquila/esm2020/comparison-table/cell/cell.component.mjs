import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { Component, EventEmitter, Input, Optional, Output, ViewChild } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "../comparison-table-base";
import * as i2 from "../comparison-table-row-base";
import * as i3 from "../toggle-section/toggle-section-base";
import * as i4 from "@angular/common";
let nextId = 0;
export class NxComparisonTableCell {
    constructor(_table, _row, _toggleSection) {
        this._table = _table;
        this._row = _row;
        this._toggleSection = _toggleSection;
        this._disabledColumn = false;
        /** @docs-private */
        this.indexChange = new EventEmitter();
        this._id = `nx-comparison-table-cell-${nextId++}`;
        this._type = 'content';
    }
    /** @docs-private */
    set index(newValue) {
        if (this._index !== newValue) {
            if (this._disabledColumn) {
                this._table._removeDisabledColumn(this._index);
                this._table._addDisabledColumn(newValue);
            }
            this._index = newValue;
            this.indexChange.emit(this._index);
        }
    }
    get index() {
        return this._index;
    }
    /** Sets all cells below a header cell to be disabled (disabled column).
     *  Important: this property can be set only on header cells.
     */
    set disabledColumn(value) {
        const newValue = coerceBooleanProperty(value);
        if (this._type === 'header' && newValue !== this.disabledColumn) {
            this._disabledColumn = newValue;
            if (this._disabledColumn) {
                this._table._addDisabledColumn(this._index);
            }
            else {
                this._table._removeDisabledColumn(this._index);
            }
        }
    }
    get disabledColumn() {
        return this._disabledColumn;
    }
    /** Sets the Id of the cell. */
    set id(value) {
        if (this._id !== value) {
            this._id = value;
        }
    }
    get id() {
        return this._id;
    }
    /** Sets the type of the cell. Default: 'content'. */
    set type(value) {
        if (this._type !== value) {
            this._type = value;
        }
    }
    get type() {
        return this._type;
    }
    _isSelected() {
        return this.index !== undefined && this.index === this._table.selectedIndex;
    }
    _isCellHidden() {
        return Array.isArray(this._table._hiddenIndexes) && this._table._hiddenIndexes.includes(this.index);
    }
    _selectCell() {
        this._table.selectedIndex = this.index;
    }
    get _isCellDisabled() {
        return this._table._disabledIndexes.includes(this.index);
    }
    _getHeaderIds() {
        // product header cell + (toggle-section) + description-cell
        const headerCell = this._table._getHeaderCells().find((cell) => cell.index === this.index);
        let headers = headerCell ? `${headerCell.id}` : '';
        if (this._row.descriptionCell) {
            headers += ` ${this._row.descriptionCell.id}`;
        }
        if (this._toggleSection) {
            headers += ` ${this._toggleSection.toggleSectionHeader.id}`;
        }
        return headers;
    }
}
NxComparisonTableCell.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxComparisonTableCell, deps: [{ token: i1.NxComparisonTableBase }, { token: i2.NxComparisonTableRowBase }, { token: i3.NxToggleSectionBase, optional: true }], target: i0.ɵɵFactoryTarget.Component });
NxComparisonTableCell.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxComparisonTableCell, selector: "nx-comparison-table-cell", inputs: { index: "index", disabledColumn: "disabledColumn", id: "id", type: "type" }, outputs: { indexChange: "indexChange" }, viewQueries: [{ propertyName: "_content", first: true, predicate: ["content"], descendants: true, static: true }], ngImport: i0, template: "<ng-template #content>\n    <ng-container *ngIf=\"_table.viewType === 'desktop' || _table.viewType === 'tablet'\">\n        <div\n            class=\"nx-comparison-table__cell\"\n            [class.is-disabled]=\"_isCellDisabled\"\n            [attr.role]=\"type === 'header' ? 'columnheader' : 'cell'\"\n            [class.is-selected]=\"_isSelected()\"\n            [class.is-hidden]=\"_isCellHidden()\"\n            [attr.id]=\"id\"\n            [attr.headers]=\"_getHeaderIds()\"\n        >\n            <div class=\"nx-comparison-table__cell-content\">\n                <ng-container *ngTemplateOutlet=\"ngContent\"></ng-container>\n            </div>\n        </div>\n    </ng-container>\n    <ng-container *ngIf=\"_table.viewType === 'mobile'\">\n        <td\n            [class.nx-comparison-table__mobile-header-cell]=\"type === 'header'\"\n            [class.nx-comparison-table__cell]=\"type !== 'header'\"\n            [class.is-selected]=\"_isSelected()\"\n            [class.is-hidden]=\"_isCellHidden()\"\n            [attr.scope]=\"type === 'header' ? 'row' : ''\"\n            [attr.id]=\"id\"\n            [attr.headers]=\"_getHeaderIds()\"\n        >\n            <ng-container *ngTemplateOutlet=\"ngContent\"></ng-container>\n        </td>\n    </ng-container>\n</ng-template>\n\n<ng-template #ngContent>\n    <ng-content></ng-content>\n</ng-template>\n", styles: [".nx-comparison-table__mobile-header-cell.is-selected,.nx-comparison-table__cell.is-selected{background-color:var(--comparison-table-selected-column-background-color);color:var(--comparison-table-selected-column-text-color)}.nx-comparison-table__mobile-header-cell.is-hidden,.nx-comparison-table__cell.is-hidden{display:none}\n"], directives: [{ type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i4.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxComparisonTableCell, decorators: [{
            type: Component,
            args: [{ selector: 'nx-comparison-table-cell', template: "<ng-template #content>\n    <ng-container *ngIf=\"_table.viewType === 'desktop' || _table.viewType === 'tablet'\">\n        <div\n            class=\"nx-comparison-table__cell\"\n            [class.is-disabled]=\"_isCellDisabled\"\n            [attr.role]=\"type === 'header' ? 'columnheader' : 'cell'\"\n            [class.is-selected]=\"_isSelected()\"\n            [class.is-hidden]=\"_isCellHidden()\"\n            [attr.id]=\"id\"\n            [attr.headers]=\"_getHeaderIds()\"\n        >\n            <div class=\"nx-comparison-table__cell-content\">\n                <ng-container *ngTemplateOutlet=\"ngContent\"></ng-container>\n            </div>\n        </div>\n    </ng-container>\n    <ng-container *ngIf=\"_table.viewType === 'mobile'\">\n        <td\n            [class.nx-comparison-table__mobile-header-cell]=\"type === 'header'\"\n            [class.nx-comparison-table__cell]=\"type !== 'header'\"\n            [class.is-selected]=\"_isSelected()\"\n            [class.is-hidden]=\"_isCellHidden()\"\n            [attr.scope]=\"type === 'header' ? 'row' : ''\"\n            [attr.id]=\"id\"\n            [attr.headers]=\"_getHeaderIds()\"\n        >\n            <ng-container *ngTemplateOutlet=\"ngContent\"></ng-container>\n        </td>\n    </ng-container>\n</ng-template>\n\n<ng-template #ngContent>\n    <ng-content></ng-content>\n</ng-template>\n", styles: [".nx-comparison-table__mobile-header-cell.is-selected,.nx-comparison-table__cell.is-selected{background-color:var(--comparison-table-selected-column-background-color);color:var(--comparison-table-selected-column-text-color)}.nx-comparison-table__mobile-header-cell.is-hidden,.nx-comparison-table__cell.is-hidden{display:none}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.NxComparisonTableBase }, { type: i2.NxComparisonTableRowBase }, { type: i3.NxToggleSectionBase, decorators: [{
                    type: Optional
                }] }]; }, propDecorators: { _content: [{
                type: ViewChild,
                args: ['content', { static: true }]
            }], index: [{
                type: Input
            }], disabledColumn: [{
                type: Input
            }], indexChange: [{
                type: Output
            }], id: [{
                type: Input
            }], type: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2VsbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1hcXVpbGEvc3JjL2NvbXBhcmlzb24tdGFibGUvY2VsbC9jZWxsLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWFxdWlsYS9zcmMvY29tcGFyaXNvbi10YWJsZS9jZWxsL2NlbGwuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFnQixxQkFBcUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzVFLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFlLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7Ozs7O0FBT3pHLElBQUksTUFBTSxHQUFHLENBQUMsQ0FBQztBQU9mLE1BQU0sT0FBTyxxQkFBcUI7SUF3RTlCLFlBQW1CLE1BQTZCLEVBQVUsSUFBOEIsRUFBc0IsY0FBMEM7UUFBckksV0FBTSxHQUFOLE1BQU0sQ0FBdUI7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUEwQjtRQUFzQixtQkFBYyxHQUFkLGNBQWMsQ0FBNEI7UUFsRGhKLG9CQUFlLEdBQUcsS0FBSyxDQUFDO1FBcUJoQyxvQkFBb0I7UUFDVixnQkFBVyxHQUF5QixJQUFJLFlBQVksRUFBVSxDQUFDO1FBRWpFLFFBQUcsR0FBRyw0QkFBNEIsTUFBTSxFQUFFLEVBQUUsQ0FBQztRQWE3QyxVQUFLLEdBQTZCLFNBQVMsQ0FBQztJQWF1RyxDQUFDO0lBbkU1SixvQkFBb0I7SUFDcEIsSUFDSSxLQUFLLENBQUMsUUFBZ0I7UUFDdEIsSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLFFBQVEsRUFBRTtZQUMxQixJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7Z0JBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FB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SSxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztTQUNqRDtRQUVELElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUNyQixPQUFPLElBQUksSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLG1CQUFtQixDQUFDLEVBQUUsRUFBRSxDQUFDO1NBQy9EO1FBRUQsT0FBTyxPQUFPLENBQUM7SUFDbkIsQ0FBQzs7a0hBeEdRLHFCQUFxQjtzR0FBckIscUJBQXFCLGtUQ2ZsQywrMUNBa0NBOzJGRG5CYSxxQkFBcUI7a0JBTGpDLFNBQVM7K0JBQ0ksMEJBQTBCOzswQkE0RXVELFFBQVE7NENBdkUzRCxRQUFRO3NCQUEvQyxTQUFTO3VCQUFDLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBTWxDLEtBQUs7c0JBRFIsS0FBSztnQkFzQkYsY0FBYztzQkFEakIsS0FBSztnQkFpQkksV0FBVztzQkFBcEIsTUFBTTtnQkFNSCxFQUFFO3NCQURMLEtBQUs7Z0JBY0YsSUFBSTtzQkFEUCxLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQm9vbGVhbklucHV0LCBjb2VyY2VCb29sZWFuUHJvcGVydHkgfSBmcm9tICdAYW5ndWxhci9jZGsvY29lcmNpb24nO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPcHRpb25hbCwgT3V0cHV0LCBUZW1wbGF0ZVJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IE54Q29tcGFyaXNvblRhYmxlUm93VHlwZSB9IGZyb20gJy4uL2NvbXBhcmlzb24tdGFibGUubW9kZWxzJztcbmltcG9ydCB7IE54Q29tcGFyaXNvblRhYmxlQmFzZSB9IGZyb20gJy4uL2NvbXBhcmlzb24tdGFibGUtYmFzZSc7XG5pbXBvcnQgeyBOeENvbXBhcmlzb25UYWJsZVJvd0Jhc2UgfSBmcm9tICcuLi9jb21wYXJpc29uLXRhYmxlLXJvdy1iYXNlJztcbmltcG9ydCB7IE54VG9nZ2xlU2VjdGlvbkJhc2UgfSBmcm9tICcuLi90b2dnbGUtc2VjdGlvbi90b2dnbGUtc2VjdGlvbi1iYXNlJztcblxubGV0IG5leHRJZCA9IDA7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnbngtY29tcGFyaXNvbi10YWJsZS1jZWxsJyxcbiAgICBzdHlsZVVybHM6IFsnLi9jZWxsLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgdGVtcGxhdGVVcmw6ICcuL2NlbGwuY29tcG9uZW50Lmh0bWwnLFxufSlcbmV4cG9ydCBjbGFzcyBOeENvbXBhcmlzb25UYWJsZUNlbGwge1xuICAgIEBWaWV3Q2hpbGQoJ2NvbnRlbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBfY29udGVudCE6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgICBwcml2YXRlIF9pbmRleCE6IG51bWJlcjtcblxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgQElucHV0KClcbiAgICBzZXQgaW5kZXgobmV3VmFsdWU6IG51bWJlcikge1xuICAgICAgICBpZiAodGhpcy5faW5kZXggIT09IG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fZGlzYWJsZWRDb2x1bW4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90YWJsZS5fcmVtb3ZlRGlzYWJsZWRDb2x1bW4odGhpcy5faW5kZXgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RhYmxlLl9hZGREaXNhYmxlZENvbHVtbihuZXdWYWx1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2luZGV4ID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB0aGlzLmluZGV4Q2hhbmdlLmVtaXQodGhpcy5faW5kZXgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBpbmRleCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5faW5kZXg7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZGlzYWJsZWRDb2x1bW4gPSBmYWxzZTtcblxuICAgIC8qKiBTZXRzIGFsbCBjZWxscyBiZWxvdyBhIGhlYWRlciBjZWxsIHRvIGJlIGRpc2FibGVkIChkaXNhYmxlZCBjb2x1bW4pLlxuICAgICAqICBJbXBvcnRhbnQ6IHRoaXMgcHJvcGVydHkgY2FuIGJlIHNldCBvbmx5IG9uIGhlYWRlciBjZWxscy5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHNldCBkaXNhYmxlZENvbHVtbih2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgICAgICAgaWYgKHRoaXMuX3R5cGUgPT09ICdoZWFkZXInICYmIG5ld1ZhbHVlICE9PSB0aGlzLmRpc2FibGVkQ29sdW1uKSB7XG4gICAgICAgICAgICB0aGlzLl9kaXNhYmxlZENvbHVtbiA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2Rpc2FibGVkQ29sdW1uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGFibGUuX2FkZERpc2FibGVkQ29sdW1uKHRoaXMuX2luZGV4KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGFibGUuX3JlbW92ZURpc2FibGVkQ29sdW1uKHRoaXMuX2luZGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgZGlzYWJsZWRDb2x1bW4oKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kaXNhYmxlZENvbHVtbjtcbiAgICB9XG5cbiAgICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICAgIEBPdXRwdXQoKSBpbmRleENoYW5nZTogRXZlbnRFbWl0dGVyPG51bWJlcj4gPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlcj4oKTtcblxuICAgIHByaXZhdGUgX2lkID0gYG54LWNvbXBhcmlzb24tdGFibGUtY2VsbC0ke25leHRJZCsrfWA7XG5cbiAgICAvKiogU2V0cyB0aGUgSWQgb2YgdGhlIGNlbGwuICovXG4gICAgQElucHV0KClcbiAgICBzZXQgaWQodmFsdWU6IHN0cmluZykge1xuICAgICAgICBpZiAodGhpcy5faWQgIT09IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLl9pZCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBpZCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5faWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfdHlwZTogTnhDb21wYXJpc29uVGFibGVSb3dUeXBlID0gJ2NvbnRlbnQnO1xuXG4gICAgLyoqIFNldHMgdGhlIHR5cGUgb2YgdGhlIGNlbGwuIERlZmF1bHQ6ICdjb250ZW50Jy4gKi9cbiAgICBASW5wdXQoKVxuICAgIHNldCB0eXBlKHZhbHVlOiBOeENvbXBhcmlzb25UYWJsZVJvd1R5cGUpIHtcbiAgICAgICAgaWYgKHRoaXMuX3R5cGUgIT09IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLl90eXBlID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHR5cGUoKTogTnhDb21wYXJpc29uVGFibGVSb3dUeXBlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGU7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IocHVibGljIF90YWJsZTogTnhDb21wYXJpc29uVGFibGVCYXNlLCBwcml2YXRlIF9yb3c6IE54Q29tcGFyaXNvblRhYmxlUm93QmFzZSwgQE9wdGlvbmFsKCkgcHJpdmF0ZSBfdG9nZ2xlU2VjdGlvbjogTnhUb2dnbGVTZWN0aW9uQmFzZSB8IG51bGwpIHt9XG5cbiAgICBfaXNTZWxlY3RlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXggIT09IHVuZGVmaW5lZCAmJiB0aGlzLmluZGV4ID09PSB0aGlzLl90YWJsZS5zZWxlY3RlZEluZGV4O1xuICAgIH1cblxuICAgIF9pc0NlbGxIaWRkZW4oKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KHRoaXMuX3RhYmxlLl9oaWRkZW5JbmRleGVzKSAmJiB0aGlzLl90YWJsZS5faGlkZGVuSW5kZXhlcy5pbmNsdWRlcyh0aGlzLmluZGV4KTtcbiAgICB9XG5cbiAgICBfc2VsZWN0Q2VsbCgpIHtcbiAgICAgICAgdGhpcy5fdGFibGUuc2VsZWN0ZWRJbmRleCA9IHRoaXMuaW5kZXg7XG4gICAgfVxuXG4gICAgZ2V0IF9pc0NlbGxEaXNhYmxlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RhYmxlLl9kaXNhYmxlZEluZGV4ZXMuaW5jbHVkZXModGhpcy5pbmRleCk7XG4gICAgfVxuXG4gICAgX2dldEhlYWRlcklkcygpOiBzdHJpbmcge1xuICAgICAgICAvLyBwcm9kdWN0IGhlYWRlciBjZWxsICsgKHRvZ2dsZS1zZWN0aW9uKSArIGRlc2NyaXB0aW9uLWNlbGxcbiAgICAgICAgY29uc3QgaGVhZGVyQ2VsbCA9IHRoaXMuX3RhYmxlLl9nZXRIZWFkZXJDZWxscygpLmZpbmQoKGNlbGw6IE54Q29tcGFyaXNvblRhYmxlQ2VsbCkgPT4gY2VsbC5pbmRleCA9PT0gdGhpcy5pbmRleCk7XG4gICAgICAgIGxldCBoZWFkZXJzID0gaGVhZGVyQ2VsbCA/IGAke2hlYWRlckNlbGwuaWR9YCA6ICcnO1xuXG4gICAgICAgIGlmICh0aGlzLl9yb3cuZGVzY3JpcHRpb25DZWxsKSB7XG4gICAgICAgICAgICBoZWFkZXJzICs9IGAgJHt0aGlzLl9yb3cuZGVzY3JpcHRpb25DZWxsLmlkfWA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5fdG9nZ2xlU2VjdGlvbikge1xuICAgICAgICAgICAgaGVhZGVycyArPSBgICR7dGhpcy5fdG9nZ2xlU2VjdGlvbi50b2dnbGVTZWN0aW9uSGVhZGVyLmlkfWA7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaGVhZGVycztcbiAgICB9XG59XG4iLCI8bmctdGVtcGxhdGUgI2NvbnRlbnQ+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIl90YWJsZS52aWV3VHlwZSA9PT0gJ2Rlc2t0b3AnIHx8IF90YWJsZS52aWV3VHlwZSA9PT0gJ3RhYmxldCdcIj5cbiAgICAgICAgPGRpdlxuICAgICAgICAgICAgY2xhc3M9XCJueC1jb21wYXJpc29uLXRhYmxlX19jZWxsXCJcbiAgICAgICAgICAgIFtjbGFzcy5pcy1kaXNhYmxlZF09XCJfaXNDZWxsRGlzYWJsZWRcIlxuICAgICAgICAgICAgW2F0dHIucm9sZV09XCJ0eXBlID09PSAnaGVhZGVyJyA/ICdjb2x1bW5oZWFkZXInIDogJ2NlbGwnXCJcbiAgICAgICAgICAgIFtjbGFzcy5pcy1zZWxlY3RlZF09XCJfaXNTZWxlY3RlZCgpXCJcbiAgICAgICAgICAgIFtjbGFzcy5pcy1oaWRkZW5dPVwiX2lzQ2VsbEhpZGRlbigpXCJcbiAgICAgICAgICAgIFthdHRyLmlkXT1cImlkXCJcbiAgICAgICAgICAgIFthdHRyLmhlYWRlcnNdPVwiX2dldEhlYWRlcklkcygpXCJcbiAgICAgICAgPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm54LWNvbXBhcmlzb24tdGFibGVfX2NlbGwtY29udGVudFwiPlxuICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJuZ0NvbnRlbnRcIj48L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiX3RhYmxlLnZpZXdUeXBlID09PSAnbW9iaWxlJ1wiPlxuICAgICAgICA8dGRcbiAgICAgICAgICAgIFtjbGFzcy5ueC1jb21wYXJpc29uLXRhYmxlX19tb2JpbGUtaGVhZGVyLWNlbGxdPVwidHlwZSA9PT0gJ2hlYWRlcidcIlxuICAgICAgICAgICAgW2NsYXNzLm54LWNvbXBhcmlzb24tdGFibGVfX2NlbGxdPVwidHlwZSAhPT0gJ2hlYWRlcidcIlxuICAgICAgICAgICAgW2NsYXNzLmlzLXNlbGVjdGVkXT1cIl9pc1NlbGVjdGVkKClcIlxuICAgICAgICAgICAgW2NsYXNzLmlzLWhpZGRlbl09XCJfaXNDZWxsSGlkZGVuKClcIlxuICAgICAgICAgICAgW2F0dHIuc2NvcGVdPVwidHlwZSA9PT0gJ2hlYWRlcicgPyAncm93JyA6ICcnXCJcbiAgICAgICAgICAgIFthdHRyLmlkXT1cImlkXCJcbiAgICAgICAgICAgIFthdHRyLmhlYWRlcnNdPVwiX2dldEhlYWRlcklkcygpXCJcbiAgICAgICAgPlxuICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cIm5nQ29udGVudFwiPjwvbmctY29udGFpbmVyPlxuICAgICAgICA8L3RkPlxuICAgIDwvbmctY29udGFpbmVyPlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlICNuZ0NvbnRlbnQ+XG4gICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuPC9uZy10ZW1wbGF0ZT5cbiJdfQ==