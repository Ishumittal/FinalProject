import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output, ViewChildren, } from '@angular/core';
import { Subject } from 'rxjs';
import { take, takeUntil } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/a11y";
import * as i2 from "@angular/common";
/**
 * An internal class that represents the data corresponding to a single calendar cell.
 * @docs-private
 */
export class NxCalendarCell {
    constructor(value, displayValue, ariaLabel, enabled) {
        this.value = value;
        this.displayValue = displayValue;
        this.ariaLabel = ariaLabel;
        this.enabled = enabled;
    }
}
/**
 * An internal component used to display calendar data in a table.
 * @docs-private
 */
export class NxCalendarBodyComponent {
    constructor(_elementRef, _ngZone, _focusMonitor) {
        this._elementRef = _elementRef;
        this._ngZone = _ngZone;
        this._focusMonitor = _focusMonitor;
        /** The number of columns in the table. */
        this.numCols = 7;
        /** Whether to allow selection of disabled cells. */
        this.allowDisabledSelection = false;
        /** The cell number of the active cell in the table. */
        this.activeCell = 0;
        /** The items to display in the first row in the offset space. */
        this.previousItems = [];
        /** The items to display in the last row in the offset space. */
        this.followingItems = [[]];
        /** Emits when a new value out of rows is selected. */
        this.selectedValueChange = new EventEmitter();
        /** Emits when a new value out of previousItems is selected. */
        this.selectedValueChangeToPrevious = new EventEmitter();
        /** Emits when a new value out of followingItems is selected. */
        this.selectedValueChangeToFollowing = new EventEmitter();
        this._destroyed = new Subject();
    }
    ngAfterViewInit() {
        this._cells.forEach(cell => this._focusMonitor.monitor(cell));
        this._cellsPrevious = this._cells;
        this._cells.changes.pipe(takeUntil(this._destroyed)).subscribe(changes => {
            this._cellsPrevious.forEach(cell => this._focusMonitor.stopMonitoring(cell));
            this._cellsPrevious = this._cells;
            this._cells.forEach(cell => this._focusMonitor.monitor(cell));
        });
    }
    ngOnDestroy() {
        this._destroyed.next();
        this._destroyed.complete();
        this._cells.forEach(cell => this._focusMonitor.stopMonitoring(cell));
    }
    _previousCellClicked(cell) {
        if (!this.allowDisabledSelection && !cell.enabled) {
            return;
        }
        this.selectedValueChangeToPrevious.emit(cell.value);
    }
    _cellClicked(cell) {
        if (!this.allowDisabledSelection && !cell.enabled) {
            return;
        }
        this.selectedValueChange.emit(cell.value);
    }
    _followingCellClicked(cell) {
        if (!this.allowDisabledSelection && !cell.enabled) {
            return;
        }
        this.selectedValueChangeToFollowing.emit(cell.value);
    }
    /** The number of blank cells to put at the beginning for the first row. */
    get _firstRowOffset() {
        return this.rows?.length && this.rows[0].length ? this.numCols - this.rows[0].length : 0;
    }
    /** The number of blank cells to put at the end of the last filled row. */
    get _lastRowOffset() {
        return this.rows?.length && this.rows[this.rows.length - 1].length ? this.numCols - this.rows[this.rows.length - 1].length : 0;
    }
    /** The index of the last row. */
    get _lastRowIndex() {
        return this.rows?.length ? this.rows.length - 1 : 0;
    }
    /**
     * The following full rows to display and fill up the calendar.
     */
    get _followingRows() {
        if (this.followingItems?.length) {
            // if first row is not a full row => display them in offset space
            if (this.followingItems[0].length < this.numCols) {
                return this.followingItems.slice(1, this.followingItems.length);
            }
            return this.followingItems;
        }
        return [];
    }
    _isActiveCell(rowIndex, colIndex) {
        let cellNumber = rowIndex * this.numCols + colIndex;
        // Account for the fact that the first row may not have as many cells.
        if (rowIndex) {
            cellNumber -= this._firstRowOffset;
        }
        return cellNumber === this.activeCell;
    }
    /** Focuses the active cell after the microtask queue is empty. */
    _focusActiveCell() {
        this._ngZone.runOutsideAngular(() => {
            this._ngZone.onStable
                .asObservable()
                .pipe(take(1))
                .subscribe(() => {
                this._elementRef.nativeElement.querySelector('.nx-calendar-body-active').focus();
            });
        });
    }
}
NxCalendarBodyComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxCalendarBodyComponent, deps: [{ token: i0.ElementRef }, { token: i0.NgZone }, { token: i1.FocusMonitor }], target: i0.ɵɵFactoryTarget.Component });
NxCalendarBodyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxCalendarBodyComponent, selector: "[nx-calendar-body]", inputs: { label: "label", rows: "rows", todayValue: "todayValue", selectedValue: "selectedValue", numCols: "numCols", allowDisabledSelection: "allowDisabledSelection", activeCell: "activeCell", previousItems: "previousItems", followingItems: "followingItems" }, outputs: { selectedValueChange: "selectedValueChange", selectedValueChangeToPrevious: "selectedValueChangeToPrevious", selectedValueChangeToFollowing: "selectedValueChangeToFollowing" }, host: { attributes: { "role": "grid", "attr.aria-readonly": "true" }, classAttribute: "nx-calendar-body" }, viewQueries: [{ propertyName: "_cells", predicate: ["cell"], descendants: true }], exportAs: ["nxCalendarBody"], ngImport: i0, template: "<!-- Create the first and last row separately so we can include special spacer cells. -->\n<tr *ngFor=\"let row of rows; let rowIndex = index\" role=\"row\">\n    <!--\n    We mark this cell as aria-hidden so it doesn't get read out as one of the days in the week.\n    The aspect ratio of the table cells is maintained by setting the top and bottom padding as a\n    percentage of the width (a variant of the trick described here:\n    https://www.w3schools.com/howto/howto_css_aspect_ratio.asp).\n  -->\n    <ng-container *ngIf=\"rowIndex === 0\">\n        <td\n            *ngFor=\"let item of previousItems\"\n            aria-hidden=\"true\"\n            class=\"nx-calendar-adjacent-cell\"\n            [class.nx-calendar-body-disabled]=\"!item.enabled\"\n            (click)=\"_previousCellClicked(item)\"\n        >\n            <div aria-hidden=\"true\" class=\"nx-calendar-adjacent-cell-content\"> {{ item.displayValue }} </div>\n        </td>\n    </ng-container>\n\n    <td\n        *ngFor=\"let item of row; let colIndex = index\"\n        #cell\n        role=\"gridcell\"\n        class=\"nx-calendar-body-cell\"\n        [tabindex]=\"_isActiveCell(rowIndex, colIndex) ? 0 : -1\"\n        [class.nx-calendar-body-disabled]=\"!item.enabled\"\n        [class.nx-calendar-body-active]=\"_isActiveCell(rowIndex, colIndex)\"\n        [attr.aria-label]=\"item.ariaLabel\"\n        [attr.aria-disabled]=\"!item.enabled || null\"\n        (click)=\"_cellClicked(item)\"\n        [style.width.%]=\"100 / numCols\"\n    >\n        <div\n            class=\"nx-calendar-body-cell-content\"\n            [class.nx-calendar-body-selected]=\"selectedValue === item.value\"\n            [class.nx-calendar-body-today]=\"todayValue === item.value\"\n        >\n            {{item.displayValue}}\n        </div>\n    </td>\n\n    <ng-container *ngIf=\"rowIndex === _lastRowIndex && _lastRowOffset\">\n        <td\n            *ngFor=\"let item of followingItems[0]\"\n            aria-hidden=\"true\"\n            class=\"nx-calendar-adjacent-cell\"\n            [class.nx-calendar-body-disabled]=\"!item.enabled\"\n            (click)=\"_followingCellClicked(item)\"\n        >\n            <div aria-hidden=\"true\" class=\"nx-calendar-adjacent-cell-content\"> {{ item.displayValue }} </div>\n        </td>\n    </ng-container>\n</tr>\n\n<!-- \n  if there are still elements remaining in 'following-elements', then create some extra rows\n  to fill up the space\n-->\n<tr *ngFor=\"let row of _followingRows\" aria-hidden=\"true\">\n    <td *ngFor=\"let item of row\" class=\"nx-calendar-adjacent-cell\" [class.nx-calendar-body-disabled]=\"!item.enabled\" (click)=\"_followingCellClicked(item)\">\n        <div class=\"nx-calendar-adjacent-cell-content\"> {{ item.displayValue }} </div>\n    </td>\n</tr>\n", styles: [".nx-calendar-body-cell,.nx-calendar-adjacent-cell{position:relative;height:0;line-height:0;text-align:center;outline:none;vertical-align:text-bottom;cursor:pointer}.nx-calendar-body-disabled{cursor:default}.nx-calendar-body-cell-content{display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:40px;height:40px;margin:0 auto;font-size:var(--datefield-cell-font-size);line-height:var(--datefield-cell-line-height);font-weight:var(--datefield-cell-font-weight);letter-spacing:var(--datefield-cell-letter-spacing);color:var(--datefield-cell-color);border-radius:50%;line-height:1;box-shadow:0 0 0 6px transparent}@media screen and (-ms-high-contrast: active){.nx-calendar-body-cell-content{color:buttonText}}.nx-calendar-body-cell-content.nx-calendar-body-selected{color:var(--datefield-cell-selected-color);background-color:var(--datefield-cell-selected-background-color)}@media screen and (-ms-high-contrast: active){.nx-calendar-body-cell-content.nx-calendar-body-selected{-ms-high-contrast-adjust:none;background-color:highlight;color:highlightText}}.nx-calendar-body-cell-content.nx-calendar-body-today{color:var(--datefield-controls-color)!important}.nx-calendar-body-cell-content.nx-calendar-body-today:after{content:\"\";display:block;position:absolute;width:4px;height:4px;margin-top:24px;background-color:var(--datefield-controls-color);border-radius:50%}.nx-calendar-body-cell-content.nx-calendar-body-today.nx-calendar-body-selected{color:var(--datefield-cell-selected-color)!important}.nx-calendar-body-cell-content.nx-calendar-body-today.nx-calendar-body-selected:after{background-color:var(--datefield-cell-selected-color)}.nx-calendar-body-disabled>.nx-calendar-body-cell-content:not(.nx-calendar-body-selected){color:var(--datefield-cell-disabled-color);font-weight:400}@media screen and (-ms-high-contrast: active){.nx-calendar-body-disabled>.nx-calendar-body-cell-content:not(.nx-calendar-body-selected){color:GrayText}}:not(.nx-calendar-body-disabled):hover>.nx-calendar-body-cell-content:not(.nx-calendar-body-selected),:not(.nx-calendar-body-disabled):hover>.nx-calendar-adjacent-cell-content,.nx-calendar-body-active:not(.nx-calendar-body-disabled)>.nx-calendar-body-cell-content:not(.nx-calendar-body-selected),.nx-calendar-body-active:not(.nx-calendar-body-disabled)>.nx-calendar-adjacent-cell-content{color:var(--datefield-cell-hover-color);background-color:var(--datefield-cell-hover-background-color)}@media screen and (-ms-high-contrast: active){:not(.nx-calendar-body-disabled):hover>.nx-calendar-body-cell-content:not(.nx-calendar-body-selected),:not(.nx-calendar-body-disabled):hover>.nx-calendar-adjacent-cell-content,.nx-calendar-body-active:not(.nx-calendar-body-disabled)>.nx-calendar-body-cell-content:not(.nx-calendar-body-selected),.nx-calendar-body-active:not(.nx-calendar-body-disabled)>.nx-calendar-adjacent-cell-content{-ms-high-contrast-adjust:none;background-color:highlight;color:highlightText}}.nx-calendar-body-cell.cdk-keyboard-focused .nx-calendar-body-cell-content{box-shadow:var(--focus-box-shadow)}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-calendar-body-cell.cdk-keyboard-focused .nx-calendar-body-cell-content{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}.nx-calendar-body-cell.cdk-keyboard-focused.nx-calendar-body-disabled .nx-calendar-body-cell-content{color:var(--datefield-cell-disabled-color)}.nx-calendar-body-cell.cdk-keyboard-focused .nx-calendar-body-cell-content:not(.nx-calendar-body-selected){background-color:var(--datefield-cell-focused-background-color)}@media screen and (-ms-high-contrast: active){.nx-calendar-body-cell.cdk-keyboard-focused .nx-calendar-body-cell-content:not(.nx-calendar-body-selected){background-color:highlight}}.nx-calendar-adjacent-cell-content{display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:40px;height:40px;margin:0 auto;font-size:var(--datefield-cell-font-size);line-height:var(--datefield-cell-line-height);font-weight:var(--datefield-cell-font-weight);letter-spacing:var(--datefield-cell-letter-spacing);font-weight:400;color:var(--datefield-cell-disabled-color);border-radius:50%;line-height:1}@media screen and (-ms-high-contrast: active){.nx-calendar-adjacent-cell-content{color:GrayText}}\n"], directives: [{ type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxCalendarBodyComponent, decorators: [{
            type: Component,
            args: [{ selector: '[nx-calendar-body]', host: {
                        class: 'nx-calendar-body',
                        role: 'grid',
                        'attr.aria-readonly': 'true',
                    }, exportAs: 'nxCalendarBody', changeDetection: ChangeDetectionStrategy.OnPush, template: "<!-- Create the first and last row separately so we can include special spacer cells. -->\n<tr *ngFor=\"let row of rows; let rowIndex = index\" role=\"row\">\n    <!--\n    We mark this cell as aria-hidden so it doesn't get read out as one of the days in the week.\n    The aspect ratio of the table cells is maintained by setting the top and bottom padding as a\n    percentage of the width (a variant of the trick described here:\n    https://www.w3schools.com/howto/howto_css_aspect_ratio.asp).\n  -->\n    <ng-container *ngIf=\"rowIndex === 0\">\n        <td\n            *ngFor=\"let item of previousItems\"\n            aria-hidden=\"true\"\n            class=\"nx-calendar-adjacent-cell\"\n            [class.nx-calendar-body-disabled]=\"!item.enabled\"\n            (click)=\"_previousCellClicked(item)\"\n        >\n            <div aria-hidden=\"true\" class=\"nx-calendar-adjacent-cell-content\"> {{ item.displayValue }} </div>\n        </td>\n    </ng-container>\n\n    <td\n        *ngFor=\"let item of row; let colIndex = index\"\n        #cell\n        role=\"gridcell\"\n        class=\"nx-calendar-body-cell\"\n        [tabindex]=\"_isActiveCell(rowIndex, colIndex) ? 0 : -1\"\n        [class.nx-calendar-body-disabled]=\"!item.enabled\"\n        [class.nx-calendar-body-active]=\"_isActiveCell(rowIndex, colIndex)\"\n        [attr.aria-label]=\"item.ariaLabel\"\n        [attr.aria-disabled]=\"!item.enabled || null\"\n        (click)=\"_cellClicked(item)\"\n        [style.width.%]=\"100 / numCols\"\n    >\n        <div\n            class=\"nx-calendar-body-cell-content\"\n            [class.nx-calendar-body-selected]=\"selectedValue === item.value\"\n            [class.nx-calendar-body-today]=\"todayValue === item.value\"\n        >\n            {{item.displayValue}}\n        </div>\n    </td>\n\n    <ng-container *ngIf=\"rowIndex === _lastRowIndex && _lastRowOffset\">\n        <td\n            *ngFor=\"let item of followingItems[0]\"\n            aria-hidden=\"true\"\n            class=\"nx-calendar-adjacent-cell\"\n            [class.nx-calendar-body-disabled]=\"!item.enabled\"\n            (click)=\"_followingCellClicked(item)\"\n        >\n            <div aria-hidden=\"true\" class=\"nx-calendar-adjacent-cell-content\"> {{ item.displayValue }} </div>\n        </td>\n    </ng-container>\n</tr>\n\n<!-- \n  if there are still elements remaining in 'following-elements', then create some extra rows\n  to fill up the space\n-->\n<tr *ngFor=\"let row of _followingRows\" aria-hidden=\"true\">\n    <td *ngFor=\"let item of row\" class=\"nx-calendar-adjacent-cell\" [class.nx-calendar-body-disabled]=\"!item.enabled\" (click)=\"_followingCellClicked(item)\">\n        <div class=\"nx-calendar-adjacent-cell-content\"> {{ item.displayValue }} </div>\n    </td>\n</tr>\n", styles: [".nx-calendar-body-cell,.nx-calendar-adjacent-cell{position:relative;height:0;line-height:0;text-align:center;outline:none;vertical-align:text-bottom;cursor:pointer}.nx-calendar-body-disabled{cursor:default}.nx-calendar-body-cell-content{display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:40px;height:40px;margin:0 auto;font-size:var(--datefield-cell-font-size);line-height:var(--datefield-cell-line-height);font-weight:var(--datefield-cell-font-weight);letter-spacing:var(--datefield-cell-letter-spacing);color:var(--datefield-cell-color);border-radius:50%;line-height:1;box-shadow:0 0 0 6px transparent}@media screen and (-ms-high-contrast: active){.nx-calendar-body-cell-content{color:buttonText}}.nx-calendar-body-cell-content.nx-calendar-body-selected{color:var(--datefield-cell-selected-color);background-color:var(--datefield-cell-selected-background-color)}@media screen and (-ms-high-contrast: active){.nx-calendar-body-cell-content.nx-calendar-body-selected{-ms-high-contrast-adjust:none;background-color:highlight;color:highlightText}}.nx-calendar-body-cell-content.nx-calendar-body-today{color:var(--datefield-controls-color)!important}.nx-calendar-body-cell-content.nx-calendar-body-today:after{content:\"\";display:block;position:absolute;width:4px;height:4px;margin-top:24px;background-color:var(--datefield-controls-color);border-radius:50%}.nx-calendar-body-cell-content.nx-calendar-body-today.nx-calendar-body-selected{color:var(--datefield-cell-selected-color)!important}.nx-calendar-body-cell-content.nx-calendar-body-today.nx-calendar-body-selected:after{background-color:var(--datefield-cell-selected-color)}.nx-calendar-body-disabled>.nx-calendar-body-cell-content:not(.nx-calendar-body-selected){color:var(--datefield-cell-disabled-color);font-weight:400}@media screen and (-ms-high-contrast: active){.nx-calendar-body-disabled>.nx-calendar-body-cell-content:not(.nx-calendar-body-selected){color:GrayText}}:not(.nx-calendar-body-disabled):hover>.nx-calendar-body-cell-content:not(.nx-calendar-body-selected),:not(.nx-calendar-body-disabled):hover>.nx-calendar-adjacent-cell-content,.nx-calendar-body-active:not(.nx-calendar-body-disabled)>.nx-calendar-body-cell-content:not(.nx-calendar-body-selected),.nx-calendar-body-active:not(.nx-calendar-body-disabled)>.nx-calendar-adjacent-cell-content{color:var(--datefield-cell-hover-color);background-color:var(--datefield-cell-hover-background-color)}@media screen and (-ms-high-contrast: active){:not(.nx-calendar-body-disabled):hover>.nx-calendar-body-cell-content:not(.nx-calendar-body-selected),:not(.nx-calendar-body-disabled):hover>.nx-calendar-adjacent-cell-content,.nx-calendar-body-active:not(.nx-calendar-body-disabled)>.nx-calendar-body-cell-content:not(.nx-calendar-body-selected),.nx-calendar-body-active:not(.nx-calendar-body-disabled)>.nx-calendar-adjacent-cell-content{-ms-high-contrast-adjust:none;background-color:highlight;color:highlightText}}.nx-calendar-body-cell.cdk-keyboard-focused .nx-calendar-body-cell-content{box-shadow:var(--focus-box-shadow)}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-calendar-body-cell.cdk-keyboard-focused .nx-calendar-body-cell-content{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}.nx-calendar-body-cell.cdk-keyboard-focused.nx-calendar-body-disabled .nx-calendar-body-cell-content{color:var(--datefield-cell-disabled-color)}.nx-calendar-body-cell.cdk-keyboard-focused .nx-calendar-body-cell-content:not(.nx-calendar-body-selected){background-color:var(--datefield-cell-focused-background-color)}@media screen and (-ms-high-contrast: active){.nx-calendar-body-cell.cdk-keyboard-focused .nx-calendar-body-cell-content:not(.nx-calendar-body-selected){background-color:highlight}}.nx-calendar-adjacent-cell-content{display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:40px;height:40px;margin:0 auto;font-size:var(--datefield-cell-font-size);line-height:var(--datefield-cell-line-height);font-weight:var(--datefield-cell-font-weight);letter-spacing:var(--datefield-cell-letter-spacing);font-weight:400;color:var(--datefield-cell-disabled-color);border-radius:50%;line-height:1}@media screen and (-ms-high-contrast: active){.nx-calendar-adjacent-cell-content{color:GrayText}}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.NgZone }, { type: i1.FocusMonitor }]; }, propDecorators: { label: [{
                type: Input
            }], rows: [{
                type: Input
            }], todayValue: [{
                type: Input
            }], selectedValue: [{
                type: Input
            }], numCols: [{
                type: Input
            }], allowDisabledSelection: [{
                type: Input
            }], activeCell: [{
                type: Input
            }], previousItems: [{
                type: Input
            }], followingItems: [{
                type: Input
            }], selectedValueChange: [{
                type: Output
            }], selectedValueChangeToPrevious: [{
                type: Output
            }], selectedValueChangeToFollowing: [{
                type: Output
            }], _cells: [{
                type: ViewChildren,
                args: ['cell']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXItYm9keS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWFxdWlsYS9zcmMvZGF0ZWZpZWxkL2RhdGVwaWNrZXIvY2FsZW5kYXItYm9keS50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWFxdWlsYS9zcmMvZGF0ZWZpZWxkL2RhdGVwaWNrZXIvY2FsZW5kYXItYm9keS5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVNBLE9BQU8sRUFFSCx1QkFBdUIsRUFDdkIsU0FBUyxFQUVULFlBQVksRUFDWixLQUFLLEVBR0wsTUFBTSxFQUVOLFlBQVksR0FDZixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7QUFFakQ7OztHQUdHO0FBQ0gsTUFBTSxPQUFPLGNBQWM7SUFDdkIsWUFBbUIsS0FBYSxFQUFTLFlBQW9CLEVBQVMsU0FBa0IsRUFBUyxPQUFpQjtRQUEvRixVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQVMsaUJBQVksR0FBWixZQUFZLENBQVE7UUFBUyxjQUFTLEdBQVQsU0FBUyxDQUFTO1FBQVMsWUFBTyxHQUFQLE9BQU8sQ0FBVTtJQUFHLENBQUM7Q0FDekg7QUFFRDs7O0dBR0c7QUFhSCxNQUFNLE9BQU8sdUJBQXVCO0lBNENoQyxZQUFvQixXQUF1QixFQUFVLE9BQWUsRUFBVSxhQUEyQjtRQUFyRixnQkFBVyxHQUFYLFdBQVcsQ0FBWTtRQUFVLFlBQU8sR0FBUCxPQUFPLENBQVE7UUFBVSxrQkFBYSxHQUFiLGFBQWEsQ0FBYztRQS9CekcsMENBQTBDO1FBQ2pDLFlBQU8sR0FBRyxDQUFDLENBQUM7UUFFckIsb0RBQW9EO1FBQzNDLDJCQUFzQixHQUFHLEtBQUssQ0FBQztRQUV4Qyx1REFBdUQ7UUFDOUMsZUFBVSxHQUFHLENBQUMsQ0FBQztRQUV4QixpRUFBaUU7UUFDeEQsa0JBQWEsR0FBcUIsRUFBRSxDQUFDO1FBRTlDLGdFQUFnRTtRQUN2RCxtQkFBYyxHQUF1QixDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRW5ELHNEQUFzRDtRQUNuQyx3QkFBbUIsR0FBeUIsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUUxRiwrREFBK0Q7UUFDNUMsa0NBQTZCLEdBQXlCLElBQUksWUFBWSxFQUFVLENBQUM7UUFFcEcsZ0VBQWdFO1FBQzdDLG1DQUE4QixHQUF5QixJQUFJLFlBQVksRUFBVSxDQUFDO1FBT3BGLGVBQVUsR0FBRyxJQUFJLE9BQU8sRUFBUSxDQUFDO0lBRTBELENBQUM7SUFFN0csZUFBZTtRQUNYLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUM5RCxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7UUFFbEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDckUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQzdFLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUNsQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDbEUsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsV0FBVztRQUNQLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUMzQixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDekUsQ0FBQztJQUVELG9CQUFvQixDQUFDLElBQW9CO1FBQ3JDLElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQy9DLE9BQU87U0FDVjtRQUNELElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFFRCxZQUFZLENBQUMsSUFBb0I7UUFDN0IsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDL0MsT0FBTztTQUNWO1FBQ0QsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVELHFCQUFxQixDQUFDLElBQW9CO1FBQ3RDLElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQy9DLE9BQU87U0FDVjtRQUNELElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pELENBQUM7SUFFRCwyRUFBMkU7SUFDM0UsSUFBSSxlQUFlO1FBQ2YsT0FBTyxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzdGLENBQUM7SUFFRCwwRUFBMEU7SUFDMUUsSUFBSSxjQUFjO1FBQ2QsT0FBTyxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ25JLENBQUM7SUFFRCxpQ0FBaUM7SUFDakMsSUFBSSxhQUFhO1FBQ2IsT0FBTyxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDeEQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBSSxjQUFjO1FBQ2QsSUFBSSxJQUFJLENBQUMsY0FBYyxFQUFFLE1BQU0sRUFBRTtZQUM3QixpRUFBaUU7WUFDakUsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTyxFQUFFO2dCQUM5QyxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQ25FO1lBQ0QsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDO1NBQzlCO1FBRUQsT0FBTyxFQUFFLENBQUM7SUFDZCxDQUFDO0lBRUQsYUFBYSxDQUFDLFFBQWdCLEVBQUUsUUFBZ0I7UUFDNUMsSUFBSSxVQUFVLEdBQUcsUUFBUSxHQUFHLElBQUksQ0FBQyxPQUFPLEdBQUcsUUFBUSxDQUFDO1FBRXBELHNFQUFzRTtRQUN0RSxJQUFJLFFBQVEsRUFBRTtZQUNWLFVBQVUsSUFBSSxJQUFJLENBQUMsZUFBZSxDQUFDO1NBQ3RDO1FBRUQsT0FBTyxVQUFVLEtBQUssSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUMxQyxDQUFDO0lBRUQsa0VBQWtFO0lBQ2xFLGdCQUFnQjtRQUNaLElBQUksQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFO1lBQ2hDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUTtpQkFDaEIsWUFBWSxFQUFFO2lCQUNkLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ2IsU0FBUyxDQUFDLEdBQUcsRUFBRTtnQkFDWixJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNyRixDQUFDLENBQUMsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7b0hBdklRLHVCQUF1Qjt3R0FBdkIsdUJBQXVCLHd0QkNqRHBDLHN2RkFnRUE7MkZEZmEsdUJBQXVCO2tCQVpuQyxTQUFTOytCQUNJLG9CQUFvQixRQUd4Qjt3QkFDRixLQUFLLEVBQUUsa0JBQWtCO3dCQUN6QixJQUFJLEVBQUUsTUFBTTt3QkFDWixvQkFBb0IsRUFBRSxNQUFNO3FCQUMvQixZQUNTLGdCQUFnQixtQkFDVCx1QkFBdUIsQ0FBQyxNQUFNO2lKQUl0QyxLQUFLO3NCQUFiLEtBQUs7Z0JBR0csSUFBSTtzQkFBWixLQUFLO2dCQUdHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBR0csYUFBYTtzQkFBckIsS0FBSztnQkFHRyxPQUFPO3NCQUFmLEtBQUs7Z0JBR0csc0JBQXNCO3NCQUE5QixLQUFLO2dCQUdHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBR0csYUFBYTtzQkFBckIsS0FBSztnQkFHRyxjQUFjO3NCQUF0QixLQUFLO2dCQUdhLG1CQUFtQjtzQkFBckMsTUFBTTtnQkFHWSw2QkFBNkI7c0JBQS9DLE1BQU07Z0JBR1ksOEJBQThCO3NCQUFoRCxNQUFNO2dCQUVlLE1BQU07c0JBQTNCLFlBQVk7dUJBQUMsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBHb29nbGUgTExDIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9hbmd1bGFyLmlvL2xpY2Vuc2VcbiAqL1xuXG5pbXBvcnQgeyBGb2N1c01vbml0b3IgfSBmcm9tICdAYW5ndWxhci9jZGsvYTExeSc7XG5pbXBvcnQge1xuICAgIEFmdGVyVmlld0luaXQsXG4gICAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gICAgQ29tcG9uZW50LFxuICAgIEVsZW1lbnRSZWYsXG4gICAgRXZlbnRFbWl0dGVyLFxuICAgIElucHV0LFxuICAgIE5nWm9uZSxcbiAgICBPbkRlc3Ryb3ksXG4gICAgT3V0cHV0LFxuICAgIFF1ZXJ5TGlzdCxcbiAgICBWaWV3Q2hpbGRyZW4sXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZSwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG4vKipcbiAqIEFuIGludGVybmFsIGNsYXNzIHRoYXQgcmVwcmVzZW50cyB0aGUgZGF0YSBjb3JyZXNwb25kaW5nIHRvIGEgc2luZ2xlIGNhbGVuZGFyIGNlbGwuXG4gKiBAZG9jcy1wcml2YXRlXG4gKi9cbmV4cG9ydCBjbGFzcyBOeENhbGVuZGFyQ2VsbCB7XG4gICAgY29uc3RydWN0b3IocHVibGljIHZhbHVlOiBudW1iZXIsIHB1YmxpYyBkaXNwbGF5VmFsdWU6IHN0cmluZywgcHVibGljIGFyaWFMYWJlbD86IHN0cmluZywgcHVibGljIGVuYWJsZWQ/OiBib29sZWFuKSB7fVxufVxuXG4vKipcbiAqIEFuIGludGVybmFsIGNvbXBvbmVudCB1c2VkIHRvIGRpc3BsYXkgY2FsZW5kYXIgZGF0YSBpbiBhIHRhYmxlLlxuICogQGRvY3MtcHJpdmF0ZVxuICovXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ1tueC1jYWxlbmRhci1ib2R5XScsXG4gICAgdGVtcGxhdGVVcmw6ICdjYWxlbmRhci1ib2R5Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWydjYWxlbmRhci1ib2R5LnNjc3MnXSxcbiAgICBob3N0OiB7XG4gICAgICAgIGNsYXNzOiAnbngtY2FsZW5kYXItYm9keScsXG4gICAgICAgIHJvbGU6ICdncmlkJyxcbiAgICAgICAgJ2F0dHIuYXJpYS1yZWFkb25seSc6ICd0cnVlJyxcbiAgICB9LFxuICAgIGV4cG9ydEFzOiAnbnhDYWxlbmRhckJvZHknLFxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBOeENhbGVuZGFyQm9keUNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG4gICAgLyoqIFRoZSBsYWJlbCBmb3IgdGhlIHRhYmxlLiAoZS5nLiBcIkphbiAyMDE3XCIpLiAqL1xuICAgIEBJbnB1dCgpIGxhYmVsITogc3RyaW5nO1xuXG4gICAgLyoqIFRoZSBjZWxscyB0byBkaXNwbGF5IGluIHRoZSB0YWJsZS4gKi9cbiAgICBASW5wdXQoKSByb3dzITogTnhDYWxlbmRhckNlbGxbXVtdO1xuXG4gICAgLyoqIFRoZSB2YWx1ZSBpbiB0aGUgdGFibGUgdGhhdCBjb3JyZXNwb25kcyB0byB0b2RheS4gKi9cbiAgICBASW5wdXQoKSB0b2RheVZhbHVlITogbnVtYmVyO1xuXG4gICAgLyoqIFRoZSB2YWx1ZSBpbiB0aGUgdGFibGUgdGhhdCBpcyBjdXJyZW50bHkgc2VsZWN0ZWQuICovXG4gICAgQElucHV0KCkgc2VsZWN0ZWRWYWx1ZSE6IG51bWJlcjtcblxuICAgIC8qKiBUaGUgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIHRhYmxlLiAqL1xuICAgIEBJbnB1dCgpIG51bUNvbHMgPSA3O1xuXG4gICAgLyoqIFdoZXRoZXIgdG8gYWxsb3cgc2VsZWN0aW9uIG9mIGRpc2FibGVkIGNlbGxzLiAqL1xuICAgIEBJbnB1dCgpIGFsbG93RGlzYWJsZWRTZWxlY3Rpb24gPSBmYWxzZTtcblxuICAgIC8qKiBUaGUgY2VsbCBudW1iZXIgb2YgdGhlIGFjdGl2ZSBjZWxsIGluIHRoZSB0YWJsZS4gKi9cbiAgICBASW5wdXQoKSBhY3RpdmVDZWxsID0gMDtcblxuICAgIC8qKiBUaGUgaXRlbXMgdG8gZGlzcGxheSBpbiB0aGUgZmlyc3Qgcm93IGluIHRoZSBvZmZzZXQgc3BhY2UuICovXG4gICAgQElucHV0KCkgcHJldmlvdXNJdGVtczogTnhDYWxlbmRhckNlbGxbXSA9IFtdO1xuXG4gICAgLyoqIFRoZSBpdGVtcyB0byBkaXNwbGF5IGluIHRoZSBsYXN0IHJvdyBpbiB0aGUgb2Zmc2V0IHNwYWNlLiAqL1xuICAgIEBJbnB1dCgpIGZvbGxvd2luZ0l0ZW1zOiBOeENhbGVuZGFyQ2VsbFtdW10gPSBbW11dO1xuXG4gICAgLyoqIEVtaXRzIHdoZW4gYSBuZXcgdmFsdWUgb3V0IG9mIHJvd3MgaXMgc2VsZWN0ZWQuICovXG4gICAgQE91dHB1dCgpIHJlYWRvbmx5IHNlbGVjdGVkVmFsdWVDaGFuZ2U6IEV2ZW50RW1pdHRlcjxudW1iZXI+ID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XG5cbiAgICAvKiogRW1pdHMgd2hlbiBhIG5ldyB2YWx1ZSBvdXQgb2YgcHJldmlvdXNJdGVtcyBpcyBzZWxlY3RlZC4gKi9cbiAgICBAT3V0cHV0KCkgcmVhZG9ubHkgc2VsZWN0ZWRWYWx1ZUNoYW5nZVRvUHJldmlvdXM6IEV2ZW50RW1pdHRlcjxudW1iZXI+ID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XG5cbiAgICAvKiogRW1pdHMgd2hlbiBhIG5ldyB2YWx1ZSBvdXQgb2YgZm9sbG93aW5nSXRlbXMgaXMgc2VsZWN0ZWQuICovXG4gICAgQE91dHB1dCgpIHJlYWRvbmx5IHNlbGVjdGVkVmFsdWVDaGFuZ2VUb0ZvbGxvd2luZzogRXZlbnRFbWl0dGVyPG51bWJlcj4gPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlcj4oKTtcblxuICAgIEBWaWV3Q2hpbGRyZW4oJ2NlbGwnKSBfY2VsbHMhOiBRdWVyeUxpc3Q8RWxlbWVudFJlZjxIVE1MRWxlbWVudD4+O1xuXG4gICAgLyoqIFByZXNlcnZlcyB0aGUgY3VycmVudCB2YWx1ZSBvZiB0aGUgX2NlbGxzIFZpZXdDaGlsZHJlbiBpbiBjYXNlIF9jZWxscyBjaGFuZ2VzLiAqL1xuICAgIHByaXZhdGUgX2NlbGxzUHJldmlvdXMhOiBRdWVyeUxpc3Q8RWxlbWVudFJlZjxIVE1MRWxlbWVudD4+O1xuXG4gICAgcHJpdmF0ZSByZWFkb25seSBfZGVzdHJveWVkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX2VsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIHByaXZhdGUgX25nWm9uZTogTmdab25lLCBwcml2YXRlIF9mb2N1c01vbml0b3I6IEZvY3VzTW9uaXRvcikge31cblxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgdGhpcy5fY2VsbHMuZm9yRWFjaChjZWxsID0+IHRoaXMuX2ZvY3VzTW9uaXRvci5tb25pdG9yKGNlbGwpKTtcbiAgICAgICAgdGhpcy5fY2VsbHNQcmV2aW91cyA9IHRoaXMuX2NlbGxzO1xuXG4gICAgICAgIHRoaXMuX2NlbGxzLmNoYW5nZXMucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkKSkuc3Vic2NyaWJlKGNoYW5nZXMgPT4ge1xuICAgICAgICAgICAgdGhpcy5fY2VsbHNQcmV2aW91cy5mb3JFYWNoKGNlbGwgPT4gdGhpcy5fZm9jdXNNb25pdG9yLnN0b3BNb25pdG9yaW5nKGNlbGwpKTtcbiAgICAgICAgICAgIHRoaXMuX2NlbGxzUHJldmlvdXMgPSB0aGlzLl9jZWxscztcbiAgICAgICAgICAgIHRoaXMuX2NlbGxzLmZvckVhY2goY2VsbCA9PiB0aGlzLl9mb2N1c01vbml0b3IubW9uaXRvcihjZWxsKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLl9kZXN0cm95ZWQubmV4dCgpO1xuICAgICAgICB0aGlzLl9kZXN0cm95ZWQuY29tcGxldGUoKTtcbiAgICAgICAgdGhpcy5fY2VsbHMuZm9yRWFjaChjZWxsID0+IHRoaXMuX2ZvY3VzTW9uaXRvci5zdG9wTW9uaXRvcmluZyhjZWxsKSk7XG4gICAgfVxuXG4gICAgX3ByZXZpb3VzQ2VsbENsaWNrZWQoY2VsbDogTnhDYWxlbmRhckNlbGwpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLmFsbG93RGlzYWJsZWRTZWxlY3Rpb24gJiYgIWNlbGwuZW5hYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZUNoYW5nZVRvUHJldmlvdXMuZW1pdChjZWxsLnZhbHVlKTtcbiAgICB9XG5cbiAgICBfY2VsbENsaWNrZWQoY2VsbDogTnhDYWxlbmRhckNlbGwpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLmFsbG93RGlzYWJsZWRTZWxlY3Rpb24gJiYgIWNlbGwuZW5hYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZUNoYW5nZS5lbWl0KGNlbGwudmFsdWUpO1xuICAgIH1cblxuICAgIF9mb2xsb3dpbmdDZWxsQ2xpY2tlZChjZWxsOiBOeENhbGVuZGFyQ2VsbCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuYWxsb3dEaXNhYmxlZFNlbGVjdGlvbiAmJiAhY2VsbC5lbmFibGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlQ2hhbmdlVG9Gb2xsb3dpbmcuZW1pdChjZWxsLnZhbHVlKTtcbiAgICB9XG5cbiAgICAvKiogVGhlIG51bWJlciBvZiBibGFuayBjZWxscyB0byBwdXQgYXQgdGhlIGJlZ2lubmluZyBmb3IgdGhlIGZpcnN0IHJvdy4gKi9cbiAgICBnZXQgX2ZpcnN0Um93T2Zmc2V0KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvd3M/Lmxlbmd0aCAmJiB0aGlzLnJvd3NbMF0ubGVuZ3RoID8gdGhpcy5udW1Db2xzIC0gdGhpcy5yb3dzWzBdLmxlbmd0aCA6IDA7XG4gICAgfVxuXG4gICAgLyoqIFRoZSBudW1iZXIgb2YgYmxhbmsgY2VsbHMgdG8gcHV0IGF0IHRoZSBlbmQgb2YgdGhlIGxhc3QgZmlsbGVkIHJvdy4gKi9cbiAgICBnZXQgX2xhc3RSb3dPZmZzZXQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm93cz8ubGVuZ3RoICYmIHRoaXMucm93c1t0aGlzLnJvd3MubGVuZ3RoIC0gMV0ubGVuZ3RoID8gdGhpcy5udW1Db2xzIC0gdGhpcy5yb3dzW3RoaXMucm93cy5sZW5ndGggLSAxXS5sZW5ndGggOiAwO1xuICAgIH1cblxuICAgIC8qKiBUaGUgaW5kZXggb2YgdGhlIGxhc3Qgcm93LiAqL1xuICAgIGdldCBfbGFzdFJvd0luZGV4KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvd3M/Lmxlbmd0aCA/IHRoaXMucm93cy5sZW5ndGggLSAxIDogMDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgZm9sbG93aW5nIGZ1bGwgcm93cyB0byBkaXNwbGF5IGFuZCBmaWxsIHVwIHRoZSBjYWxlbmRhci5cbiAgICAgKi9cbiAgICBnZXQgX2ZvbGxvd2luZ1Jvd3MoKTogTnhDYWxlbmRhckNlbGxbXVtdIHtcbiAgICAgICAgaWYgKHRoaXMuZm9sbG93aW5nSXRlbXM/Lmxlbmd0aCkge1xuICAgICAgICAgICAgLy8gaWYgZmlyc3Qgcm93IGlzIG5vdCBhIGZ1bGwgcm93ID0+IGRpc3BsYXkgdGhlbSBpbiBvZmZzZXQgc3BhY2VcbiAgICAgICAgICAgIGlmICh0aGlzLmZvbGxvd2luZ0l0ZW1zWzBdLmxlbmd0aCA8IHRoaXMubnVtQ29scykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZvbGxvd2luZ0l0ZW1zLnNsaWNlKDEsIHRoaXMuZm9sbG93aW5nSXRlbXMubGVuZ3RoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZvbGxvd2luZ0l0ZW1zO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIF9pc0FjdGl2ZUNlbGwocm93SW5kZXg6IG51bWJlciwgY29sSW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgICAgICBsZXQgY2VsbE51bWJlciA9IHJvd0luZGV4ICogdGhpcy5udW1Db2xzICsgY29sSW5kZXg7XG5cbiAgICAgICAgLy8gQWNjb3VudCBmb3IgdGhlIGZhY3QgdGhhdCB0aGUgZmlyc3Qgcm93IG1heSBub3QgaGF2ZSBhcyBtYW55IGNlbGxzLlxuICAgICAgICBpZiAocm93SW5kZXgpIHtcbiAgICAgICAgICAgIGNlbGxOdW1iZXIgLT0gdGhpcy5fZmlyc3RSb3dPZmZzZXQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY2VsbE51bWJlciA9PT0gdGhpcy5hY3RpdmVDZWxsO1xuICAgIH1cblxuICAgIC8qKiBGb2N1c2VzIHRoZSBhY3RpdmUgY2VsbCBhZnRlciB0aGUgbWljcm90YXNrIHF1ZXVlIGlzIGVtcHR5LiAqL1xuICAgIF9mb2N1c0FjdGl2ZUNlbGwoKSB7XG4gICAgICAgIHRoaXMuX25nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9uZ1pvbmUub25TdGFibGVcbiAgICAgICAgICAgICAgICAuYXNPYnNlcnZhYmxlKClcbiAgICAgICAgICAgICAgICAucGlwZSh0YWtlKDEpKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLm54LWNhbGVuZGFyLWJvZHktYWN0aXZlJykuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIiwiPCEtLSBDcmVhdGUgdGhlIGZpcnN0IGFuZCBsYXN0IHJvdyBzZXBhcmF0ZWx5IHNvIHdlIGNhbiBpbmNsdWRlIHNwZWNpYWwgc3BhY2VyIGNlbGxzLiAtLT5cbjx0ciAqbmdGb3I9XCJsZXQgcm93IG9mIHJvd3M7IGxldCByb3dJbmRleCA9IGluZGV4XCIgcm9sZT1cInJvd1wiPlxuICAgIDwhLS1cbiAgICBXZSBtYXJrIHRoaXMgY2VsbCBhcyBhcmlhLWhpZGRlbiBzbyBpdCBkb2Vzbid0IGdldCByZWFkIG91dCBhcyBvbmUgb2YgdGhlIGRheXMgaW4gdGhlIHdlZWsuXG4gICAgVGhlIGFzcGVjdCByYXRpbyBvZiB0aGUgdGFibGUgY2VsbHMgaXMgbWFpbnRhaW5lZCBieSBzZXR0aW5nIHRoZSB0b3AgYW5kIGJvdHRvbSBwYWRkaW5nIGFzIGFcbiAgICBwZXJjZW50YWdlIG9mIHRoZSB3aWR0aCAoYSB2YXJpYW50IG9mIHRoZSB0cmljayBkZXNjcmliZWQgaGVyZTpcbiAgICBodHRwczovL3d3dy53M3NjaG9vbHMuY29tL2hvd3RvL2hvd3RvX2Nzc19hc3BlY3RfcmF0aW8uYXNwKS5cbiAgLS0+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInJvd0luZGV4ID09PSAwXCI+XG4gICAgICAgIDx0ZFxuICAgICAgICAgICAgKm5nRm9yPVwibGV0IGl0ZW0gb2YgcHJldmlvdXNJdGVtc1wiXG4gICAgICAgICAgICBhcmlhLWhpZGRlbj1cInRydWVcIlxuICAgICAgICAgICAgY2xhc3M9XCJueC1jYWxlbmRhci1hZGphY2VudC1jZWxsXCJcbiAgICAgICAgICAgIFtjbGFzcy5ueC1jYWxlbmRhci1ib2R5LWRpc2FibGVkXT1cIiFpdGVtLmVuYWJsZWRcIlxuICAgICAgICAgICAgKGNsaWNrKT1cIl9wcmV2aW91c0NlbGxDbGlja2VkKGl0ZW0pXCJcbiAgICAgICAgPlxuICAgICAgICAgICAgPGRpdiBhcmlhLWhpZGRlbj1cInRydWVcIiBjbGFzcz1cIm54LWNhbGVuZGFyLWFkamFjZW50LWNlbGwtY29udGVudFwiPiB7eyBpdGVtLmRpc3BsYXlWYWx1ZSB9fSA8L2Rpdj5cbiAgICAgICAgPC90ZD5cbiAgICA8L25nLWNvbnRhaW5lcj5cblxuICAgIDx0ZFxuICAgICAgICAqbmdGb3I9XCJsZXQgaXRlbSBvZiByb3c7IGxldCBjb2xJbmRleCA9IGluZGV4XCJcbiAgICAgICAgI2NlbGxcbiAgICAgICAgcm9sZT1cImdyaWRjZWxsXCJcbiAgICAgICAgY2xhc3M9XCJueC1jYWxlbmRhci1ib2R5LWNlbGxcIlxuICAgICAgICBbdGFiaW5kZXhdPVwiX2lzQWN0aXZlQ2VsbChyb3dJbmRleCwgY29sSW5kZXgpID8gMCA6IC0xXCJcbiAgICAgICAgW2NsYXNzLm54LWNhbGVuZGFyLWJvZHktZGlzYWJsZWRdPVwiIWl0ZW0uZW5hYmxlZFwiXG4gICAgICAgIFtjbGFzcy5ueC1jYWxlbmRhci1ib2R5LWFjdGl2ZV09XCJfaXNBY3RpdmVDZWxsKHJvd0luZGV4LCBjb2xJbmRleClcIlxuICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIml0ZW0uYXJpYUxhYmVsXCJcbiAgICAgICAgW2F0dHIuYXJpYS1kaXNhYmxlZF09XCIhaXRlbS5lbmFibGVkIHx8IG51bGxcIlxuICAgICAgICAoY2xpY2spPVwiX2NlbGxDbGlja2VkKGl0ZW0pXCJcbiAgICAgICAgW3N0eWxlLndpZHRoLiVdPVwiMTAwIC8gbnVtQ29sc1wiXG4gICAgPlxuICAgICAgICA8ZGl2XG4gICAgICAgICAgICBjbGFzcz1cIm54LWNhbGVuZGFyLWJvZHktY2VsbC1jb250ZW50XCJcbiAgICAgICAgICAgIFtjbGFzcy5ueC1jYWxlbmRhci1ib2R5LXNlbGVjdGVkXT1cInNlbGVjdGVkVmFsdWUgPT09IGl0ZW0udmFsdWVcIlxuICAgICAgICAgICAgW2NsYXNzLm54LWNhbGVuZGFyLWJvZHktdG9kYXldPVwidG9kYXlWYWx1ZSA9PT0gaXRlbS52YWx1ZVwiXG4gICAgICAgID5cbiAgICAgICAgICAgIHt7aXRlbS5kaXNwbGF5VmFsdWV9fVxuICAgICAgICA8L2Rpdj5cbiAgICA8L3RkPlxuXG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInJvd0luZGV4ID09PSBfbGFzdFJvd0luZGV4ICYmIF9sYXN0Um93T2Zmc2V0XCI+XG4gICAgICAgIDx0ZFxuICAgICAgICAgICAgKm5nRm9yPVwibGV0IGl0ZW0gb2YgZm9sbG93aW5nSXRlbXNbMF1cIlxuICAgICAgICAgICAgYXJpYS1oaWRkZW49XCJ0cnVlXCJcbiAgICAgICAgICAgIGNsYXNzPVwibngtY2FsZW5kYXItYWRqYWNlbnQtY2VsbFwiXG4gICAgICAgICAgICBbY2xhc3MubngtY2FsZW5kYXItYm9keS1kaXNhYmxlZF09XCIhaXRlbS5lbmFibGVkXCJcbiAgICAgICAgICAgIChjbGljayk9XCJfZm9sbG93aW5nQ2VsbENsaWNrZWQoaXRlbSlcIlxuICAgICAgICA+XG4gICAgICAgICAgICA8ZGl2IGFyaWEtaGlkZGVuPVwidHJ1ZVwiIGNsYXNzPVwibngtY2FsZW5kYXItYWRqYWNlbnQtY2VsbC1jb250ZW50XCI+IHt7IGl0ZW0uZGlzcGxheVZhbHVlIH19IDwvZGl2PlxuICAgICAgICA8L3RkPlxuICAgIDwvbmctY29udGFpbmVyPlxuPC90cj5cblxuPCEtLSBcbiAgaWYgdGhlcmUgYXJlIHN0aWxsIGVsZW1lbnRzIHJlbWFpbmluZyBpbiAnZm9sbG93aW5nLWVsZW1lbnRzJywgdGhlbiBjcmVhdGUgc29tZSBleHRyYSByb3dzXG4gIHRvIGZpbGwgdXAgdGhlIHNwYWNlXG4tLT5cbjx0ciAqbmdGb3I9XCJsZXQgcm93IG9mIF9mb2xsb3dpbmdSb3dzXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+XG4gICAgPHRkICpuZ0Zvcj1cImxldCBpdGVtIG9mIHJvd1wiIGNsYXNzPVwibngtY2FsZW5kYXItYWRqYWNlbnQtY2VsbFwiIFtjbGFzcy5ueC1jYWxlbmRhci1ib2R5LWRpc2FibGVkXT1cIiFpdGVtLmVuYWJsZWRcIiAoY2xpY2spPVwiX2ZvbGxvd2luZ0NlbGxDbGlja2VkKGl0ZW0pXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJueC1jYWxlbmRhci1hZGphY2VudC1jZWxsLWNvbnRlbnRcIj4ge3sgaXRlbS5kaXNwbGF5VmFsdWUgfX0gPC9kaXY+XG4gICAgPC90ZD5cbjwvdHI+XG4iXX0=