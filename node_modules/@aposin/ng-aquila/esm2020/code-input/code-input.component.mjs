import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { BACKSPACE, DOWN_ARROW, LEFT_ARROW, RIGHT_ARROW, SPACE, UP_ARROW } from '@angular/cdk/keycodes';
import { ChangeDetectionStrategy, Component, Input, Optional, Self } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "./code-input-intl";
import * as i3 from "@aposin/ng-aquila/utils";
import * as i4 from "@angular/common";
const DEFAULT_INPUT_LENGTH = 6;
const TAG_NAME_INPUT = 'INPUT';
const AUTO_UPPERCASE = 'upper';
const AUTO_LOWERCASE = 'lower';
const INPUT_FIELD_GAP = 'nx-code-input--field-with-gap';
export class NxCodeInputComponent {
    constructor(_cdr, _el, _control, _intl, _errorStateMatcher, _parentForm, _parentFormGroup) {
        this._cdr = _cdr;
        this._el = _el;
        this._control = _control;
        this._intl = _intl;
        this._errorStateMatcher = _errorStateMatcher;
        this._parentForm = _parentForm;
        this._parentFormGroup = _parentFormGroup;
        /** Whether the current input of the component has an error. */
        this.errorState = false;
        this._codeLength = DEFAULT_INPUT_LENGTH;
        this._type = 'text';
        this._isUpDown = false;
        this._tabindex = 0;
        /** The user input in array form */
        this._keyCode = new Array(DEFAULT_INPUT_LENGTH);
        this._focused = false;
        this._negative = false;
        this._disabled = false;
        /** @docs-private */
        this.propagateChange = (_) => { };
        /** @docs-private */
        this.propagateTouch = (_) => { };
        if (this._control) {
            // Note: we provide the value accessor through here, instead of
            // the `providers` to avoid running into a circular import.
            this._control.valueAccessor = this;
        }
    }
    /** The length of the code input. Default: 6. */
    set codeLength(value) {
        this._codeLength = value;
        this.setInputLength();
        this._cdr.markForCheck();
    }
    get codeLength() {
        return this._codeLength;
    }
    /** The type of HTML input */
    set type(value) {
        this._type = value;
        this._cdr.markForCheck();
    }
    get type() {
        return this._type;
    }
    /** Sets the tabindex of the contained input elements. */
    set tabindex(value) {
        this._tabindex = value;
        this._cdr.markForCheck();
    }
    get tabindex() {
        return this._tabindex;
    }
    /** Whether the form should auto capitalize or lowercase (optional). */
    set convertTo(value) {
        this._convertTo = value;
        this._cdr.markForCheck();
    }
    get convertTo() {
        return this._convertTo;
    }
    /** Whether the code input uses the negative set of styling. */
    set negative(value) {
        const newValue = coerceBooleanProperty(value);
        if (this._negative !== newValue) {
            this._negative = newValue;
            this._cdr.markForCheck();
        }
    }
    get negative() {
        return this._negative;
    }
    /** Whether the code input is disabled. */
    set disabled(value) {
        const newValue = coerceBooleanProperty(value);
        if (this._disabled !== newValue) {
            this._disabled = newValue;
            this._cdr.markForCheck();
        }
    }
    get disabled() {
        return this._disabled;
    }
    ngDoCheck() {
        if (this._control) {
            // We need to re-evaluate this on every change detection cycle, because there are some
            // error triggers that we can't subscribe to (e.g. parent form submissions). This means
            // that whatever logic is in here has to be super lean or we risk destroying the performance.
            this.updateErrorState();
        }
    }
    /** Sets the length of the input fields. */
    setInputLength() {
        if (this.codeLength) {
            this._keyCode = new Array(this.codeLength);
        }
        else {
            this._keyCode = new Array(DEFAULT_INPUT_LENGTH);
        }
    }
    /** Converts to upper or lowercase when enabled. */
    _convertLetterSize(value) {
        if (value === 'ß') {
            return value;
        }
        if (typeof value === 'string') {
            if (this.convertTo === AUTO_UPPERCASE) {
                return value.toUpperCase();
            }
            else if (this.convertTo === AUTO_LOWERCASE) {
                return value.toLowerCase();
            }
            return value;
        }
        return undefined;
    }
    /** Reacts to keydown event. */
    _keydownAction(event) {
        const targetElement = event.target;
        const previousInputField = targetElement.previousElementSibling;
        const nextInputField = targetElement.nextElementSibling;
        switch (event.keyCode) {
            case SPACE:
                return false;
            case BACKSPACE:
                if (targetElement.value === '') {
                    if (previousInputField && previousInputField.tagName === TAG_NAME_INPUT) {
                        this.selectInput(previousInputField);
                    }
                }
                break;
            case LEFT_ARROW:
                if (previousInputField && previousInputField.tagName === TAG_NAME_INPUT) {
                    event.preventDefault();
                    this.selectInput(previousInputField);
                }
                break;
            case RIGHT_ARROW:
                if (nextInputField && nextInputField.tagName === TAG_NAME_INPUT) {
                    this.selectInput(nextInputField);
                }
                event.preventDefault();
                break;
            case DOWN_ARROW:
                this._isUpDown = true;
                if (this._type === 'number' && (targetElement.value === '' || targetElement.value === '0')) {
                    event.preventDefault();
                }
                break;
            case UP_ARROW:
                this._isUpDown = true;
                if (this._type === 'number' && targetElement.value === '9') {
                    event.preventDefault();
                }
                break;
            default:
                break;
        }
    }
    /** Selects the value on click of an input field. */
    _selectText(event) {
        this.selectInput(event.target);
    }
    /** Automatically focuses and selects the next input on key input. */
    _selectNextInput(event) {
        const eventTarget = event.target;
        eventTarget.value = this._convertLetterSize(eventTarget.value.slice(0, 1));
        const currentIndex = Number(this._getFocusedInputIndex(event));
        // save in model with uppercase if needed
        this._keyCode[currentIndex] = eventTarget.value;
        this.propagateChange(this._keyCode.join(''));
        // don't jump to next input if the user uses UP/DOWn arrow (native behaviour)
        const focusNextInput = !(this._isUpDown && this.type === 'number');
        if (eventTarget.value && focusNextInput) {
            const nextInputField = eventTarget.nextSibling;
            if (nextInputField !== null && nextInputField.tagName === TAG_NAME_INPUT) {
                nextInputField.focus();
                if (nextInputField.value !== '') {
                    this.selectInput(nextInputField);
                }
            }
        }
        this._isUpDown = false;
    }
    /** Paste event to distribute content in input fields. */
    _pasteClipboard(event) {
        let copiedText = (event.clipboardData || window.clipboardData).getData('text');
        let copiedTextIndex = 0;
        const inputIndex = Number(this._getFocusedInputIndex(event));
        copiedText = this.type === 'number' ? this._formatNumberInput(copiedText) : copiedText;
        for (let i = inputIndex; i < this.codeLength; i++) {
            this._keyCode[i] = this._convertLetterSize(copiedText[copiedTextIndex]);
            copiedTextIndex++;
        }
        this.propagateChange(this._keyCode.join(''));
        if (inputIndex + copiedText.length < this.codeLength) {
            this._el.nativeElement.children.item(inputIndex + copiedText.length).focus();
        }
        else {
            this._el.nativeElement.children.item(this.codeLength - 1).focus();
        }
        event.preventDefault();
    }
    /** Returns the index of the code input, which is currently focused. */
    _getFocusedInputIndex(event) {
        let inputIndex;
        for (let i = 0; i < this._el.nativeElement.children.length; i++) {
            if (event.srcElement === this._el.nativeElement.children.item(i)) {
                inputIndex = i;
            }
        }
        return inputIndex;
    }
    /** Removes all characters from the input except for numbers [0-9]. */
    _formatNumberInput(copiedText) {
        let formattedInput = '';
        for (let i = 0; i < copiedText.length; i++) {
            if (copiedText[i].match(/\d$/)) {
                formattedInput += copiedText[i];
            }
        }
        return formattedInput;
    }
    /** Triggers when an input field is blurred. */
    _onBlur() {
        this._focused = false;
        setTimeout(() => {
            if (!this._focused) {
                this.propagateTouch(this._keyCode.join(''));
            }
            this._cdr.markForCheck();
        });
    }
    /** Sets _focused state and makes valid. */
    _setFocusState() {
        this._focused = true;
    }
    /**
     * Disables the code input. Part of the ControlValueAccessor interface required
     * to integrate with Angular's core forms API.
     *
     * @param isDisabled Sets whether the component is disabled.
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
        this._cdr.markForCheck();
    }
    /** Sets initial value, used by ControlValueAccessor. */
    writeValue(value) {
        if (value) {
            const valueAsArray = value.split('').slice(0, this.codeLength);
            for (let i = 0; i < this.codeLength; i++) {
                this._keyCode[i] = valueAsArray[i];
            }
        }
        else {
            this.setInputLength();
        }
        this._cdr.markForCheck();
    }
    _trackByKeyCode(index, item) {
        return index;
    }
    /** Adds a gap to input fields when appropriate. */
    _inputGap(index) {
        switch (this.codeLength) {
            case 4:
            case 6:
            case 8:
                if (index === this.codeLength / 2) {
                    return INPUT_FIELD_GAP;
                }
                return '';
            default:
                return '';
        }
    }
    registerOnChange(fn) {
        this.propagateChange = fn;
    }
    registerOnTouched(fn) {
        this.propagateTouch = fn;
    }
    /** @docs-private */
    updateErrorState() {
        const oldState = this.errorState;
        const parent = this._parentFormGroup || this._parentForm;
        const control = this._control ? this._control.control : null;
        const newState = this._errorStateMatcher.isErrorState(control, parent);
        if (newState !== oldState) {
            this.errorState = newState;
        }
    }
    getAriaLabel(keyIndex) {
        return `${this._intl.inputFieldAriaLabel} ${keyIndex + 1} ${this._intl.ofLabel} ${this._keyCode.length}`;
    }
    /** @docs-private
     * Workaround preventing the selection error because the `setSelectionRange` is not supported on input['type=number']
     * */
    selectInput(input) {
        input.focus();
        try {
            input.setSelectionRange(0, input.value.length);
        }
        catch (err) {
            if (err instanceof DOMException && err.name === 'InvalidStateError') {
                // setSelectionRange does not apply
            }
            else {
                throw err;
            }
        }
    }
}
NxCodeInputComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxCodeInputComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: i0.ElementRef }, { token: i1.NgControl, optional: true, self: true }, { token: i2.NxCodeInputIntl }, { token: i3.ErrorStateMatcher }, { token: i1.NgForm, optional: true }, { token: i1.FormGroupDirective, optional: true }], target: i0.ɵɵFactoryTarget.Component });
NxCodeInputComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxCodeInputComponent, selector: "nx-code-input", inputs: { codeLength: ["length", "codeLength"], type: "type", tabindex: "tabindex", convertTo: ["nxConvertTo", "convertTo"], negative: "negative", disabled: "disabled" }, host: { properties: { "class.nx-code-input": "true", "class.has-error": "errorState", "class.is-negative": "negative", "class.is-disabled": "disabled", "attr.tabindex": "-1" } }, ngImport: i0, template: "<input\n    class=\"nx-code-input__field\"\n    maxlength=\"1\"\n    *ngFor=\"let key of _keyCode; index as i; trackBy: _trackByKeyCode\"\n    [(ngModel)]=\"_keyCode[i]\"\n    [ngClass]=\"_inputGap(i)\"\n    [attr.aria-label]=\"getAriaLabel(i)\"\n    [attr.type]=\"type\"\n    (input)=\"_selectNextInput($event)\"\n    (paste)=\"_pasteClipboard($event)\"\n    (blur)=\"_onBlur()\"\n    (focus)=\"_setFocusState()\"\n    (click)=\"_selectText($event)\"\n    (keydown)=\"_keydownAction($event)\"\n    [attr.tabindex]=\"tabindex\"\n    [attr.disabled]=\"disabled ? '' : null\"\n/>\n", styles: [":host{display:block}:host .nx-code-input__field{font-size:var(--code-input-font-size);line-height:var(--code-input-line-height);font-weight:var(--code-input-font-weight);letter-spacing:var(--code-input-letter-spacing);color:var(--code-input-color);margin:0 4px;text-align:center;border:0;outline:0;caret-color:var(--code-input-active-color);box-shadow:inset 0 -1px 0 0 var(--code-input-color);-webkit-appearance:none;width:32px;border-radius:0;padding:0;background:transparent;box-sizing:border-box}:host .nx-code-input__field:focus{margin-bottom:-nx-border-size(xs);color:var(--code-input-active-color);box-shadow:inset 0 -2px 0 0 var(--code-input-active-color)}:host .nx-code-input__field:first-child{margin-left:0}:host .nx-code-input__field:last-child{margin-right:0}:host .nx-code-input--field-with-gap{margin-left:20px}:host:focus{outline:none}[dir=rtl] :host .nx-code-input__field:first-child{margin-right:0;margin-left:4px}[dir=rtl] :host .nx-code-input__field:last-child{margin-left:0;margin-right:4px}[dir=rtl] :host .nx-code-input--field-with-gap{margin-left:4px;margin-right:20px}:host.is-negative .nx-code-input__field{caret-color:var(--negative);box-shadow:inset 0 -1px 0 0 var(--negative);color:var(--negative)}:host.is-negative .nx-code-input__field:focus{box-shadow:inset 0 -2px 0 0 var(--negative)}:host.has-error:not(.is-negative) .nx-code-input__field{margin-bottom:-nx-border-size(xs);font-weight:700;color:var(--code-input-error-color);box-shadow:inset 0 -1px 0 0 var(--code-input-error-color)}:host.has-error:not(.is-negative) .nx-code-input__field:focus{box-shadow:inset 0 -2px 0 0 var(--code-input-error-color)}:host.has-error.is-negative .nx-code-input__field{font-weight:700}:host.is-disabled{cursor:not-allowed}:host.is-disabled .nx-code-input__field{cursor:not-allowed;color:var(--code-input-disabled-color);box-shadow:inset 0 -1px 0 0 nx-theme-color(code-input-disabled-color);box-shadow:inset 0 -1px 0 0 var(--code-input-disabled-color)}:host.is-disabled.is-negative .nx-code-input__field{color:var(--negative-02-dimmed);box-shadow:inset 0 -1px 0 0 var(--negative-02-dimmed)}input[type=number]::-webkit-outer-spin-button,input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number],.nx-code-input__field[type=number]{-moz-appearance:textfield}@media screen and (forced-colors: active){.nx-code-input__field{border-bottom:1px solid buttonText!important}.nx-code-input__field:focus{border-bottom:2px solid highlight!important}:host.is-disabled .nx-code-input__field{border-bottom:1px solid GrayText!important}}@media screen and (-ms-high-contrast: active){.nx-code-input__field{box-shadow:inset 0 -1px 0 0 buttonText}.nx-code-input__field:focus{box-shadow:inset 0 -2px 0 0 buttonText}:host.is-disabled .nx-code-input__field{color:GrayText;box-shadow:inset 0 -1px 0 0 GrayText;opacity:1}}\n"], directives: [{ type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i1.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { type: i1.MaxLengthValidator, selector: "[maxlength][formControlName],[maxlength][formControl],[maxlength][ngModel]", inputs: ["maxlength"] }, { type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i1.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { type: i4.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxCodeInputComponent, decorators: [{
            type: Component,
            args: [{ selector: 'nx-code-input', host: {
                        '[class.nx-code-input]': 'true',
                        '[class.has-error]': 'errorState',
                        '[class.is-negative]': 'negative',
                        '[class.is-disabled]': 'disabled',
                        '[attr.tabindex]': '-1',
                    }, changeDetection: ChangeDetectionStrategy.OnPush, template: "<input\n    class=\"nx-code-input__field\"\n    maxlength=\"1\"\n    *ngFor=\"let key of _keyCode; index as i; trackBy: _trackByKeyCode\"\n    [(ngModel)]=\"_keyCode[i]\"\n    [ngClass]=\"_inputGap(i)\"\n    [attr.aria-label]=\"getAriaLabel(i)\"\n    [attr.type]=\"type\"\n    (input)=\"_selectNextInput($event)\"\n    (paste)=\"_pasteClipboard($event)\"\n    (blur)=\"_onBlur()\"\n    (focus)=\"_setFocusState()\"\n    (click)=\"_selectText($event)\"\n    (keydown)=\"_keydownAction($event)\"\n    [attr.tabindex]=\"tabindex\"\n    [attr.disabled]=\"disabled ? '' : null\"\n/>\n", styles: [":host{display:block}:host .nx-code-input__field{font-size:var(--code-input-font-size);line-height:var(--code-input-line-height);font-weight:var(--code-input-font-weight);letter-spacing:var(--code-input-letter-spacing);color:var(--code-input-color);margin:0 4px;text-align:center;border:0;outline:0;caret-color:var(--code-input-active-color);box-shadow:inset 0 -1px 0 0 var(--code-input-color);-webkit-appearance:none;width:32px;border-radius:0;padding:0;background:transparent;box-sizing:border-box}:host .nx-code-input__field:focus{margin-bottom:-nx-border-size(xs);color:var(--code-input-active-color);box-shadow:inset 0 -2px 0 0 var(--code-input-active-color)}:host .nx-code-input__field:first-child{margin-left:0}:host .nx-code-input__field:last-child{margin-right:0}:host .nx-code-input--field-with-gap{margin-left:20px}:host:focus{outline:none}[dir=rtl] :host .nx-code-input__field:first-child{margin-right:0;margin-left:4px}[dir=rtl] :host .nx-code-input__field:last-child{margin-left:0;margin-right:4px}[dir=rtl] :host .nx-code-input--field-with-gap{margin-left:4px;margin-right:20px}:host.is-negative .nx-code-input__field{caret-color:var(--negative);box-shadow:inset 0 -1px 0 0 var(--negative);color:var(--negative)}:host.is-negative .nx-code-input__field:focus{box-shadow:inset 0 -2px 0 0 var(--negative)}:host.has-error:not(.is-negative) .nx-code-input__field{margin-bottom:-nx-border-size(xs);font-weight:700;color:var(--code-input-error-color);box-shadow:inset 0 -1px 0 0 var(--code-input-error-color)}:host.has-error:not(.is-negative) .nx-code-input__field:focus{box-shadow:inset 0 -2px 0 0 var(--code-input-error-color)}:host.has-error.is-negative .nx-code-input__field{font-weight:700}:host.is-disabled{cursor:not-allowed}:host.is-disabled .nx-code-input__field{cursor:not-allowed;color:var(--code-input-disabled-color);box-shadow:inset 0 -1px 0 0 nx-theme-color(code-input-disabled-color);box-shadow:inset 0 -1px 0 0 var(--code-input-disabled-color)}:host.is-disabled.is-negative .nx-code-input__field{color:var(--negative-02-dimmed);box-shadow:inset 0 -1px 0 0 var(--negative-02-dimmed)}input[type=number]::-webkit-outer-spin-button,input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number],.nx-code-input__field[type=number]{-moz-appearance:textfield}@media screen and (forced-colors: active){.nx-code-input__field{border-bottom:1px solid buttonText!important}.nx-code-input__field:focus{border-bottom:2px solid highlight!important}:host.is-disabled .nx-code-input__field{border-bottom:1px solid GrayText!important}}@media screen and (-ms-high-contrast: active){.nx-code-input__field{box-shadow:inset 0 -1px 0 0 buttonText}.nx-code-input__field:focus{box-shadow:inset 0 -2px 0 0 buttonText}:host.is-disabled .nx-code-input__field{color:GrayText;box-shadow:inset 0 -1px 0 0 GrayText;opacity:1}}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i0.ElementRef }, { type: i1.NgControl, decorators: [{
                    type: Optional
                }, {
                    type: Self
                }] }, { type: i2.NxCodeInputIntl }, { type: i3.ErrorStateMatcher }, { type: i1.NgForm, decorators: [{
                    type: Optional
                }] }, { type: i1.FormGroupDirective, decorators: [{
                    type: Optional
                }] }]; }, propDecorators: { codeLength: [{
                type: Input,
                args: ['length']
            }], type: [{
                type: Input
            }], tabindex: [{
                type: Input
            }], convertTo: [{
                type: Input,
                args: ['nxConvertTo']
            }], negative: [{
                type: Input
            }], disabled: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZS1pbnB1dC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1hcXVpbGEvc3JjL2NvZGUtaW5wdXQvY29kZS1pbnB1dC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1hcXVpbGEvc3JjL2NvZGUtaW5wdXQvY29kZS1pbnB1dC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWdCLHFCQUFxQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDNUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDeEcsT0FBTyxFQUFFLHVCQUF1QixFQUFxQixTQUFTLEVBQXVCLEtBQUssRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7Ozs7QUFNbEksTUFBTSxvQkFBb0IsR0FBRyxDQUFDLENBQUM7QUFDL0IsTUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDO0FBQy9CLE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQztBQUMvQixNQUFNLGNBQWMsR0FBRyxPQUFPLENBQUM7QUFDL0IsTUFBTSxlQUFlLEdBQUcsK0JBQStCLENBQUM7QUFnQnhELE1BQU0sT0FBTyxvQkFBb0I7SUFvRjdCLFlBQ1ksSUFBdUIsRUFDdkIsR0FBZSxFQUNJLFFBQTBCLEVBQzlDLEtBQXNCLEVBQ3JCLGtCQUFxQyxFQUN6QixXQUEwQixFQUMxQixnQkFBMkM7UUFOdkQsU0FBSSxHQUFKLElBQUksQ0FBbUI7UUFDdkIsUUFBRyxHQUFILEdBQUcsQ0FBWTtRQUNJLGFBQVEsR0FBUixRQUFRLENBQWtCO1FBQzlDLFVBQUssR0FBTCxLQUFLLENBQWlCO1FBQ3JCLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBbUI7UUFDekIsZ0JBQVcsR0FBWCxXQUFXLENBQWU7UUFDMUIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUEyQjtRQTFGbkUsK0RBQStEO1FBQy9ELGVBQVUsR0FBRyxLQUFLLENBQUM7UUFZWCxnQkFBVyxHQUFXLG9CQUFvQixDQUFDO1FBVzNDLFVBQUssR0FBRyxNQUFNLENBQUM7UUFDZixjQUFTLEdBQUcsS0FBSyxDQUFDO1FBV2xCLGNBQVMsR0FBRyxDQUFDLENBQUM7UUFhdEIsbUNBQW1DO1FBQ25DLGFBQVEsR0FBYSxJQUFJLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBQzdDLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFlakIsY0FBUyxHQUFHLEtBQUssQ0FBQztRQWVsQixjQUFTLEdBQUcsS0FBSyxDQUFDO1FBcVAxQixvQkFBb0I7UUFDcEIsb0JBQWUsR0FBRyxDQUFDLENBQU0sRUFBRSxFQUFFLEdBQUUsQ0FBQyxDQUFDO1FBRWpDLG9CQUFvQjtRQUNwQixtQkFBYyxHQUFHLENBQUMsQ0FBTSxFQUFFLEVBQUUsR0FBRSxDQUFDLENBQUM7UUE5TzVCLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNmLCtEQUErRDtZQUMvRCwyREFBMkQ7WUFDM0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDO1NBQ3RDO0lBQ0wsQ0FBQztJQTlGRCxnREFBZ0Q7SUFDaEQsSUFDSSxVQUFVLENBQUMsS0FBYTtRQUN4QixJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztRQUN6QixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBQ0QsSUFBSSxVQUFVO1FBQ1YsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzVCLENBQUM7SUFHRCw2QkFBNkI7SUFDN0IsSUFDSSxJQUFJLENBQUMsS0FBYTtRQUNsQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFDRCxJQUFJLElBQUk7UUFDSixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDdEIsQ0FBQztJQUlELHlEQUF5RDtJQUN6RCxJQUNJLFFBQVEsQ0FBQyxLQUFhO1FBQ3RCLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDN0IsQ0FBQztJQUNELElBQUksUUFBUTtRQUNSLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUMxQixDQUFDO0lBR0QsdUVBQXVFO0lBQ3ZFLElBQ0ksU0FBUyxDQUFDLEtBQXdCO1FBQ2xDLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDN0IsQ0FBQztJQUNELElBQUksU0FBUztRQUNULE9BQU8sSUFBSSxDQUFDLFVBQVcsQ0FBQztJQUM1QixDQUFDO0lBT0QsK0RBQStEO0lBQy9ELElBQ0ksUUFBUSxDQUFDLEtBQW1CO1FBQzVCLE1BQU0sUUFBUSxHQUFHLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzlDLElBQUksSUFBSSxDQUFDLFNBQVMsS0FBSyxRQUFRLEVBQUU7WUFDN0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUM7WUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztTQUM1QjtJQUNMLENBQUM7SUFDRCxJQUFJLFFBQVE7UUFDUixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDMUIsQ0FBQztJQUlELDBDQUEwQztJQUMxQyxJQUNJLFFBQVEsQ0FBQyxLQUFtQjtRQUM1QixNQUFNLFFBQVEsR0FBRyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM5QyxJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssUUFBUSxFQUFFO1lBQzdCLElBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDO1lBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7U0FDNUI7SUFDTCxDQUFDO0lBQ0QsSUFBSSxRQUFRO1FBQ1IsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQzFCLENBQUM7SUFvQkQsU0FBUztRQUNMLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNmLHNGQUFzRjtZQUN0Rix1RkFBdUY7WUFDdkYsNkZBQTZGO1lBQzdGLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1NBQzNCO0lBQ0wsQ0FBQztJQUVELDJDQUEyQztJQUMzQyxjQUFjO1FBQ1YsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1NBQzlDO2FBQU07WUFDSCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUM7U0FDbkQ7SUFDTCxDQUFDO0lBRUQsbURBQW1EO0lBQ25ELGtCQUFrQixDQUFDLEtBQVU7UUFDekIsSUFBSSxLQUFLLEtBQUssR0FBRyxFQUFFO1lBQ2YsT0FBTyxLQUFLLENBQUM7U0FDaEI7UUFFRCxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsRUFBRTtZQUMzQixJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssY0FBYyxFQUFFO2dCQUNuQyxPQUFPLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQzthQUM5QjtpQkFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssY0FBYyxFQUFFO2dCQUMxQyxPQUFPLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQzthQUM5QjtZQUVELE9BQU8sS0FBSyxDQUFDO1NBQ2hCO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDckIsQ0FBQztJQUVELCtCQUErQjtJQUMvQixjQUFjLENBQUMsS0FBb0I7UUFDL0IsTUFBTSxhQUFhLEdBQXFCLEtBQUssQ0FBQyxNQUEwQixDQUFDO1FBQ3pFLE1BQU0sa0JBQWtCLEdBQXFCLGFBQWEsQ0FBQyxzQkFBMEMsQ0FBQztRQUN0RyxNQUFNLGNBQWMsR0FBcUIsYUFBYSxDQUFDLGtCQUFzQyxDQUFDO1FBRTlGLFFBQVEsS0FBSyxDQUFDLE9BQU8sRUFBRTtZQUNuQixLQUFLLEtBQUs7Z0JBQ04sT0FBTyxLQUFLLENBQUM7WUFFakIsS0FBSyxTQUFTO2dCQUNWLElBQUksYUFBYSxDQUFDLEtBQUssS0FBSyxFQUFFLEVBQUU7b0JBQzVCLElBQUksa0JBQWtCLElBQUksa0JBQWtCLENBQUMsT0FBTyxLQUFLLGNBQWMsRUFBRTt3QkFDckUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO3FCQUN4QztpQkFDSjtnQkFDRCxNQUFNO1lBRVYsS0FBSyxVQUFVO2dCQUNYLElBQUksa0JBQWtCLElBQUksa0JBQWtCLENBQUMsT0FBTyxLQUFLLGNBQWMsRUFBRTtvQkFDckUsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO29CQUN2QixJQUFJLENBQUMsV0FBVyxDQUFDLGtCQUFrQixDQUFDLENBQUM7aUJBQ3hDO2dCQUNELE1BQU07WUFFVixLQUFLLFdBQVc7Z0JBQ1osSUFBSSxjQUFjLElBQUksY0FBYyxDQUFDLE9BQU8sS0FBSyxjQUFjLEVBQUU7b0JBQzdELElBQUksQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLENBQUM7aUJBQ3BDO2dCQUNELEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztnQkFDdkIsTUFBTTtZQUVWLEtBQUssVUFBVTtnQkFDWCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztnQkFDdEIsSUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLFFBQVEsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEtBQUssRUFBRSxJQUFJLGFBQWEsQ0FBQyxLQUFLLEtBQUssR0FBRyxDQUFDLEVBQUU7b0JBQ3hGLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztpQkFDMUI7Z0JBQ0QsTUFBTTtZQUVWLEtBQUssUUFBUTtnQkFDVCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztnQkFDdEIsSUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLFFBQVEsSUFBSSxhQUFhLENBQUMsS0FBSyxLQUFLLEdBQUcsRUFBRTtvQkFDeEQsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO2lCQUMxQjtnQkFDRCxNQUFNO1lBRVY7Z0JBQ0ksTUFBTTtTQUNiO0lBQ0wsQ0FBQztJQUVELG9EQUFvRDtJQUNwRCxXQUFXLENBQUMsS0FBWTtRQUNwQixJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxNQUEwQixDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVELHFFQUFxRTtJQUNyRSxnQkFBZ0IsQ0FBQyxLQUFZO1FBQ3pCLE1BQU0sV0FBVyxHQUFxQixLQUFLLENBQUMsTUFBMEIsQ0FBQztRQUN2RSxXQUFXLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQVcsQ0FBQztRQUNyRixNQUFNLFlBQVksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDL0QseUNBQXlDO1FBQ3pDLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQztRQUNoRCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFN0MsNkVBQTZFO1FBQzdFLE1BQU0sY0FBYyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssUUFBUSxDQUFDLENBQUM7UUFFbkUsSUFBSSxXQUFXLENBQUMsS0FBSyxJQUFJLGNBQWMsRUFBRTtZQUNyQyxNQUFNLGNBQWMsR0FBRyxXQUFXLENBQUMsV0FBK0IsQ0FBQztZQUVuRSxJQUFJLGNBQWMsS0FBSyxJQUFJLElBQUksY0FBYyxDQUFDLE9BQU8sS0FBSyxjQUFjLEVBQUU7Z0JBQ3RFLGNBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDdkIsSUFBSSxjQUFjLENBQUMsS0FBSyxLQUFLLEVBQUUsRUFBRTtvQkFDN0IsSUFBSSxDQUFDLFdBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQztpQkFDcEM7YUFDSjtTQUNKO1FBRUQsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7SUFDM0IsQ0FBQztJQUVELHlEQUF5RDtJQUN6RCxlQUFlLENBQUMsS0FBcUI7UUFDakMsSUFBSSxVQUFVLEdBQUcsQ0FBQyxLQUFLLENBQUMsYUFBYSxJQUFLLE1BQWMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEYsSUFBSSxlQUFlLEdBQUcsQ0FBQyxDQUFDO1FBQ3hCLE1BQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUU3RCxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDO1FBRXZGLEtBQUssSUFBSSxDQUFDLEdBQVcsVUFBVSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3ZELElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFVBQVUsQ0FBQyxlQUFlLENBQUMsQ0FBVyxDQUFDO1lBQ2xGLGVBQWUsRUFBRSxDQUFDO1NBQ3JCO1FBRUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRTdDLElBQUksVUFBVSxHQUFHLFVBQVUsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNsRCxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDaEY7YUFBTTtZQUNILElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUNyRTtRQUVELEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUMzQixDQUFDO0lBRUQsdUVBQXVFO0lBQy9ELHFCQUFxQixDQUFDLEtBQVk7UUFDdEMsSUFBSSxVQUFVLENBQUM7UUFDZixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUM3RCxJQUFJLEtBQUssQ0FBQyxVQUFVLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDOUQsVUFBVSxHQUFHLENBQUMsQ0FBQzthQUNsQjtTQUNKO1FBQ0QsT0FBTyxVQUFVLENBQUM7SUFDdEIsQ0FBQztJQUVELHNFQUFzRTtJQUM5RCxrQkFBa0IsQ0FBQyxVQUFrQjtRQUN6QyxJQUFJLGNBQWMsR0FBRyxFQUFFLENBQUM7UUFDeEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDeEMsSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUM1QixjQUFjLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ25DO1NBQ0o7UUFFRCxPQUFPLGNBQWMsQ0FBQztJQUMxQixDQUFDO0lBRUQsK0NBQStDO0lBQy9DLE9BQU87UUFDSCxJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztRQUN0QixVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ1osSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQ2hCLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQzthQUMvQztZQUNELElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsMkNBQTJDO0lBQzNDLGNBQWM7UUFDVixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztJQUN6QixDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSCxnQkFBZ0IsQ0FBQyxVQUFtQjtRQUNoQyxJQUFJLENBQUMsUUFBUSxHQUFHLFVBQVUsQ0FBQztRQUMzQixJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRCx3REFBd0Q7SUFDeEQsVUFBVSxDQUFDLEtBQWE7UUFDcEIsSUFBSSxLQUFLLEVBQUU7WUFDUCxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRS9ELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUN0QyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUN0QztTQUNKO2FBQU07WUFDSCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDekI7UUFFRCxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRCxlQUFlLENBQUMsS0FBYSxFQUFFLElBQVk7UUFDdkMsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUVELG1EQUFtRDtJQUNuRCxTQUFTLENBQUMsS0FBYTtRQUNuQixRQUFRLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDckIsS0FBSyxDQUFDLENBQUM7WUFDUCxLQUFLLENBQUMsQ0FBQztZQUNQLEtBQUssQ0FBQztnQkFDRixJQUFJLEtBQUssS0FBSyxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsRUFBRTtvQkFDL0IsT0FBTyxlQUFlLENBQUM7aUJBQzFCO2dCQUNELE9BQU8sRUFBRSxDQUFDO1lBRWQ7Z0JBQ0ksT0FBTyxFQUFFLENBQUM7U0FDakI7SUFDTCxDQUFDO0lBUUQsZ0JBQWdCLENBQUMsRUFBTztRQUNwQixJQUFJLENBQUMsZUFBZSxHQUFHLEVBQUUsQ0FBQztJQUM5QixDQUFDO0lBRUQsaUJBQWlCLENBQUMsRUFBTztRQUNyQixJQUFJLENBQUMsY0FBYyxHQUFHLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBRUQsb0JBQW9CO0lBQ3BCLGdCQUFnQjtRQUNaLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDakMsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixJQUFJLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDekQsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUF1QixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDOUUsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFFdkUsSUFBSSxRQUFRLEtBQUssUUFBUSxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxVQUFVLEdBQUcsUUFBUSxDQUFDO1NBQzlCO0lBQ0wsQ0FBQztJQUVELFlBQVksQ0FBQyxRQUFnQjtRQUN6QixPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsSUFBSSxRQUFRLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDN0csQ0FBQztJQUVEOztTQUVLO0lBQ0wsV0FBVyxDQUFDLEtBQXVCO1FBQy9CLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNkLElBQUk7WUFDQSxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDbEQ7UUFBQyxPQUFPLEdBQUcsRUFBRTtZQUNWLElBQUksR0FBRyxZQUFZLFlBQVksSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLG1CQUFtQixFQUFFO2dCQUNqRSxtQ0FBbUM7YUFDdEM7aUJBQU07Z0JBQ0gsTUFBTSxHQUFHLENBQUM7YUFDYjtTQUNKO0lBQ0wsQ0FBQzs7aUhBblhRLG9CQUFvQjtxR0FBcEIsb0JBQW9CLG1aQzVCakMscWtCQWlCQTsyRkRXYSxvQkFBb0I7a0JBYmhDLFNBQVM7K0JBQ0ksZUFBZSxRQUduQjt3QkFDRix1QkFBdUIsRUFBRSxNQUFNO3dCQUMvQixtQkFBbUIsRUFBRSxZQUFZO3dCQUNqQyxxQkFBcUIsRUFBRSxVQUFVO3dCQUNqQyxxQkFBcUIsRUFBRSxVQUFVO3dCQUNqQyxpQkFBaUIsRUFBRSxJQUFJO3FCQUMxQixtQkFDZ0IsdUJBQXVCLENBQUMsTUFBTTs7MEJBeUYxQyxRQUFROzswQkFBSSxJQUFJOzswQkFHaEIsUUFBUTs7MEJBQ1IsUUFBUTs0Q0FyRlQsVUFBVTtzQkFEYixLQUFLO3VCQUFDLFFBQVE7Z0JBYVgsSUFBSTtzQkFEUCxLQUFLO2dCQWFGLFFBQVE7c0JBRFgsS0FBSztnQkFZRixTQUFTO3NCQURaLEtBQUs7dUJBQUMsYUFBYTtnQkFnQmhCLFFBQVE7c0JBRFgsS0FBSztnQkFnQkYsUUFBUTtzQkFEWCxLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQm9vbGVhbklucHV0LCBjb2VyY2VCb29sZWFuUHJvcGVydHkgfSBmcm9tICdAYW5ndWxhci9jZGsvY29lcmNpb24nO1xuaW1wb3J0IHsgQkFDS1NQQUNFLCBET1dOX0FSUk9XLCBMRUZUX0FSUk9XLCBSSUdIVF9BUlJPVywgU1BBQ0UsIFVQX0FSUk9XIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2tleWNvZGVzJztcbmltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBEb0NoZWNrLCBFbGVtZW50UmVmLCBJbnB1dCwgT3B0aW9uYWwsIFNlbGYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBGb3JtQ29udHJvbCwgRm9ybUdyb3VwRGlyZWN0aXZlLCBOZ0NvbnRyb2wsIE5nRm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEVycm9yU3RhdGVNYXRjaGVyIH0gZnJvbSAnQGFwb3Npbi9uZy1hcXVpbGEvdXRpbHMnO1xuXG5pbXBvcnQgeyBOeENvZGVJbnB1dEludGwgfSBmcm9tICcuL2NvZGUtaW5wdXQtaW50bCc7XG5cbmNvbnN0IERFRkFVTFRfSU5QVVRfTEVOR1RIID0gNjtcbmNvbnN0IFRBR19OQU1FX0lOUFVUID0gJ0lOUFVUJztcbmNvbnN0IEFVVE9fVVBQRVJDQVNFID0gJ3VwcGVyJztcbmNvbnN0IEFVVE9fTE9XRVJDQVNFID0gJ2xvd2VyJztcbmNvbnN0IElOUFVUX0ZJRUxEX0dBUCA9ICdueC1jb2RlLWlucHV0LS1maWVsZC13aXRoLWdhcCc7XG5leHBvcnQgdHlwZSBOeENvbnZlcnNpb25UeXBlcyA9ICdsb3dlcicgfCAndXBwZXInO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ254LWNvZGUtaW5wdXQnLFxuICAgIHRlbXBsYXRlVXJsOiAnY29kZS1pbnB1dC5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJ2NvZGUtaW5wdXQuc2NzcyddLFxuICAgIGhvc3Q6IHtcbiAgICAgICAgJ1tjbGFzcy5ueC1jb2RlLWlucHV0XSc6ICd0cnVlJyxcbiAgICAgICAgJ1tjbGFzcy5oYXMtZXJyb3JdJzogJ2Vycm9yU3RhdGUnLFxuICAgICAgICAnW2NsYXNzLmlzLW5lZ2F0aXZlXSc6ICduZWdhdGl2ZScsXG4gICAgICAgICdbY2xhc3MuaXMtZGlzYWJsZWRdJzogJ2Rpc2FibGVkJyxcbiAgICAgICAgJ1thdHRyLnRhYmluZGV4XSc6ICctMScsXG4gICAgfSxcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgTnhDb2RlSW5wdXRDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgRG9DaGVjayB7XG4gICAgLyoqIFdoZXRoZXIgdGhlIGN1cnJlbnQgaW5wdXQgb2YgdGhlIGNvbXBvbmVudCBoYXMgYW4gZXJyb3IuICovXG4gICAgZXJyb3JTdGF0ZSA9IGZhbHNlO1xuXG4gICAgLyoqIFRoZSBsZW5ndGggb2YgdGhlIGNvZGUgaW5wdXQuIERlZmF1bHQ6IDYuICovXG4gICAgQElucHV0KCdsZW5ndGgnKVxuICAgIHNldCBjb2RlTGVuZ3RoKHZhbHVlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5fY29kZUxlbmd0aCA9IHZhbHVlO1xuICAgICAgICB0aGlzLnNldElucHV0TGVuZ3RoKCk7XG4gICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gICAgZ2V0IGNvZGVMZW5ndGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb2RlTGVuZ3RoO1xuICAgIH1cbiAgICBwcml2YXRlIF9jb2RlTGVuZ3RoOiBudW1iZXIgPSBERUZBVUxUX0lOUFVUX0xFTkdUSDtcblxuICAgIC8qKiBUaGUgdHlwZSBvZiBIVE1MIGlucHV0ICovXG4gICAgQElucHV0KClcbiAgICBzZXQgdHlwZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuX3R5cGUgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cbiAgICBnZXQgdHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGU7XG4gICAgfVxuICAgIHByaXZhdGUgX3R5cGUgPSAndGV4dCc7XG4gICAgcHJpdmF0ZSBfaXNVcERvd24gPSBmYWxzZTtcblxuICAgIC8qKiBTZXRzIHRoZSB0YWJpbmRleCBvZiB0aGUgY29udGFpbmVkIGlucHV0IGVsZW1lbnRzLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2V0IHRhYmluZGV4KHZhbHVlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5fdGFiaW5kZXggPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cbiAgICBnZXQgdGFiaW5kZXgoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RhYmluZGV4O1xuICAgIH1cbiAgICBwcml2YXRlIF90YWJpbmRleCA9IDA7XG5cbiAgICAvKiogV2hldGhlciB0aGUgZm9ybSBzaG91bGQgYXV0byBjYXBpdGFsaXplIG9yIGxvd2VyY2FzZSAob3B0aW9uYWwpLiAqL1xuICAgIEBJbnB1dCgnbnhDb252ZXJ0VG8nKVxuICAgIHNldCBjb252ZXJ0VG8odmFsdWU6IE54Q29udmVyc2lvblR5cGVzKSB7XG4gICAgICAgIHRoaXMuX2NvbnZlcnRUbyA9IHZhbHVlO1xuICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuICAgIGdldCBjb252ZXJ0VG8oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0VG8hO1xuICAgIH1cbiAgICBwcml2YXRlIF9jb252ZXJ0VG8/OiBOeENvbnZlcnNpb25UeXBlcztcblxuICAgIC8qKiBUaGUgdXNlciBpbnB1dCBpbiBhcnJheSBmb3JtICovXG4gICAgX2tleUNvZGU6IHN0cmluZ1tdID0gbmV3IEFycmF5KERFRkFVTFRfSU5QVVRfTEVOR1RIKTtcbiAgICBwcml2YXRlIF9mb2N1c2VkID0gZmFsc2U7XG5cbiAgICAvKiogV2hldGhlciB0aGUgY29kZSBpbnB1dCB1c2VzIHRoZSBuZWdhdGl2ZSBzZXQgb2Ygc3R5bGluZy4gKi9cbiAgICBASW5wdXQoKVxuICAgIHNldCBuZWdhdGl2ZSh2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgICAgICAgaWYgKHRoaXMuX25lZ2F0aXZlICE9PSBuZXdWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5fbmVnYXRpdmUgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgbmVnYXRpdmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9uZWdhdGl2ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9uZWdhdGl2ZSA9IGZhbHNlO1xuXG4gICAgLyoqIFdoZXRoZXIgdGhlIGNvZGUgaW5wdXQgaXMgZGlzYWJsZWQuICovXG4gICAgQElucHV0KClcbiAgICBzZXQgZGlzYWJsZWQodmFsdWU6IEJvb2xlYW5JbnB1dCkge1xuICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSh2YWx1ZSk7XG4gICAgICAgIGlmICh0aGlzLl9kaXNhYmxlZCAhPT0gbmV3VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuX2Rpc2FibGVkID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGRpc2FibGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZGlzYWJsZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZGlzYWJsZWQgPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIF9jZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICBwcml2YXRlIF9lbDogRWxlbWVudFJlZixcbiAgICAgICAgQE9wdGlvbmFsKCkgQFNlbGYoKSBwdWJsaWMgX2NvbnRyb2w6IE5nQ29udHJvbCB8IG51bGwsXG4gICAgICAgIHB1YmxpYyBfaW50bDogTnhDb2RlSW5wdXRJbnRsLFxuICAgICAgICBwcml2YXRlIF9lcnJvclN0YXRlTWF0Y2hlcjogRXJyb3JTdGF0ZU1hdGNoZXIsXG4gICAgICAgIEBPcHRpb25hbCgpIHByaXZhdGUgX3BhcmVudEZvcm06IE5nRm9ybSB8IG51bGwsXG4gICAgICAgIEBPcHRpb25hbCgpIHByaXZhdGUgX3BhcmVudEZvcm1Hcm91cDogRm9ybUdyb3VwRGlyZWN0aXZlIHwgbnVsbCxcbiAgICApIHtcbiAgICAgICAgaWYgKHRoaXMuX2NvbnRyb2wpIHtcbiAgICAgICAgICAgIC8vIE5vdGU6IHdlIHByb3ZpZGUgdGhlIHZhbHVlIGFjY2Vzc29yIHRocm91Z2ggaGVyZSwgaW5zdGVhZCBvZlxuICAgICAgICAgICAgLy8gdGhlIGBwcm92aWRlcnNgIHRvIGF2b2lkIHJ1bm5pbmcgaW50byBhIGNpcmN1bGFyIGltcG9ydC5cbiAgICAgICAgICAgIHRoaXMuX2NvbnRyb2wudmFsdWVBY2Nlc3NvciA9IHRoaXM7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ0RvQ2hlY2soKSB7XG4gICAgICAgIGlmICh0aGlzLl9jb250cm9sKSB7XG4gICAgICAgICAgICAvLyBXZSBuZWVkIHRvIHJlLWV2YWx1YXRlIHRoaXMgb24gZXZlcnkgY2hhbmdlIGRldGVjdGlvbiBjeWNsZSwgYmVjYXVzZSB0aGVyZSBhcmUgc29tZVxuICAgICAgICAgICAgLy8gZXJyb3IgdHJpZ2dlcnMgdGhhdCB3ZSBjYW4ndCBzdWJzY3JpYmUgdG8gKGUuZy4gcGFyZW50IGZvcm0gc3VibWlzc2lvbnMpLiBUaGlzIG1lYW5zXG4gICAgICAgICAgICAvLyB0aGF0IHdoYXRldmVyIGxvZ2ljIGlzIGluIGhlcmUgaGFzIHRvIGJlIHN1cGVyIGxlYW4gb3Igd2UgcmlzayBkZXN0cm95aW5nIHRoZSBwZXJmb3JtYW5jZS5cbiAgICAgICAgICAgIHRoaXMudXBkYXRlRXJyb3JTdGF0ZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIFNldHMgdGhlIGxlbmd0aCBvZiB0aGUgaW5wdXQgZmllbGRzLiAqL1xuICAgIHNldElucHV0TGVuZ3RoKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5jb2RlTGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLl9rZXlDb2RlID0gbmV3IEFycmF5KHRoaXMuY29kZUxlbmd0aCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9rZXlDb2RlID0gbmV3IEFycmF5KERFRkFVTFRfSU5QVVRfTEVOR1RIKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBDb252ZXJ0cyB0byB1cHBlciBvciBsb3dlcmNhc2Ugd2hlbiBlbmFibGVkLiAqL1xuICAgIF9jb252ZXJ0TGV0dGVyU2l6ZSh2YWx1ZTogYW55KTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgaWYgKHZhbHVlID09PSAnw58nKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgaWYgKHRoaXMuY29udmVydFRvID09PSBBVVRPX1VQUEVSQ0FTRSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbnZlcnRUbyA9PT0gQVVUT19MT1dFUkNBU0UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLyoqIFJlYWN0cyB0byBrZXlkb3duIGV2ZW50LiAqL1xuICAgIF9rZXlkb3duQWN0aW9uKGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCB8IGZhbHNlIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0RWxlbWVudDogSFRNTElucHV0RWxlbWVudCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICBjb25zdCBwcmV2aW91c0lucHV0RmllbGQ6IEhUTUxJbnB1dEVsZW1lbnQgPSB0YXJnZXRFbGVtZW50LnByZXZpb3VzRWxlbWVudFNpYmxpbmcgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgY29uc3QgbmV4dElucHV0RmllbGQ6IEhUTUxJbnB1dEVsZW1lbnQgPSB0YXJnZXRFbGVtZW50Lm5leHRFbGVtZW50U2libGluZyBhcyBIVE1MSW5wdXRFbGVtZW50O1xuXG4gICAgICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgICAgY2FzZSBTUEFDRTpcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgIGNhc2UgQkFDS1NQQUNFOlxuICAgICAgICAgICAgICAgIGlmICh0YXJnZXRFbGVtZW50LnZhbHVlID09PSAnJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAocHJldmlvdXNJbnB1dEZpZWxkICYmIHByZXZpb3VzSW5wdXRGaWVsZC50YWdOYW1lID09PSBUQUdfTkFNRV9JTlBVVCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RJbnB1dChwcmV2aW91c0lucHV0RmllbGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIExFRlRfQVJST1c6XG4gICAgICAgICAgICAgICAgaWYgKHByZXZpb3VzSW5wdXRGaWVsZCAmJiBwcmV2aW91c0lucHV0RmllbGQudGFnTmFtZSA9PT0gVEFHX05BTUVfSU5QVVQpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RJbnB1dChwcmV2aW91c0lucHV0RmllbGQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBSSUdIVF9BUlJPVzpcbiAgICAgICAgICAgICAgICBpZiAobmV4dElucHV0RmllbGQgJiYgbmV4dElucHV0RmllbGQudGFnTmFtZSA9PT0gVEFHX05BTUVfSU5QVVQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RJbnB1dChuZXh0SW5wdXRGaWVsZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgRE9XTl9BUlJPVzpcbiAgICAgICAgICAgICAgICB0aGlzLl9pc1VwRG93biA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3R5cGUgPT09ICdudW1iZXInICYmICh0YXJnZXRFbGVtZW50LnZhbHVlID09PSAnJyB8fCB0YXJnZXRFbGVtZW50LnZhbHVlID09PSAnMCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFVQX0FSUk9XOlxuICAgICAgICAgICAgICAgIHRoaXMuX2lzVXBEb3duID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fdHlwZSA9PT0gJ251bWJlcicgJiYgdGFyZ2V0RWxlbWVudC52YWx1ZSA9PT0gJzknKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIFNlbGVjdHMgdGhlIHZhbHVlIG9uIGNsaWNrIG9mIGFuIGlucHV0IGZpZWxkLiAqL1xuICAgIF9zZWxlY3RUZXh0KGV2ZW50OiBFdmVudCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNlbGVjdElucHV0KGV2ZW50LnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KTtcbiAgICB9XG5cbiAgICAvKiogQXV0b21hdGljYWxseSBmb2N1c2VzIGFuZCBzZWxlY3RzIHRoZSBuZXh0IGlucHV0IG9uIGtleSBpbnB1dC4gKi9cbiAgICBfc2VsZWN0TmV4dElucHV0KGV2ZW50OiBFdmVudCk6IHZvaWQge1xuICAgICAgICBjb25zdCBldmVudFRhcmdldDogSFRNTElucHV0RWxlbWVudCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICBldmVudFRhcmdldC52YWx1ZSA9IHRoaXMuX2NvbnZlcnRMZXR0ZXJTaXplKGV2ZW50VGFyZ2V0LnZhbHVlLnNsaWNlKDAsIDEpKSBhcyBzdHJpbmc7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IE51bWJlcih0aGlzLl9nZXRGb2N1c2VkSW5wdXRJbmRleChldmVudCkpO1xuICAgICAgICAvLyBzYXZlIGluIG1vZGVsIHdpdGggdXBwZXJjYXNlIGlmIG5lZWRlZFxuICAgICAgICB0aGlzLl9rZXlDb2RlW2N1cnJlbnRJbmRleF0gPSBldmVudFRhcmdldC52YWx1ZTtcbiAgICAgICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UodGhpcy5fa2V5Q29kZS5qb2luKCcnKSk7XG5cbiAgICAgICAgLy8gZG9uJ3QganVtcCB0byBuZXh0IGlucHV0IGlmIHRoZSB1c2VyIHVzZXMgVVAvRE9XbiBhcnJvdyAobmF0aXZlIGJlaGF2aW91cilcbiAgICAgICAgY29uc3QgZm9jdXNOZXh0SW5wdXQgPSAhKHRoaXMuX2lzVXBEb3duICYmIHRoaXMudHlwZSA9PT0gJ251bWJlcicpO1xuXG4gICAgICAgIGlmIChldmVudFRhcmdldC52YWx1ZSAmJiBmb2N1c05leHRJbnB1dCkge1xuICAgICAgICAgICAgY29uc3QgbmV4dElucHV0RmllbGQgPSBldmVudFRhcmdldC5uZXh0U2libGluZyBhcyBIVE1MSW5wdXRFbGVtZW50O1xuXG4gICAgICAgICAgICBpZiAobmV4dElucHV0RmllbGQgIT09IG51bGwgJiYgbmV4dElucHV0RmllbGQudGFnTmFtZSA9PT0gVEFHX05BTUVfSU5QVVQpIHtcbiAgICAgICAgICAgICAgICBuZXh0SW5wdXRGaWVsZC5mb2N1cygpO1xuICAgICAgICAgICAgICAgIGlmIChuZXh0SW5wdXRGaWVsZC52YWx1ZSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RJbnB1dChuZXh0SW5wdXRGaWVsZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5faXNVcERvd24gPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvKiogUGFzdGUgZXZlbnQgdG8gZGlzdHJpYnV0ZSBjb250ZW50IGluIGlucHV0IGZpZWxkcy4gKi9cbiAgICBfcGFzdGVDbGlwYm9hcmQoZXZlbnQ6IENsaXBib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgICAgIGxldCBjb3BpZWRUZXh0ID0gKGV2ZW50LmNsaXBib2FyZERhdGEgfHwgKHdpbmRvdyBhcyBhbnkpLmNsaXBib2FyZERhdGEpLmdldERhdGEoJ3RleHQnKTtcbiAgICAgICAgbGV0IGNvcGllZFRleHRJbmRleCA9IDA7XG4gICAgICAgIGNvbnN0IGlucHV0SW5kZXggPSBOdW1iZXIodGhpcy5fZ2V0Rm9jdXNlZElucHV0SW5kZXgoZXZlbnQpKTtcblxuICAgICAgICBjb3BpZWRUZXh0ID0gdGhpcy50eXBlID09PSAnbnVtYmVyJyA/IHRoaXMuX2Zvcm1hdE51bWJlcklucHV0KGNvcGllZFRleHQpIDogY29waWVkVGV4dDtcblxuICAgICAgICBmb3IgKGxldCBpOiBudW1iZXIgPSBpbnB1dEluZGV4OyBpIDwgdGhpcy5jb2RlTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuX2tleUNvZGVbaV0gPSB0aGlzLl9jb252ZXJ0TGV0dGVyU2l6ZShjb3BpZWRUZXh0W2NvcGllZFRleHRJbmRleF0pIGFzIHN0cmluZztcbiAgICAgICAgICAgIGNvcGllZFRleHRJbmRleCsrO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UodGhpcy5fa2V5Q29kZS5qb2luKCcnKSk7XG5cbiAgICAgICAgaWYgKGlucHV0SW5kZXggKyBjb3BpZWRUZXh0Lmxlbmd0aCA8IHRoaXMuY29kZUxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5fZWwubmF0aXZlRWxlbWVudC5jaGlsZHJlbi5pdGVtKGlucHV0SW5kZXggKyBjb3BpZWRUZXh0Lmxlbmd0aCkuZm9jdXMoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2VsLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW4uaXRlbSh0aGlzLmNvZGVMZW5ndGggLSAxKS5mb2N1cygpO1xuICAgICAgICB9XG5cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICAvKiogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIGNvZGUgaW5wdXQsIHdoaWNoIGlzIGN1cnJlbnRseSBmb2N1c2VkLiAqL1xuICAgIHByaXZhdGUgX2dldEZvY3VzZWRJbnB1dEluZGV4KGV2ZW50OiBFdmVudCkge1xuICAgICAgICBsZXQgaW5wdXRJbmRleDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9lbC5uYXRpdmVFbGVtZW50LmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQuc3JjRWxlbWVudCA9PT0gdGhpcy5fZWwubmF0aXZlRWxlbWVudC5jaGlsZHJlbi5pdGVtKGkpKSB7XG4gICAgICAgICAgICAgICAgaW5wdXRJbmRleCA9IGk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlucHV0SW5kZXg7XG4gICAgfVxuXG4gICAgLyoqIFJlbW92ZXMgYWxsIGNoYXJhY3RlcnMgZnJvbSB0aGUgaW5wdXQgZXhjZXB0IGZvciBudW1iZXJzIFswLTldLiAqL1xuICAgIHByaXZhdGUgX2Zvcm1hdE51bWJlcklucHV0KGNvcGllZFRleHQ6IHN0cmluZykge1xuICAgICAgICBsZXQgZm9ybWF0dGVkSW5wdXQgPSAnJztcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3BpZWRUZXh0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoY29waWVkVGV4dFtpXS5tYXRjaCgvXFxkJC8pKSB7XG4gICAgICAgICAgICAgICAgZm9ybWF0dGVkSW5wdXQgKz0gY29waWVkVGV4dFtpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmb3JtYXR0ZWRJbnB1dDtcbiAgICB9XG5cbiAgICAvKiogVHJpZ2dlcnMgd2hlbiBhbiBpbnB1dCBmaWVsZCBpcyBibHVycmVkLiAqL1xuICAgIF9vbkJsdXIoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuX2ZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2ZvY3VzZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BhZ2F0ZVRvdWNoKHRoaXMuX2tleUNvZGUuam9pbignJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKiogU2V0cyBfZm9jdXNlZCBzdGF0ZSBhbmQgbWFrZXMgdmFsaWQuICovXG4gICAgX3NldEZvY3VzU3RhdGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuX2ZvY3VzZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERpc2FibGVzIHRoZSBjb2RlIGlucHV0LiBQYXJ0IG9mIHRoZSBDb250cm9sVmFsdWVBY2Nlc3NvciBpbnRlcmZhY2UgcmVxdWlyZWRcbiAgICAgKiB0byBpbnRlZ3JhdGUgd2l0aCBBbmd1bGFyJ3MgY29yZSBmb3JtcyBBUEkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaXNEaXNhYmxlZCBTZXRzIHdoZXRoZXIgdGhlIGNvbXBvbmVudCBpcyBkaXNhYmxlZC5cbiAgICAgKi9cbiAgICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XG4gICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG5cbiAgICAvKiogU2V0cyBpbml0aWFsIHZhbHVlLCB1c2VkIGJ5IENvbnRyb2xWYWx1ZUFjY2Vzc29yLiAqL1xuICAgIHdyaXRlVmFsdWUodmFsdWU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlQXNBcnJheSA9IHZhbHVlLnNwbGl0KCcnKS5zbGljZSgwLCB0aGlzLmNvZGVMZW5ndGgpO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY29kZUxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fa2V5Q29kZVtpXSA9IHZhbHVlQXNBcnJheVtpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0SW5wdXRMZW5ndGgoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG5cbiAgICBfdHJhY2tCeUtleUNvZGUoaW5kZXg6IG51bWJlciwgaXRlbTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgIH1cblxuICAgIC8qKiBBZGRzIGEgZ2FwIHRvIGlucHV0IGZpZWxkcyB3aGVuIGFwcHJvcHJpYXRlLiAqL1xuICAgIF9pbnB1dEdhcChpbmRleDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLmNvZGVMZW5ndGgpIHtcbiAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IHRoaXMuY29kZUxlbmd0aCAvIDIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIElOUFVUX0ZJRUxEX0dBUDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgcHJvcGFnYXRlQ2hhbmdlID0gKF86IGFueSkgPT4ge307XG5cbiAgICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICAgIHByb3BhZ2F0ZVRvdWNoID0gKF86IGFueSkgPT4ge307XG5cbiAgICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpIHtcbiAgICAgICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UgPSBmbjtcbiAgICB9XG5cbiAgICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KSB7XG4gICAgICAgIHRoaXMucHJvcGFnYXRlVG91Y2ggPSBmbjtcbiAgICB9XG5cbiAgICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICAgIHVwZGF0ZUVycm9yU3RhdGUoKSB7XG4gICAgICAgIGNvbnN0IG9sZFN0YXRlID0gdGhpcy5lcnJvclN0YXRlO1xuICAgICAgICBjb25zdCBwYXJlbnQgPSB0aGlzLl9wYXJlbnRGb3JtR3JvdXAgfHwgdGhpcy5fcGFyZW50Rm9ybTtcbiAgICAgICAgY29uc3QgY29udHJvbCA9IHRoaXMuX2NvbnRyb2wgPyAodGhpcy5fY29udHJvbC5jb250cm9sIGFzIEZvcm1Db250cm9sKSA6IG51bGw7XG4gICAgICAgIGNvbnN0IG5ld1N0YXRlID0gdGhpcy5fZXJyb3JTdGF0ZU1hdGNoZXIuaXNFcnJvclN0YXRlKGNvbnRyb2wsIHBhcmVudCk7XG5cbiAgICAgICAgaWYgKG5ld1N0YXRlICE9PSBvbGRTdGF0ZSkge1xuICAgICAgICAgICAgdGhpcy5lcnJvclN0YXRlID0gbmV3U3RhdGU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRBcmlhTGFiZWwoa2V5SW5kZXg6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gYCR7dGhpcy5faW50bC5pbnB1dEZpZWxkQXJpYUxhYmVsfSAke2tleUluZGV4ICsgMX0gJHt0aGlzLl9pbnRsLm9mTGFiZWx9ICR7dGhpcy5fa2V5Q29kZS5sZW5ndGh9YDtcbiAgICB9XG5cbiAgICAvKiogQGRvY3MtcHJpdmF0ZVxuICAgICAqIFdvcmthcm91bmQgcHJldmVudGluZyB0aGUgc2VsZWN0aW9uIGVycm9yIGJlY2F1c2UgdGhlIGBzZXRTZWxlY3Rpb25SYW5nZWAgaXMgbm90IHN1cHBvcnRlZCBvbiBpbnB1dFsndHlwZT1udW1iZXInXVxuICAgICAqICovXG4gICAgc2VsZWN0SW5wdXQoaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQpIHtcbiAgICAgICAgaW5wdXQuZm9jdXMoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlucHV0LnNldFNlbGVjdGlvblJhbmdlKDAsIGlucHV0LnZhbHVlLmxlbmd0aCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIERPTUV4Y2VwdGlvbiAmJiBlcnIubmFtZSA9PT0gJ0ludmFsaWRTdGF0ZUVycm9yJykge1xuICAgICAgICAgICAgICAgIC8vIHNldFNlbGVjdGlvblJhbmdlIGRvZXMgbm90IGFwcGx5XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbiIsIjxpbnB1dFxuICAgIGNsYXNzPVwibngtY29kZS1pbnB1dF9fZmllbGRcIlxuICAgIG1heGxlbmd0aD1cIjFcIlxuICAgICpuZ0Zvcj1cImxldCBrZXkgb2YgX2tleUNvZGU7IGluZGV4IGFzIGk7IHRyYWNrQnk6IF90cmFja0J5S2V5Q29kZVwiXG4gICAgWyhuZ01vZGVsKV09XCJfa2V5Q29kZVtpXVwiXG4gICAgW25nQ2xhc3NdPVwiX2lucHV0R2FwKGkpXCJcbiAgICBbYXR0ci5hcmlhLWxhYmVsXT1cImdldEFyaWFMYWJlbChpKVwiXG4gICAgW2F0dHIudHlwZV09XCJ0eXBlXCJcbiAgICAoaW5wdXQpPVwiX3NlbGVjdE5leHRJbnB1dCgkZXZlbnQpXCJcbiAgICAocGFzdGUpPVwiX3Bhc3RlQ2xpcGJvYXJkKCRldmVudClcIlxuICAgIChibHVyKT1cIl9vbkJsdXIoKVwiXG4gICAgKGZvY3VzKT1cIl9zZXRGb2N1c1N0YXRlKClcIlxuICAgIChjbGljayk9XCJfc2VsZWN0VGV4dCgkZXZlbnQpXCJcbiAgICAoa2V5ZG93bik9XCJfa2V5ZG93bkFjdGlvbigkZXZlbnQpXCJcbiAgICBbYXR0ci50YWJpbmRleF09XCJ0YWJpbmRleFwiXG4gICAgW2F0dHIuZGlzYWJsZWRdPVwiZGlzYWJsZWQgPyAnJyA6IG51bGxcIlxuLz5cbiJdfQ==