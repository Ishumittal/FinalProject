import { ChangeDetectionStrategy, Component, ContentChildren, Input, Optional, ViewChildren, } from '@angular/core';
import { takeUntil } from 'rxjs/operators';
import { NxProgressStepperDirective } from '../progress-stepper.component';
import { NxMultiStepperGroupComponent } from './multi-step-group.component';
import { NxMultiStepItemComponent } from './multi-step-item.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/bidi";
import * as i2 from "./multi-step-item.component";
import * as i3 from "@angular/common";
export class NxMultiStepperComponent extends NxProgressStepperDirective {
    constructor(_cdr, _dir, _el) {
        super(_cdr, _dir, _el);
        this._direction = 'horizontal';
    }
    /** Sets the direction of the multi stepper. */
    get direction() {
        return this._direction;
    }
    set direction(value) {
        this._direction = value;
    }
    ngAfterViewChecked() {
        // the _keyManager is currently private in the CdkStepper and the CDK/Material way
        // is to create to separate components for the vertical and horizontal stepper with no
        // possibility to change it during runtime
        // opened a ticket: https://github.com/angular/components/issues/21874
        // for now the quick solution is the hacky way to access the private property
        this['_keyManager'].withVerticalOrientation(this._direction === 'vertical');
    }
    ngAfterContentInit() {
        super.ngAfterContentInit();
        if (this.groups.length) {
            this.steps.reset(this._stepsInGroups);
            this.steps.notifyOnChanges();
        }
        this.groups.changes.pipe(takeUntil(this._destroyed)).subscribe(() => {
            this.steps.reset(this._stepsInGroups);
            this.steps.notifyOnChanges();
        });
    }
    ngOnDestroy() {
        this._destroyed.next();
        this._destroyed.complete();
    }
    _stepDisabled(index) {
        const steps = this.steps.toArray();
        if (this.linear && index >= 0) {
            return steps.slice(0, index).some(step => {
                const control = step.stepControl;
                const isIncomplete = control ? control.invalid || control.pending || !step.interacted : !step.completed;
                return isIncomplete && !step.optional;
            });
        }
        return false;
    }
    get _stepsInGroups() {
        if (this.groups.length) {
            return this.groups.reduce((steps, group) => steps.concat(group.steps.toArray()), []);
        }
        return [];
    }
    // Returns the index of a certain step
    _getIndex(step) {
        return this.steps.toArray().indexOf(step);
    }
    _isGroupActive(groupIndex) {
        return this.selectedIndex >= this.getGroupItemIndex(groupIndex);
    }
    _isGroupDisabled(groupIndex) {
        return this._stepDisabled(this.getGroupItemIndex(groupIndex));
    }
    getGroupItemIndex(groupIndex) {
        let count = 0;
        const groups = this.groups.toArray();
        for (let i = 0; i < groupIndex; i++) {
            count += groups[i].steps.length;
        }
        return count;
    }
}
NxMultiStepperComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxMultiStepperComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: i1.Directionality, optional: true }, { token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component });
NxMultiStepperComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxMultiStepperComponent, selector: "nx-multi-stepper", inputs: { direction: "direction" }, host: { properties: { "class.nx-multi-stepper--vertical": "direction === \"vertical\"" } }, providers: [{ provide: NxProgressStepperDirective, useExisting: NxMultiStepperComponent }], queries: [{ propertyName: "groups", predicate: NxMultiStepperGroupComponent, descendants: true }], viewQueries: [{ propertyName: "_stepHeader", predicate: NxMultiStepItemComponent, descendants: true }], usesInheritance: true, ngImport: i0, template: "<span class=\"nx-progress-stepper__title\" *ngIf=\"direction === 'horizontal'\">\n    <ng-content select=\"nx-label\"></ng-content>\n</span>\n\n<div class=\"nx-multi-stepper__items\" role=\"tablist\">\n    <ng-container *ngIf=\"groups.length === 0 || direction === 'horizontal'; else groupsTemplate\">\n        <ng-container *ngFor=\"let step of steps; let i = index; let isLast = last; let isFirst = first\">\n            <nx-multi-step-item\n                (click)=\"!_stepDisabled(i) && step.select()\"\n                (keydown)=\"_onKeydown($event)\"\n                [last]=\"isLast\"\n                [tabindex]=\"_getFocusIndex() === i ? 0 : -1\"\n                [label]=\"step.stepLabel || step.label\"\n                [completed]=\"step.completed\"\n                [selected]=\"selectedIndex === i\"\n                [active]=\"selectedIndex > i\"\n                [disabled]=\"_stepDisabled(i)\"\n                [direction]=\"direction\"\n            >\n            </nx-multi-step-item>\n        </ng-container>\n    </ng-container>\n</div>\n\n<div class=\"labels-container\" *ngIf=\"direction === 'horizontal'\" role=\"tablist\">\n    <div\n        class=\"label\"\n        role=\"tab\"\n        tabindex=\"-1\"\n        [attr.aria-selected]=\"selectedIndex === i\"\n        *ngFor=\"let step of steps; let i = index\"\n        [ngClass]=\"{ 'is-disabled': _stepDisabled(i), 'is-selected': selectedIndex === i }\"\n        (click)=\"!_stepDisabled(i) && step.select()\"\n    >\n        <span>{{ step.label }}</span>\n    </div>\n</div>\n\n<div class=\"nx-progress-stepper__mobile-label\">\n    {{ currentLabel }}\n</div>\n\n<div\n    *ngFor=\"let step of steps; let i = index\"\n    class=\"nx-progress-stepper__content\"\n    role=\"tabpanel\"\n    [id]=\"_getStepContentId(i)\"\n    [attr.aria-label]=\"currentLabel\"\n    [attr.aria-expanded]=\"selectedIndex === i\"\n>\n    <ng-container [ngTemplateOutlet]=\"step.content\"></ng-container>\n</div>\n\n<ng-template #groupsTemplate>\n    <ng-container *ngFor=\"let group of groups; let i = index\">\n        <div class=\"nx-multi-stepper__group\">\n            <div class=\"nx-multi-stepper__group-label\" [class.is-active]=\"_isGroupActive(i)\" [class.is-disabled]=\"_isGroupDisabled(i)\">\n                {{ group.label }}\n            </div>\n\n            <div class=\"nx-multi-stepper__group-items\">\n                <ng-container *ngFor=\"let step of group.steps; let isLast = last\">\n                    <nx-multi-step-item\n                        (click)=\"!_stepDisabled(_getIndex(step)) && step.select()\"\n                        (keydown)=\"_onKeydown($event)\"\n                        [tabindex]=\"_getFocusIndex() === _getIndex(step) ? 0 : -1\"\n                        [last]=\"isLast\"\n                        [label]=\"step.stepLabel || step.label\"\n                        [completed]=\"step.completed\"\n                        [selected]=\"selectedIndex === _getIndex(step)\"\n                        [active]=\"selectedIndex > _getIndex(step)\"\n                        [disabled]=\"_stepDisabled(_getIndex(step))\"\n                        [direction]=\"direction\"\n                    >\n                    </nx-multi-step-item>\n                </ng-container>\n            </div>\n        </div>\n    </ng-container>\n</ng-template>\n", styles: [":host{display:block}.nx-progress-stepper__content[aria-expanded=false]{height:0;overflow:hidden;visibility:hidden}.nx-progress-stepper__mobile-label{display:none;color:var(--progress-indicator-mobile-color);font-size:var(--progress-indicator-mobile-font-size);line-height:var(--progress-indicator-mobile-line-height);font-weight:var(--progress-indicator-mobile-font-weight);letter-spacing:var(--progress-indicator-mobile-letter-spacing)}@media (max-width: 703px){.nx-progress-stepper__mobile-label{display:block;text-align:center}}.nx-progress-stepper__title{display:block}.nx-progress-stepper__title ::ng-deep nx-label{margin-bottom:24px}\n", ":host{width:100%}@media (min-width: 704px){:host.nx-multi-stepper--vertical{display:flex}}:host.nx-multi-stepper--vertical .nx-progress-stepper__content[aria-expanded=false]{width:0}:host.nx-multi-stepper--vertical .nx-multi-stepper__items{align-items:flex-start;flex-direction:column;margin:0 56px 0 0;max-width:100%}[dir=rtl] :host.nx-multi-stepper--vertical .nx-multi-stepper__items{margin:0 0 0 56px}:host.nx-multi-stepper--vertical .nx-multi-stepper__group-items{flex-direction:column;max-width:100%}:host.nx-multi-stepper--vertical .nx-multi-stepper__group-label{transform:none;border-left:4px solid transparent;margin-bottom:16px;margin-left:6px;padding-left:22px}[dir=rtl] :host.nx-multi-stepper--vertical .nx-multi-stepper__group-label{margin-left:0;margin-left:initial;padding-left:0;padding-left:initial;margin-right:6px;padding-right:22px}:host.nx-multi-stepper--vertical .nx-multi-stepper__group:nth-child(n+2) .nx-multi-stepper__group-label{padding-top:16px;margin-top:16px;border-left-style:dotted;border-left-color:var(--multi-stepper-line-color)}:host.nx-multi-stepper--vertical .nx-multi-stepper__group:nth-child(n+2) .nx-multi-stepper__group-label.is-active{padding-top:36px;padding-bottom:20px;margin-top:-nx-spacer(3xs);margin-bottom:-nx-spacer(3xs);border-left-style:solid;border-left-color:var(--multi-stepper-line-filled-color)}[dir=rtl] :host.nx-multi-stepper--vertical .nx-multi-stepper__group:nth-child(n+2) .nx-multi-stepper__group-label{border-left-style:none;border-right-style:dotted;border-right-color:var(--multi-stepper-line-color)}[dir=rtl] :host.nx-multi-stepper--vertical .nx-multi-stepper__group:nth-child(n+2) .nx-multi-stepper__group-label.is-active{border-left-style:none;border-right-style:solid;border-right-color:var(--multi-stepper-line-filled-color)}:host .labels-container{width:100%;flex:1 1 100%;display:flex;margin:0 auto;vertical-align:top;align-self:flex-start;align-items:flex-start}@media (max-width: 703px){:host .labels-container{display:none}}:host .labels-container .label{flex:1 1 100%;display:flex;align-items:center;justify-content:center;position:relative;font-size:var(--multi-stepper-step-font-size);line-height:var(--multi-stepper-step-line-height);font-weight:var(--multi-stepper-step-font-weight);letter-spacing:var(--multi-stepper-step-letter-spacing);color:var(--multi-stepper-step-color);cursor:pointer;text-align:center}:host .labels-container .label.is-disabled{color:var(--multi-stepper-step-disabled-color);cursor:not-allowed}@media screen and (-ms-high-contrast: active){:host .labels-container .label{color:buttonText}:host .labels-container .label.is-disabled{color:GrayText}:host .labels-container .label:not(.is-disabled){color:buttonText}:host .labels-container .label span{-ms-high-contrast-adjust:none;background-color:buttonFace;border-radius:4px;box-shadow:0 0 0 2px buttonFace}:host .labels-container .label.is-selected span{background-color:highlight;border-radius:4px;box-shadow:0 0 0 2px highlight;color:highlightText}}.nx-multi-stepper__items{display:flex;margin:0 auto;align-items:center}@media (max-width: 703px){.nx-multi-stepper__items{display:none}}.nx-multi-stepper__group-items{display:flex}.nx-multi-stepper__group{display:flex;flex-direction:column;flex:1 1 auto;max-width:100%}.nx-multi-stepper__group-label{font-size:var(--multi-stepper-group-font-size);line-height:var(--multi-stepper-group-line-height);font-weight:var(--multi-stepper-group-font-weight);letter-spacing:var(--multi-stepper-group-letter-spacing);color:var(--multi-stepper-group-color)}.nx-multi-stepper__group-label.is-disabled{color:var(--multi-stepper-group-disabled-color)}\n"], components: [{ type: i2.NxMultiStepItemComponent, selector: "nx-multi-step-item", inputs: ["direction", "label", "selected", "active", "disabled", "last", "completed"] }], directives: [{ type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i3.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxMultiStepperComponent, decorators: [{
            type: Component,
            args: [{ selector: 'nx-multi-stepper', providers: [{ provide: NxProgressStepperDirective, useExisting: NxMultiStepperComponent }], changeDetection: ChangeDetectionStrategy.OnPush, host: {
                        '[class.nx-multi-stepper--vertical]': 'direction === "vertical"',
                    }, template: "<span class=\"nx-progress-stepper__title\" *ngIf=\"direction === 'horizontal'\">\n    <ng-content select=\"nx-label\"></ng-content>\n</span>\n\n<div class=\"nx-multi-stepper__items\" role=\"tablist\">\n    <ng-container *ngIf=\"groups.length === 0 || direction === 'horizontal'; else groupsTemplate\">\n        <ng-container *ngFor=\"let step of steps; let i = index; let isLast = last; let isFirst = first\">\n            <nx-multi-step-item\n                (click)=\"!_stepDisabled(i) && step.select()\"\n                (keydown)=\"_onKeydown($event)\"\n                [last]=\"isLast\"\n                [tabindex]=\"_getFocusIndex() === i ? 0 : -1\"\n                [label]=\"step.stepLabel || step.label\"\n                [completed]=\"step.completed\"\n                [selected]=\"selectedIndex === i\"\n                [active]=\"selectedIndex > i\"\n                [disabled]=\"_stepDisabled(i)\"\n                [direction]=\"direction\"\n            >\n            </nx-multi-step-item>\n        </ng-container>\n    </ng-container>\n</div>\n\n<div class=\"labels-container\" *ngIf=\"direction === 'horizontal'\" role=\"tablist\">\n    <div\n        class=\"label\"\n        role=\"tab\"\n        tabindex=\"-1\"\n        [attr.aria-selected]=\"selectedIndex === i\"\n        *ngFor=\"let step of steps; let i = index\"\n        [ngClass]=\"{ 'is-disabled': _stepDisabled(i), 'is-selected': selectedIndex === i }\"\n        (click)=\"!_stepDisabled(i) && step.select()\"\n    >\n        <span>{{ step.label }}</span>\n    </div>\n</div>\n\n<div class=\"nx-progress-stepper__mobile-label\">\n    {{ currentLabel }}\n</div>\n\n<div\n    *ngFor=\"let step of steps; let i = index\"\n    class=\"nx-progress-stepper__content\"\n    role=\"tabpanel\"\n    [id]=\"_getStepContentId(i)\"\n    [attr.aria-label]=\"currentLabel\"\n    [attr.aria-expanded]=\"selectedIndex === i\"\n>\n    <ng-container [ngTemplateOutlet]=\"step.content\"></ng-container>\n</div>\n\n<ng-template #groupsTemplate>\n    <ng-container *ngFor=\"let group of groups; let i = index\">\n        <div class=\"nx-multi-stepper__group\">\n            <div class=\"nx-multi-stepper__group-label\" [class.is-active]=\"_isGroupActive(i)\" [class.is-disabled]=\"_isGroupDisabled(i)\">\n                {{ group.label }}\n            </div>\n\n            <div class=\"nx-multi-stepper__group-items\">\n                <ng-container *ngFor=\"let step of group.steps; let isLast = last\">\n                    <nx-multi-step-item\n                        (click)=\"!_stepDisabled(_getIndex(step)) && step.select()\"\n                        (keydown)=\"_onKeydown($event)\"\n                        [tabindex]=\"_getFocusIndex() === _getIndex(step) ? 0 : -1\"\n                        [last]=\"isLast\"\n                        [label]=\"step.stepLabel || step.label\"\n                        [completed]=\"step.completed\"\n                        [selected]=\"selectedIndex === _getIndex(step)\"\n                        [active]=\"selectedIndex > _getIndex(step)\"\n                        [disabled]=\"_stepDisabled(_getIndex(step))\"\n                        [direction]=\"direction\"\n                    >\n                    </nx-multi-step-item>\n                </ng-container>\n            </div>\n        </div>\n    </ng-container>\n</ng-template>\n", styles: [":host{display:block}.nx-progress-stepper__content[aria-expanded=false]{height:0;overflow:hidden;visibility:hidden}.nx-progress-stepper__mobile-label{display:none;color:var(--progress-indicator-mobile-color);font-size:var(--progress-indicator-mobile-font-size);line-height:var(--progress-indicator-mobile-line-height);font-weight:var(--progress-indicator-mobile-font-weight);letter-spacing:var(--progress-indicator-mobile-letter-spacing)}@media (max-width: 703px){.nx-progress-stepper__mobile-label{display:block;text-align:center}}.nx-progress-stepper__title{display:block}.nx-progress-stepper__title ::ng-deep nx-label{margin-bottom:24px}\n", ":host{width:100%}@media (min-width: 704px){:host.nx-multi-stepper--vertical{display:flex}}:host.nx-multi-stepper--vertical .nx-progress-stepper__content[aria-expanded=false]{width:0}:host.nx-multi-stepper--vertical .nx-multi-stepper__items{align-items:flex-start;flex-direction:column;margin:0 56px 0 0;max-width:100%}[dir=rtl] :host.nx-multi-stepper--vertical .nx-multi-stepper__items{margin:0 0 0 56px}:host.nx-multi-stepper--vertical .nx-multi-stepper__group-items{flex-direction:column;max-width:100%}:host.nx-multi-stepper--vertical .nx-multi-stepper__group-label{transform:none;border-left:4px solid transparent;margin-bottom:16px;margin-left:6px;padding-left:22px}[dir=rtl] :host.nx-multi-stepper--vertical .nx-multi-stepper__group-label{margin-left:0;margin-left:initial;padding-left:0;padding-left:initial;margin-right:6px;padding-right:22px}:host.nx-multi-stepper--vertical .nx-multi-stepper__group:nth-child(n+2) .nx-multi-stepper__group-label{padding-top:16px;margin-top:16px;border-left-style:dotted;border-left-color:var(--multi-stepper-line-color)}:host.nx-multi-stepper--vertical .nx-multi-stepper__group:nth-child(n+2) .nx-multi-stepper__group-label.is-active{padding-top:36px;padding-bottom:20px;margin-top:-nx-spacer(3xs);margin-bottom:-nx-spacer(3xs);border-left-style:solid;border-left-color:var(--multi-stepper-line-filled-color)}[dir=rtl] :host.nx-multi-stepper--vertical .nx-multi-stepper__group:nth-child(n+2) .nx-multi-stepper__group-label{border-left-style:none;border-right-style:dotted;border-right-color:var(--multi-stepper-line-color)}[dir=rtl] :host.nx-multi-stepper--vertical .nx-multi-stepper__group:nth-child(n+2) .nx-multi-stepper__group-label.is-active{border-left-style:none;border-right-style:solid;border-right-color:var(--multi-stepper-line-filled-color)}:host .labels-container{width:100%;flex:1 1 100%;display:flex;margin:0 auto;vertical-align:top;align-self:flex-start;align-items:flex-start}@media (max-width: 703px){:host .labels-container{display:none}}:host .labels-container .label{flex:1 1 100%;display:flex;align-items:center;justify-content:center;position:relative;font-size:var(--multi-stepper-step-font-size);line-height:var(--multi-stepper-step-line-height);font-weight:var(--multi-stepper-step-font-weight);letter-spacing:var(--multi-stepper-step-letter-spacing);color:var(--multi-stepper-step-color);cursor:pointer;text-align:center}:host .labels-container .label.is-disabled{color:var(--multi-stepper-step-disabled-color);cursor:not-allowed}@media screen and (-ms-high-contrast: active){:host .labels-container .label{color:buttonText}:host .labels-container .label.is-disabled{color:GrayText}:host .labels-container .label:not(.is-disabled){color:buttonText}:host .labels-container .label span{-ms-high-contrast-adjust:none;background-color:buttonFace;border-radius:4px;box-shadow:0 0 0 2px buttonFace}:host .labels-container .label.is-selected span{background-color:highlight;border-radius:4px;box-shadow:0 0 0 2px highlight;color:highlightText}}.nx-multi-stepper__items{display:flex;margin:0 auto;align-items:center}@media (max-width: 703px){.nx-multi-stepper__items{display:none}}.nx-multi-stepper__group-items{display:flex}.nx-multi-stepper__group{display:flex;flex-direction:column;flex:1 1 auto;max-width:100%}.nx-multi-stepper__group-label{font-size:var(--multi-stepper-group-font-size);line-height:var(--multi-stepper-group-line-height);font-weight:var(--multi-stepper-group-font-weight);letter-spacing:var(--multi-stepper-group-letter-spacing);color:var(--multi-stepper-group-color)}.nx-multi-stepper__group-label.is-disabled{color:var(--multi-stepper-group-disabled-color)}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i1.Directionality, decorators: [{
                    type: Optional
                }] }, { type: i0.ElementRef }]; }, propDecorators: { _stepHeader: [{
                type: ViewChildren,
                args: [NxMultiStepItemComponent]
            }], groups: [{
                type: ContentChildren,
                args: [NxMultiStepperGroupComponent, { descendants: true }]
            }], direction: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGktc3RlcC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1hcXVpbGEvc3JjL3Byb2dyZXNzLXN0ZXBwZXIvbXVsdGkvbXVsdGktc3RlcC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1hcXVpbGEvc3JjL3Byb2dyZXNzLXN0ZXBwZXIvbXVsdGkvbXVsdGktc3RlcC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBR0gsdUJBQXVCLEVBRXZCLFNBQVMsRUFDVCxlQUFlLEVBRWYsS0FBSyxFQUVMLFFBQVEsRUFFUixZQUFZLEdBQ2YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE9BQU8sRUFBRSwwQkFBMEIsRUFBbUIsTUFBTSwrQkFBK0IsQ0FBQztBQUU1RixPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUM1RSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQzs7Ozs7QUFZdkUsTUFBTSxPQUFPLHVCQUF3QixTQUFRLDBCQUEwQjtJQXFCbkUsWUFBWSxJQUF1QixFQUFjLElBQTJCLEVBQUUsR0FBNEI7UUFDdEcsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFIbkIsZUFBVSxHQUE0QixZQUFZLENBQUM7SUFJM0QsQ0FBQztJQVpELCtDQUErQztJQUMvQyxJQUNJLFNBQVM7UUFDVCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDM0IsQ0FBQztJQUNELElBQUksU0FBUyxDQUFDLEtBQThCO1FBQ3hDLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO0lBQzVCLENBQUM7SUFPRCxrQkFBa0I7UUFDZCxrRkFBa0Y7UUFDbEYsc0ZBQXNGO1FBQ3RGLDBD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TUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRXJDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDakMsS0FBSyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO1NBQ25DO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQzs7b0hBakdRLHVCQUF1Qjt3R0FBdkIsdUJBQXVCLDJLQU5yQixDQUFDLEVBQUUsT0FBTyxFQUFFLDBCQUEwQixFQUFFLFdBQVcsRUFBRSx1QkFBdUIsRUFBRSxDQUFDLGlEQWN6RSw0QkFBNEIsZ0ZBSC9CLHdCQUF3Qix1RUNyQzFDLDR3R0FnRkE7MkZEaERhLHVCQUF1QjtrQkFWbkMsU0FBUzsrQkFDSSxrQkFBa0IsYUFHakIsQ0FBQyxFQUFFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxXQUFXLHlCQUF5QixFQUFFLENBQUMsbUJBQ3pFLHVCQUF1QixDQUFDLE1BQU0sUUFDekM7d0JBQ0Ysb0NBQW9DLEVBQUUsMEJBQTBCO3FCQUNuRTs7MEJBdUJxQyxRQUFRO3FFQWhCTixXQUFXO3NCQUFsRCxZQUFZO3VCQUFDLHdCQUF3QjtnQkFJdEMsTUFBTTtzQkFETCxlQUFlO3VCQUFDLDRCQUE0QixFQUFFLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRTtnQkFLaEUsU0FBUztzQkFEWixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aW9uYWxpdHkgfSBmcm9tICdAYW5ndWxhci9jZGsvYmlkaSc7XG5pbXBvcnQge1xuICAgIEFmdGVyQ29udGVudEluaXQsXG4gICAgQWZ0ZXJWaWV3Q2hlY2tlZCxcbiAgICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBDb21wb25lbnQsXG4gICAgQ29udGVudENoaWxkcmVuLFxuICAgIEVsZW1lbnRSZWYsXG4gICAgSW5wdXQsXG4gICAgT25EZXN0cm95LFxuICAgIE9wdGlvbmFsLFxuICAgIFF1ZXJ5TGlzdCxcbiAgICBWaWV3Q2hpbGRyZW4sXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBOeFByb2dyZXNzU3RlcHBlckRpcmVjdGl2ZSwgTnhTdGVwQ29tcG9uZW50IH0gZnJvbSAnLi4vcHJvZ3Jlc3Mtc3RlcHBlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgTnhNdWx0aVN0ZXBwZXJEaXJlY3Rpb24gfSBmcm9tICcuLi9wcm9ncmVzcy1zdGVwcGVyLm1vZGVscyc7XG5pbXBvcnQgeyBOeE11bHRpU3RlcHBlckdyb3VwQ29tcG9uZW50IH0gZnJvbSAnLi9tdWx0aS1zdGVwLWdyb3VwLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBOeE11bHRpU3RlcEl0ZW1Db21wb25lbnQgfSBmcm9tICcuL211bHRpLXN0ZXAtaXRlbS5jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ254LW11bHRpLXN0ZXBwZXInLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9tdWx0aS1zdGVwLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi4vcHJvZ3Jlc3Mtc3RlcHBlci5jb21wb25lbnQuc2NzcycsICcuL211bHRpLXN0ZXAuY29tcG9uZW50LnNjc3MnXSxcbiAgICBwcm92aWRlcnM6IFt7IHByb3ZpZGU6IE54UHJvZ3Jlc3NTdGVwcGVyRGlyZWN0aXZlLCB1c2VFeGlzdGluZzogTnhNdWx0aVN0ZXBwZXJDb21wb25lbnQgfV0sXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gICAgaG9zdDoge1xuICAgICAgICAnW2NsYXNzLm54LW11bHRpLXN0ZXBwZXItLXZlcnRpY2FsXSc6ICdkaXJlY3Rpb24gPT09IFwidmVydGljYWxcIicsXG4gICAgfSxcbn0pXG5leHBvcnQgY2xhc3MgTnhNdWx0aVN0ZXBwZXJDb21wb25lbnQgZXh0ZW5kcyBOeFByb2dyZXNzU3RlcHBlckRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uRGVzdHJveSwgQWZ0ZXJDb250ZW50SW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCB7XG4gICAgLyoqXG4gICAgICogV2UgbmVlZCB0byBzZXQgdGhlIF9zdGVwSGVhZGVyIHByb3BlcnR5IGFzIFZpZXdDaGlsZHJlbiBoZXJlXG4gICAgICogYXMgaXQgaXMgYSBDb250ZW50Q2hpbGRyZW4gcXVlcnkgaW4gdGhlIENES1xuICAgICAqL1xuICAgIEBWaWV3Q2hpbGRyZW4oTnhNdWx0aVN0ZXBJdGVtQ29tcG9uZW50KSBfc3RlcEhlYWRlciE6IFF1ZXJ5TGlzdDxOeE11bHRpU3RlcEl0ZW1Db21wb25lbnQ+O1xuXG4gICAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgICBAQ29udGVudENoaWxkcmVuKE54TXVsdGlTdGVwcGVyR3JvdXBDb21wb25lbnQsIHsgZGVzY2VuZGFudHM6IHRydWUgfSlcbiAgICBncm91cHMhOiBRdWVyeUxpc3Q8TnhNdWx0aVN0ZXBwZXJHcm91cENvbXBvbmVudD47XG5cbiAgICAvKiogU2V0cyB0aGUgZGlyZWN0aW9uIG9mIHRoZSBtdWx0aSBzdGVwcGVyLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZ2V0IGRpcmVjdGlvbigpOiBOeE11bHRpU3RlcHBlckRpcmVjdGlvbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kaXJlY3Rpb247XG4gICAgfVxuICAgIHNldCBkaXJlY3Rpb24odmFsdWU6IE54TXVsdGlTdGVwcGVyRGlyZWN0aW9uKSB7XG4gICAgICAgIHRoaXMuX2RpcmVjdGlvbiA9IHZhbHVlO1xuICAgIH1cbiAgICBwcml2YXRlIF9kaXJlY3Rpb246IE54TXVsdGlTdGVwcGVyRGlyZWN0aW9uID0gJ2hvcml6b250YWwnO1xuXG4gICAgY29uc3RydWN0b3IoX2NkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsIEBPcHRpb25hbCgpIF9kaXI6IERpcmVjdGlvbmFsaXR5IHwgbnVsbCwgX2VsOiBFbGVtZW50UmVmPEhUTUxFbGVtZW50Pikge1xuICAgICAgICBzdXBlcihfY2RyLCBfZGlyLCBfZWwpO1xuICAgIH1cblxuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcbiAgICAgICAgLy8gdGhlIF9rZXlNYW5hZ2VyIGlzIGN1cnJlbnRseSBwcml2YXRlIGluIHRoZSBDZGtTdGVwcGVyIGFuZCB0aGUgQ0RLL01hdGVyaWFsIHdheVxuICAgICAgICAvLyBpcyB0byBjcmVhdGUgdG8gc2VwYXJhdGUgY29tcG9uZW50cyBmb3IgdGhlIHZlcnRpY2FsIGFuZCBob3Jpem9udGFsIHN0ZXBwZXIgd2l0aCBub1xuICAgICAgICAvLyBwb3NzaWJpbGl0eSB0byBjaGFuZ2UgaXQgZHVyaW5nIHJ1bnRpbWVcbiAgICAgICAgLy8gb3BlbmVkIGEgdGlja2V0OiBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9jb21wb25lbnRzL2lzc3Vlcy8yMTg3NFxuICAgICAgICAvLyBmb3Igbm93IHRoZSBxdWljayBzb2x1dGlvbiBpcyB0aGUgaGFja3kgd2F5IHRvIGFjY2VzcyB0aGUgcHJpdmF0ZSBwcm9wZXJ0eVxuICAgICAgICB0aGlzWydfa2V5TWFuYWdlciddLndpdGhWZXJ0aWNhbE9yaWVudGF0aW9uKHRoaXMuX2RpcmVjdGlvbiA9PT0gJ3ZlcnRpY2FsJyk7XG4gICAgfVxuXG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgICAgICBzdXBlci5uZ0FmdGVyQ29udGVudEluaXQoKTtcblxuICAgICAgICBpZiAodGhpcy5ncm91cHMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnN0ZXBzLnJlc2V0KHRoaXMuX3N0ZXBzSW5Hcm91cHMpO1xuICAgICAgICAgICAgdGhpcy5zdGVwcy5ub3RpZnlPbkNoYW5nZXMoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZ3JvdXBzLmNoYW5nZXMucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc3RlcHMucmVzZXQodGhpcy5fc3RlcHNJbkdyb3Vwcyk7XG4gICAgICAgICAgICB0aGlzLnN0ZXBzLm5vdGlmeU9uQ2hhbmdlcygpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fZGVzdHJveWVkLm5leHQoKTtcbiAgICAgICAgdGhpcy5fZGVzdHJveWVkLmNvbXBsZXRlKCk7XG4gICAgfVxuXG4gICAgX3N0ZXBEaXNhYmxlZChpbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IHN0ZXBzID0gdGhpcy5zdGVwcy50b0FycmF5KCk7XG5cbiAgICAgICAgaWYgKHRoaXMubGluZWFyICYmIGluZGV4ID49IDApIHtcbiAgICAgICAgICAgIHJldHVybiBzdGVwcy5zbGljZSgwLCBpbmRleCkuc29tZShzdGVwID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb250cm9sID0gc3RlcC5zdGVwQ29udHJvbDtcbiAgICAgICAgICAgICAgICBjb25zdCBpc0luY29tcGxldGUgPSBjb250cm9sID8gY29udHJvbC5pbnZhbGlkIHx8IGNvbnRyb2wucGVuZGluZyB8fCAhc3RlcC5pbnRlcmFjdGVkIDogIXN0ZXAuY29tcGxldGVkO1xuICAgICAgICAgICAgICAgIHJldHVybiBpc0luY29tcGxldGUgJiYgIXN0ZXAub3B0aW9uYWw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldCBfc3RlcHNJbkdyb3VwcygpOiBOeFN0ZXBDb21wb25lbnRbXSB7XG4gICAgICAgIGlmICh0aGlzLmdyb3Vwcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdyb3Vwcy5yZWR1Y2U8TnhTdGVwQ29tcG9uZW50W10+KChzdGVwcywgZ3JvdXApID0+IHN0ZXBzLmNvbmNhdChncm91cC5zdGVwcy50b0FycmF5KCkpLCBbXSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgLy8gUmV0dXJucyB0aGUgaW5kZXggb2YgYSBjZXJ0YWluIHN0ZXBcbiAgICBfZ2V0SW5kZXgoc3RlcDogTnhTdGVwQ29tcG9uZW50KTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RlcHMudG9BcnJheSgpLmluZGV4T2Yoc3RlcCk7XG4gICAgfVxuXG4gICAgX2lzR3JvdXBBY3RpdmUoZ3JvdXBJbmRleDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkSW5kZXggPj0gdGhpcy5nZXRHcm91cEl0ZW1JbmRleChncm91cEluZGV4KTtcbiAgICB9XG5cbiAgICBfaXNHcm91cERpc2FibGVkKGdyb3VwSW5kZXg6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3RlcERpc2FibGVkKHRoaXMuZ2V0R3JvdXBJdGVtSW5kZXgoZ3JvdXBJbmRleCkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0R3JvdXBJdGVtSW5kZXgoZ3JvdXBJbmRleDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgbGV0IGNvdW50ID0gMDtcbiAgICAgICAgY29uc3QgZ3JvdXBzID0gdGhpcy5ncm91cHMudG9BcnJheSgpO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JvdXBJbmRleDsgaSsrKSB7XG4gICAgICAgICAgICBjb3VudCArPSBncm91cHNbaV0uc3RlcHMubGVuZ3RoO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNvdW50O1xuICAgIH1cbn1cbiIsIjxzcGFuIGNsYXNzPVwibngtcHJvZ3Jlc3Mtc3RlcHBlcl9fdGl0bGVcIiAqbmdJZj1cImRpcmVjdGlvbiA9PT0gJ2hvcml6b250YWwnXCI+XG4gICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwibngtbGFiZWxcIj48L25nLWNvbnRlbnQ+XG48L3NwYW4+XG5cbjxkaXYgY2xhc3M9XCJueC1tdWx0aS1zdGVwcGVyX19pdGVtc1wiIHJvbGU9XCJ0YWJsaXN0XCI+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImdyb3Vwcy5sZW5ndGggPT09IDAgfHwgZGlyZWN0aW9uID09PSAnaG9yaXpvbnRhbCc7IGVsc2UgZ3JvdXBzVGVtcGxhdGVcIj5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdGb3I9XCJsZXQgc3RlcCBvZiBzdGVwczsgbGV0IGkgPSBpbmRleDsgbGV0IGlzTGFzdCA9IGxhc3Q7IGxldCBpc0ZpcnN0ID0gZmlyc3RcIj5cbiAgICAgICAgICAgIDxueC1tdWx0aS1zdGVwLWl0ZW1cbiAgICAgICAgICAgICAgICAoY2xpY2spPVwiIV9zdGVwRGlzYWJsZWQoaSkgJiYgc3RlcC5zZWxlY3QoKVwiXG4gICAgICAgICAgICAgICAgKGtleWRvd24pPVwiX29uS2V5ZG93bigkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICBbbGFzdF09XCJpc0xhc3RcIlxuICAgICAgICAgICAgICAgIFt0YWJpbmRleF09XCJfZ2V0Rm9jdXNJbmRleCgpID09PSBpID8gMCA6IC0xXCJcbiAgICAgICAgICAgICAgICBbbGFiZWxdPVwic3RlcC5zdGVwTGFiZWwgfHwgc3RlcC5sYWJlbFwiXG4gICAgICAgICAgICAgICAgW2NvbXBsZXRlZF09XCJzdGVwLmNvbXBsZXRlZFwiXG4gICAgICAgICAgICAgICAgW3NlbGVjdGVkXT1cInNlbGVjdGVkSW5kZXggPT09IGlcIlxuICAgICAgICAgICAgICAgIFthY3RpdmVdPVwic2VsZWN0ZWRJbmRleCA+IGlcIlxuICAgICAgICAgICAgICAgIFtkaXNhYmxlZF09XCJfc3RlcERpc2FibGVkKGkpXCJcbiAgICAgICAgICAgICAgICBbZGlyZWN0aW9uXT1cImRpcmVjdGlvblwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICA8L254LW11bHRpLXN0ZXAtaXRlbT5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9uZy1jb250YWluZXI+XG48L2Rpdj5cblxuPGRpdiBjbGFzcz1cImxhYmVscy1jb250YWluZXJcIiAqbmdJZj1cImRpcmVjdGlvbiA9PT0gJ2hvcml6b250YWwnXCIgcm9sZT1cInRhYmxpc3RcIj5cbiAgICA8ZGl2XG4gICAgICAgIGNsYXNzPVwibGFiZWxcIlxuICAgICAgICByb2xlPVwidGFiXCJcbiAgICAgICAgdGFiaW5kZXg9XCItMVwiXG4gICAgICAgIFthdHRyLmFyaWEtc2VsZWN0ZWRdPVwic2VsZWN0ZWRJbmRleCA9PT0gaVwiXG4gICAgICAgICpuZ0Zvcj1cImxldCBzdGVwIG9mIHN0ZXBzOyBsZXQgaSA9IGluZGV4XCJcbiAgICAgICAgW25nQ2xhc3NdPVwieyAnaXMtZGlzYWJsZWQnOiBfc3RlcERpc2FibGVkKGkpLCAnaXMtc2VsZWN0ZWQnOiBzZWxlY3RlZEluZGV4ID09PSBpIH1cIlxuICAgICAgICAoY2xpY2spPVwiIV9zdGVwRGlzYWJsZWQoaSkgJiYgc3RlcC5zZWxlY3QoKVwiXG4gICAgPlxuICAgICAgICA8c3Bhbj57eyBzdGVwLmxhYmVsIH19PC9zcGFuPlxuICAgIDwvZGl2PlxuPC9kaXY+XG5cbjxkaXYgY2xhc3M9XCJueC1wcm9ncmVzcy1zdGVwcGVyX19tb2JpbGUtbGFiZWxcIj5cbiAgICB7eyBjdXJyZW50TGFiZWwgfX1cbjwvZGl2PlxuXG48ZGl2XG4gICAgKm5nRm9yPVwibGV0IHN0ZXAgb2Ygc3RlcHM7IGxldCBpID0gaW5kZXhcIlxuICAgIGNsYXNzPVwibngtcHJvZ3Jlc3Mtc3RlcHBlcl9fY29udGVudFwiXG4gICAgcm9sZT1cInRhYnBhbmVsXCJcbiAgICBbaWRdPVwiX2dldFN0ZXBDb250ZW50SWQoaSlcIlxuICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiY3VycmVudExhYmVsXCJcbiAgICBbYXR0ci5hcmlhLWV4cGFuZGVkXT1cInNlbGVjdGVkSW5kZXggPT09IGlcIlxuPlxuICAgIDxuZy1jb250YWluZXIgW25nVGVtcGxhdGVPdXRsZXRdPVwic3RlcC5jb250ZW50XCI+PC9uZy1jb250YWluZXI+XG48L2Rpdj5cblxuPG5nLXRlbXBsYXRlICNncm91cHNUZW1wbGF0ZT5cbiAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBncm91cCBvZiBncm91cHM7IGxldCBpID0gaW5kZXhcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm54LW11bHRpLXN0ZXBwZXJfX2dyb3VwXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibngtbXVsdGktc3RlcHBlcl9fZ3JvdXAtbGFiZWxcIiBbY2xhc3MuaXMtYWN0aXZlXT1cIl9pc0dyb3VwQWN0aXZlKGkpXCIgW2NsYXNzLmlzLWRpc2FibGVkXT1cIl9pc0dyb3VwRGlzYWJsZWQoaSlcIj5cbiAgICAgICAgICAgICAgICB7eyBncm91cC5sYWJlbCB9fVxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJueC1tdWx0aS1zdGVwcGVyX19ncm91cC1pdGVtc1wiPlxuICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IHN0ZXAgb2YgZ3JvdXAuc3RlcHM7IGxldCBpc0xhc3QgPSBsYXN0XCI+XG4gICAgICAgICAgICAgICAgICAgIDxueC1tdWx0aS1zdGVwLWl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XCIhX3N0ZXBEaXNhYmxlZChfZ2V0SW5kZXgoc3RlcCkpICYmIHN0ZXAuc2VsZWN0KClcIlxuICAgICAgICAgICAgICAgICAgICAgICAgKGtleWRvd24pPVwiX29uS2V5ZG93bigkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIFt0YWJpbmRleF09XCJfZ2V0Rm9jdXNJbmRleCgpID09PSBfZ2V0SW5kZXgoc3RlcCkgPyAwIDogLTFcIlxuICAgICAgICAgICAgICAgICAgICAgICAgW2xhc3RdPVwiaXNMYXN0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtsYWJlbF09XCJzdGVwLnN0ZXBMYWJlbCB8fCBzdGVwLmxhYmVsXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtjb21wbGV0ZWRdPVwic3RlcC5jb21wbGV0ZWRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgW3NlbGVjdGVkXT1cInNlbGVjdGVkSW5kZXggPT09IF9nZXRJbmRleChzdGVwKVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBbYWN0aXZlXT1cInNlbGVjdGVkSW5kZXggPiBfZ2V0SW5kZXgoc3RlcClcIlxuICAgICAgICAgICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cIl9zdGVwRGlzYWJsZWQoX2dldEluZGV4KHN0ZXApKVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBbZGlyZWN0aW9uXT1cImRpcmVjdGlvblwiXG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgPC9ueC1tdWx0aS1zdGVwLWl0ZW0+XG4gICAgICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9uZy1jb250YWluZXI+XG48L25nLXRlbXBsYXRlPlxuIl19