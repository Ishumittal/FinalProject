import { animateChild, query, transition, trigger, useAnimation } from '@angular/animations';
import { ChangeDetectionStrategy, Component, Directive, EventEmitter, Input, Output, ViewChild, } from '@angular/core';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { fadeIn, fadeOut, scaleDown, scaleUp } from './animations';
import * as i0 from "@angular/core";
import * as i1 from "./modal.service";
import * as i2 from "@angular/platform-browser";
import * as i3 from "@angular/cdk/a11y";
import * as i4 from "@aposin/ng-aquila/icon";
import * as i5 from "@angular/common";
import * as i6 from "@angular/cdk/scrolling";
/** Container for the action buttons in a modal. Has a fixed position at the bottom of the modal on scroll. */
export class NxModalActionsDirective {
}
NxModalActionsDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxModalActionsDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive });
NxModalActionsDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.3.1", type: NxModalActionsDirective, selector: "[nxModalActions]", host: { properties: { "class.nx-modal__actions": "true" } }, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxModalActionsDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[nxModalActions]',
                    host: {
                        '[class.nx-modal__actions]': 'true',
                    },
                }]
        }] });
/** Scrollable container for the content of a modal. */
export class NxModalContentDirective {
}
NxModalContentDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxModalContentDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive });
NxModalContentDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.3.1", type: NxModalContentDirective, selector: "[nxModalContent]", host: { properties: { "class.nx-modal__content": "true" } }, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxModalContentDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[nxModalContent]',
                    host: {
                        '[class.nx-modal__content]': 'true',
                    },
                }]
        }] });
export class NxModalComponent {
    constructor(modalService, eventManager, _cdr, _focusMonitor) {
        this.modalService = modalService;
        this.eventManager = eventManager;
        this._cdr = _cdr;
        this._focusMonitor = _focusMonitor;
        this._closeButtonLabel = 'Close dialog';
        /**
         * Whether the modal view should close when the user hits the escape key.
         * Default is true.
         */
        this.hideOnEsc = true;
        /**
         * Whether the modal view should close when the user clicks on the backdrop.
         * Default is true.
         */
        this.hideOnClickOutside = true;
        /**
         * Whether the modal view should have a close icon in the upper right corner.
         * Default is true.
         */
        this.showCloseIcon = true;
        /**
         * Controls the width of the dialog.
         * On `auto` the width is controlled by the content width,
         * on `fixed` the dialog gets a fixed width of 736px if the viewport is big enough. */
        this.size = 'auto';
        /**
         * An event emitted when the user clicks on the backdrop or uses the built-in close button.
         * This event can be applied in conjunction with the custom open state handling
         * of a modal to close it when requested by the user.
         */
        this.closeEvent = new EventEmitter();
        this._destroyed = new Subject();
    }
    /** Sets the 'aria-label' of the modal close button needed for accessibility.
     *
     * Default value is 'Close dialog'.
     */
    set closeButtonLabel(value) {
        if (value !== this._closeButtonLabel) {
            this._closeButtonLabel = value;
            this._cdr.markForCheck();
        }
    }
    get closeButtonLabel() {
        return this._closeButtonLabel;
    }
    ngOnInit() {
        this.modalService.close$.pipe(takeUntil(this._destroyed)).subscribe(() => this.closeEvent.emit());
        this.removeEventListener = this.eventManager.addGlobalEventListener('window', 'keyup.esc', () => {
            if (this.hideOnEsc) {
                this.modalService.close();
            }
        });
    }
    ngAfterViewInit() {
        if (this.showCloseIcon) {
            this._focusMonitor.monitor(this._closeButton);
        }
    }
    ngOnDestroy() {
        this._destroyed.next();
        this._destroyed.complete();
        this.removeEventListener();
        this._focusMonitor.stopMonitoring(this._closeButton);
    }
    /** @docs-private */
    clickOutsideModal() {
        if (this.hideOnClickOutside) {
            this.modalService.close();
        }
    }
    /** @docs-private */
    closeButtonClick() {
        this.modalService.close();
    }
    /** @docs-private */
    cancelClick(evt) {
        evt.stopPropagation();
    }
}
NxModalComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxModalComponent, deps: [{ token: i1.NxModalService }, { token: i2.EventManager }, { token: i0.ChangeDetectorRef }, { token: i3.FocusMonitor }], target: i0.ɵɵFactoryTarget.Component });
NxModalComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxModalComponent, selector: "nx-modal", inputs: { closeButtonLabel: "closeButtonLabel", body: ["nxBody", "body"], hideOnEsc: ["nxHideOnEsc", "hideOnEsc"], hideOnClickOutside: ["nxHideOnClickOutside", "hideOnClickOutside"], showCloseIcon: ["nxShowCloseIcon", "showCloseIcon"], size: ["nxSize", "size"] }, outputs: { closeEvent: "nxClose" }, host: { properties: { "@fadeInOut": "", "class.nx-modal--fixed-width": "size === \"fixed\"" } }, viewQueries: [{ propertyName: "_closeButton", first: true, predicate: ["closeButton"], descendants: true }], ngImport: i0, template: "<div class=\"nx-modal\" role=\"dialog\" cdkTrapFocus cdkTrapFocusAutoCapture cdkFocusInitial>\n    <div class=\"nx-modal__backdrop\" (click)=\"clickOutsideModal()\">\n        <div class=\"nx-modal__position\">\n            <div class=\"nx-modal__container\" (click)=\"cancelClick($event)\" [@scaleUpDown]>\n                <button\n                    #closeButton\n                    (click)=\"closeButtonClick()\"\n                    *ngIf=\"showCloseIcon\"\n                    [attr.aria-label]=\"closeButtonLabel\"\n                    class=\"nx-modal__close\"\n                    type=\"button\"\n                >\n                    <nx-icon name=\"close\"></nx-icon>\n                </button>\n\n                <div class=\"nx-modal__content-wrapper\" cdkScrollable>\n                    <ng-container *ngIf=\"body; else projectContent\">\n                        <ng-container *ngTemplateOutlet=\"body\"></ng-container>\n                    </ng-container>\n\n                    <ng-template #projectContent>\n                        <ng-content></ng-content>\n                    </ng-template>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n", styles: [":host{position:relative;z-index:1000}.nx-modal{display:flex;position:fixed;width:100vw;height:100vh;top:0;bottom:0;left:0;right:0;z-index:1000;align-items:center;justify-content:center;transition:opacity .3s ease}.nx-modal__backdrop{background-color:#00000059;height:100%;left:0;position:absolute;top:0;width:100%;z-index:-1}.nx-modal__position{position:absolute;display:inline-block;top:50%;left:50%;transform:translate(-50%,-50%);z-index:20}.nx-modal__container{border-radius:4px;box-shadow:var(--shadow-large);background:var(--modal-background-color);color:var(--modal-text-color)}.nx-modal__content-wrapper{padding:40px 40px 48px;max-height:calc(100vh - 48px);overflow-y:auto}@media (max-width: 703px){.nx-modal__content-wrapper{max-height:70vh;padding:40px 32px 48px}}.nx-modal__close{background-color:transparent;border:none;cursor:pointer;position:absolute;top:16px;right:16px;height:24px;outline:none;padding:0;color:var(--modal-close-icon-color)}.nx-modal__close nx-icon{font-size:24px}.nx-modal__close::-moz-focus-inner{border:0}:host-context([dir=rtl]) .nx-modal__close{right:auto;left:16px}.nx-modal__close.cdk-keyboard-focused{box-shadow:var(--focus-box-shadow);border-radius:4px}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-modal__close.cdk-keyboard-focused{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}@media (max-width: 703px){.nx-modal__position{width:100%}.nx-modal__container{position:relative;max-width:calc(100vw - 16px);max-height:70vh;margin:0 auto}}:host(.nx-modal--fixed-width) .nx-modal__container{width:736px;max-width:calc(100vw - 16px)}::ng-deep .nx-modal__actions{height:72px;border-top:1px solid var(--modal-actions-border-color);display:flex;align-items:center;justify-content:flex-end;padding:0 40px;position:absolute;bottom:0;left:0;width:100%;border-bottom-left-radius:4px;border-bottom-right-radius:4px;background:var(--modal-actions-background-color)}::ng-deep .nx-modal__content{overflow-y:auto;max-height:calc(100vh - 120px);padding:0 40px;margin:0 -40px}@media (max-width: 703px){::ng-deep .nx-modal__content{max-height:calc(70vh - 120px);margin:0 -32px}}@media screen and (-ms-high-contrast: active){.nx-modal__content-wrapper,::ng-deep .nx-modal__actions{border:2px solid windowText}}\n"], components: [{ type: i4.NxIconComponent, selector: "nx-icon", inputs: ["name", "outline", "fill", "size", "font"] }], directives: [{ type: i3.CdkTrapFocus, selector: "[cdkTrapFocus]", inputs: ["cdkTrapFocus", "cdkTrapFocusAutoCapture"], exportAs: ["cdkTrapFocus"] }, { type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i6.CdkScrollable, selector: "[cdk-scrollable], [cdkScrollable]" }, { type: i5.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }], animations: [
        trigger('fadeInOut', [
            transition(':enter', [useAnimation(fadeIn), query('@scaleUpDown', [animateChild()])]),
            transition(':leave', [query('@scaleUpDown', [animateChild()]), useAnimation(fadeOut)]),
        ]),
        trigger('scaleUpDown', [transition(':enter', useAnimation(scaleDown)), transition(':leave', useAnimation(scaleUp))]),
    ], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxModalComponent, decorators: [{
            type: Component,
            args: [{ selector: 'nx-modal', changeDetection: ChangeDetectionStrategy.OnPush, animations: [
                        trigger('fadeInOut', [
                            transition(':enter', [useAnimation(fadeIn), query('@scaleUpDown', [animateChild()])]),
                            transition(':leave', [query('@scaleUpDown', [animateChild()]), useAnimation(fadeOut)]),
                        ]),
                        trigger('scaleUpDown', [transition(':enter', useAnimation(scaleDown)), transition(':leave', useAnimation(scaleUp))]),
                    ], host: {
                        '[@fadeInOut]': '',
                        '[class.nx-modal--fixed-width]': 'size === "fixed"',
                    }, template: "<div class=\"nx-modal\" role=\"dialog\" cdkTrapFocus cdkTrapFocusAutoCapture cdkFocusInitial>\n    <div class=\"nx-modal__backdrop\" (click)=\"clickOutsideModal()\">\n        <div class=\"nx-modal__position\">\n            <div class=\"nx-modal__container\" (click)=\"cancelClick($event)\" [@scaleUpDown]>\n                <button\n                    #closeButton\n                    (click)=\"closeButtonClick()\"\n                    *ngIf=\"showCloseIcon\"\n                    [attr.aria-label]=\"closeButtonLabel\"\n                    class=\"nx-modal__close\"\n                    type=\"button\"\n                >\n                    <nx-icon name=\"close\"></nx-icon>\n                </button>\n\n                <div class=\"nx-modal__content-wrapper\" cdkScrollable>\n                    <ng-container *ngIf=\"body; else projectContent\">\n                        <ng-container *ngTemplateOutlet=\"body\"></ng-container>\n                    </ng-container>\n\n                    <ng-template #projectContent>\n                        <ng-content></ng-content>\n                    </ng-template>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n", styles: [":host{position:relative;z-index:1000}.nx-modal{display:flex;position:fixed;width:100vw;height:100vh;top:0;bottom:0;left:0;right:0;z-index:1000;align-items:center;justify-content:center;transition:opacity .3s ease}.nx-modal__backdrop{background-color:#00000059;height:100%;left:0;position:absolute;top:0;width:100%;z-index:-1}.nx-modal__position{position:absolute;display:inline-block;top:50%;left:50%;transform:translate(-50%,-50%);z-index:20}.nx-modal__container{border-radius:4px;box-shadow:var(--shadow-large);background:var(--modal-background-color);color:var(--modal-text-color)}.nx-modal__content-wrapper{padding:40px 40px 48px;max-height:calc(100vh - 48px);overflow-y:auto}@media (max-width: 703px){.nx-modal__content-wrapper{max-height:70vh;padding:40px 32px 48px}}.nx-modal__close{background-color:transparent;border:none;cursor:pointer;position:absolute;top:16px;right:16px;height:24px;outline:none;padding:0;color:var(--modal-close-icon-color)}.nx-modal__close nx-icon{font-size:24px}.nx-modal__close::-moz-focus-inner{border:0}:host-context([dir=rtl]) .nx-modal__close{right:auto;left:16px}.nx-modal__close.cdk-keyboard-focused{box-shadow:var(--focus-box-shadow);border-radius:4px}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-modal__close.cdk-keyboard-focused{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}@media (max-width: 703px){.nx-modal__position{width:100%}.nx-modal__container{position:relative;max-width:calc(100vw - 16px);max-height:70vh;margin:0 auto}}:host(.nx-modal--fixed-width) .nx-modal__container{width:736px;max-width:calc(100vw - 16px)}::ng-deep .nx-modal__actions{height:72px;border-top:1px solid var(--modal-actions-border-color);display:flex;align-items:center;justify-content:flex-end;padding:0 40px;position:absolute;bottom:0;left:0;width:100%;border-bottom-left-radius:4px;border-bottom-right-radius:4px;background:var(--modal-actions-background-color)}::ng-deep .nx-modal__content{overflow-y:auto;max-height:calc(100vh - 120px);padding:0 40px;margin:0 -40px}@media (max-width: 703px){::ng-deep .nx-modal__content{max-height:calc(70vh - 120px);margin:0 -32px}}@media screen and (-ms-high-contrast: active){.nx-modal__content-wrapper,::ng-deep .nx-modal__actions{border:2px solid windowText}}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.NxModalService }, { type: i2.EventManager }, { type: i0.ChangeDetectorRef }, { type: i3.FocusMonitor }]; }, propDecorators: { _closeButton: [{
                type: ViewChild,
                args: ['closeButton']
            }], closeButtonLabel: [{
                type: Input
            }], body: [{
                type: Input,
                args: ['nxBody']
            }], hideOnEsc: [{
                type: Input,
                args: ['nxHideOnEsc']
            }], hideOnClickOutside: [{
                type: Input,
                args: ['nxHideOnClickOutside']
            }], showCloseIcon: [{
                type: Input,
                args: ['nxShowCloseIcon']
            }], size: [{
                type: Input,
                args: ['nxSize']
            }], closeEvent: [{
                type: Output,
                args: ['nxClose']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmctYXF1aWxhL3NyYy9tb2RhbC9tb2RhbC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1hcXVpbGEvc3JjL21vZGFsL21vZGFsLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFN0YsT0FBTyxFQUVILHVCQUF1QixFQUV2QixTQUFTLEVBQ1QsU0FBUyxFQUVULFlBQVksRUFDWixLQUFLLEVBR0wsTUFBTSxFQUVOLFNBQVMsR0FDWixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLE1BQU0sY0FBYyxDQUFDOzs7Ozs7OztBQUduRSw4R0FBOEc7QUFPOUcsTUFBTSxPQUFPLHVCQUF1Qjs7b0hBQXZCLHVCQUF1Qjt3R0FBdkIsdUJBQXVCOzJGQUF2Qix1QkFBdUI7a0JBTm5DLFNBQVM7bUJBQUM7b0JBQ1AsUUFBUSxFQUFFLGtCQUFrQjtvQkFDNUIsSUFBSSxFQUFFO3dCQUNGLDJCQUEyQixFQUFFLE1BQU07cUJBQ3RDO2lCQUNKOztBQUdELHVEQUF1RDtBQU92RCxNQUFNLE9BQU8sdUJBQXVCOztvSEFBdkIsdUJBQXVCO3dHQUF2Qix1QkFBdUI7MkZBQXZCLHVCQUF1QjtrQkFObkMsU0FBUzttQkFBQztvQkFDUCxRQUFRLEVBQUUsa0JBQWtCO29CQUM1QixJQUFJLEVBQUU7d0JBQ0YsMkJBQTJCLEVBQUUsTUFBTTtx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QkFEbkIsS0FBSztnQkFlVyxJQUFJO3NCQUFwQixLQUFLO3VCQUFDLFFBQVE7Z0JBTU8sU0FBUztzQkFBOUIsS0FBSzt1QkFBQyxhQUFhO2dCQU1XLGtCQUFrQjtzQkFBaEQsS0FBSzt1QkFBQyxzQkFBc0I7Z0JBTUgsYUFBYTtzQkFBdEMsS0FBSzt1QkFBQyxpQkFBaUI7Z0JBTVAsSUFBSTtzQkFBcEIsS0FBSzt1QkFBQyxRQUFRO2dCQU9JLFVBQVU7c0JBQTVCLE1BQU07dUJBQUMsU0FBUyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFuaW1hdGVDaGlsZCwgcXVlcnksIHRyYW5zaXRpb24sIHRyaWdnZXIsIHVzZUFuaW1hdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgRm9jdXNNb25pdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2ExMXknO1xuaW1wb3J0IHtcbiAgICBBZnRlclZpZXdJbml0LFxuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgIENvbXBvbmVudCxcbiAgICBEaXJlY3RpdmUsXG4gICAgRWxlbWVudFJlZixcbiAgICBFdmVudEVtaXR0ZXIsXG4gICAgSW5wdXQsXG4gICAgT25EZXN0cm95LFxuICAgIE9uSW5pdCxcbiAgICBPdXRwdXQsXG4gICAgVGVtcGxhdGVSZWYsXG4gICAgVmlld0NoaWxkLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEV2ZW50TWFuYWdlciB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBmYWRlSW4sIGZhZGVPdXQsIHNjYWxlRG93biwgc2NhbGVVcCB9IGZyb20gJy4vYW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBOeE1vZGFsU2VydmljZSB9IGZyb20gJy4vbW9kYWwuc2VydmljZSc7XG5cbi8qKiBDb250YWluZXIgZm9yIHRoZSBhY3Rpb24gYnV0dG9ucyBpbiBhIG1vZGFsLiBIYXMgYSBmaXhlZCBwb3NpdGlvbiBhdCB0aGUgYm90dG9tIG9mIHRoZSBtb2RhbCBvbiBzY3JvbGwuICovXG5ARGlyZWN0aXZlKHtcbiAgICBzZWxlY3RvcjogJ1tueE1vZGFsQWN0aW9uc10nLFxuICAgIGhvc3Q6IHtcbiAgICAgICAgJ1tjbGFzcy5ueC1tb2RhbF9fYWN0aW9uc10nOiAndHJ1ZScsXG4gICAgfSxcbn0pXG5leHBvcnQgY2xhc3MgTnhNb2RhbEFjdGlvbnNEaXJlY3RpdmUge31cblxuLyoqIFNjcm9sbGFibGUgY29udGFpbmVyIGZvciB0aGUgY29udGVudCBvZiBhIG1vZGFsLiAqL1xuQERpcmVjdGl2ZSh7XG4gICAgc2VsZWN0b3I6ICdbbnhNb2RhbENvbnRlbnRdJyxcbiAgICBob3N0OiB7XG4gICAgICAgICdbY2xhc3MubngtbW9kYWxfX2NvbnRlbnRdJzogJ3RydWUnLFxuICAgIH0sXG59KVxuZXhwb3J0IGNsYXNzIE54TW9kYWxDb250ZW50RGlyZWN0aXZlIHt9XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnbngtbW9kYWwnLFxuICAgIHRlbXBsYXRlVXJsOiAnbW9kYWwuY29tcG9uZW50Lmh0bWwnLFxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICAgIHN0eWxlVXJsczogWycuL21vZGFsLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgYW5pbWF0aW9uczogW1xuICAgICAgICB0cmlnZ2VyKCdmYWRlSW5PdXQnLCBbXG4gICAgICAgICAgICB0cmFuc2l0aW9uKCc6ZW50ZXInLCBbdXNlQW5pbWF0aW9uKGZhZGVJbiksIHF1ZXJ5KCdAc2NhbGVVcERvd24nLCBbYW5pbWF0ZUNoaWxkKCldKV0pLFxuICAgICAgICAgICAgdHJhbnNpdGlvbignOmxlYXZlJywgW3F1ZXJ5KCdAc2NhbGVVcERvd24nLCBbYW5pbWF0ZUNoaWxkKCldKSwgdXNlQW5pbWF0aW9uKGZhZGVPdXQpXSksXG4gICAgICAgIF0pLFxuICAgICAgICB0cmlnZ2VyKCdzY2FsZVVwRG93bicsIFt0cmFuc2l0aW9uKCc6ZW50ZXInLCB1c2VBbmltYXRpb24oc2NhbGVEb3duKSksIHRyYW5zaXRpb24oJzpsZWF2ZScsIHVzZUFuaW1hdGlvbihzY2FsZVVwKSldKSxcbiAgICBdLFxuICAgIGhvc3Q6IHtcbiAgICAgICAgJ1tAZmFkZUluT3V0XSc6ICcnLFxuICAgICAgICAnW2NsYXNzLm54LW1vZGFsLS1maXhlZC13aWR0aF0nOiAnc2l6ZSA9PT0gXCJmaXhlZFwiJyxcbiAgICB9LFxufSlcbmV4cG9ydCBjbGFzcyBOeE1vZGFsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICAgIHByaXZhdGUgX2Nsb3NlQnV0dG9uTGFiZWwgPSAnQ2xvc2UgZGlhbG9nJztcblxuICAgIEBWaWV3Q2hpbGQoJ2Nsb3NlQnV0dG9uJykgX2Nsb3NlQnV0dG9uITogRWxlbWVudFJlZjtcblxuICAgIC8qKiBTZXRzIHRoZSAnYXJpYS1sYWJlbCcgb2YgdGhlIG1vZGFsIGNsb3NlIGJ1dHRvbiBuZWVkZWQgZm9yIGFjY2Vzc2liaWxpdHkuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0IHZhbHVlIGlzICdDbG9zZSBkaWFsb2cnLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2V0IGNsb3NlQnV0dG9uTGFiZWwodmFsdWU6IHN0cmluZykge1xuICAgICAgICBpZiAodmFsdWUgIT09IHRoaXMuX2Nsb3NlQnV0dG9uTGFiZWwpIHtcbiAgICAgICAgICAgIHRoaXMuX2Nsb3NlQnV0dG9uTGFiZWwgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgY2xvc2VCdXR0b25MYWJlbCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2xvc2VCdXR0b25MYWJlbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBIHRlbXBsYXRlIHJlZmVyZW5jZSB2YXJpYWJsZSBwb2ludGluZyB0byB0aGUgdGVtcGxhdGVcbiAgICAgKiB3aGljaCBjb250YWlucyB0aGUgY29udGVudCBvZiB0aGUgbW9kYWwgdmlldy5cbiAgICAgKi9cbiAgICBASW5wdXQoJ254Qm9keScpIGJvZHkhOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gICAgLyoqXG4gICAgICogV2hldGhlciB0aGUgbW9kYWwgdmlldyBzaG91bGQgY2xvc2Ugd2hlbiB0aGUgdXNlciBoaXRzIHRoZSBlc2NhcGUga2V5LlxuICAgICAqIERlZmF1bHQgaXMgdHJ1ZS5cbiAgICAgKi9cbiAgICBASW5wdXQoJ254SGlkZU9uRXNjJykgaGlkZU9uRXNjID0gdHJ1ZTtcblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhlIG1vZGFsIHZpZXcgc2hvdWxkIGNsb3NlIHdoZW4gdGhlIHVzZXIgY2xpY2tzIG9uIHRoZSBiYWNrZHJvcC5cbiAgICAgKiBEZWZhdWx0IGlzIHRydWUuXG4gICAgICovXG4gICAgQElucHV0KCdueEhpZGVPbkNsaWNrT3V0c2lkZScpIGhpZGVPbkNsaWNrT3V0c2lkZSA9IHRydWU7XG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRoZSBtb2RhbCB2aWV3IHNob3VsZCBoYXZlIGEgY2xvc2UgaWNvbiBpbiB0aGUgdXBwZXIgcmlnaHQgY29ybmVyLlxuICAgICAqIERlZmF1bHQgaXMgdHJ1ZS5cbiAgICAgKi9cbiAgICBASW5wdXQoJ254U2hvd0Nsb3NlSWNvbicpIHNob3dDbG9zZUljb24gPSB0cnVlO1xuXG4gICAgLyoqXG4gICAgICogQ29udHJvbHMgdGhlIHdpZHRoIG9mIHRoZSBkaWFsb2cuXG4gICAgICogT24gYGF1dG9gIHRoZSB3aWR0aCBpcyBjb250cm9sbGVkIGJ5IHRoZSBjb250ZW50IHdpZHRoLFxuICAgICAqIG9uIGBmaXhlZGAgdGhlIGRpYWxvZyBnZXRzIGEgZml4ZWQgd2lkdGggb2YgNzM2cHggaWYgdGhlIHZpZXdwb3J0IGlzIGJpZyBlbm91Z2guICovXG4gICAgQElucHV0KCdueFNpemUnKSBzaXplOiAnZml4ZWQnIHwgJ2F1dG8nID0gJ2F1dG8nO1xuXG4gICAgLyoqXG4gICAgICogQW4gZXZlbnQgZW1pdHRlZCB3aGVuIHRoZSB1c2VyIGNsaWNrcyBvbiB0aGUgYmFja2Ryb3Agb3IgdXNlcyB0aGUgYnVpbHQtaW4gY2xvc2UgYnV0dG9uLlxuICAgICAqIFRoaXMgZXZlbnQgY2FuIGJlIGFwcGxpZWQgaW4gY29uanVuY3Rpb24gd2l0aCB0aGUgY3VzdG9tIG9wZW4gc3RhdGUgaGFuZGxpbmdcbiAgICAgKiBvZiBhIG1vZGFsIHRvIGNsb3NlIGl0IHdoZW4gcmVxdWVzdGVkIGJ5IHRoZSB1c2VyLlxuICAgICAqL1xuICAgIEBPdXRwdXQoJ254Q2xvc2UnKSBjbG9zZUV2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gICAgcHJpdmF0ZSByZWFkb25seSBfZGVzdHJveWVkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICAgIHByaXZhdGUgcmVtb3ZlRXZlbnRMaXN0ZW5lciE6ICgpID0+IHZvaWQ7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IE54TW9kYWxTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGV2ZW50TWFuYWdlcjogRXZlbnRNYW5hZ2VyLFxuICAgICAgICBwcml2YXRlIF9jZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICBwcml2YXRlIF9mb2N1c01vbml0b3I6IEZvY3VzTW9uaXRvcixcbiAgICApIHt9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5tb2RhbFNlcnZpY2UuY2xvc2UkLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCkpLnN1YnNjcmliZSgoKSA9PiB0aGlzLmNsb3NlRXZlbnQuZW1pdCgpKTtcblxuICAgICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSB0aGlzLmV2ZW50TWFuYWdlci5hZGRHbG9iYWxFdmVudExpc3RlbmVyKCd3aW5kb3cnLCAna2V5dXAuZXNjJywgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuaGlkZU9uRXNjKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tb2RhbFNlcnZpY2UuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkgYXMgKCkgPT4gdm9pZDtcbiAgICB9XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIGlmICh0aGlzLnNob3dDbG9zZUljb24pIHtcbiAgICAgICAgICAgIHRoaXMuX2ZvY3VzTW9uaXRvci5tb25pdG9yKHRoaXMuX2Nsb3NlQnV0dG9uKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLl9kZXN0cm95ZWQubmV4dCgpO1xuICAgICAgICB0aGlzLl9kZXN0cm95ZWQuY29tcGxldGUoKTtcbiAgICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKCk7XG4gICAgICAgIHRoaXMuX2ZvY3VzTW9uaXRvci5zdG9wTW9uaXRvcmluZyh0aGlzLl9jbG9zZUJ1dHRvbik7XG4gICAgfVxuXG4gICAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgICBjbGlja091dHNpZGVNb2RhbCgpIHtcbiAgICAgICAgaWYgKHRoaXMuaGlkZU9uQ2xpY2tPdXRzaWRlKSB7XG4gICAgICAgICAgICB0aGlzLm1vZGFsU2VydmljZS5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgICBjbG9zZUJ1dHRvbkNsaWNrKCkge1xuICAgICAgICB0aGlzLm1vZGFsU2VydmljZS5jbG9zZSgpO1xuICAgIH1cblxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgY2FuY2VsQ2xpY2soZXZ0OiBNb3VzZUV2ZW50KSB7XG4gICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwibngtbW9kYWxcIiByb2xlPVwiZGlhbG9nXCIgY2RrVHJhcEZvY3VzIGNka1RyYXBGb2N1c0F1dG9DYXB0dXJlIGNka0ZvY3VzSW5pdGlhbD5cbiAgICA8ZGl2IGNsYXNzPVwibngtbW9kYWxfX2JhY2tkcm9wXCIgKGNsaWNrKT1cImNsaWNrT3V0c2lkZU1vZGFsKClcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm54LW1vZGFsX19wb3NpdGlvblwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm54LW1vZGFsX19jb250YWluZXJcIiAoY2xpY2spPVwiY2FuY2VsQ2xpY2soJGV2ZW50KVwiIFtAc2NhbGVVcERvd25dPlxuICAgICAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgICAgICAgI2Nsb3NlQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIChjbGljayk9XCJjbG9zZUJ1dHRvbkNsaWNrKClcIlxuICAgICAgICAgICAgICAgICAgICAqbmdJZj1cInNob3dDbG9zZUljb25cIlxuICAgICAgICAgICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cImNsb3NlQnV0dG9uTGFiZWxcIlxuICAgICAgICAgICAgICAgICAgICBjbGFzcz1cIm54LW1vZGFsX19jbG9zZVwiXG4gICAgICAgICAgICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgPG54LWljb24gbmFtZT1cImNsb3NlXCI+PC9ueC1pY29uPlxuICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm54LW1vZGFsX19jb250ZW50LXdyYXBwZXJcIiBjZGtTY3JvbGxhYmxlPlxuICAgICAgICAgICAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiYm9keTsgZWxzZSBwcm9qZWN0Q29udGVudFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImJvZHlcIj48L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XG5cbiAgICAgICAgICAgICAgICAgICAgPG5nLXRlbXBsYXRlICNwcm9qZWN0Q29udGVudD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbiAgICAgICAgICAgICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbjwvZGl2PlxuIl19