import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { ChangeDetectionStrategy, Component, forwardRef, HostListener, Inject, Input, } from '@angular/core';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { NxRadioToggleComponent } from './radio-toggle.component';
import { NxRadioToggleButtonBaseComponent } from './radio-toggle-button-base.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/collections";
import * as i2 from "@angular/cdk/a11y";
import * as i3 from "@aposin/ng-aquila/icon";
import * as i4 from "./radio-toggle.component";
/** @docs-private */
export class NxRadioToggleButtonChange {
    constructor(source, value) {
        this.source = source;
        this.value = value;
    }
}
export class NxRadioToggleButtonComponent extends NxRadioToggleButtonBaseComponent {
    constructor(radioToggle, 
    /** @docs-private */ renderer, _cdr, _toggleDispatcher, _focusMonitor) {
        super(renderer);
        this.radioToggle = radioToggle;
        this._cdr = _cdr;
        this._toggleDispatcher = _toggleDispatcher;
        this._focusMonitor = _focusMonitor;
        /** @docs-private */
        // emits when the button is checked to notify the group
        this.onChecked = new Subject();
        this._disabled = false;
        this._selected = false;
        this._destroyed = new Subject();
        /** Unregister function for _expansionDispatcher. */
        this._removeUniqueSelectionListener = () => { };
        this._removeUniqueSelectionListener = this._toggleDispatcher.listen((id, radioToggleId) => {
            if (this.radioToggle && this.radioToggle.id === radioToggleId && this.id !== id) {
                this._selected = false;
                // need to let change detector know in case that the select() function was called on another button
                this._cdr.markForCheck();
            }
        });
        this.radioToggle._disableChange.pipe(takeUntil(this._destroyed)).subscribe(() => {
            this._cdr.markForCheck();
        });
    }
    /** @docs-private */
    set disabled(value) {
        this._disabled = coerceBooleanProperty(value);
        this._cdr.markForCheck();
    }
    get disabled() {
        return this._disabled || this.radioToggle?.disabled;
    }
    /** Sets the checked state and notify siblings and the parent group about the change */
    // Only use this if you want the onChecked event to be fired, this will inform the parent about the change!
    // To select a button without firing the event use the select() function
    set selected(value) {
        if (this._selected !== value) {
            this._selected = value;
            if (this._selected) {
                this._notifySiblings();
                this._emitCheckedEvent();
            }
            this._cdr.markForCheck();
        }
    }
    get selected() {
        return this._selected;
    }
    ngAfterViewInit() {
        this._focusMonitor.monitor(this.toggleInput);
    }
    ngOnDestroy() {
        this._removeUniqueSelectionListener();
        this._destroyed.next();
        this._destroyed.complete();
        this._focusMonitor.stopMonitoring(this.toggleInput);
    }
    /** @docs-private */
    get toggleId() {
        return this.radioToggle.id;
    }
    /** @docs-private */
    get id() {
        return this.toggleButtonId;
    }
    _notifySiblings() {
        const toggleId = this.radioToggle ? this.radioToggle.id : this.id;
        this._toggleDispatcher.notify(this.id, toggleId);
    }
    _emitCheckedEvent() {
        this.onChecked.next(new NxRadioToggleButtonChange(this, this.value));
    }
    // Does NOT emit the onChecked event. Useful when you need to set initial
    // state. Used by the parent to set checked states on initialization and during
    // writeValue() changes.
    /** @docs-private */
    select() {
        if (!this._selected) {
            this._selected = true;
            this._notifySiblings();
        }
        this._cdr.markForCheck();
    }
    /** @docs-private */
    deselect() {
        if (this._selected) {
            this._selected = false;
        }
        this._cdr.markForCheck();
    }
    /** @docs-private */
    onKeyupSpace() {
        this._selected = false;
        this._notifySiblings();
    }
    /** @docs-private */
    _controlInvalid() {
        return !!this.radioToggle?.errorState;
    }
}
NxRadioToggleButtonComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxRadioToggleButtonComponent, deps: [{ token: forwardRef(() => NxRadioToggleComponent) }, { token: i0.Renderer2 }, { token: i0.ChangeDetectorRef }, { token: i1.UniqueSelectionDispatcher }, { token: i2.FocusMonitor }], target: i0.ɵɵFactoryTarget.Component });
NxRadioToggleButtonComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxRadioToggleButtonComponent, selector: "nx-radio-toggle-button", inputs: { disabled: ["nxDisabled", "disabled"], selected: ["nxSelected", "selected"] }, host: { listeners: { "keyup.space": "onKeyupSpace()" }, properties: { "class.has-error": "_controlInvalid() || null", "attr.aria-invalid": "_controlInvalid() || null" } }, providers: [
        {
            provide: NxRadioToggleButtonBaseComponent,
            useExisting: forwardRef(() => NxRadioToggleButtonComponent),
        },
    ], usesInheritance: true, ngImport: i0, template: "<input\n    [attr.id]=\"toggleButtonId\"\n    #toggleInput\n    [attr.name]=\"toggleId\"\n    [checked]=\"selected\"\n    class=\"nx-radio-toggle__input\"\n    type=\"radio\"\n    (click)=\"selected = true\"\n    [disabled]=\"disabled\"\n/>\n<div (click)=\"triggerInputClick($event)\" #toggleButtonLabelContainer class=\"nx-radio-toggle__label-container\">\n    <label [attr.for]=\"toggleButtonId\" class=\"nx-radio-toggle__label\">\n        <nx-icon class=\"nx-toggle-button__mobile-check\" name=\"check\" aria-hidden=\"true\"></nx-icon>\n        <ng-content></ng-content>\n    </label>\n</div>\n", styles: [":host{display:flex;position:relative;flex-direction:row}@media (max-width: 703px){:host{width:100%}}:host.has-error .nx-radio-toggle__input:checked+.nx-radio-toggle__label-container{border-color:var(--danger);background-color:var(--danger)}:host.has-error .nx-radio-toggle__label-container{border-color:var(--danger);color:var(--danger)}:host.has-error:hover .nx-radio-toggle__label-container{color:var(--toggle-button-hover-text-color)}.nx-radio-toggle__input{opacity:0;position:absolute}.nx-radio-toggle__input:active+.nx-radio-toggle__label-container{background-color:var(--toggle-button-active-background-color);border-color:var(--toggle-button-active-border-color);color:var(--toggle-button-active-text-color)}.nx-radio-toggle__input:checked:disabled+.nx-radio-toggle__label-container{background-color:var(--toggle-button-disabled-selected-background-color);border-color:var(--toggle-button-disabled-selected-border-color);color:var(--toggle-button-disabled-selected-text-color)}.nx-radio-toggle__input:disabled+.nx-radio-toggle__label-container{background-color:var(--toggle-button-disabled-background-color);border-color:var(--toggle-button-disabled-border-color);color:var(--toggle-button-disabled-text-color);cursor:not-allowed}.nx-radio-toggle__input:disabled+.nx-radio-toggle__label-container .nx-radio-toggle__label{cursor:not-allowed}.nx-radio-toggle__input:checked+.nx-radio-toggle__label-container{background-color:var(--toggle-button-selected-background-color);border-color:var(--toggle-button-selected-border-color);color:var(--toggle-button-selected-text-color);cursor:default}@media (max-width: 703px){.nx-radio-toggle__input:checked+.nx-radio-toggle__label-container .nx-toggle-button__mobile-check{display:inline-block}}.nx-radio-toggle__input:checked+.nx-radio-toggle__label-container .nx-radio-toggle__label{cursor:default}.nx-toggle-button__mobile-check{display:none;font-size:24px;margin-right:8px;height:24px}:host-context([dir=rtl]) .nx-toggle-button__mobile-check{margin-right:0;margin-right:initial;margin-left:8px}:host-context(.nx-radio-toggle--small) .nx-radio-toggle__label-container{font-size:var(--toggle-button-small-font-size);line-height:var(--toggle-button-small-line-height);font-weight:var(--toggle-button-small-font-weight);letter-spacing:var(--toggle-button-small-letter-spacing);min-height:16px;padding:6px;text-transform:none}@media (max-width: 703px){:host-context(.nx-radio-toggle--small) .nx-radio-toggle__label-container{font-size:var(--toggle-button-large-font-size);line-height:var(--toggle-button-large-line-height);font-weight:var(--toggle-button-large-font-weight);letter-spacing:var(--toggle-button-large-letter-spacing);padding:11px 31px}}.nx-radio-toggle{-webkit-user-select:none;user-select:none;cursor:pointer}.nx-radio-toggle__label-container.nx-radio-toggle__label-container--first{border-radius:4px 0 0 4px;border-width:2px 0 2px 2px}@media (max-width: 703px){.nx-radio-toggle__label-container.nx-radio-toggle__label-container--first{border-width:2px;border-bottom-width:1px;border-radius:4px 4px 0 0}}:host-context([dir=rtl]) .nx-radio-toggle__label-container.nx-radio-toggle__label-container--first{border-radius:0 4px 4px 0;border-width:2px 2px 2px 0}@media (max-width: 703px){:host-context([dir=rtl]) .nx-radio-toggle__label-container.nx-radio-toggle__label-container--first{border-width:2px;border-bottom-width:1px;border-radius:4px 4px 0 0}}.nx-radio-toggle__label-container.nx-radio-toggle__label-container--last{border-radius:0 4px 4px 0;border-width:2px}@media (max-width: 703px){.nx-radio-toggle__label-container.nx-radio-toggle__label-container--last{border-width:2px;border-top-width:1px;border-radius:0 0 4px 4px}.nx-radio-toggle__label-container.nx-radio-toggle__label-container--last.nx-radio-toggle__label-container--first{border-radius:4px;border-width:2px}}:host-context([dir=rtl]) .nx-radio-toggle__label-container.nx-radio-toggle__label-container--last{border-radius:4px 0 0 4px;border-width:2px}@media (max-width: 703px){:host-context([dir=rtl]) .nx-radio-toggle__label-container.nx-radio-toggle__label-container--last{border-width:2px;border-top-width:1px;border-radius:0 0 4px 4px}}.nx-radio-toggle__label-container{font-size:var(--toggle-button-large-font-size);line-height:var(--toggle-button-large-line-height);font-weight:var(--toggle-button-large-font-weight);letter-spacing:var(--toggle-button-large-letter-spacing);padding:10px 30px;color:var(--toggle-button-unselected-text-color);background-color:var(--toggle-button-unselected-background-color);border-color:var(--toggle-button-unselected-border-color);border-style:solid;border-radius:0;border-width:2px 0 2px 2px;cursor:pointer;flex-grow:1;text-align:center;text-transform:var(--button-text-transform);transition:background-color .2s ease,border-color .2s ease,color .2s ease;display:flex;align-items:center;height:100%;min-height:24px}@media (max-width: 703px){.nx-radio-toggle__label-container{border-width:1px 2px;justify-content:center;padding:11px 31px}}:host-context([dir=rtl]) .nx-radio-toggle__label-container{border-width:2px 2px 2px 0}@media (max-width: 703px){:host-context([dir=rtl]) .nx-radio-toggle__label-container{border-width:1px 2px}}.nx-radio-toggle__label-container:hover{background-color:var(--toggle-button-hover-background-color);border-color:var(--toggle-button-hover-border-color);color:var(--toggle-button-hover-text-color)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__input:focus+.nx-radio-toggle__label-container{background-color:var(--negative-01);border-color:var(--negative-01);color:var(--negative-accent)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__input:active+.nx-radio-toggle__label-container{background-color:var(--negative-02);border-color:var(--negative-02);color:var(--negative-accent)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__input:disabled:checked+.nx-radio-toggle__label-container{background-color:var(--negative-dimmed);border-color:transparent;color:var(--negative-background-dimmed)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__input:disabled+.nx-radio-toggle__label-container{background-color:transparent;border-color:var(--negative-dimmed);color:var(--negative-dimmed)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__input:checked+.nx-radio-toggle__label-container{background-color:var(--negative);border-color:var(--negative);color:var(--negative-accent)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__label-container{border-color:var(--negative);color:var(--negative)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__label-container:hover{background-color:var(--negative-01);border-color:var(--negative-01);color:var(--negative-accent)}.nx-radio-toggle__label{display:flex;align-items:center;cursor:pointer}.nx-radio-toggle__input.cdk-keyboard-focused+.nx-radio-toggle__label-container{box-shadow:var(--focus-box-shadow);z-index:1}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-radio-toggle__input.cdk-keyboard-focused+.nx-radio-toggle__label-container{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}@media screen and (-ms-high-contrast: active){:host{forced-color-adjust:none}.nx-radio-toggle__label-container{background-color:buttonFace!important;border-color:buttonText!important;color:buttonText!important}.nx-radio-toggle__label-container .nx-radio-toggle__label{-ms-high-contrast-adjust:none}.nx-radio-toggle__input:disabled+.nx-radio-toggle__label-container{background-color:buttonFace!important;border-color:GrayText!important;color:GrayText!important}.nx-radio-toggle__input:checked+.nx-radio-toggle__label-container{background-color:highlight!important;border-color:buttonText!important;color:highlightText!important}.nx-radio-toggle__input:checked+.nx-radio-toggle__label-container .nx-radio-toggle__label{color:highlightText!important}}\n"], components: [{ type: i3.NxIconComponent, selector: "nx-icon", inputs: ["name", "outline", "fill", "size", "font"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxRadioToggleButtonComponent, decorators: [{
            type: Component,
            args: [{ selector: 'nx-radio-toggle-button', changeDetection: ChangeDetectionStrategy.OnPush, providers: [
                        {
                            provide: NxRadioToggleButtonBaseComponent,
                            useExisting: forwardRef(() => NxRadioToggleButtonComponent),
                        },
                    ], host: {
                        '[class.has-error]': '_controlInvalid() || null',
                        '[attr.aria-invalid]': '_controlInvalid() || null',
                    }, template: "<input\n    [attr.id]=\"toggleButtonId\"\n    #toggleInput\n    [attr.name]=\"toggleId\"\n    [checked]=\"selected\"\n    class=\"nx-radio-toggle__input\"\n    type=\"radio\"\n    (click)=\"selected = true\"\n    [disabled]=\"disabled\"\n/>\n<div (click)=\"triggerInputClick($event)\" #toggleButtonLabelContainer class=\"nx-radio-toggle__label-container\">\n    <label [attr.for]=\"toggleButtonId\" class=\"nx-radio-toggle__label\">\n        <nx-icon class=\"nx-toggle-button__mobile-check\" name=\"check\" aria-hidden=\"true\"></nx-icon>\n        <ng-content></ng-content>\n    </label>\n</div>\n", styles: [":host{display:flex;position:relative;flex-direction:row}@media (max-width: 703px){:host{width:100%}}:host.has-error .nx-radio-toggle__input:checked+.nx-radio-toggle__label-container{border-color:var(--danger);background-color:var(--danger)}:host.has-error .nx-radio-toggle__label-container{border-color:var(--danger);color:var(--danger)}:host.has-error:hover .nx-radio-toggle__label-container{color:var(--toggle-button-hover-text-color)}.nx-radio-toggle__input{opacity:0;position:absolute}.nx-radio-toggle__input:active+.nx-radio-toggle__label-container{background-color:var(--toggle-button-active-background-color);border-color:var(--toggle-button-active-border-color);color:var(--toggle-button-active-text-color)}.nx-radio-toggle__input:checked:disabled+.nx-radio-toggle__label-container{background-color:var(--toggle-button-disabled-selected-background-color);border-color:var(--toggle-button-disabled-selected-border-color);color:var(--toggle-button-disabled-selected-text-color)}.nx-radio-toggle__input:disabled+.nx-radio-toggle__label-container{background-color:var(--toggle-button-disabled-background-color);border-color:var(--toggle-button-disabled-border-color);color:var(--toggle-button-disabled-text-color);cursor:not-allowed}.nx-radio-toggle__input:disabled+.nx-radio-toggle__label-container .nx-radio-toggle__label{cursor:not-allowed}.nx-radio-toggle__input:checked+.nx-radio-toggle__label-container{background-color:var(--toggle-button-selected-background-color);border-color:var(--toggle-button-selected-border-color);color:var(--toggle-button-selected-text-color);cursor:default}@media (max-width: 703px){.nx-radio-toggle__input:checked+.nx-radio-toggle__label-container .nx-toggle-button__mobile-check{display:inline-block}}.nx-radio-toggle__input:checked+.nx-radio-toggle__label-container .nx-radio-toggle__label{cursor:default}.nx-toggle-button__mobile-check{display:none;font-size:24px;margin-right:8px;height:24px}:host-context([dir=rtl]) .nx-toggle-button__mobile-check{margin-right:0;margin-right:initial;margin-left:8px}:host-context(.nx-radio-toggle--small) .nx-radio-toggle__label-container{font-size:var(--toggle-button-small-font-size);line-height:var(--toggle-button-small-line-height);font-weight:var(--toggle-button-small-font-weight);letter-spacing:var(--toggle-button-small-letter-spacing);min-height:16px;padding:6px;text-transform:none}@media (max-width: 703px){:host-context(.nx-radio-toggle--small) .nx-radio-toggle__label-container{font-size:var(--toggle-button-large-font-size);line-height:var(--toggle-button-large-line-height);font-weight:var(--toggle-button-large-font-weight);letter-spacing:var(--toggle-button-large-letter-spacing);padding:11px 31px}}.nx-radio-toggle{-webkit-user-select:none;user-select:none;cursor:pointer}.nx-radio-toggle__label-container.nx-radio-toggle__label-container--first{border-radius:4px 0 0 4px;border-width:2px 0 2px 2px}@media (max-width: 703px){.nx-radio-toggle__label-container.nx-radio-toggle__label-container--first{border-width:2px;border-bottom-width:1px;border-radius:4px 4px 0 0}}:host-context([dir=rtl]) .nx-radio-toggle__label-container.nx-radio-toggle__label-container--first{border-radius:0 4px 4px 0;border-width:2px 2px 2px 0}@media (max-width: 703px){:host-context([dir=rtl]) .nx-radio-toggle__label-container.nx-radio-toggle__label-container--first{border-width:2px;border-bottom-width:1px;border-radius:4px 4px 0 0}}.nx-radio-toggle__label-container.nx-radio-toggle__label-container--last{border-radius:0 4px 4px 0;border-width:2px}@media (max-width: 703px){.nx-radio-toggle__label-container.nx-radio-toggle__label-container--last{border-width:2px;border-top-width:1px;border-radius:0 0 4px 4px}.nx-radio-toggle__label-container.nx-radio-toggle__label-container--last.nx-radio-toggle__label-container--first{border-radius:4px;border-width:2px}}:host-context([dir=rtl]) .nx-radio-toggle__label-container.nx-radio-toggle__label-container--last{border-radius:4px 0 0 4px;border-width:2px}@media (max-width: 703px){:host-context([dir=rtl]) .nx-radio-toggle__label-container.nx-radio-toggle__label-container--last{border-width:2px;border-top-width:1px;border-radius:0 0 4px 4px}}.nx-radio-toggle__label-container{font-size:var(--toggle-button-large-font-size);line-height:var(--toggle-button-large-line-height);font-weight:var(--toggle-button-large-font-weight);letter-spacing:var(--toggle-button-large-letter-spacing);padding:10px 30px;color:var(--toggle-button-unselected-text-color);background-color:var(--toggle-button-unselected-background-color);border-color:var(--toggle-button-unselected-border-color);border-style:solid;border-radius:0;border-width:2px 0 2px 2px;cursor:pointer;flex-grow:1;text-align:center;text-transform:var(--button-text-transform);transition:background-color .2s ease,border-color .2s ease,color .2s ease;display:flex;align-items:center;height:100%;min-height:24px}@media (max-width: 703px){.nx-radio-toggle__label-container{border-width:1px 2px;justify-content:center;padding:11px 31px}}:host-context([dir=rtl]) .nx-radio-toggle__label-container{border-width:2px 2px 2px 0}@media (max-width: 703px){:host-context([dir=rtl]) .nx-radio-toggle__label-container{border-width:1px 2px}}.nx-radio-toggle__label-container:hover{background-color:var(--toggle-button-hover-background-color);border-color:var(--toggle-button-hover-border-color);color:var(--toggle-button-hover-text-color)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__input:focus+.nx-radio-toggle__label-container{background-color:var(--negative-01);border-color:var(--negative-01);color:var(--negative-accent)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__input:active+.nx-radio-toggle__label-container{background-color:var(--negative-02);border-color:var(--negative-02);color:var(--negative-accent)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__input:disabled:checked+.nx-radio-toggle__label-container{background-color:var(--negative-dimmed);border-color:transparent;color:var(--negative-background-dimmed)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__input:disabled+.nx-radio-toggle__label-container{background-color:transparent;border-color:var(--negative-dimmed);color:var(--negative-dimmed)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__input:checked+.nx-radio-toggle__label-container{background-color:var(--negative);border-color:var(--negative);color:var(--negative-accent)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__label-container{border-color:var(--negative);color:var(--negative)}:host-context(.nx-radio-toggle--negative) .nx-radio-toggle__label-container:hover{background-color:var(--negative-01);border-color:var(--negative-01);color:var(--negative-accent)}.nx-radio-toggle__label{display:flex;align-items:center;cursor:pointer}.nx-radio-toggle__input.cdk-keyboard-focused+.nx-radio-toggle__label-container{box-shadow:var(--focus-box-shadow);z-index:1}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-radio-toggle__input.cdk-keyboard-focused+.nx-radio-toggle__label-container{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}@media screen and (-ms-high-contrast: active){:host{forced-color-adjust:none}.nx-radio-toggle__label-container{background-color:buttonFace!important;border-color:buttonText!important;color:buttonText!important}.nx-radio-toggle__label-container .nx-radio-toggle__label{-ms-high-contrast-adjust:none}.nx-radio-toggle__input:disabled+.nx-radio-toggle__label-container{background-color:buttonFace!important;border-color:GrayText!important;color:GrayText!important}.nx-radio-toggle__input:checked+.nx-radio-toggle__label-container{background-color:highlight!important;border-color:buttonText!important;color:highlightText!important}.nx-radio-toggle__input:checked+.nx-radio-toggle__label-container .nx-radio-toggle__label{color:highlightText!important}}\n"] }]
        }], ctorParameters: function () { return [{ type: i4.NxRadioToggleComponent, decorators: [{
                    type: Inject,
                    args: [forwardRef(() => NxRadioToggleComponent)]
                }] }, { type: i0.Renderer2 }, { type: i0.ChangeDetectorRef }, { type: i1.UniqueSelectionDispatcher }, { type: i2.FocusMonitor }]; }, propDecorators: { disabled: [{
                type: Input,
                args: ['nxDisabled']
            }], selected: [{
                type: Input,
                args: ['nxSelected']
            }], onKeyupSpace: [{
                type: HostListener,
                args: ['keyup.space']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFkaW8tdG9nZ2xlLWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1hcXVpbGEvc3JjL3JhZGlvLXRvZ2dsZS9yYWRpby10b2dnbGUtYnV0dG9uLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWFxdWlsYS9zcmMvcmFkaW8tdG9nZ2xlL3JhZGlvLXRvZ2dsZS1idXR0b24uY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFnQixxQkFBcUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRTVFLE9BQU8sRUFFSCx1QkFBdUIsRUFFdkIsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssR0FHUixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsZ0NBQWdDLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQzs7Ozs7O0FBRXhGLG9CQUFvQjtBQUNwQixNQUFNLE9BQU8seUJBQXlCO0lBQ2xDLFlBQW1CLE1BQW9DLEVBQVMsS0FBVTtRQUF2RCxXQUFNLEdBQU4sTUFBTSxDQUE4QjtRQUFTLFVBQUssR0FBTCxLQUFLLENBQUs7SUFBRyxDQUFDO0NBQ2pGO0FBa0JELE1BQU0sT0FBTyw0QkFBNkIsU0FBUSxnQ0FBZ0M7SUEwQzlFLFlBQzhELFdBQW1DO0lBQzdGLG9CQUFvQixDQUFDLFFBQW1CLEVBQ2hDLElBQXVCLEVBQ3ZCLGlCQUE0QyxFQUM1QyxhQUEyQjtRQUVuQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7UUFOMEMsZ0JBQVcsR0FBWCxXQUFXLENBQXdCO1FB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QUcsRUFBRSxDQUFDLHNCQUFzQixDQUFDOzZHQTNDM0MsNEJBQTRCLHFUQVgxQjtRQUNQO1lBQ0ksT0FBTyxFQUFFLGdDQUFnQztZQUN6QyxXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLDRCQUE0QixDQUFDO1NBQzlEO0tBQ0osaURDcENMLHVsQkFnQkE7MkZEMEJhLDRCQUE0QjtrQkFoQnhDLFNBQVM7K0JBQ0ksd0JBQXdCLG1CQUVqQix1QkFBdUIsQ0FBQyxNQUFNLGFBRXBDO3dCQUNQOzRCQUNJLE9BQU8sRUFBRSxnQ0FBZ0M7NEJBQ3pDLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLDZCQUE2QixDQUFDO3lCQUM5RDtxQkFDSixRQUNLO3dCQUNGLG1CQUFtQixFQUFFLDJCQUEyQjt3QkFDaEQscUJBQXFCLEVBQUUsMkJBQTJCO3FCQUNyRDs7MEJBNkNJLE1BQU07MkJBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLHNCQUFzQixDQUFDO3VLQWpDaEQsUUFBUTtzQkFEWCxLQUFLO3VCQUFDLFlBQVk7Z0JBYWYsUUFBUTtzQkFEWCxLQUFLO3VCQUFDLFlBQVk7Z0JBaUduQixZQUFZO3NCQURYLFlBQVk7dUJBQUMsYUFBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvY3VzTW9uaXRvciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9hMTF5JztcbmltcG9ydCB7IEJvb2xlYW5JbnB1dCwgY29lcmNlQm9vbGVhblByb3BlcnR5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcbmltcG9ydCB7IFVuaXF1ZVNlbGVjdGlvbkRpc3BhdGNoZXIgfSBmcm9tICdAYW5ndWxhci9jZGsvY29sbGVjdGlvbnMnO1xuaW1wb3J0IHtcbiAgICBBZnRlclZpZXdJbml0LFxuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgIENvbXBvbmVudCxcbiAgICBmb3J3YXJkUmVmLFxuICAgIEhvc3RMaXN0ZW5lcixcbiAgICBJbmplY3QsXG4gICAgSW5wdXQsXG4gICAgT25EZXN0cm95LFxuICAgIFJlbmRlcmVyMixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IE54UmFkaW9Ub2dnbGVDb21wb25lbnQgfSBmcm9tICcuL3JhZGlvLXRvZ2dsZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgTnhSYWRpb1RvZ2dsZUJ1dHRvbkJhc2VDb21wb25lbnQgfSBmcm9tICcuL3JhZGlvLXRvZ2dsZS1idXR0b24tYmFzZS5jb21wb25lbnQnO1xuXG4vKiogQGRvY3MtcHJpdmF0ZSAqL1xuZXhwb3J0IGNsYXNzIE54UmFkaW9Ub2dnbGVCdXR0b25DaGFuZ2Uge1xuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBzb3VyY2U6IE54UmFkaW9Ub2dnbGVCdXR0b25Db21wb25lbnQsIHB1YmxpYyB2YWx1ZTogYW55KSB7fVxufVxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ254LXJhZGlvLXRvZ2dsZS1idXR0b24nLFxuICAgIHN0eWxlVXJsczogWydyYWRpby10b2dnbGUtYnV0dG9uLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gICAgdGVtcGxhdGVVcmw6ICdyYWRpby10b2dnbGUtYnV0dG9uLmNvbXBvbmVudC5odG1sJyxcbiAgICBwcm92aWRlcnM6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgcHJvdmlkZTogTnhSYWRpb1RvZ2dsZUJ1dHRvbkJhc2VDb21wb25lbnQsXG4gICAgICAgICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBOeFJhZGlvVG9nZ2xlQnV0dG9uQ29tcG9uZW50KSxcbiAgICAgICAgfSxcbiAgICBdLFxuICAgIGhvc3Q6IHtcbiAgICAgICAgJ1tjbGFzcy5oYXMtZXJyb3JdJzogJ19jb250cm9sSW52YWxpZCgpIHx8IG51bGwnLFxuICAgICAgICAnW2F0dHIuYXJpYS1pbnZhbGlkXSc6ICdfY29udHJvbEludmFsaWQoKSB8fCBudWxsJyxcbiAgICB9LFxufSlcbmV4cG9ydCBjbGFzcyBOeFJhZGlvVG9nZ2xlQnV0dG9uQ29tcG9uZW50IGV4dGVuZHMgTnhSYWRpb1RvZ2dsZUJ1dHRvbkJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgLy8gZW1pdHMgd2hlbiB0aGUgYnV0dG9uIGlzIGNoZWNrZWQgdG8gbm90aWZ5IHRoZSBncm91cFxuICAgIHJlYWRvbmx5IG9uQ2hlY2tlZCA9IG5ldyBTdWJqZWN0PE54UmFkaW9Ub2dnbGVCdXR0b25DaGFuZ2U+KCk7XG5cbiAgICBwcml2YXRlIF9kaXNhYmxlZCA9IGZhbHNlO1xuICAgIHByaXZhdGUgX3NlbGVjdGVkID0gZmFsc2U7XG5cbiAgICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICAgIEBJbnB1dCgnbnhEaXNhYmxlZCcpXG4gICAgc2V0IGRpc2FibGVkKHZhbHVlOiBCb29sZWFuSW5wdXQpIHtcbiAgICAgICAgdGhpcy5fZGlzYWJsZWQgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsdWUpO1xuICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuICAgIGdldCBkaXNhYmxlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVkIHx8IHRoaXMucmFkaW9Ub2dnbGU/LmRpc2FibGVkO1xuICAgIH1cblxuICAgIC8qKiBTZXRzIHRoZSBjaGVja2VkIHN0YXRlIGFuZCBub3RpZnkgc2libGluZ3MgYW5kIHRoZSBwYXJlbnQgZ3JvdXAgYWJvdXQgdGhlIGNoYW5nZSAqL1xuICAgIC8vIE9ubHkgdXNlIHRoaXMgaWYgeW91IHdhbnQgdGhlIG9uQ2hlY2tlZCBldmVudCB0byBiZSBmaXJlZCwgdGhpcyB3aWxsIGluZm9ybSB0aGUgcGFyZW50IGFib3V0IHRoZSBjaGFuZ2UhXG4gICAgLy8gVG8gc2VsZWN0IGEgYnV0dG9uIHdpdGhvdXQgZmlyaW5nIHRoZSBldmVudCB1c2UgdGhlIHNlbGVjdCgpIGZ1bmN0aW9uXG4gICAgQElucHV0KCdueFNlbGVjdGVkJylcbiAgICBzZXQgc2VsZWN0ZWQodmFsdWU6IGJvb2xlYW4pIHtcbiAgICAgICAgaWYgKHRoaXMuX3NlbGVjdGVkICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5fc2VsZWN0ZWQgPSB2YWx1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX25vdGlmeVNpYmxpbmdzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fZW1pdENoZWNrZWRFdmVudCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHNlbGVjdGVkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0ZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZWFkb25seSBfZGVzdHJveWVkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICAgIC8qKiBVbnJlZ2lzdGVyIGZ1bmN0aW9uIGZvciBfZXhwYW5zaW9uRGlzcGF0Y2hlci4gKi9cbiAgICBwcml2YXRlIF9yZW1vdmVVbmlxdWVTZWxlY3Rpb25MaXN0ZW5lcjogKCkgPT4gdm9pZCA9ICgpID0+IHt9O1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIEBJbmplY3QoZm9yd2FyZFJlZigoKSA9PiBOeFJhZGlvVG9nZ2xlQ29tcG9uZW50KSkgcHJpdmF0ZSByYWRpb1RvZ2dsZTogTnhSYWRpb1RvZ2dsZUNvbXBvbmVudCxcbiAgICAgICAgLyoqIEBkb2NzLXByaXZhdGUgKi8gcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICAgICAgcHJpdmF0ZSBfY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgcHJpdmF0ZSBfdG9nZ2xlRGlzcGF0Y2hlcjogVW5pcXVlU2VsZWN0aW9uRGlzcGF0Y2hlcixcbiAgICAgICAgcHJpdmF0ZSBfZm9jdXNNb25pdG9yOiBGb2N1c01vbml0b3IsXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKHJlbmRlcmVyKTtcblxuICAgICAgICB0aGlzLl9yZW1vdmVVbmlxdWVTZWxlY3Rpb25MaXN0ZW5lciA9IHRoaXMuX3RvZ2dsZURpc3BhdGNoZXIubGlzdGVuKChpZDogc3RyaW5nLCByYWRpb1RvZ2dsZUlkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnJhZGlvVG9nZ2xlICYmIHRoaXMucmFkaW9Ub2dnbGUuaWQgPT09IHJhZGlvVG9nZ2xlSWQgJiYgdGhpcy5pZCAhPT0gaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8gbGV0IGNoYW5nZSBkZXRlY3RvciBrbm93IGluIGNhc2UgdGhhdCB0aGUgc2VsZWN0KCkgZnVuY3Rpb24gd2FzIGNhbGxlZCBvbiBhbm90aGVyIGJ1dHRvblxuICAgICAgICAgICAgICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5yYWRpb1RvZ2dsZS5fZGlzYWJsZUNoYW5nZS5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIHRoaXMuX2ZvY3VzTW9uaXRvci5tb25pdG9yKHRoaXMudG9nZ2xlSW5wdXQpO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLl9yZW1vdmVVbmlxdWVTZWxlY3Rpb25MaXN0ZW5lcigpO1xuICAgICAgICB0aGlzLl9kZXN0cm95ZWQubmV4dCgpO1xuICAgICAgICB0aGlzLl9kZXN0cm95ZWQuY29tcGxldGUoKTtcbiAgICAgICAgdGhpcy5fZm9jdXNNb25pdG9yLnN0b3BNb25pdG9yaW5nKHRoaXMudG9nZ2xlSW5wdXQpO1xuICAgIH1cblxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgZ2V0IHRvZ2dsZUlkKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLnJhZGlvVG9nZ2xlLmlkO1xuICAgIH1cblxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgZ2V0IGlkKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLnRvZ2dsZUJ1dHRvbklkO1xuICAgIH1cblxuICAgIHByaXZhdGUgX25vdGlmeVNpYmxpbmdzKCkge1xuICAgICAgICBjb25zdCB0b2dnbGVJZCA9IHRoaXMucmFkaW9Ub2dnbGUgPyB0aGlzLnJhZGlvVG9nZ2xlLmlkIDogdGhpcy5pZDtcbiAgICAgICAgdGhpcy5fdG9nZ2xlRGlzcGF0Y2hlci5ub3RpZnkodGhpcy5pZCwgdG9nZ2xlSWQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2VtaXRDaGVja2VkRXZlbnQoKSB7XG4gICAgICAgIHRoaXMub25DaGVja2VkLm5leHQobmV3IE54UmFkaW9Ub2dnbGVCdXR0b25DaGFuZ2UodGhpcywgdGhpcy52YWx1ZSkpO1xuICAgIH1cblxuICAgIC8vIERvZXMgTk9UIGVtaXQgdGhlIG9uQ2hlY2tlZCBldmVudC4gVXNlZnVsIHdoZW4geW91IG5lZWQgdG8gc2V0IGluaXRpYWxcbiAgICAvLyBzdGF0ZS4gVXNlZCBieSB0aGUgcGFyZW50IHRvIHNldCBjaGVja2VkIHN0YXRlcyBvbiBpbml0aWFsaXphdGlvbiBhbmQgZHVyaW5nXG4gICAgLy8gd3JpdGVWYWx1ZSgpIGNoYW5nZXMuXG4gICAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgICBzZWxlY3QoKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5fc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX3NlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX25vdGlmeVNpYmxpbmdzKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuXG4gICAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgICBkZXNlbGVjdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3NlbGVjdGVkKSB7XG4gICAgICAgICAgICB0aGlzLl9zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cblxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgQEhvc3RMaXN0ZW5lcigna2V5dXAuc3BhY2UnKVxuICAgIG9uS2V5dXBTcGFjZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fbm90aWZ5U2libGluZ3MoKTtcbiAgICB9XG5cbiAgICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICAgIF9jb250cm9sSW52YWxpZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5yYWRpb1RvZ2dsZT8uZXJyb3JTdGF0ZTtcbiAgICB9XG59XG4iLCI8aW5wdXRcbiAgICBbYXR0ci5pZF09XCJ0b2dnbGVCdXR0b25JZFwiXG4gICAgI3RvZ2dsZUlucHV0XG4gICAgW2F0dHIubmFtZV09XCJ0b2dnbGVJZFwiXG4gICAgW2NoZWNrZWRdPVwic2VsZWN0ZWRcIlxuICAgIGNsYXNzPVwibngtcmFkaW8tdG9nZ2xlX19pbnB1dFwiXG4gICAgdHlwZT1cInJhZGlvXCJcbiAgICAoY2xpY2spPVwic2VsZWN0ZWQgPSB0cnVlXCJcbiAgICBbZGlzYWJsZWRdPVwiZGlzYWJsZWRcIlxuLz5cbjxkaXYgKGNsaWNrKT1cInRyaWdnZXJJbnB1dENsaWNrKCRldmVudClcIiAjdG9nZ2xlQnV0dG9uTGFiZWxDb250YWluZXIgY2xhc3M9XCJueC1yYWRpby10b2dnbGVfX2xhYmVsLWNvbnRhaW5lclwiPlxuICAgIDxsYWJlbCBbYXR0ci5mb3JdPVwidG9nZ2xlQnV0dG9uSWRcIiBjbGFzcz1cIm54LXJhZGlvLXRvZ2dsZV9fbGFiZWxcIj5cbiAgICAgICAgPG54LWljb24gY2xhc3M9XCJueC10b2dnbGUtYnV0dG9uX19tb2JpbGUtY2hlY2tcIiBuYW1lPVwiY2hlY2tcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L254LWljb24+XG4gICAgICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbiAgICA8L2xhYmVsPlxuPC9kaXY+XG4iXX0=