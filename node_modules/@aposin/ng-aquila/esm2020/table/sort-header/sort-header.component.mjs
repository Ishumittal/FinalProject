import { ENTER, SPACE } from '@angular/cdk/keycodes';
import { ChangeDetectionStrategy, Component, Input, Optional, ViewChild } from '@angular/core';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "./sort.directive";
import * as i2 from "./sort-header-intl";
import * as i3 from "@angular/cdk/a11y";
import * as i4 from "@aposin/ng-aquila/icon";
export class NxSortHeaderComponent {
    constructor(_sort, _intl, _cdr, _focusMonitor) {
        this._intl = _intl;
        this._cdr = _cdr;
        this._focusMonitor = _focusMonitor;
        this._destroyed = new Subject();
        if (!_sort) {
            throw new Error(`NxTable: Using the 'nxSortHeaderCell' component requires the 'nxSort' directive on containing table.`);
        }
        this._sort = _sort;
        this._intl.changes.pipe(takeUntil(this._destroyed)).subscribe(() => this._cdr.markForCheck());
    }
    /** Sets the key of this sort header. */
    set key(value) {
        if (this._key !== value) {
            this._key = value;
        }
    }
    get key() {
        return this._key;
    }
    ngOnInit() {
        this._sort._stateChanges.pipe(takeUntil(this._destroyed)).subscribe(() => {
            this._cdr.markForCheck();
        });
    }
    ngAfterViewInit() {
        this._focusMonitor.monitor(this._focusContainer);
    }
    ngOnDestroy() {
        this._destroyed.next();
        this._destroyed.complete();
        this._focusMonitor.stopMonitoring(this._focusContainer);
    }
    _handleClick() {
        this._sort.sort(this._key);
    }
    _onKeydown($event) {
        if ($event && ($event.keyCode === ENTER || $event.keyCode === SPACE)) {
            this._sort.sort(this._key);
            // prevent page from scrolling down
            if ($event.keyCode === SPACE) {
                $event.preventDefault();
            }
        }
    }
    _isSortedAscending() {
        return this._sort.active === this._key && this._sort.direction === 'asc';
    }
    _isSortedDescending() {
        return this._sort.active === this._key && this._sort.direction === 'desc';
    }
    _getAriaLabel() {
        if (this._sort.active === this._key) {
            if (this._sort.direction === 'asc') {
                return `${this._intl.sortedAscendingAriaLabel}`;
            }
            return `${this._intl.sortedDescendingAriaLabel}`;
        }
        return '';
    }
    _getTitle() {
        if (this._sort.active === this._key && this._sort.direction === 'asc') {
            return `${this._intl.sortDescendingAriaLabel}`;
        }
        return `${this._intl.sortAscendingAriaLabel}`;
    }
}
NxSortHeaderComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxSortHeaderComponent, deps: [{ token: i1.NxSortDirective, optional: true }, { token: i2.NxSortHeaderIntl }, { token: i0.ChangeDetectorRef }, { token: i3.FocusMonitor }], target: i0.ɵɵFactoryTarget.Component });
NxSortHeaderComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: NxSortHeaderComponent, selector: "th[nxSortHeaderCell]", inputs: { key: ["nxSortHeaderCell", "key"] }, host: { listeners: { "click": "_handleClick()", "keydown": "_onKeydown($event)" } }, viewQueries: [{ propertyName: "_focusContainer", first: true, predicate: ["focusContainer"], descendants: true }], exportAs: ["nxSortHeaderComponent"], ngImport: i0, template: "<div #focusContainer class=\"nx-sort-header__focus-container\" role=\"button\" tabindex=\"0\" [title]=\"_getTitle()\" aria-live=\"polite\">\n    <div class=\"nx-sort-header__icons-container\" [attr.aria-label]=\"_getAriaLabel()\">\n        <nx-icon name=\"chevron-up-small\" class=\"nx-sort-header__icon-up\" [class.nx-sort-header__hidden-icon]=\"_isSortedDescending()\"> </nx-icon>\n        <nx-icon name=\"chevron-down-small\" class=\"nx-sort-header__icon-down\" [class.nx-sort-header__hidden-icon]=\"_isSortedAscending()\"> </nx-icon>\n    </div>\n\n    <ng-content></ng-content>\n</div>\n", styles: [":host{cursor:pointer}.nx-sort-header__icons-container{display:inline-block;margin-right:16px;vertical-align:bottom;width:9px;position:relative}:host-context([dir=rtl]) .nx-sort-header__icons-container{margin-right:0;margin-right:initial;margin-left:16px}.nx-sort-header__icons-container nx-icon{font-size:20px;position:absolute;font-weight:600;width:9px}.nx-sort-header__icons-container .nx-sort-header__icon-up{top:-4px}.nx-sort-header__icons-container .nx-sort-header__icon-down{top:5px}.nx-sort-header__icons-container .nx-sort-header__hidden-icon{visibility:hidden}.nx-sort-header__focus-container{display:flex}.nx-sort-header__focus-container:focus{outline:0}.nx-sort-header__focus-container:focus.cdk-keyboard-focused{box-shadow:var(--focus-box-shadow);border-radius:4px}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-sort-header__focus-container:focus.cdk-keyboard-focused{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}@media screen and (-ms-high-contrast: active){.nx-sort-header__focus-container{color:buttonText}}\n"], components: [{ type: i4.NxIconComponent, selector: "nx-icon", inputs: ["name", "outline", "fill", "size", "font"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: NxSortHeaderComponent, decorators: [{
            type: Component,
            args: [{ selector: 'th[nxSortHeaderCell]', exportAs: 'nxSortHeaderComponent', host: {
                        '(click)': '_handleClick()',
                        '(keydown)': '_onKeydown($event)',
                    }, changeDetection: ChangeDetectionStrategy.OnPush, template: "<div #focusContainer class=\"nx-sort-header__focus-container\" role=\"button\" tabindex=\"0\" [title]=\"_getTitle()\" aria-live=\"polite\">\n    <div class=\"nx-sort-header__icons-container\" [attr.aria-label]=\"_getAriaLabel()\">\n        <nx-icon name=\"chevron-up-small\" class=\"nx-sort-header__icon-up\" [class.nx-sort-header__hidden-icon]=\"_isSortedDescending()\"> </nx-icon>\n        <nx-icon name=\"chevron-down-small\" class=\"nx-sort-header__icon-down\" [class.nx-sort-header__hidden-icon]=\"_isSortedAscending()\"> </nx-icon>\n    </div>\n\n    <ng-content></ng-content>\n</div>\n", styles: [":host{cursor:pointer}.nx-sort-header__icons-container{display:inline-block;margin-right:16px;vertical-align:bottom;width:9px;position:relative}:host-context([dir=rtl]) .nx-sort-header__icons-container{margin-right:0;margin-right:initial;margin-left:16px}.nx-sort-header__icons-container nx-icon{font-size:20px;position:absolute;font-weight:600;width:9px}.nx-sort-header__icons-container .nx-sort-header__icon-up{top:-4px}.nx-sort-header__icons-container .nx-sort-header__icon-down{top:5px}.nx-sort-header__icons-container .nx-sort-header__hidden-icon{visibility:hidden}.nx-sort-header__focus-container{display:flex}.nx-sort-header__focus-container:focus{outline:0}.nx-sort-header__focus-container:focus.cdk-keyboard-focused{box-shadow:var(--focus-box-shadow);border-radius:4px}@media screen and (-ms-high-contrast: active),(forced-colors: active){.nx-sort-header__focus-container:focus.cdk-keyboard-focused{box-shadow:0 0 0 2px background,0 0 0 6px windowText;outline:4px solid CanvasText;outline-offset:2px}}@media screen and (-ms-high-contrast: active){.nx-sort-header__focus-container{color:buttonText}}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.NxSortDirective, decorators: [{
                    type: Optional
                }] }, { type: i2.NxSortHeaderIntl }, { type: i0.ChangeDetectorRef }, { type: i3.FocusMonitor }]; }, propDecorators: { _focusContainer: [{
                type: ViewChild,
                args: ['focusContainer']
            }], key: [{
                type: Input,
                args: ['nxSortHeaderCell']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC1oZWFkZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmctYXF1aWxhL3NyYy90YWJsZS9zb3J0LWhlYWRlci9zb3J0LWhlYWRlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1hcXVpbGEvc3JjL3RhYmxlL3NvcnQtaGVhZGVyL3NvcnQtaGVhZGVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDckQsT0FBTyxFQUFpQix1QkFBdUIsRUFBcUIsU0FBUyxFQUFjLEtBQUssRUFBcUIsUUFBUSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNoSyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7O0FBZ0IzQyxNQUFNLE9BQU8scUJBQXFCO0lBb0I5QixZQUNnQixLQUE2QixFQUNsQyxLQUF1QixFQUN0QixJQUF1QixFQUN2QixhQUEyQjtRQUY1QixVQUFLLEdBQUwsS0FBSyxDQUFrQjtRQUN0QixTQUFJLEdBQUosSUFBSSxDQUFtQjtRQUN2QixrQkFBYSxHQUFiLGFBQWEsQ0FBYztRQU50QixlQUFVLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQVE5QyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1IsTUFBTSxJQUFJLEtBQUssQ0FBQyxzR0FBc0csQ0FBQyxDQUFDO1NBQzNIO1FBQ0QsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFFbkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDO0lBQ2xHLENBQUM7SUEzQkQsd0NBQXdDO0lBQ3hDLElBQ0ksR0FBRyxDQUFDLEtBQWE7UUFDakIsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLEtBQUssRUFBRTtZQUNyQixJQUFJLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQztTQUNyQjtJQUNMLENBQUM7SUFDRCxJQUFJLEdBQUc7UUFDSCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDckIsQ0FBQztJQW9CRCxRQUFRO1FBQ0osSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO1lBQ3JFLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsZUFBZTtRQUNYLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQsV0FBVztRQUNQLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUMzQixJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVELFlBQVk7UUFDUixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVELFVBQVUsQ0FBQyxNQUFxQjtRQUM1QixJQUFJLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEtBQUssS0FBSyxJQUFJLE1BQU0sQ0FBQyxPQUFPLEtBQUssS0FBSyxDQUFDLEVBQUU7WUFDbEUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRTNCLG1DQUFtQztZQUNuQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLEtBQUssS0FBSyxFQUFFO2dCQUMxQixNQUFNLENBQUMsY0FBYyxFQUFFLENBQUM7YUFDM0I7U0FDSjtJQUNMLENBQUM7SUFFRCxrQkFBa0I7UUFDZCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLEtBQUssS0FBSyxDQUFDO0lBQzdFLENBQUM7SUFFRCxtQkFBbUI7UUFDZixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLEtBQUssTUFBTSxDQUFDO0lBQzlFLENBQUM7SUFFRCxhQUFhO1FBQ1QsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ2pDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLEtBQUssS0FBSyxFQUFFO2dCQUNoQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO2FBQ25EO1lBQ0QsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMseUJBQXlCLEVBQUUsQ0FBQztTQUNwRDtRQUVELE9BQU8sRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQUVELFNBQVM7UUFDTCxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLEtBQUssS0FBSyxFQUFFO1lBQ25FLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLHVCQUF1QixFQUFFLENBQUM7U0FDbEQ7UUFDRCxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO0lBQ2xELENBQUM7O2tIQXpGUSxxQkFBcUI7c0dBQXJCLHFCQUFxQix1VkNwQmxDLGtsQkFRQTsyRkRZYSxxQkFBcUI7a0JBWGpDLFNBQVM7K0JBQ0ksc0JBQXNCLFlBQ3RCLHVCQUF1QixRQUczQjt3QkFDRixTQUFTLEVBQUUsZ0JBQWdCO3dCQUMzQixXQUFXLEVBQUUsb0JBQW9CO3FCQUNwQyxtQkFDZ0IsdUJBQXVCLENBQUMsTUFBTTs7MEJBdUIxQyxRQUFRO3NJQWxCZ0IsZUFBZTtzQkFBM0MsU0FBUzt1QkFBQyxnQkFBZ0I7Z0JBSXZCLEdBQUc7c0JBRE4sS0FBSzt1QkFBQyxrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGb2N1c01vbml0b3IgfSBmcm9tICdAYW5ndWxhci9jZGsvYTExeSc7XG5pbXBvcnQgeyBFTlRFUiwgU1BBQ0UgfSBmcm9tICdAYW5ndWxhci9jZGsva2V5Y29kZXMnO1xuaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCwgT3B0aW9uYWwsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBOeFNvcnREaXJlY3RpdmUgfSBmcm9tICcuL3NvcnQuZGlyZWN0aXZlJztcbmltcG9ydCB7IE54U29ydEhlYWRlckludGwgfSBmcm9tICcuL3NvcnQtaGVhZGVyLWludGwnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3RoW254U29ydEhlYWRlckNlbGxdJyxcbiAgICBleHBvcnRBczogJ254U29ydEhlYWRlckNvbXBvbmVudCcsXG4gICAgdGVtcGxhdGVVcmw6ICdzb3J0LWhlYWRlci5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJ3NvcnQtaGVhZGVyLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgaG9zdDoge1xuICAgICAgICAnKGNsaWNrKSc6ICdfaGFuZGxlQ2xpY2soKScsXG4gICAgICAgICcoa2V5ZG93biknOiAnX29uS2V5ZG93bigkZXZlbnQpJyxcbiAgICB9LFxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBOeFNvcnRIZWFkZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG4gICAgcHJpdmF0ZSBfa2V5ITogc3RyaW5nO1xuXG4gICAgQFZpZXdDaGlsZCgnZm9jdXNDb250YWluZXInKSBfZm9jdXNDb250YWluZXIhOiBFbGVtZW50UmVmO1xuXG4gICAgLyoqIFNldHMgdGhlIGtleSBvZiB0aGlzIHNvcnQgaGVhZGVyLiAqL1xuICAgIEBJbnB1dCgnbnhTb3J0SGVhZGVyQ2VsbCcpXG4gICAgc2V0IGtleSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIGlmICh0aGlzLl9rZXkgIT09IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLl9rZXkgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQga2V5KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9rZXk7XG4gICAgfVxuXG4gICAgcmVhZG9ubHkgX3NvcnQ6IE54U29ydERpcmVjdGl2ZTtcblxuICAgIHByaXZhdGUgcmVhZG9ubHkgX2Rlc3Ryb3llZCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgQE9wdGlvbmFsKCkgX3NvcnQ6IE54U29ydERpcmVjdGl2ZSB8IG51bGwsXG4gICAgICAgIHB1YmxpYyBfaW50bDogTnhTb3J0SGVhZGVySW50bCxcbiAgICAgICAgcHJpdmF0ZSBfY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgcHJpdmF0ZSBfZm9jdXNNb25pdG9yOiBGb2N1c01vbml0b3IsXG4gICAgKSB7XG4gICAgICAgIGlmICghX3NvcnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTnhUYWJsZTogVXNpbmcgdGhlICdueFNvcnRIZWFkZXJDZWxsJyBjb21wb25lbnQgcmVxdWlyZXMgdGhlICdueFNvcnQnIGRpcmVjdGl2ZSBvbiBjb250YWluaW5nIHRhYmxlLmApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3NvcnQgPSBfc29ydDtcblxuICAgICAgICB0aGlzLl9pbnRsLmNoYW5nZXMucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkKSkuc3Vic2NyaWJlKCgpID0+IHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKSk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuX3NvcnQuX3N0YXRlQ2hhbmdlcy5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIHRoaXMuX2ZvY3VzTW9uaXRvci5tb25pdG9yKHRoaXMuX2ZvY3VzQ29udGFpbmVyKTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5fZGVzdHJveWVkLm5leHQoKTtcbiAgICAgICAgdGhpcy5fZGVzdHJveWVkLmNvbXBsZXRlKCk7XG4gICAgICAgIHRoaXMuX2ZvY3VzTW9uaXRvci5zdG9wTW9uaXRvcmluZyh0aGlzLl9mb2N1c0NvbnRhaW5lcik7XG4gICAgfVxuXG4gICAgX2hhbmRsZUNsaWNrKCkge1xuICAgICAgICB0aGlzLl9zb3J0LnNvcnQodGhpcy5fa2V5KTtcbiAgICB9XG5cbiAgICBfb25LZXlkb3duKCRldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgICAgICBpZiAoJGV2ZW50ICYmICgkZXZlbnQua2V5Q29kZSA9PT0gRU5URVIgfHwgJGV2ZW50LmtleUNvZGUgPT09IFNQQUNFKSkge1xuICAgICAgICAgICAgdGhpcy5fc29ydC5zb3J0KHRoaXMuX2tleSk7XG5cbiAgICAgICAgICAgIC8vIHByZXZlbnQgcGFnZSBmcm9tIHNjcm9sbGluZyBkb3duXG4gICAgICAgICAgICBpZiAoJGV2ZW50LmtleUNvZGUgPT09IFNQQUNFKSB7XG4gICAgICAgICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfaXNTb3J0ZWRBc2NlbmRpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zb3J0LmFjdGl2ZSA9PT0gdGhpcy5fa2V5ICYmIHRoaXMuX3NvcnQuZGlyZWN0aW9uID09PSAnYXNjJztcbiAgICB9XG5cbiAgICBfaXNTb3J0ZWREZXNjZW5kaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc29ydC5hY3RpdmUgPT09IHRoaXMuX2tleSAmJiB0aGlzLl9zb3J0LmRpcmVjdGlvbiA9PT0gJ2Rlc2MnO1xuICAgIH1cblxuICAgIF9nZXRBcmlhTGFiZWwoKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHRoaXMuX3NvcnQuYWN0aXZlID09PSB0aGlzLl9rZXkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9zb3J0LmRpcmVjdGlvbiA9PT0gJ2FzYycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5faW50bC5zb3J0ZWRBc2NlbmRpbmdBcmlhTGFiZWx9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLl9pbnRsLnNvcnRlZERlc2NlbmRpbmdBcmlhTGFiZWx9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbiAgICBfZ2V0VGl0bGUoKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHRoaXMuX3NvcnQuYWN0aXZlID09PSB0aGlzLl9rZXkgJiYgdGhpcy5fc29ydC5kaXJlY3Rpb24gPT09ICdhc2MnKSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5faW50bC5zb3J0RGVzY2VuZGluZ0FyaWFMYWJlbH1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHt0aGlzLl9pbnRsLnNvcnRBc2NlbmRpbmdBcmlhTGFiZWx9YDtcbiAgICB9XG59XG4iLCI8ZGl2ICNmb2N1c0NvbnRhaW5lciBjbGFzcz1cIm54LXNvcnQtaGVhZGVyX19mb2N1cy1jb250YWluZXJcIiByb2xlPVwiYnV0dG9uXCIgdGFiaW5kZXg9XCIwXCIgW3RpdGxlXT1cIl9nZXRUaXRsZSgpXCIgYXJpYS1saXZlPVwicG9saXRlXCI+XG4gICAgPGRpdiBjbGFzcz1cIm54LXNvcnQtaGVhZGVyX19pY29ucy1jb250YWluZXJcIiBbYXR0ci5hcmlhLWxhYmVsXT1cIl9nZXRBcmlhTGFiZWwoKVwiPlxuICAgICAgICA8bngtaWNvbiBuYW1lPVwiY2hldnJvbi11cC1zbWFsbFwiIGNsYXNzPVwibngtc29ydC1oZWFkZXJfX2ljb24tdXBcIiBbY2xhc3Mubngtc29ydC1oZWFkZXJfX2hpZGRlbi1pY29uXT1cIl9pc1NvcnRlZERlc2NlbmRpbmcoKVwiPiA8L254LWljb24+XG4gICAgICAgIDxueC1pY29uIG5hbWU9XCJjaGV2cm9uLWRvd24tc21hbGxcIiBjbGFzcz1cIm54LXNvcnQtaGVhZGVyX19pY29uLWRvd25cIiBbY2xhc3Mubngtc29ydC1oZWFkZXJfX2hpZGRlbi1pY29uXT1cIl9pc1NvcnRlZEFzY2VuZGluZygpXCI+IDwvbngtaWNvbj5cbiAgICA8L2Rpdj5cblxuICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbjwvZGl2PlxuIl19