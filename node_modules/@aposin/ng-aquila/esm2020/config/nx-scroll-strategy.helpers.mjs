import { Overlay } from '@angular/cdk/overlay';
import { NX_AUTOCOMPLETE_SCROLL_STRATEGY } from '@aposin/ng-aquila/autocomplete';
import { NX_CONTEXT_MENU_SCROLL_STRATEGY } from '@aposin/ng-aquila/context-menu';
import { NX_DATEPICKER_SCROLL_STRATEGY } from '@aposin/ng-aquila/datefield';
import { NX_DROPDOWN_SCROLL_STRATEGY } from '@aposin/ng-aquila/dropdown';
import { NX_MODAL_SCROLL_STRATEGY } from '@aposin/ng-aquila/modal';
import { NX_NOTIFICATION_PANEL_SCROLL_STRATEGY } from '@aposin/ng-aquila/notification-panel';
import { NX_OVERLAY_SCROLL_STRATEGY } from '@aposin/ng-aquila/overlay';
import { NX_POPOVER_SCROLL_STRATEGY } from '@aposin/ng-aquila/popover';
import { NX_TOOLTIP_SCROLL_STRATEGY } from '@aposin/ng-aquila/tooltip';
/** Return an appropriate scroll strategy factory from the `Overlay` service. */
export function getScrollStrategyFactory(preset, overlay, options) {
    switch (preset) {
        case 'reposition':
            return () => overlay.scrollStrategies.reposition({ autoClose: options?.autoClose, scrollThrottle: options?.scrollThrottle });
        case 'close':
            return () => overlay.scrollStrategies.close({ threshold: options?.threshold });
        case 'block':
            return overlay.scrollStrategies.block;
        case 'noop':
            return overlay.scrollStrategies.noop;
        default:
            return overlay.scrollStrategies.reposition;
    }
}
/** Return an array of scroll strategy providers based on the provided default config. */
export function getScrollStrategyDefaultProviders(config) {
    return [
        { provide: NX_AUTOCOMPLETE_SCROLL_STRATEGY, useFactory: getFactoryFnByDefaultConfig(config, 'autocomplete'), deps: [Overlay] },
        { provide: NX_CONTEXT_MENU_SCROLL_STRATEGY, useFactory: getFactoryFnByDefaultConfig(config, 'contextMenu'), deps: [Overlay] },
        { provide: NX_DATEPICKER_SCROLL_STRATEGY, useFactory: getFactoryFnByDefaultConfig(config, 'datepicker'), deps: [Overlay] },
        { provide: NX_DROPDOWN_SCROLL_STRATEGY, useFactory: getFactoryFnByDefaultConfig(config, 'dropdown'), deps: [Overlay] },
        { provide: NX_NOTIFICATION_PANEL_SCROLL_STRATEGY, useFactory: getFactoryFnByDefaultConfig(config, 'notificationPanel'), deps: [Overlay] },
        ...getExtraProvidersByDefaultConfig(config),
    ];
}
function getFactoryFnByDefaultConfig(config, componentName) {
    const componentConfig = config.overrides?.[componentName] ?? config;
    return (overlay) => getScrollStrategyFactory(componentConfig.scrollStrategy, overlay, componentConfig.scrollStrategyOptions);
}
function getExtraProvidersByDefaultConfig(config) {
    return Object.entries(config.extraComponents ?? {}).map(([componentName, { scrollStrategy, scrollStrategyOptions }]) => ({
        provide: getInjectionToken(componentName),
        useFactory: (overlay) => getScrollStrategyFactory(scrollStrategy, overlay, scrollStrategyOptions),
        deps: [Overlay],
    }));
}
/** Return an array of scroll strategy providers based on the provided factory config. */
export function getScrollStrategyFactoryProviders(config) {
    return [
        { provide: NX_AUTOCOMPLETE_SCROLL_STRATEGY, useFactory: getFactoryFnByFactoryConfig(config, 'autocomplete'), deps: [Overlay] },
        { provide: NX_CONTEXT_MENU_SCROLL_STRATEGY, useFactory: getFactoryFnByFactoryConfig(config, 'contextMenu'), deps: [Overlay] },
        { provide: NX_DATEPICKER_SCROLL_STRATEGY, useFactory: getFactoryFnByFactoryConfig(config, 'datepicker'), deps: [Overlay] },
        { provide: NX_DROPDOWN_SCROLL_STRATEGY, useFactory: getFactoryFnByFactoryConfig(config, 'dropdown'), deps: [Overlay] },
        { provide: NX_NOTIFICATION_PANEL_SCROLL_STRATEGY, useFactory: getFactoryFnByFactoryConfig(config, 'notificationPanel'), deps: [Overlay] },
        ...getExtraProvidersByFactoryConfig(config),
    ];
}
function getFactoryFnByFactoryConfig(config, componentName) {
    return (config.overrides?.[componentName] ?? config).scrollStrategyFactory;
}
function getExtraProvidersByFactoryConfig(config) {
    return Object.entries(config.extraComponents ?? {}).map(([componentName, { scrollStrategyFactory }]) => ({
        provide: getInjectionToken(componentName),
        useFactory: scrollStrategyFactory,
        deps: [Overlay],
    }));
}
function getInjectionToken(componentName) {
    switch (componentName) {
        case 'dialog':
            return NX_MODAL_SCROLL_STRATEGY;
        case 'overlay':
            return NX_OVERLAY_SCROLL_STRATEGY;
        case 'popover':
            return NX_POPOVER_SCROLL_STRATEGY;
        case 'tooltip':
            return NX_TOOLTIP_SCROLL_STRATEGY;
        default:
            throw new Error(`Injection token for ${componentName} scroll strategy not recognized.`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibngtc2Nyb2xsLXN0cmF0ZWd5LmhlbHBlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1hcXVpbGEvc3JjL2NvbmZpZy9ueC1zY3JvbGwtc3RyYXRlZ3kuaGVscGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFrQixNQUFNLHNCQUFzQixDQUFDO0FBRS9ELE9BQU8sRUFBRSwrQkFBK0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ2pGLE9BQU8sRUFBRSwrQkFBK0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ2pGLE9BQU8sRUFBRSw2QkFBNkIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzVFLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ3pFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ25FLE9BQU8sRUFBRSxxQ0FBcUMsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQzdGLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBSXZFLGdGQUFnRjtBQUNoRixNQUFNLFVBQVUsd0JBQXdCLENBQUMsTUFBd0IsRUFBRSxPQUFnQixFQUFFLE9BQWlDO0lBQ2xILFFBQVEsTUFBTSxFQUFFO1FBQ1osS0FBSyxZQUFZO1lBQ2IsT0FBTyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsY0FBYyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsQ0FBQyxDQUFDO1FBQ2pJLEtBQUssT0FBTztZQUNSLE9BQU8sR0FBRyxFQUFFLENB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UztZQUNWLE9BQU8sMEJBQTBCLENBQUM7UUFDdEMsS0FBSyxTQUFTO1lBQ1YsT0FBTywwQkFBMEIsQ0FBQztRQUN0QyxLQUFLLFNBQVM7WUFDVixPQUFPLDBCQUEwQixDQUFDO1FBQ3RDO1lBQ0ksTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUIsYUFBYSxrQ0FBa0MsQ0FBQyxDQUFDO0tBQy9GO0FBQ0wsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE92ZXJsYXksIFNjcm9sbFN0cmF0ZWd5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xuaW1wb3J0IHsgRmFjdG9yeVByb3ZpZGVyLCBJbmplY3Rpb25Ub2tlbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTlhfQVVUT0NPTVBMRVRFX1NDUk9MTF9TVFJBVEVHWSB9IGZyb20gJ0BhcG9zaW4vbmctYXF1aWxhL2F1dG9jb21wbGV0ZSc7XG5pbXBvcnQgeyBOWF9DT05URVhUX01FTlVfU0NST0xMX1NUUkFURUdZIH0gZnJvbSAnQGFwb3Npbi9uZy1hcXVpbGEvY29udGV4dC1tZW51JztcbmltcG9ydCB7IE5YX0RBVEVQSUNLRVJfU0NST0xMX1NUUkFURUdZIH0gZnJvbSAnQGFwb3Npbi9uZy1hcXVpbGEvZGF0ZWZpZWxkJztcbmltcG9ydCB7IE5YX0RST1BET1dOX1NDUk9MTF9TVFJBVEVHWSB9IGZyb20gJ0BhcG9zaW4vbmctYXF1aWxhL2Ryb3Bkb3duJztcbmltcG9ydCB7IE5YX01PREFMX1NDUk9MTF9TVFJBVEVHWSB9IGZyb20gJ0BhcG9zaW4vbmctYXF1aWxhL21vZGFsJztcbmltcG9ydCB7IE5YX05PVElGSUNBVElPTl9QQU5FTF9TQ1JPTExfU1RSQVRFR1kgfSBmcm9tICdAYXBvc2luL25nLWFxdWlsYS9ub3RpZmljYXRpb24tcGFuZWwnO1xuaW1wb3J0IHsgTlhfT1ZFUkxBWV9TQ1JPTExfU1RSQVRFR1kgfSBmcm9tICdAYXBvc2luL25nLWFxdWlsYS9vdmVybGF5JztcbmltcG9ydCB7IE5YX1BPUE9WRVJfU0NST0xMX1NUUkFURUdZIH0gZnJvbSAnQGFwb3Npbi9uZy1hcXVpbGEvcG9wb3Zlcic7XG5pbXBvcnQgeyBOWF9UT09MVElQX1NDUk9MTF9TVFJBVEVHWSB9IGZyb20gJ0BhcG9zaW4vbmctYXF1aWxhL3Rvb2x0aXAnO1xuXG5pbXBvcnQgeyBOeFNjcm9sbFN0cmF0ZWd5LCBOeFNjcm9sbFN0cmF0ZWd5RGVmYXVsdENvbmZpZywgTnhTY3JvbGxTdHJhdGVneUZhY3RvcnlDb25maWcsIE54U2Nyb2xsU3RyYXRlZ3lPcHRpb25zIH0gZnJvbSAnLi9ueC1zY3JvbGwtc3RyYXRlZ3kubW9kZWxzJztcblxuLyoqIFJldHVybiBhbiBhcHByb3ByaWF0ZSBzY3JvbGwgc3RyYXRlZ3kgZmFjdG9yeSBmcm9tIHRoZSBgT3ZlcmxheWAgc2VydmljZS4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRTY3JvbGxTdHJhdGVneUZhY3RvcnkocHJlc2V0OiBOeFNjcm9sbFN0cmF0ZWd5LCBvdmVybGF5OiBPdmVybGF5LCBvcHRpb25zPzogTnhTY3JvbGxTdHJhdGVneU9wdGlvbnMpOiAoKSA9PiBTY3JvbGxTdHJhdGVneSB7XG4gICAgc3dpdGNoIChwcmVzZXQpIHtcbiAgICAgICAgY2FzZSAncmVwb3NpdGlvbic6XG4gICAgICAgICAgICByZXR1cm4gKCkgPT4gb3ZlcmxheS5zY3JvbGxTdHJhdGVnaWVzLnJlcG9zaXRpb24oeyBhdXRvQ2xvc2U6IG9wdGlvbnM/LmF1dG9DbG9zZSwgc2Nyb2xsVGhyb3R0bGU6IG9wdGlvbnM/LnNjcm9sbFRocm90dGxlIH0pO1xuICAgICAgICBjYXNlICdjbG9zZSc6XG4gICAgICAgICAgICByZXR1cm4gKCkgPT4gb3ZlcmxheS5zY3JvbGxTdHJhdGVnaWVzLmNsb3NlKHsgdGhyZXNob2xkOiBvcHRpb25zPy50aHJlc2hvbGQgfSk7XG4gICAgICAgIGNhc2UgJ2Jsb2NrJzpcbiAgICAgICAgICAgIHJldHVybiBvdmVybGF5LnNjcm9sbFN0cmF0ZWdpZXMuYmxvY2s7XG4gICAgICAgIGNhc2UgJ25vb3AnOlxuICAgICAgICAgICAgcmV0dXJuIG92ZXJsYXkuc2Nyb2xsU3RyYXRlZ2llcy5ub29wO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIG92ZXJsYXkuc2Nyb2xsU3RyYXRlZ2llcy5yZXBvc2l0aW9uO1xuICAgIH1cbn1cblxuLyoqIFJldHVybiBhbiBhcnJheSBvZiBzY3JvbGwgc3RyYXRlZ3kgcHJvdmlkZXJzIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBkZWZhdWx0IGNvbmZpZy4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRTY3JvbGxTdHJhdGVneURlZmF1bHRQcm92aWRlcnMoY29uZmlnOiBOeFNjcm9sbFN0cmF0ZWd5RGVmYXVsdENvbmZpZyk6IEZhY3RvcnlQcm92aWRlcltdIHtcbiAgICByZXR1cm4gW1xuICAgICAgICB7IHByb3ZpZGU6IE5YX0FVVE9DT01QTEVURV9TQ1JPTExfU1RSQVRFR1ksIHVzZUZhY3Rvcnk6IGdldEZhY3RvcnlGbkJ5RGVmYXVsdENvbmZpZyhjb25maWcsICdhdXRvY29tcGxldGUnKSwgZGVwczogW092ZXJsYXldIH0sXG4gICAgICAgIHsgcHJvdmlkZTogTlhfQ09OVEVYVF9NRU5VX1NDUk9MTF9TVFJBVEVHWSwgdXNlRmFjdG9yeTogZ2V0RmFjdG9yeUZuQnlEZWZhdWx0Q29uZmlnKGNvbmZpZywgJ2NvbnRleHRNZW51JyksIGRlcHM6IFtPdmVybGF5XSB9LFxuICAgICAgICB7IHByb3ZpZGU6IE5YX0RBVEVQSUNLRVJfU0NST0xMX1NUUkFURUdZLCB1c2VGYWN0b3J5OiBnZXRGYWN0b3J5Rm5CeURlZmF1bHRDb25maWcoY29uZmlnLCAnZGF0ZXBpY2tlcicpLCBkZXBzOiBbT3ZlcmxheV0gfSxcbiAgICAgICAgeyBwcm92aWRlOiBOWF9EUk9QRE9XTl9TQ1JPTExfU1RSQVRFR1ksIHVzZUZhY3Rvcnk6IGdldEZhY3RvcnlGbkJ5RGVmYXVsdENvbmZpZyhjb25maWcsICdkcm9wZG93bicpLCBkZXBzOiBbT3ZlcmxheV0gfSxcbiAgICAgICAgeyBwcm92aWRlOiBOWF9OT1RJRklDQVRJT05fUEFORUxfU0NST0xMX1NUUkFURUdZLCB1c2VGYWN0b3J5OiBnZXRGYWN0b3J5Rm5CeURlZmF1bHRDb25maWcoY29uZmlnLCAnbm90aWZpY2F0aW9uUGFuZWwnKSwgZGVwczogW092ZXJsYXldIH0sXG4gICAgICAgIC4uLmdldEV4dHJhUHJvdmlkZXJzQnlEZWZhdWx0Q29uZmlnKGNvbmZpZyksXG4gICAgXTtcbn1cblxuZnVuY3Rpb24gZ2V0RmFjdG9yeUZuQnlEZWZhdWx0Q29uZmlnKFxuICAgIGNvbmZpZzogTnhTY3JvbGxTdHJhdGVneURlZmF1bHRDb25maWcsXG4gICAgY29tcG9uZW50TmFtZToga2V5b2YgKE54U2Nyb2xsU3RyYXRlZ3lEZWZhdWx0Q29uZmlnWydvdmVycmlkZXMnXSAmIFJlY29yZDxuZXZlciwgbmV2ZXI+KSxcbik6IChvdmVybGF5OiBPdmVybGF5KSA9PiAoKSA9PiBTY3JvbGxTdHJhdGVneSB7XG4gICAgY29uc3QgY29tcG9uZW50Q29uZmlnID0gY29uZmlnLm92ZXJyaWRlcz8uW2NvbXBvbmVudE5hbWVdID8/IGNvbmZpZztcbiAgICByZXR1cm4gKG92ZXJsYXk6IE92ZXJsYXkpID0+IGdldFNjcm9sbFN0cmF0ZWd5RmFjdG9yeShjb21wb25lbnRDb25maWcuc2Nyb2xsU3RyYXRlZ3ksIG92ZXJsYXksIGNvbXBvbmVudENvbmZpZy5zY3JvbGxTdHJhdGVneU9wdGlvbnMpO1xufVxuXG5mdW5jdGlvbiBnZXRFeHRyYVByb3ZpZGVyc0J5RGVmYXVsdENvbmZpZyhjb25maWc6IE54U2Nyb2xsU3RyYXRlZ3lEZWZhdWx0Q29uZmlnKTogRmFjdG9yeVByb3ZpZGVyW10ge1xuICAgIHJldHVybiBPYmplY3QuZW50cmllcyhjb25maWcuZXh0cmFDb21wb25lbnRzID8/IHt9KS5tYXAoKFtjb21wb25lbnROYW1lLCB7IHNjcm9sbFN0cmF0ZWd5LCBzY3JvbGxTdHJhdGVneU9wdGlvbnMgfV0pID0+ICh7XG4gICAgICAgIHByb3ZpZGU6IGdldEluamVjdGlvblRva2VuKGNvbXBvbmVudE5hbWUpLFxuICAgICAgICB1c2VGYWN0b3J5OiAob3ZlcmxheTogT3ZlcmxheSkgPT4gZ2V0U2Nyb2xsU3RyYXRlZ3lGYWN0b3J5KHNjcm9sbFN0cmF0ZWd5LCBvdmVybGF5LCBzY3JvbGxTdHJhdGVneU9wdGlvbnMpLFxuICAgICAgICBkZXBzOiBbT3ZlcmxheV0sXG4gICAgfSkpO1xufVxuXG4vKiogUmV0dXJuIGFuIGFycmF5IG9mIHNjcm9sbCBzdHJhdGVneSBwcm92aWRlcnMgYmFzZWQgb24gdGhlIHByb3ZpZGVkIGZhY3RvcnkgY29uZmlnLiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNjcm9sbFN0cmF0ZWd5RmFjdG9yeVByb3ZpZGVycyhjb25maWc6IE54U2Nyb2xsU3RyYXRlZ3lGYWN0b3J5Q29uZmlnKTogRmFjdG9yeVByb3ZpZGVyW10ge1xuICAgIHJldHVybiBbXG4gICAgICAgIHsgcHJvdmlkZTogTlhfQVVUT0NPTVBMRVRFX1NDUk9MTF9TVFJBVEVHWSwgdXNlRmFjdG9yeTogZ2V0RmFjdG9yeUZuQnlGYWN0b3J5Q29uZmlnKGNvbmZpZywgJ2F1dG9jb21wbGV0ZScpLCBkZXBzOiBbT3ZlcmxheV0gfSxcbiAgICAgICAgeyBwcm92aWRlOiBOWF9DT05URVhUX01FTlVfU0NST0xMX1NUUkFURUdZLCB1c2VGYWN0b3J5OiBnZXRGYWN0b3J5Rm5CeUZhY3RvcnlDb25maWcoY29uZmlnLCAnY29udGV4dE1lbnUnKSwgZGVwczogW092ZXJsYXldIH0sXG4gICAgICAgIHsgcHJvdmlkZTogTlhfREFURVBJQ0tFUl9TQ1JPTExfU1RSQVRFR1ksIHVzZUZhY3Rvcnk6IGdldEZhY3RvcnlGbkJ5RmFjdG9yeUNvbmZpZyhjb25maWcsICdkYXRlcGlja2VyJyksIGRlcHM6IFtPdmVybGF5XSB9LFxuICAgICAgICB7IHByb3ZpZGU6IE5YX0RST1BET1dOX1NDUk9MTF9TVFJBVEVHWSwgdXNlRmFjdG9yeTogZ2V0RmFjdG9yeUZuQnlGYWN0b3J5Q29uZmlnKGNvbmZpZywgJ2Ryb3Bkb3duJyksIGRlcHM6IFtPdmVybGF5XSB9LFxuICAgICAgICB7IHByb3ZpZGU6IE5YX05PVElGSUNBVElPTl9QQU5FTF9TQ1JPTExfU1RSQVRFR1ksIHVzZUZhY3Rvcnk6IGdldEZhY3RvcnlGbkJ5RmFjdG9yeUNvbmZpZyhjb25maWcsICdub3RpZmljYXRpb25QYW5lbCcpLCBkZXBzOiBbT3ZlcmxheV0gfSxcbiAgICAgICAgLi4uZ2V0RXh0cmFQcm92aWRlcnNCeUZhY3RvcnlDb25maWcoY29uZmlnKSxcbiAgICBdO1xufVxuXG5mdW5jdGlvbiBnZXRGYWN0b3J5Rm5CeUZhY3RvcnlDb25maWcoXG4gICAgY29uZmlnOiBOeFNjcm9sbFN0cmF0ZWd5RmFjdG9yeUNvbmZpZyxcbiAgICBjb21wb25lbnROYW1lOiBrZXlvZiAoTnhTY3JvbGxTdHJhdGVneURlZmF1bHRDb25maWdbJ292ZXJyaWRlcyddICYgUmVjb3JkPG5ldmVyLCBuZXZlcj4pLFxuKTogKG92ZXJsYXk6IE92ZXJsYXkpID0+ICgpID0+IFNjcm9sbFN0cmF0ZWd5IHtcbiAgICByZXR1cm4gKGNvbmZpZy5vdmVycmlkZXM/Lltjb21wb25lbnROYW1lXSA/PyBjb25maWcpLnNjcm9sbFN0cmF0ZWd5RmFjdG9yeTtcbn1cblxuZnVuY3Rpb24gZ2V0RXh0cmFQcm92aWRlcnNCeUZhY3RvcnlDb25maWcoY29uZmlnOiBOeFNjcm9sbFN0cmF0ZWd5RmFjdG9yeUNvbmZpZyk6IEZhY3RvcnlQcm92aWRlcltdIHtcbiAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMoY29uZmlnLmV4dHJhQ29tcG9uZW50cyA/PyB7fSkubWFwKChbY29tcG9uZW50TmFtZSwgeyBzY3JvbGxTdHJhdGVneUZhY3RvcnkgfV0pID0+ICh7XG4gICAgICAgIHByb3ZpZGU6IGdldEluamVjdGlvblRva2VuKGNvbXBvbmVudE5hbWUpLFxuICAgICAgICB1c2VGYWN0b3J5OiBzY3JvbGxTdHJhdGVneUZhY3RvcnksXG4gICAgICAgIGRlcHM6IFtPdmVybGF5XSxcbiAgICB9KSk7XG59XG5cbmZ1bmN0aW9uIGdldEluamVjdGlvblRva2VuKGNvbXBvbmVudE5hbWU6IHN0cmluZyk6IEluamVjdGlvblRva2VuPCgpID0+IFNjcm9sbFN0cmF0ZWd5PiB7XG4gICAgc3dpdGNoIChjb21wb25lbnROYW1lKSB7XG4gICAgICAgIGNhc2UgJ2RpYWxvZyc6XG4gICAgICAgICAgICByZXR1cm4gTlhfTU9EQUxfU0NST0xMX1NUUkFURUdZO1xuICAgICAgICBjYXNlICdvdmVybGF5JzpcbiAgICAgICAgICAgIHJldHVybiBOWF9PVkVSTEFZX1NDUk9MTF9TVFJBVEVHWTtcbiAgICAgICAgY2FzZSAncG9wb3Zlcic6XG4gICAgICAgICAgICByZXR1cm4gTlhfUE9QT1ZFUl9TQ1JPTExfU1RSQVRFR1k7XG4gICAgICAgIGNhc2UgJ3Rvb2x0aXAnOlxuICAgICAgICAgICAgcmV0dXJuIE5YX1RPT0xUSVBfU0NST0xMX1NUUkFURUdZO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbmplY3Rpb24gdG9rZW4gZm9yICR7Y29tcG9uZW50TmFtZX0gc2Nyb2xsIHN0cmF0ZWd5IG5vdCByZWNvZ25pemVkLmApO1xuICAgIH1cbn1cbiJdfQ==